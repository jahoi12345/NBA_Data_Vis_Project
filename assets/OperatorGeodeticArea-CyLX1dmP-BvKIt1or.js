import{P as xt,F as yt,B as Rt,p as Mt,R as ft,aV as Gt,o as Ct,k as Y,f as S,av as Q,W as zt,Y as dt,b3 as L,bd as G,S as ot,_ as Tt,a2 as N,C as Et}from"./Point2D-CMz7woHH-BVbGGL7p.js";import{u as wt,m as ut,R as pt,E as mt,N as Dt,Q as W,Z as kt,I as lt,al as et,am as Ot,S as it,U as st,V as qt,a0 as y,$ as x,an as Pt,ao as ct,ap as M,x as R,aq as O,ar as St,as as Z,C as Lt,X as Nt,Y as bt}from"./ProjectionTransformation-PJc9H7Gq-Rbz84pUM.js";import{Envelope2D as b}from"./Envelope2D-mFnl8dXR-MYac-bfa.js";import{u as Ft}from"./OperatorShapePreservingLength-CNZ8HKmB-C5pkSoFs.js";import{bS as F,bT as nt}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{Z as at}from"./Transformation2D-CrydmBdC-D4jE8w-_.js";import{R as Yt}from"./GeodeticDistanceCalculator-Ce-woMPw-DXSu93kl-Ox6Pbk0h.js";import"./SimpleGeometryCursor-B92kdZ15-B1Z6elF7.js";import"./OperatorDefinitions-DP7_WWTp-DP7_WWTp.js";import"./Distance2DCalculator-CXhBP-8I-BMMI87Nn--mnz8rUK.js";import"./OperatorGeodeticDensifyByLength-C8tLqGwm-uxZ15ltN.js";class Jt{constructor(t,n,i,s,a=100){this.m_startPt=t.clone(),this.m_endPt=n.clone(),this.m_cE2=s,this.m_cE=Math.sqrt(this.m_cE2),this.m_c1By2e=1/(2*this.m_cE),this.m_cRpu=i.getGCS().getUnit().getUnitToBaseFactor(),this.isPcs=i.getCoordinateSystemType()===2,this.PEProjcs=i.getPECoordSys(),this.m_points=Ct(2*a,Number.NaN)}setSegmentEndPoints(t,n){this.m_startPt.assign(t),this.m_endPt.assign(n)}makeFunctor(){return t=>{const n=[0,0];n[0]=this.m_startPt.x*(1-t)+this.m_endPt.x*t,n[1]=this.m_startPt.y*(1-t)+this.m_endPt.y*t,this.isPcs&&qt.projToGeogCenter(this.PEProjcs,1,n,0);const i=Math.sin(n[1]*this.m_cRpu);return this.m_cE2===0?i:-Math.log((1-this.m_cE*i)/(1+this.m_cE*i))*this.m_c1By2e+i/(1-this.m_cE2*i*i)}}}function Ut(p,t,n){const i=new b;p.queryEnvelope(i);const s=Lt(t,i,!0).total(),a=t.getPannableExtent();a.xmin=i.xmin-10*s,a.xmax=i.xmax+10*s;const e=new Nt().execute(p,a,t,n).getImpl().querySegmentIterator();e.stripAttributes();const _=lt();t.querySpheroidData(_);const r=_.e2,o=r===0?2:1,l=new S(0,0),h=new S(0,0),m=new Y(0),u=new Jt(l,h,t,r,100);for(;e.nextPath();)for(;e.hasNextSegment();){const g=e.nextSegment();l.assign(g.getStartXY()),h.assign(g.getEndXY()),u.setSegmentEndPoints(l,h);const A=Z(6,0,1,1e-12,1e-15,u.makeFunctor());m.pe((h.x-l.x)*A)}const c=_.majorSemiAxis;return o*c*c*(1-r)*Math.PI*m.getResult()/t.getPannableExtent().width()}function Xt(p,t,n,i,s){const a=Vt(p,t,s);let e=At(p,a.first,n,i,s),_=1,r=0,o=0;do{if(_++,a.first*=.5,a.first<50*t.getTolerance(0))return e;a.second*=2,o=At(p,a.first,n,i,s),r=Math.abs(o-e),e=o}while(Math.abs(e)>1&&r>1e-8*Math.abs(e)&&(a.second<65e3&&_<8||_<4));return o}function At(p,t,n,i,s){const a=new ut().execute(p,t,0,0,s);let e;e=i?new W().execute(a,i,s):a;const _=n.getUnit().getUnitToBaseFactor()===1?Math.PI/180:1,r=new b;e.queryEnvelope(r);const o=new b,l=new b,h=new b;o.setCoords({xmin:r.xmin,ymin:75*_,xmax:r.xmax,ymax:90*_}),l.setCoords({xmin:r.xmin,ymin:-60*_,xmax:r.xmax,ymax:75*_}),h.setCoords({xmin:r.xmin,ymin:-90*_,xmax:r.xmax,ymax:-60*_}),o.inflateCoords(.01*o.width(),0),l.inflateCoords(.01*l.width(),0),h.inflateCoords(.01*h.width(),0);let m=0;return m+=_t(e,o,n,s),m+=_t(e,l,n,s),m+=_t(e,h,n,s),m}function _t(p,t,n,i){const s=new Nt().execute(p,t,n,i);if(s!==null&&!s.isEmpty()){const a=new b;s.queryEnvelope(a);const{first:e,second:_}=Ht(n,a,!1),r=pt(n,e,null),o=new W().execute(s,r,i).calculateArea2D();return _&&e.destroy(),o}return 0}const j=[null,null,null,null,null,null,null];function Bt(p,t,n){const i=p.getUnit().getUnitToBaseFactor(),s=t.getCenter();s.scale(180*i/Math.PI);const a=new S;a.x=0,a.y=0;let e=0;if(e===0){s.y>45?(a.y=N,e=0):s.y<-45?(a.y=-N,e=1):s.x>=45&&s.x<135?(a.x=N,e=2):s.x>=135||s.x<-135?(a.x=N,e=3):s.x<-45&&s.x>=-135?(a.x=-N,e=4):(a.x=0,e=5);const P=i*Math.sqrt(Et(t.xmin-t.xmax)+Et(t.ymin-t.ymax)),f=a.clone(),d=t.getCenter();if(d.scale(i),e<2&&(f.x=d.x),S.distance(f,d)+.5*P>N)return null}const _=j[e];if(_!==null&&_.getGCS().equalHorizontal(p))return _;const r=p.getText(),o=a.x,l=a.y,h=0,m=0;let u=0,c=-1;e!==6?c=M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:(Mt(n),u=0,c=M.PE_PRJ_CYLINDRICAL_EQAREA);const g=ct("EqualAreaPCS");let A;c===M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?A=`PROJCS["${g}",${r},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${h}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${o}],PARAMETER["Latitude_of_Origin",${l}],UNIT["Meter",1.0]]`:c===M.PE_PRJ_CYLINDRICAL_EQAREA?A=`PROJCS["${g}",${r},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${h}],PARAMETER["False_Northing",${m}],PARAMETER["Central_Meridian",${o}],PARAMETER["Standard_Parallel_1",${u}],PARAMETER["Latitude_of_Origin",${l}],UNIT["Meter",1.0]]`:Tt("getEqualAreaPcsFixed");const E=bt(A);return j[e]&&j[e].destroy(),j[e]=E,E}function Ht(p,t,n){const i=Bt(p,t,n);if(i!==null)return ot(i,!1);const s=p.getText(),a=p.getUnit().getUnitToBaseFactor(),e=(t.xmin+t.width()/2)*a,_=(t.ymin+t.height()/2)*a,r=0,o=0;let l=0,h=0,m=-1;t.ymin*a>=75*Math.PI/180||t.ymax*a<=-60*Math.PI/180?m=M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:t.ymin>0||t.ymax<0?(l=(t.ymin+1/3*t.height())*a,h=(t.ymin+2/3*t.height())*a,m=M.PE_PRJ_ALBERS):(l=(t.ymin+2/3*t.height())*a,m=M.PE_PRJ_CYLINDRICAL_EQAREA);const u=ct("EqualAreaPCS");let c;return m===M.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?c=`PROJCS["${u}",${s},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${o}],PARAMETER["Central_Meridian",${e}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:m===M.PE_PRJ_ALBERS?c=`PROJCS["${u}",${s},PROJECTION["Albers"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${o}],PARAMETER["Central_Meridian",${e}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Standard_Parallel_2",${h}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:m===M.PE_PRJ_CYLINDRICAL_EQAREA?c=`PROJCS["${u}",${s},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",${r}],PARAMETER["False_Northing",${o}],PARAMETER["Central_Meridian",${e}],PARAMETER["Standard_Parallel_1",${l}],PARAMETER["Latitude_of_Origin",${_}],UNIT["Meter",1.0]]`:Tt("getEqualAreaPCSInstance"),ot(bt(c),!0)}function Vt(p,t,n){const i=p.calculateLength2D(),s=new Ft().execute(p,t,n)/25e3,a=i/p.getSegmentCount()*2;let e=Math.min(a,i/s);return e===0&&(e=1),ot(e,i/e)}class Qt{getOperatorType(){return 10314}supportsCurves(){return!0}accelerateGeometry(t,n,i){return!1}canAccelerateGeometry(t){return!1}execute(t,n,i){if(n.getCoordinateSystemType()===0&&yt(""),t.isEmpty()||t.getDimension()<2)return 0;if(xt(t),t.getGeometryType()===Rt.enumEnvelope){const o=new wt;return o.addEnvelope(t,!1),this.execute(o,n,i)}let s=t;t.getDescription().getAttributeCount()>1&&(s=t.clone(),s.dropAllAttributes());const a=new ut().execute(s,0,n.getTolerance(0),0,i);let e=null;const _=n.getGCS();_!==n&&(e=pt(n,_));let r=new mt().execute(a,n,!1,i);return r.isEmpty()?0:(r===t&&(r=t.clone()),n.isPannable()?Ut(r,n,i):Xt(r,n,_,e,i))}}function rt(){return{m_p_PCS:new S,m_factor:Number.NaN,setValues:jt,assign:Zt}}function jt(p,t){this.m_factor=p,this.m_p_PCS.assign(t)}function Zt(p){this.m_factor=p.m_factor,this.m_p_PCS.assign(p.m_p_PCS)}class Wt{constructor(t,n,i,s){this.m_ptStart=new x,this.m_ptEnd=new x,this.m_ptStart.assign(n),this.m_ptEnd.assign(i),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y,this.m_e=Math.sqrt(t),this.m_e2=t,this.m_c1MinusE2=1-t;const a=Math.sin(s);let e;e=this.m_e2===0?2*a:a*(L(this.m_e*a)+1/(1-this.m_e2*a*a)),this.m_baseA=e}setSegmentEndPoints(t,n){this.m_ptStart.assign(t),this.m_ptEnd.assign(n),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y}makeFunctor(){return t=>{const n=1-t,i=n*this.m_ptStart.x+t*this.m_ptEnd.x,s=n*this.m_ptStart.y+t*this.m_ptEnd.y,a=n*this.m_ptStart.z+t*this.m_ptEnd.z,e=i*i+s*s,_=a/Math.sqrt(a*a+this.m_c1MinusE2*this.m_c1MinusE2*e);let r;return this.m_e2===0?r=2*_:r=_*(L(this.m_e*_)+1/(1-this.m_e2*_*_)),(this.m_deltaY*i-this.m_deltaX*s)/e*(r-this.m_baseA)}}}function Kt(){return{e:Number.NaN,one_p_e:Number.NaN,one_m_e:Number.NaN,one_m_e_2:Number.NaN,atanh_e_over_e:Number.NaN,half_qp:Number.NaN,f:Number.NaN,z:Number.NaN}}function ht(){return{sin_phi:Number.NaN,one_p_sin_phi:Number.NaN,one_m_sin_phi:Number.NaN,one_m_e_2_sin_2_phi:Number.NaN,sin_half_phi_pf:Number.NaN,sin_half_phi_pz:Number.NaN,sin_half_asin_e_sin_phi_pf:Number.NaN,sin_half_asin_e_sin_phi_pz:Number.NaN,atanh_sin_phi:Number.NaN,atanh_esin_phi:Number.NaN,make_negative:!1,initialize:te,changeSign:ee,assign:ie,clone:se}}function te(p,t,n,i){const s=.5*p;this.sin_phi=Math.sin(p);const a=t*this.sin_phi,e=.5*Math.asin(a);this.one_p_sin_phi=1+this.sin_phi,this.one_m_sin_phi=1-this.sin_phi,this.one_m_e_2_sin_2_phi=(1+a)*(1-a),this.sin_half_phi_pf=Math.sin(s+n),this.sin_half_phi_pz=Math.sin(s+i),this.sin_half_asin_e_sin_phi_pf=Math.sin(e+n),this.sin_half_asin_e_sin_phi_pz=Math.sin(e+i),this.atanh_sin_phi=Math.log(this.sin_half_phi_pf/this.sin_half_phi_pz),this.atanh_esin_phi=Math.log(this.sin_half_asin_e_sin_phi_pf/this.sin_half_asin_e_sin_phi_pz)}function ee(){this.sin_phi=-this.sin_phi;let p=this.one_p_sin_phi;this.one_p_sin_phi=this.one_m_sin_phi,this.one_m_sin_phi=p,p=this.sin_half_phi_pf,this.sin_half_phi_pf=this.sin_half_phi_pz,this.sin_half_phi_pz=p,p=this.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pf=this.sin_half_asin_e_sin_phi_pz,this.sin_half_asin_e_sin_phi_pz=p,this.atanh_sin_phi=-this.atanh_sin_phi,this.atanh_esin_phi=-this.atanh_esin_phi}function ie(p){this.sin_phi=p.sin_phi,this.one_p_sin_phi=p.one_p_sin_phi,this.one_m_sin_phi=p.one_m_sin_phi,this.one_m_e_2_sin_2_phi=p.one_m_e_2_sin_2_phi,this.sin_half_phi_pf=p.sin_half_phi_pf,this.sin_half_phi_pz=p.sin_half_phi_pz,this.sin_half_asin_e_sin_phi_pf=p.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pz=p.sin_half_asin_e_sin_phi_pz,this.atanh_sin_phi=p.atanh_sin_phi,this.atanh_esin_phi=p.atanh_esin_phi,this.make_negative=p.make_negative}function se(){return{...this}}class ne{constructor(t,n,i){this.m_transformPCS2GCS=null,this.m_scaleToRadians=new at,this.m_scaleToDegrees=new at,this.m_progressTracker=i,Mt(n!==4),this.m_curveType=n,this.m_inputSR=t,t&&t.getCoordinateSystemType()!==0||yt(""),this.m_inputGCS=t.getGCS(),this.m_a=0,this.m_eSquared=0,this.m_b=0,this.m_rpu=0}executePolygonGeodeticArea(t){let n,i=t.clone();if(i.dropAllAttributes(),t.hasNonLinearSegments()&&(i=new ut().execute(i,0,this.m_inputSR.getTolerance(0),0,this.m_progressTracker)),this.m_inputSR.isPannable()){const e=new b;i.queryEnvelope(e);const _=this.m_inputSR.getPannableExtent();if(!_.containsEnvelope(e)){const r=_.getCenterX()-e.getCenterX(),o=new at;o.setShiftCoords(r,0),i.applyTransformation(o),e.move(r,0);const l=new ft;_.queryIntervalX(l);const h=new ft;e.queryIntervalX(h),i=l.contains(h)?Dt(i,this.m_inputSR):new W().foldInto360RangeGeodetic(i,this.m_inputSR,this.m_curveType)}}if(this.m_transformPCS2GCS?(i=new mt().execute(i,this.m_inputSR,!1,this.m_progressTracker),n=i.createInstance(),kt(this.m_transformPCS2GCS,i,n,this.m_progressTracker)||(n=new W().execute(i,this.m_transformPCS2GCS,this.m_progressTracker))):n=new mt().execute(i,this.m_inputGCS,!1,this.m_progressTracker),n.isEmpty())return 0;if(this.m_curveType===1){const e=lt();return this.m_inputGCS.querySpheroidData(e),this.m_a=e.majorSemiAxis,this.m_eSquared=e.e2,this.loxodromeArea(n)}const s=n.getImpl();this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_scaleToRadians.setScale(this.m_rpu),s.applyTransformation(this.m_scaleToRadians),this.m_scaleToDegrees=this.m_scaleToRadians,this.m_scaleToDegrees.invertThis();const a=lt();if(this.m_inputGCS.querySpheroidData(a),this.m_a=a.majorSemiAxis,this.m_b=a.minorSemiAxis,this.m_eSquared=a.e2,this.m_curveType===2)return this.executeClippedPolygonGreatEllipticArea(n);{const e={stack:[],error:void 0,hasError:!1};try{const _=et.unit(9101),r=this.m_inputGCS.getPECoordSys(),o=F(e,r.cloneAlterUnits(_),!1);let l,h,m=this.executeClippedPolygonGeodeticArea(n,o,0),u=0;do u++,l=this.executeClippedPolygonGeodeticArea(n,o,u),h=Math.abs(l-m),m=l;while(Math.abs(l)>1&&h>1e-8*Math.abs(l)&&u<7);return l}catch(_){e.error=_,e.hasError=!0}finally{nt(e)}}}executeClippedPolygonGeodeticArea(t,n,i){const s={stack:[],error:void 0,hasError:!1};try{const a=new b;t.queryEnvelope(a);const e=F(s,this.getEqualAreaPCSInstance(n,a),!1),_=t.clone();Ot(e,_);const r=50,o=_.getImpl().getAttributeStreamRef(0),l=t.getImpl().getAttributeStreamRef(0),h=F(s,new it,!1),m=F(s,new it,!1),u=40,c=[0,0],g=Gt(rt,u),A=Ct(u,-1),E=rt(),P=rt();let f,d;const I=e;let T=_.calculateArea2D();const w=new Y(0),z=.5*Math.PI,J=1e-10*Math.abs(T)+1e-6,K=t.getPathCount();let D,k,v,q;const C=new S,$=new S,U=new S,X=new S,B=new S,H=new S;let gt,tt;for(k=t.getPathStart(0),D=0;D<K;D++,k=v)for(v=t.getPathEnd(D),o.queryPoint2D(v-1<<1,U),l.queryPoint2D(v-1<<1,C),Math.abs(C.y)>z&&(C.y=Q(z,C.y)),q=k;q<v;q++,U.assign(X),C.assign($)){if(o.queryPoint2D(q<<1,X),l.queryPoint2D(q<<1,$),Math.abs($.y)>z&&($.y=Q(z,$.y)),gt=S.distance(U,X),gt<r||C.y===0&&$.y===0)continue;st.geodeticDistance(this.m_a,this.m_eSquared,C.x,C.y,$.x,$.y,h,m,null,this.m_curveType);const It=h.val,vt=m.val;for(E.setValues(0,U),P.setValues(1,X),d=i,g[0].assign(P),A[0]=i,f=0;f>=0;){tt=.5*(E.m_factor+P.m_factor),st.geodeticCoordinate(this.m_a,this.m_eSquared,C.x,C.y,It*tt,vt,h,m,this.m_curveType),B.x=h.val,B.y=m.val,c[0]=B.x,c[1]=B.y,qt.geogToProj(I,1,c),H.x=c[0],H.y=c[1];const $t=-H.offset(E.m_p_PCS,P.m_p_PCS),V=.5*$t*S.distance(E.m_p_PCS,P.m_p_PCS);if(w.pe(V),Math.abs(V)>J||Math.abs(V)>0&&d>0)P.setValues(tt,H),f++,g[f].assign(P),Math.abs(V)<=J?(d--,A[f-1]=d,A[f]=d):(d=A[f-1],A[f]=d);else{if(f<=0)break;E.assign(P),f--,P.assign(g[f]),d=A[f]}}}return T+=w.getResult(),Math.abs(T)}catch(a){s.error=a,s.hasError=!0}finally{nt(s)}}executeClippedPolygonGreatEllipticArea(t){const n=[],i=[],s=new S,a=new S,e=y(1,this.m_eSquared,new S(0,.5*Math.PI)),_=new Y(0),r=new Y(0),o=new Y(0),l=new x,h=new x,m=new b;t.queryLooseEnvelope(m);let u=0;m.containsCoords(m.xmin,0)||(u=Math.abs(m.ymin)<Math.abs(m.ymax)?m.ymin:m.ymax);const c=new Wt(this.m_eSquared,l,h,u),g=this.m_a*this.m_a,A=t.getImpl().querySegmentIterator();for(A.stripAttributes();A.nextPath();)for(;A.hasNextSegment();){const E=A.nextSegment();s.assign(E.getStartXY()),a.assign(E.getEndXY()),a.x-s.x>Math.PI?s.x+=2*Math.PI:a.x-s.x<-Math.PI&&(a.x+=2*Math.PI),this.splitSegmentCrossingItegralThreshold(E,n,i);for(let P of n)l.assign(y(this.m_a,this.m_eSquared,P.getStartXY())),h.assign(y(this.m_a,this.m_eSquared,P.getEndXY())),c.setSegmentEndPoints(l,h),this.adaptiveIntegrationWithRomberg(c,_);for(let P of i){let f=P.getStartXY(),d=P.getEndXY(),I=u;f.y<0&&(d=zt(f,f=d),f.y=-f.y,d.y=-d.y,I=-I);const T=y(1,this.m_eSquared,f),w=y(1,this.m_eSquared,d),z=Math.min(f.y,d.y),J=Pt(this.m_eSquared,f.x,d.x,I,z);r.pe(J);const K=Math.abs(Pt(this.m_eSquared,f.x,d.x,z,N)),D=new x;D.setSub(T,e);const k=new x;k.setSub(w,e);const v=new x;v.setCrossProductVector(D,k);let q=g*(K-.5*v.length());q=Q(q,d.x-f.x),o.pe(q)}n.length=0,i.length=0}return o.getResult()+g*(.5*(1-this.m_eSquared)*_.getResult()+r.getResult())}getEqualAreaPCSInstance(t,n){const i=n.getCenterX(),s=0,a=0;let e,_;const r=n.height();let o,l;(o=n.ymin>45*Math.PI/180||n.ymax<45*-Math.PI/180)?e=Q(.5*Math.PI,n.getCenterY()):(e=n.getCenterY(),_=n.ymin+r*(2/3));const h=ct("EqualAreaPCS"),m=t.toString();return l=o?et.fromString(M.PE_TYPE_PROJCS,`PROJCS["${h}", ${m}, PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",${s}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${i}], PARAMETER["Latitude_of_Origin", ${e}], UNIT["Meter",1.0]]`):et.fromString(M.PE_TYPE_PROJCS,`PROJCS["${h}", ${m}, PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting", ${s}],PARAMETER["False_Northing", ${a}],PARAMETER["Central_Meridian", ${i}],PARAMETER["Standard_Parallel_1", ${_}],PARAMETER["Latitude_of_Origin", ${e}],UNIT["Meter",1.0]]`),l}splitSegmentCrossingItegralThreshold(t,n,i){const s=y(this.m_a,this.m_eSquared,new S(0,N)),a=y(this.m_a,this.m_eSquared,new S(0,-N)),e=this.splitSegmentPassingThroughPole(t);for(let _ of e){const r=_.getStartXY(),o=_.getEndXY(),l=y(this.m_a,this.m_eSquared,r),h=y(this.m_a,this.m_eSquared,o),m=new S,u=new x;let c=x.sqrDistance(s,l),g=x.sqrDistance(l,h);if(c<=100){if(!(g>400)){i.push(new R({start:r,end:o}));continue}u.assign(h.sub(l)),u.normalizeThis(),u.assign(l.add(u.mul(20))),m.assign(O(this.m_a,this.m_eSquared,u)),i.push(new R({start:r,end:m})),r.assign(m)}if(l.assign(y(this.m_a,this.m_eSquared,r)),c=x.sqrDistance(s,h),g=x.sqrDistance(l,h),c<=100){if(!(g>400)){i.push(new R({start:r,end:o}));continue}u.assign(h.sub(l)),u.normalizeThis(),u.assign(h.sub(u.mul(20))),m.assign(O(this.m_a,this.m_eSquared,u)),i.push(new R({start:m,end:o})),o.assign(m)}if(l.assign(y(this.m_a,this.m_eSquared,r)),h.assign(y(this.m_a,this.m_eSquared,o)),c=x.sqrDistance(a,l),g=x.sqrDistance(l,h),c<=100){if(!(g>400)){i.push(new R({start:r,end:o}));continue}u.assign(h.sub(l)),u.normalizeThis(),u.assign(l.add(u.mul(20))),m.assign(O(this.m_a,this.m_eSquared,u)),i.push(new R({start:r,end:m})),r.assign(m)}if(l.assign(y(this.m_a,this.m_eSquared,r)),h.assign(y(this.m_a,this.m_eSquared,o)),c=x.sqrDistance(a,h),g=x.sqrDistance(l,h),c<=100){if(!(g>400)){i.push(new R({start:r,end:o}));continue}u.assign(h.sub(l)),u.normalizeThis(),u.assign(h.sub(u.mul(20))),m.assign(O(this.m_a,this.m_eSquared,u)),i.push(new R({start:m,end:o})),o.assign(m)}n.push(new R({start:r,end:o}))}}splitSegmentPassingThroughPole(t){const n={stack:[],error:void 0,hasError:!1};try{const i=[],s=new x,a=new x,e=new x,_=new S,r=20,o=3.124139361,l=10,h=t.getStartXY(),m=t.getEndXY(),u=F(n,new it,!1);if(st.geodeticDistance(this.m_a,this.m_eSquared,h.x,h.y,m.x,m.y,u,null,null,2),Math.abs(m.x-h.x)>o&&u.val>r){const c=new Yt(new S(0,90),h.divide(this.m_rpu),m.divide(this.m_rpu),this.m_inputGCS,2,2);let g=St(c.makeFunctor(),0,1,1e-10);if(g.second<=l&&g.first>0&&g.first<1)return s.assign(y(this.m_a,this.m_eSquared,h)),a.assign(y(this.m_a,this.m_eSquared,m)),dt(s,a,g.first,e),_.assign(O(this.m_a,this.m_eSquared,e)),i.push(new R({start:h,end:_})),i.push(new R({start:_,end:m})),i;if(c.setPointDistFrom(new S(0,-90)),g=St(c.makeFunctor(),0,1,1e-10),g.second<=l&&g.first>0&&g.first<1)return s.assign(y(this.m_a,this.m_eSquared,h)),a.assign(y(this.m_a,this.m_eSquared,m)),dt(s,a,g.first,e),_.assign(O(this.m_a,this.m_eSquared,e)),i.push(new R({start:h,end:_})),i.push(new R({start:_,end:m})),i}return i.push(new R({start:h,end:m})),i}catch(i){n.error=i,n.hasError=!0}finally{nt(n)}}adaptiveIntegrationWithRomberg(t,n){const i=t.makeFunctor();let s=0,a=1,e=i(s),_=i(a);const r=1e-17,o=1e-14;let l=(s+a)/2,h=i(l),m=Math.abs(h-e),u=Math.abs(_-h),c=0;for(;c++<32&&(m/u<.1||u/m<.1);)m<u?(n.pe(Z(5,s,l,o,r,i)),s=l,e=h):(n.pe(Z(5,l,a,o,r,i)),a=l,_=h),l=(s+a)/2,h=Math.abs(i(l)),m=Math.abs(h-e),u=Math.abs(_-h);n.pe(Z(5,s,a,o,r,i))}loxodromeAreaHemi(t,n,i,s,a){const e=i.clone(),_=a.clone();let r,o,l,h,m,u,c,g,A,E,P,f,d,I,T,w;return e.make_negative&&e.changeSign(),_.make_negative&&_.changeSign(),P=s-n,Math.abs(e.sin_phi)===1||Math.abs(_.sin_phi)===1?t.half_qp*P:e.sin_phi===_.sin_phi?(E=.5*t.one_m_e_2*e.sin_phi*(1/e.one_m_e_2_sin_2_phi+L(t.e*e.sin_phi))*P,E):(T=Math.log(_.sin_half_phi_pf*e.sin_half_phi_pz/(_.sin_half_phi_pz*e.sin_half_phi_pf)),w=Math.log(_.sin_half_asin_e_sin_phi_pf*e.sin_half_asin_e_sin_phi_pz/(_.sin_half_asin_e_sin_phi_pz*e.sin_half_asin_e_sin_phi_pf)),this.m_eSquared===1?(m=0,r=.5*(T+_.sin_phi/_.one_m_e_2_sin_2_phi-e.sin_phi/e.one_m_e_2_sin_2_phi),o=0):(m=-2*t.atanh_e_over_e*(Math.log(_.one_p_sin_phi/e.one_p_sin_phi)-t.e*w),r=(T-t.e*w)/t.one_m_e_2,o=(Math.log(_.one_m_e_2_sin_2_phi/e.one_m_e_2_sin_2_phi)+m/t.atanh_e_over_e)/t.one_m_e_2),l=-w*(e.atanh_esin_phi+_.atanh_esin_phi),h=1/e.one_m_e_2_sin_2_phi-1/_.one_m_e_2_sin_2_phi,u=G(_.one_m_sin_phi/t.one_p_e,t.e)-G(e.one_m_sin_phi/t.one_p_e,t.e),c=G(_.one_p_sin_phi/t.one_p_e,t.e)-G(e.one_p_sin_phi/t.one_p_e,t.e),g=G(e.one_m_sin_phi/-t.one_m_e,t.e)-G(_.one_m_sin_phi/-t.one_m_e,t.e),A=G(e.one_p_sin_phi/-t.one_m_e,t.e)-G(_.one_p_sin_phi/-t.one_m_e,t.e),E=.25/r*(o+l+h+m+.5*(u+c+g+A)),E+=t.half_qp,f=.5*t.one_m_e_2*e.sin_phi*(1/e.one_m_e_2_sin_2_phi+L(t.e*e.sin_phi)),d=.5*t.one_m_e_2*_.sin_phi*(1/_.one_m_e_2_sin_2_phi+L(t.e*_.sin_phi)),d<f&&(I=f,f=d,d=I),E<f&&(E=f),E>d&&(E=d),E*=P,E)}loxodromeArea(t){const n=Math.PI/180;let i=0;const s=Kt(),a=ht(),e=ht();s.e=Math.sqrt(this.m_eSquared),s.one_p_e=1+s.e,s.one_m_e=1-s.e,s.one_m_e_2=1-this.m_eSquared,s.atanh_e_over_e=L(s.e),this.m_eSquared>=1?s.half_qp=1:s.half_qp=.5*(1+s.atanh_e_over_e*s.one_m_e_2),s.f=.25*Math.PI,s.z=.75*Math.PI,e.initialize(0,s.e,s.f,s.z);const _=t.getPathCount(),r=new S,o=new S,l=t.getImpl().getAttributeStreamRef(0);for(let h=0;h<_;h++){const m=t.getPathStart(h),u=t.getPathEnd(h);if(!(u-m<=1)){l.queryPoint2D(2*(u-1),r);for(let c=m;c<u;c++){l.queryPoint2D(2*c,o);const g=r.y*n,A=o.y*n;if(c===m?(a.initialize(g,s.e,s.f,s.z),a.make_negative=!1):a.assign(e),e.initialize(A,s.e,s.f,s.z),e.make_negative=!1,r.y*o.y<0){if(r.y>=90&&o.y<=-90||o.y>=90&&r.y<=-90)return Number.NaN;const E=ht();E.initialize(0,s.e,s.f,s.z),E.make_negative=!1;const P=a.atanh_sin_phi-s.e*a.atanh_esin_phi,f=e.atanh_sin_phi-s.e*e.atanh_esin_phi,d=(f*r.x-P*o.x)/(f-P);g<0?(a.make_negative=!0,i-=this.loxodromeAreaHemi(s,r.x*n,a,d*n,E),a.make_negative=!1,i+=this.loxodromeAreaHemi(s,d*n,E,o.x*n,e)):(i+=this.loxodromeAreaHemi(s,r.x*n,a,d*n,E),e.make_negative=!0,i-=this.loxodromeAreaHemi(s,d*n,E,o.x*n,e),e.make_negative=!1)}else r.y>=0?i+=this.loxodromeAreaHemi(s,r.x*n,a,o.x*n,e):(a.make_negative=!0,e.make_negative=!0,i-=this.loxodromeAreaHemi(s,r.x*n,a,o.x*n,e),a.make_negative=!1,e.make_negative=!1);r.assign(o)}}}return this.m_a*i*this.m_a}calculate(t){if(t.isEmpty()||t.getDimension()<2)return 0;if(t.getGeometryType()===Rt.enumEnvelope){const n=new wt;return n.addEnvelope(t,!1),this.calculate(n)}return this.m_inputSR!==this.m_inputGCS&&this.m_transformPCS2GCS===null&&(this.m_transformPCS2GCS=pt(this.m_inputSR,this.m_inputGCS,null)),this.executePolygonGeodeticArea(t)}}class fe{getOperatorType(){return 10311}supportsCurves(){return!0}accelerateGeometry(t,n,i){return!1}canAccelerateGeometry(t){return!1}execute(t,n,i,s){return xt(t),i===4?new Qt().execute(t,n,s):new ne(n,i,s).calculate(t)}}export{fe as OperatorGeodeticArea};
