import{m as C}from"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import{_ as u,$ as f,N as b,l as m,n as d}from"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import{ct as P,o as y,cu as V,r as w,Y as S,w as D,s as T,N as x,B as F,F as A,cw as M,ai as I,aj as q,ak as N,al as $,am as z,a0 as j,an as B,bI as L,ao as W,bJ as Y,ay as H,aO as R,bp as E,c1 as X,M as k,aM as G,aQ as J,aR as K,aN as Q,aT as Z,aS as U,ca as a}from"./Texture-CFNZjV2R-lGBztxVp.js";import{m as ee}from"./TriangleMaterial-BIKWylXl-CcDbhy8X.js";import{H as te}from"./index-CTl7hdrJ.js";import{p as se}from"./InterleavedLayout-B7roQAzV-CC2VYRPC.js";import{Y as i}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./mat4-C96X-Nn0-Do6fKsNS.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./vec32-CewSdTn3-DHOFKD0R.js";import"./collectionUtils-jDyktm0P-ArdXNs6F.js";import"./vec42-B8VM4vXb-BnA9MysM.js";import"./lengthUtils-Dt1_RvOO-bleznLOi.js";import"./vec2f64-rIxtbMRN-Kai9mK1i.js";function v(s){const e=new H,{vertex:t,fragment:o,attributes:n,varyings:l}=e,{hasVVColor:p,hasVertexColors:c}=s;return R(t,s),e.include(E),e.include(X,s),e.include(k,s),e.include(G,s),o.include(J,s),e.include(K,s),e.include(Q,s),n.add("position","vec3"),p&&n.add("colorFeatureAttribute","float"),c||l.add("vColor","vec4"),l.add("vpos","vec3",{invariant:!0}),t.uniforms.add(new Z("uColor",h=>h.color)),t.main.add(d`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${c?"vColor *= uColor;":p?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),o.include(U),o.main.add(d`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),e}const re=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));class ae extends x{constructor(e,t){super(e,t,new F(re,()=>te(()=>Promise.resolve().then(()=>le),void 0)),g(t).locations)}_createPipeline(e,t){const{oitPass:o,output:n,transparent:l,cullFace:p,draped:c,hasOccludees:h,polygonOffset:_}=e,O=o===0;return A({blending:m(n)&&l?W(o):null,culling:L(p),depthTest:c?null:{func:B(o)},depthWrite:j(e),drawBuffers:z(n,Y(o,n)),colorWrite:$,stencilWrite:h?N:null,stencilTest:h?t?I:q:null,polygonOffset:O?_?ie:null:M(e)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const ie={factor:1,units:1};function g(s){const e=se().vec3f("position");return T()&&e.vec4u8("olidColor"),s.hasVVColor?e.f32("colorFeatureAttribute"):e.vec4u8("color"),e.freeze()}class r extends S{constructor(){super(...arguments),this.cullFace=0,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasVVColor=!1,this.draped=!1,this.textureCoordinateType=0,this.emissionSource=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.hasVVInstancing=!1,this.hasVVSize=!1,this.hasVVOpacity=!1,this.snowCover=!1}}i([a({count:3})],r.prototype,"cullFace",void 0),i([a()],r.prototype,"hasVertexColors",void 0),i([a()],r.prototype,"transparent",void 0),i([a()],r.prototype,"discardInvisibleFragments",void 0),i([a()],r.prototype,"polygonOffset",void 0),i([a()],r.prototype,"enableOffset",void 0),i([a()],r.prototype,"writeDepth",void 0),i([a()],r.prototype,"hasOccludees",void 0),i([a()],r.prototype,"terrainDepthTest",void 0),i([a()],r.prototype,"cullAboveTerrain",void 0),i([a()],r.prototype,"hasVVColor",void 0),i([a()],r.prototype,"draped",void 0);class we extends ee{constructor(e){super(e,ne),this._configuration=new r,this.supportsEdges=!0,this.produces=new Map([[2,t=>this._isOpaqueMaterialPass(t)],[3,t=>this._isOpaqueNoSSAODepthPass(t)],[4,t=>u(t)&&this._transparent&&this.parameters.writeDepth],[5,t=>f(t)&&this._transparent&&this.parameters.writeDepth],[8,t=>u(t)&&this._transparent&&!this.parameters.writeDepth],[18,t=>b(t)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<P,this._configuration.terrainDepthTest=t.terrainDepthTest&&m(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=y}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===9||u(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return f(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new oe(e)}createBufferWriter(){return new V(g(this.parameters))}}class oe extends D{beginSlot(e){return this.getTechnique(ae,e)}}class ne extends w{constructor(){super(...arguments),this.color=C,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=0,this.draped=!1,this.discardInvisibleFragments=!1}}const le=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));export{we as V};
