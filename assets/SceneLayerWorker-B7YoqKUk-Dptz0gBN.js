const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/projectionUtils-BGH_5_I3-BySNUA-B.js","assets/index-CTl7hdrJ.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/SimpleObservable-CvFyr0NA-DXpoMYph.js","assets/collectionUtils-jDyktm0P-ArdXNs6F.js","assets/Point-BfTTZoMu-BAT2Wq6O.js","assets/reader-DcGs6kKN-DHJfK-tm.js","assets/reactiveUtils-SO2Ko3sy-BCLX8Jdy.js","assets/Extent-CgDMOSRD-CU1qE5Kr.js","assets/Polyline-CoiTLswR-BLagWJLS.js","assets/Polygon-D6wEPb3W-CpL9Efjx.js","assets/aaBoundingRect-CjwcS2F3-D7aII9DY.js","assets/mathUtils-PIGhLnI9-B1tKUlUb.js","assets/projectMeshVertexPositions-CRpCilk_-Cw83mAbh.js","assets/MeshLocalVertexSpace-BGd1IdEs-DqCdtROz.js","assets/Color-CERqXxxY-BuYn26eI.js","assets/vertexSpaceConversion-DwAXLcxI-Cu_SOyoj.js","assets/mat4-C96X-Nn0-Do6fKsNS.js","assets/mat4f64-q_b6UJoq-Dh6sWB_w.js","assets/vec32-CewSdTn3-DHOFKD0R.js","assets/spatialReferenceEllipsoidUtils-D2JabnKt-Cip58jmo.js","assets/computeTranslationToOriginAndRotation-Bjd4esRf-CXUng2L4.js","assets/projectPointToVector-DL7Z4uvb-BbcUuq8O.js","assets/meshVertexSpaceUtils-CtG7DPVT-V_uCtHpB.js","assets/vec3-B_phcnZY-DHC7I6xa.js","assets/BufferView-Cj2sQaht-DuP-iLZg.js","assets/vec42-B8VM4vXb-BnA9MysM.js","assets/vec2f64-rIxtbMRN-Kai9mK1i.js","assets/vec4f64-DPb6J-GU-C7c2DqbZ.js","assets/vec4-B7mYuNMQ-ChTBJPnP.js"])))=>i.map(i=>d[i]);
import{H as v,_ as L}from"./index-CTl7hdrJ.js";import{G as z}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{f as V,an as X}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{s as q,l as K}from"./DoubleArray-DExKNiTh-CvVpHySW.js";import{r as W,t as Z}from"./MeshLocalVertexSpace-BGd1IdEs-DqCdtROz.js";import{z as Q,j as ee}from"./vec3-B_phcnZY-DHC7I6xa.js";import{R as te,W as se}from"./I3SMeshWorkerHandle-BaFEt1Xl-BadcMrS1.js";import"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./collectionUtils-jDyktm0P-ArdXNs6F.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./workers-BEkgoq8Q-BNWfkyQs.js";import"./intl-DRFqUect-ClAS7BRt.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./projectionUtils-BGH_5_I3-BySNUA-B.js";import"./Polyline-CoiTLswR-BLagWJLS.js";import"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./projectVectorToVector-Csv3NYZI-BsIKHfQD.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./WorkerHandle-B930SiRy-b7IwaSpV.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./Queue-CYlrXMwB-CYJTUII-.js";import"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import"./projectPointToVector-DL7Z4uvb-BbcUuq8O.js";const x=(e,t=x,s=t.f||(t.f=["assets/projectionUtils-BGH_5_I3.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU.js","assets/SimpleObservable-CvFyr0NA.js","assets/collectionUtils-jDyktm0P.js","assets/Point-BfTTZoMu.js","assets/reader-DcGs6kKN.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-CgDMOSRD.js","assets/Polyline-CoiTLswR.js","assets/Polygon-D6wEPb3W.js","assets/aaBoundingRect-CjwcS2F3.js","assets/mathUtils-PIGhLnI9.js","assets/projectMeshVertexPositions-CRpCilk_.js","assets/MeshLocalVertexSpace-BGd1IdEs.js","assets/Color-CERqXxxY.js","assets/vertexSpaceConversion-DwAXLcxI.js","assets/mat4-C96X-Nn0.js","assets/mat4f64-q_b6UJoq.js","assets/vec32-CewSdTn3.js","assets/spatialReferenceEllipsoidUtils-D2JabnKt.js","assets/computeTranslationToOriginAndRotation-Bjd4esRf.js","assets/projectPointToVector-DL7Z4uvb.js","assets/meshVertexSpaceUtils-CtG7DPVT.js","assets/vec3-B_phcnZY.js","assets/BufferView-Cj2sQaht.js","assets/vec42-B8VM4vXb.js","assets/vec2f64-rIxtbMRN.js","assets/vec4f64-DPb6J-GU.js","assets/vec4-B7mYuNMQ.js"]))=>e.map(a=>s[a]);function re(){return S??=(async()=>await(await v(()=>L(()=>import("./i3s-DtWWdv1_-BneqqbfJ.js"),[]),[])).default({locateFile:e=>X(`esri/libs/i3s/${e}`)}))(),S}function oe(){S=null}let S;async function Be(e){r=await j();const t=[e.geometryBuffer];return{result:H(r,e,t),transferList:t}}async function De(e){r=await j();const t=[e.geometryBuffer],{geometryBuffer:s}=e,a=s.byteLength,n=r._malloc(a),c=new Uint8Array(r.HEAPU8.buffer,n,a);c.set(new Uint8Array(s));const f=r.dracoDecompressPointCloudData(n,c.byteLength);if(r._free(n),f.error.length>0)throw new Error(`i3s.wasm: ${f.error}`);const m=f.featureIds?.length>0?f.featureIds.slice():null,p=f.positions.slice();return m&&t.push(m.buffer),t.push(p.buffer),{result:{positions:p,featureIds:m},transferList:t}}async function Ne(e){await j(),ae(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function Ue(e){await j(),ne(e)}async function Ie(e){r=await j(),r.setLegacySchema(e.context,e.jsonSchema)}async function Ce(e){const{localMatrix:t,origin:s,positions:a,vertexSpace:n}=e,c=V.fromJSON(e.inSpatialReference),f=V.fromJSON(e.outSpatialReference),m=t?q(t):void 0,p=K(s);let l;const[{projectBuffer:E},{initializeProjection:R}]=await Promise.all([v(()=>L(()=>import("./projectionUtils-BGH_5_I3-BySNUA-B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(i=>i.p),x([0,1,2,3,4,5,6,7,8,9,10,11,12,13])),v(()=>L(()=>import("./projectionUtils-BGH_5_I3-BySNUA-B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(i=>i.n),x([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))]);await R(c,f);const y=[0,0,0];if(!E(p,c,0,y,f,0))throw new Error("Failed to project");if(n.type==="georeferenced"&&n.origin==null){if(l=new Float64Array(a.length),!E(a,c,0,l,f,0,l.length/3))throw new Error("Failed to project")}else{const i=n.type==="georeferenced"?W.fromJSON(n):Z.fromJSON(n),{projectMeshVertexPositions:d}=await v(async()=>{const{projectMeshVertexPositions:T}=await L(()=>import("./projectMeshVertexPositions-CRpCilk_-Cw83mAbh.js"),__vite__mapDeps([14,0,1,2,3,4,5,6,7,8,9,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]));return{projectMeshVertexPositions:T}},x([14,0,1,2,3,4,5,6,7,8,9,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])),w=d({vertexAttributes:{position:a},transform:m?{localMatrix:m}:void 0,vertexSpace:i,spatialReference:c},f);if(!w)throw new Error("Failed to project");l=w}const g=l.length,[_,A,u]=y;for(let i=0;i<g;i+=3)l[i]-=_,l[i+1]-=A,l[i+2]-=u;return{result:{projected:l,original:a,projectedOrigin:y},transferList:[l.buffer,a.buffer]}}async function Fe({normalMatrix:e,normals:t}){const s=new Float32Array(t.length);return Q(s,t,e),z(e)&&ee(s,s),{result:{transformed:s,original:t},transferList:[s.buffer,t.buffer]}}function Ve(e){Y(e)}let $,r;function ne(e){if(!r)return;const t=e.modifications,s=r._malloc(8*t.length),a=new Float64Array(r.HEAPU8.buffer,s,t.length);for(let n=0;n<t.length;++n)a[n]=t[n];r.setModifications(e.context,s,t.length,e.isGeodetic),r._free(s)}function H(e,t,s){const{context:a,globalTrafo:n,mbs:c,obbData:f,elevationOffset:m,geometryBuffer:p,geometryDescriptor:l,indexToVertexProjector:E,vertexToRenderProjector:R}=t,y=e._malloc(p.byteLength),g=33,_=e._malloc(g*Float64Array.BYTES_PER_ELEMENT),A=new Uint8Array(e.HEAPU8.buffer,y,p.byteLength);A.set(new Uint8Array(p));const u=new Float64Array(e.HEAPU8.buffer,_,g);P(u,[NaN,NaN,NaN]);let i=u.byteOffset+3*u.BYTES_PER_ELEMENT,d=new Float64Array(u.buffer,i);P(d,n),i+=16*u.BYTES_PER_ELEMENT,d=new Float64Array(u.buffer,i),P(d,c),i+=4*u.BYTES_PER_ELEMENT,f&&(d=new Float64Array(u.buffer,i),P(d,f));const w=l,T={isDraco:!1,isLegacy:!1,color:t.layouts.some(b=>b.some(h=>h.name==="color")),normal:t.needNormals&&t.layouts.some(b=>b.some(h=>h.name==="normalCompressed")),uv0:t.layouts.some(b=>b.some(h=>h.name==="uv0")),uvRegion:t.layouts.some(b=>b.some(h=>h.name==="uvRegion")),featureIndex:w.featureIndex},o=e.process(a,!!t.obbData,y,A.byteLength,w,T,_,m,E,R,t.normalReferenceFrame);if(e._free(_),e._free(y),o.error.length>0)throw new Error(`i3s.wasm: ${o.error}`);if(o.discarded)return null;const M=o.componentOffsets.length>0?o.componentOffsets.slice():null,O=o.featureIds.length>0?o.featureIds.slice():null,G=o.anchorIds.length>0?Array.from(o.anchorIds):null,J=o.anchors.length>0?Array.from(o.anchors):null,B=o.interleavedVertedData.slice().buffer,D=o.indicesType===1?new Uint16Array(o.indices.buffer,o.indices.byteOffset,o.indices.byteLength/2).slice():new Uint32Array(o.indices.buffer,o.indices.byteOffset,o.indices.byteLength/4).slice(),N=o.positions.slice(),{buffer:U,byteOffset:I,byteLength:C}=o.positionIndices,F=o.positionIndicesType===1?new Uint16Array(U,I,C/2).slice():new Uint32Array(U,I,C/4).slice(),k=new te(t.layouts[0],B,D,o.hasColors,o.hasModifications,{data:N,indices:F});return O&&s.push(O.buffer),M&&s.push(M.buffer),s.push(B),s.push(D.buffer),s.push(N.buffer),s.push(F.buffer),new se(M,O,G,J,k,n,o.obb)}function $e(e){return e===0?0:e===1?1:e===2?2:3}function ae(e){if(!r)return;const{context:t,buffer:s}=e,a=r._malloc(s.byteLength),n=s.byteLength/Float64Array.BYTES_PER_ELEMENT,c=new Float64Array(r.HEAPU8.buffer,a,n),f=new Float64Array(s);c.set(f),r.filterOBBs(t,a,n),f.set(c),r._free(a)}function Y(e){r&&r.destroy(e)===0&&(r=null,$=null,oe())}function P(e,t){for(let s=0;s<t.length;++s)e[s]=t[s]}async function He(){r||await j()}async function j(){return r||(r=await($??=re())),r}const Ye={transform:(e,t)=>r&&H(r,e,t),destroy:Y};export{Ve as destroyContext,De as dracoDecompressPointCloudData,Ne as filterObbsForModifications,ae as filterObbsForModificationsSync,He as initialize,$e as interpretObbModificationResults,Be as process,Ce as project,Ie as setLegacySchema,Ue as setModifications,ne as setModificationsSync,Ye as test,Fe as transformNormals};
