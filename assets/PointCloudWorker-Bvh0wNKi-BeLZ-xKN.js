import{bz as d,e as v}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{r as M}from"./quat-B7J5v7rV-CZ9akUv-.js";import{t as y}from"./quatf64-CCm9z-pX-CQ7_sSji.js";import{r as g}from"./vec32-CewSdTn3-VRto2OOh.js";import{_ as c,o as h}from"./vec3f32-WCVSSNPR-9V6Uhrx-.js";import{f as I}from"./Point-BfTTZoMu-DeJwQYfh.js";import{b as w}from"./projectionUtils-BGH_5_I3-DGwchVO8.js";import{T as S,F as l,M as F,J}from"./PointCloudWorkerUtil-NeuLSYI--CWtGefQb.js";import{d as x}from"./orientedBoundingBox-BLEx7wLU-ByGP9QG1.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./collectionUtils-jDyktm0P-BDP2Oq99.js";import"./index-B0z_nLWi.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./vec42-B8VM4vXb-B6OGOEI9.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./PointCloudUniqueValueRenderer-7tgHeRs5-DZSH_eUF.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./RendererLegendOptions-ByGHYLtx-Bwoo6l33.js";import"./ColorStop-De5gQTjr-C1lw16u9.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import"./spatialReferenceEllipsoidUtils-D2JabnKt-Ce3ED0lc.js";import"./mat4-C96X-Nn0-BrMLOLCb.js";import"./vector-B8ZDYGQ6-DRILJdcx.js";import"./vec2f64-rIxtbMRN-Kai9mK1i.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./I3SBinaryReader-ZmgM2p_h-BnxBvCpV.js";import"./computeTranslationToOriginAndRotation-Bjd4esRf-vJ4LbdOU.js";import"./plane-BNdSPG2o-DTV5z6SO.js";class z{transform(t){const r=this._transform(t),o=[r.points.buffer,r.rgb.buffer];r.pointIdFilterMap!=null&&o.push(r.pointIdFilterMap.buffer);for(const f of r.attributes)"buffer"in f.values&&d(f.values.buffer)&&f.values.buffer!==r.rgb.buffer&&o.push(f.values.buffer);return Promise.resolve({result:r,transferList:o})}_transform(t){const r=S(t.schema,t.geometryBuffer);let o=r.length/3,f=null;const n=new Array,e=l(t.primaryAttributeData,r,o);t.primaryAttributeData!=null&&e&&n.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:e});const m=l(t.modulationAttributeData,r,o);t.modulationAttributeData!=null&&m&&n.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:m});let a=F(t.rendererInfo,e,m,o);if(t.filterInfo&&t.filterInfo.length>0&&t.filterAttributesData!=null){const u=t.filterAttributesData.filter(v).map(i=>{const D=l(i,r,o),b={attributeInfo:i.attributeInfo,values:D};return n.push(b),b});f=new Uint32Array(o),o=J(r,a,f,t.filterInfo,u)}for(const u of t.userAttributesData){const i=l(u,r,o);n.push({attributeInfo:u.attributeInfo,values:i})}3*o<a.length&&(a=new Uint8Array(a.buffer.slice(0,3*o))),N(r,o,t.elevationOffset);const p=_(r,o,x.fromData(t.obbData),I.fromJSON(t.inSR),I.fromJSON(t.outSR));return{obbData:t.obbData,points:p,rgb:a,attributes:n,pointIdFilterMap:f}}}function _(s,t,r,o,f){if(!w(s,o,0,s,f,0,t))throw new Error("Can't reproject");const n=c(r.center),e=h(),m=h(),a=c(r.halfSize);M(A,r.quaternion);const p=new Float32Array(3*t);for(let u=0;u<t;u++){let i=3*u;e[0]=s[i]-n[0],e[1]=s[i+1]-n[1],e[2]=s[i+2]-n[2],g(m,e,A),a[0]=Math.max(a[0],Math.abs(m[0])),a[1]=Math.max(a[1],Math.abs(m[1])),a[2]=Math.max(a[2],Math.abs(m[2])),p[i++]=e[0],p[i++]=e[1],p[i]=e[2]}return r.halfSize=a,p}function N(s,t,r){if(r!==0)for(let o=0;o<t;o++)s[3*o+2]+=r}const A=y();function pt(){return new z}export{pt as default};
