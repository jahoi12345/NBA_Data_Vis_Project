import{o as c,$ as w,w as y,a5 as h,s as O,Y as b,G as T}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{j as v,l as d,t as $,r as j}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{l as A}from"./InteractiveToolBase-DXh7kfgV-B5EAl8tr.js";import{H as f}from"./asyncUtils-w6KfWU41-HenJ0UOu.js";let u=class extends A{constructor(e){super(e)}initialize(){this.addHandles(v(()=>this.analysisViewData.visible,e=>this.visible=e,d))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};u=b([T("esri.views.interactive.AnalysisToolBase")],u);function C(e,t){e.interactive=!0;const{tool:a,view:o}=e;o.activeTool=a;let i=h(t,()=>{o.activeTool===a&&(o.activeTool=null)});return f(async s=>{await j(()=>!e.tool?.active,s),i=O(i)},t)}function R(e,t){return v(()=>e.interactive,()=>D(e,t),d)}function D(e,t){e.interactive?g(e,t):p(e)}function g(e,t){p(e);const{view:a,analysis:o}=e,i=new t({view:a,analysis:o,analysisViewData:e});return e.tool=i,a.tools.add(i),i}function p(e){const{view:t,tool:a}=e;a!=null&&(t.tools.remove(a),e.tool=null)}function x(e,t){const a=e.userOperation,o=f(async i=>{if(a){const n=a.promise.catch(()=>{});a?.abort(),await n,c(i)}const s=C(e,{signal:i}),l=t?.shouldRejectOnCancel??(()=>!0),m=w([$(()=>e.tool,"cancel",()=>{l()&&s.abort()})]),{tool:r}=e;try{r&&(r.resetCreated(),t?.onToolActivated?.(r)),await s.promise,c(i)}catch(n){if(i.aborted||!y(n)||l())throw n}finally{m?.remove()}},{signal:t?.abortOptions?.signal});return e.userOperation=o,o.promise.finally(()=>{e.userOperation===o&&(e.userOperation=null)})}async function V(e,t){const a=e.analysis.clone();return await x(e,{abortOptions:t?.placementOptions,onToolActivated:t?.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:o}=e;return!o.valid||o.equals(a)}}),{}}export{V as B,x as D,p as f,u,R as z};
