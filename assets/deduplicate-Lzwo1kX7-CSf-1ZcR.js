import{g as z}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{m as B,E as v}from"./Indices-D0_UQPPr-t1Qev6md.js";function D(o,r,a){const n=Array.isArray(o),e=n?o.length/r:o.byteLength/(4*r),h=n?o:new Uint32Array(o,0,e*r),g=a?.minReduction??0,c=a?.originalIndices||null,q=c?c.length:0,f=a?.componentOffsets||null;let U=0;if(f)for(let t=0;t<f.length-1;t++){const u=f[t+1]-f[t];u>U&&(U=u)}else U=e;const m=Math.floor(1.1*U)+1;(s==null||s.length<2*m)&&(s=new Uint32Array(z(2*m)));for(let t=0;t<2*m;t++)s[t]=0;let i=0;const w=!!f&&!!c,b=w?q:e;let A=B(e);const p=new Uint32Array(q),k=1.96;let I=g!==0?Math.ceil(4*k*k/(g*g)*g*(1-g)):b,d=1,$=f?f[1]:b;for(let t=0;t<b;t++){if(t===I){const l=1-i/t;if(l+k*Math.sqrt(l*(1-l)/t)<g)return null;I*=2}if(t===$){for(let l=0;l<2*m;l++)s[l]=0;if(c)for(let l=f[d-1];l<f[d];l++)p[l]=A[c[l]];$=f[++d]}const u=w?c[t]:t,j=u*r,x=L(h,j,r);let y=x%m,C=i;for(;s[2*y+1]!==0;){if(s[2*y]===x){const l=s[2*y+1]-1;if(E(h,j,l*r,r)){C=A[l];break}}y++,y>=m&&(y-=m)}C===i&&(s[2*y]=x,s[2*y+1]=u+1,i++),A[u]=C}if(g!==0&&1-i/e<g)return null;if(w){for(let t=f[d-1];t<p.length;t++)p[t]=A[c[t]];A=v(p)}const M=n?new Array(i):new Uint32Array(i*r);i=0;for(let t=0;t<b;t++)A[t]===i&&(F(h,(w?c[t]:t)*r,M,i*r,r),i++);if(c&&!w){const t=new Uint32Array(q);for(let u=0;u<t.length;u++)t[u]=A[c[u]];A=v(t)}return{buffer:Array.isArray(M)?M:M.buffer,indices:A,uniqueCount:i}}function E(o,r,a,n){for(let e=0;e<n;e++)if(o[r+e]!==o[a+e])return!1;return!0}function F(o,r,a,n,e){for(let h=0;h<e;h++)a[n+h]=o[r+h]}function L(o,r,a){let n=0;for(let e=0;e<a;e++)n=o[r+e]+n|0,n=n+(n<<11)+(n>>>2)|0;return n>>>0}let s=null;export{D as F};
