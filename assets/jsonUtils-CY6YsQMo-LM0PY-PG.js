import{bh as He,I as b}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{f as Ke,O as Qe,I as Ve,R as We,M as Ze}from"./Color-CERqXxxY-BuYn26eI.js";import{f as tn}from"./screenUtils-BitdhK1O-L0FLPAMi.js";import{o as Ct}from"./mat4f32-Djp3mnm5-DzYG3LYB.js";import{C as I,G as X}from"./mat4-C96X-Nn0-BrMLOLCb.js";const en=(n,r)=>{const t=I(n,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return X(t,t)},nn=(n,r)=>{const t=I(n,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return X(t,t)},rn=(n,r)=>{const t=1-r,u=I(n,.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,1);return X(u,u)},sn=(n,r)=>{const t=Math.sin(r*Math.PI/180),u=Math.cos(r*Math.PI/180),f=I(n,.213+.787*u-.213*t,.715-.715*u-.715*t,.072-.072*u+.928*t,0,.213-.213*u+.143*t,.715+.285*u+.14*t,.072-.072*u-.283*t,0,.213-.213*u-.787*t,.715-.715*u+.715*t,.072+.928*u+.072*t,0,0,0,0,1);return X(f,f)},on=(n,r)=>{const t=1-2*r,u=I(n,t,0,0,r,0,t,0,r,0,0,t,r,0,0,0,1);return X(u,u)},an=(n,r)=>{const t=I(n,.213+.787*r,.715-.715*r,.072-.072*r,0,.213-.213*r,.715+.285*r,.072-.072*r,0,.213-.213*r,.715-.715*r,.072+.928*r,0,0,0,0,1);return X(t,t)},un=(n,r)=>{const t=1-r,u=I(n,.393+.607*t,.769-.769*t,.189-.189*t,0,.349-.349*t,.686+.314*t,.168-.168*t,0,.272-.272*t,.534-.534*t,.131+.869*t,0,0,0,0,1);return X(u,u)};let Et=class Ft{constructor(r,t,u){this.strength=r,this.radius=t,this.threshold=u,this.type="bloom"}interpolate(r,t,u){this.strength=A(r.strength,t.strength,u),this.radius=A(r.radius,t.radius,u),this.threshold=A(r.threshold,t.threshold,u)}clone(){return new Ft(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:L(this.radius),strength:this.strength,threshold:this.threshold}}},Rt=class St{constructor(r){this.radius=r,this.type="blur"}interpolate(r,t,u){this.radius=Math.round(A(r.radius,t.radius,u))}clone(){return new St(this.radius)}toJSON(){return{type:"blur",radius:L(this.radius)}}};class U{constructor(r,t){this.type=r,this.amount=t,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,t,u){this.amount=A(r.amount,t.amount,u),this._updateMatrix()}clone(){return new U(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const r=this._colorMatrix||Ct();switch(this.type){case"brightness":this._colorMatrix=en(r,this.amount);break;case"contrast":this._colorMatrix=nn(r,this.amount);break;case"grayscale":this._colorMatrix=rn(r,this.amount);break;case"invert":this._colorMatrix=on(r,this.amount);break;case"saturate":this._colorMatrix=an(r,this.amount);break;case"sepia":this._colorMatrix=un(r,this.amount)}}}let Ot=class _t{constructor(r,t,u,f){this.offsetX=r,this.offsetY=t,this.blurRadius=u,this.color=f,this.type="drop-shadow"}interpolate(r,t,u){this.offsetX=A(r.offsetX,t.offsetX,u),this.offsetY=A(r.offsetY,t.offsetY,u),this.blurRadius=A(r.blurRadius,t.blurRadius,u),this.color[0]=Math.round(A(r.color[0],t.color[0],u)),this.color[1]=Math.round(A(r.color[1],t.color[1],u)),this.color[2]=Math.round(A(r.color[2],t.color[2],u)),this.color[3]=A(r.color[3],t.color[3],u)}clone(){return new _t(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const r=[...this.color];return r[3]*=255,{type:"drop-shadow",xoffset:L(this.offsetX),yoffset:L(this.offsetY),blurRadius:L(this.blurRadius),color:r}}},kt=class Nt{constructor(r){this.angle=r,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(r,t,u){this.angle=A(r.angle,t.angle,u),this._updateMatrix()}clone(){return new Nt(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const r=this._colorMatrix||Ct();this._colorMatrix=sn(r,this.angle)}},Pt=class Yt{constructor(r){this.amount=r,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(r,t,u){this.amount=A(r.amount,t.amount,u)}clone(){return new Yt(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function A(n,r,t){return n+(r-n)*t}function L(n){return Math.round(1e3*tn(n))/1e3}function cn(n){switch(n.type){case"grayscale":case"sepia":case"invert":return new U(n.type,0);case"saturate":case"brightness":case"contrast":return new U(n.type,1);case"opacity":return new Pt(1);case"hue-rotate":return new kt(0);case"blur":return new Rt(0);case"drop-shadow":return new Ot(0,0,0,[...Ke("transparent")]);case"bloom":return new Et(0,0,1)}}function ln(n,r){const t=n.length>r.length?n:r;return(n.length>r.length?r:n).every((u,f)=>u.type===t[f].type)}function fn(n,r){const t=n.length>r.length?n:r,u=n.length>r.length?r:n;for(let f=u.length;f<t.length;f++)u.push(cn(t[f]))}function hn(n){const r=n[0];return!!r&&"type"in r}class At extends SyntaxError{constructor(r,t,u,f){super(r),this.expected=t,this.found=u,this.location=f,this.name="SyntaxError"}format(r){let t="Error: "+this.message;if(this.location){let u=null;const f=r.find(S=>S.source===this.location.source);f&&(u=f.text.split(/\r\n|\n|\r/g));const M=this.location.start,R=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(M):M,_=this.location.source+":"+R.line+":"+R.column;if(u){const S=this.location.end,j="".padEnd(R.line.toString().length," "),q=u[M.line-1],J=(M.line===S.line?S.column:q.length+1)-M.column||1;t+=`
 --> `+_+`
`+j+` |
`+R.line+" | "+q+`
`+j+" | "+"".padEnd(M.column-1," ")+"".padEnd(J,"^")}else t+=`
 at `+_}return t}static buildMessage(r,t){function u(g){return g.codePointAt(0).toString(16).toUpperCase()}const f=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function M(g){return f?g.replace(f,h=>"\\u{"+u(h)+"}"):g}function R(g){return M(g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,h=>"\\x0"+u(h)).replace(/[\x10-\x1F\x7F-\x9F]/g,h=>"\\x"+u(h)))}function _(g){return M(g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,h=>"\\x0"+u(h)).replace(/[\x10-\x1F\x7F-\x9F]/g,h=>"\\x"+u(h)))}const S={literal:g=>'"'+R(g.text)+'"',class(g){const h=g.parts.map(C=>Array.isArray(C)?_(C[0])+"-"+_(C[1]):_(C));return"["+(g.inverted?"^":"")+h.join("")+"]"+(g.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:g=>g.description};function j(g){return S[g.type](g)}function q(g){const h=g.map(j);if(h.sort(),h.length>0){let C=1;for(let k=1;k<h.length;k++)h[k-1]!==h[k]&&(h[C]=h[k],C++);h.length=C}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function J(g){return g?'"'+R(g)+'"':"end of input"}return"Expected "+q(r)+" but "+J(t)+" found."}}function pn(n,r){const t={},u=(r=r!==void 0?r:{}).grammarSource,f={start:xt};let M=xt;const R="none",_=")",S=",",j="(",q="%",J="px",g="cm",h="mm",C="in",k="pt",rt="pc",st="deg",ot="rad",at="grad",ut="turn",jt="#",qt=".",Jt="e",it=/^[ \t\n\r]/,ct=/^[a-z\-]/,lt=/^[0-9a-fA-F]/,ft=/^[+\-]/,N=/^[0-9]/,zt=Y("none"),Gt=w("none",!1),Tt=w(")",!1),ht=w(",",!1),pt=D([" ","	",`
`,"\r"],!1,!1,!1),Dt=Y("function"),Lt=w("(",!1),Ut=Y("identifier"),gt=D([["a","z"],"-"],!1,!1,!1),Bt=Y("percentage"),Ht=w("%",!1),Kt=Y("length"),Qt=w("px",!1),Vt=w("cm",!1),Wt=w("mm",!1),Zt=w("in",!1),te=w("pt",!1),ee=w("pc",!1),ne=Y("angle"),re=w("deg",!1),se=w("rad",!1),oe=w("grad",!1),ae=w("turn",!1),ue=Y("number"),ie=Y("color"),ce=w("#",!1),mt=D([["0","9"],["a","f"],["A","F"]],!1,!1,!1),dt=D(["+","-"],!1,!1,!1),P=D([["0","9"]],!1,!1,!1),le=w(".",!1),fe=w("e",!1);function he(){return[]}function pe(e,s){return{type:"function",name:e,parameters:s||[]}}function ge(e,s){return s.length>0?Be(e,s,3):[e]}function me(e){return{type:"quantity",value:e.value,unit:e.unit}}function de(e){return{type:"color",colorType:e.type,value:e.value}}function ye(){return K()}function we(e){return{value:e,unit:"%"}}function xe(e){return{value:e,unit:"px"}}function be(e){return{value:e,unit:"cm"}}function ve(e){return{value:e,unit:"mm"}}function Ae(e){return{value:e,unit:"in"}}function Me(e){return{value:e,unit:"pt"}}function $e(e){return{value:e,unit:"pc"}}function Ce(e){return{value:e,unit:"deg"}}function Ee(e){return{value:e,unit:"rad"}}function Fe(e){return{value:e,unit:"grad"}}function Re(e){return{value:e,unit:"turn"}}function Se(e){return{value:e,unit:null}}function Oe(){return{type:"hex",value:K()}}function _e(e){return{type:"function",value:e}}function ke(){return{type:"named",value:K()}}function Ne(){return parseFloat(K())}let o=0|r.peg$currPos,m=o;const z=[{line:1,column:1}];let T,E=o,H=r.peg$maxFailExpected||[],i=0|r.peg$silentFails;if(r.startRule){if(!(r.startRule in f))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');M=f[r.startRule]}function K(){return n.substring(m,o)}function Pe(e=o){const s=n.codePointAt(e);return s===void 0?"":String.fromCodePoint(s)}function w(e,s){return{type:"literal",text:e,ignoreCase:s}}function D(e,s,a,c){return{type:"class",parts:e,inverted:s,ignoreCase:a,unicode:c}}function Ye(){return{type:"end"}}function Y(e){return{type:"other",description:e}}function yt(e){let s,a=z[e];if(a)return a;if(e>=z.length)s=z.length-1;else for(s=e;!z[--s];);for(a=z[s],a={line:a.line,column:a.column};s<e;)n.charCodeAt(s)===10?(a.line++,a.column=1):a.column++,s++;return z[e]=a,a}function wt(e,s,a){const c=yt(e),p=yt(s);return{source:u,start:{offset:e,line:c.line,column:c.column},end:{offset:s,line:p.line,column:p.column}}}function l(e){o<E||(o>E&&(E=o,H=[]),H.push(e))}function Ie(e,s,a){return new At(At.buildMessage(e,s),e,s,a)}function xt(){let e;return e=Xe(),e===t&&(e=je()),e}function Xe(){let e,s;return i++,e=o,x(),n.substr(o,4)===R?(s=R,o+=4):(s=t,i===0&&l(Gt)),s!==t?(x(),m=e,e=he()):(o=e,e=t),i--,e===t&&i===0&&l(zt),e}function je(){let e,s;if(e=[],s=V(),s!==t)for(;s!==t;)e.push(s),s=V();else e=t;return e}function V(){let e,s,a,c;return e=o,x(),s=Je(),s!==t?(x(),a=qe(),a===t&&(a=null),x(),n.charCodeAt(o)===41?(c=_,o++):(c=t,i===0&&l(Tt)),c!==t?(x(),m=e,e=pe(s,a)):(o=e,e=t)):(o=e,e=t),e}function qe(){let e,s,a,c,p,d,y,v;if(e=o,s=W(),s!==t){for(a=[],c=o,p=x(),n.charCodeAt(o)===44?(d=S,o++):(d=t,i===0&&l(ht)),d===t&&(d=null),y=x(),v=W(),v!==t?(p=[p,d,y,v],c=p):(o=c,c=t);c!==t;)a.push(c),c=o,p=x(),n.charCodeAt(o)===44?(d=S,o++):(d=t,i===0&&l(ht)),d===t&&(d=null),y=x(),v=W(),v!==t?(p=[p,d,y,v],c=p):(o=c,c=t);m=e,e=ge(s,a)}else o=e,e=t;return e}function W(){let e,s;return e=o,s=ze(),s===t&&(s=Ge(),s===t&&(s=Te(),s===t&&(s=De()))),s!==t&&(m=e,s=me(s)),e=s,e===t&&(e=o,s=Le(),s!==t&&(m=e,s=de(s)),e=s),e}function x(){let e,s;for(i++,e=[],s=n.charAt(o),it.test(s)?o++:(s=t,i===0&&l(pt));s!==t;)e.push(s),s=n.charAt(o),it.test(s)?o++:(s=t,i===0&&l(pt));return i--,e}function Je(){let e,s,a;return i++,e=o,s=bt(),s!==t?(n.charCodeAt(o)===40?(a=j,o++):(a=t,i===0&&l(Lt)),a!==t?(m=e,e=s):(o=e,e=t)):(o=e,e=t),i--,e===t&&(s=t,i===0&&l(Dt)),e}function bt(){let e,s,a;if(i++,e=o,s=[],a=n.charAt(o),ct.test(a)?o++:(a=t,i===0&&l(gt)),a!==t)for(;a!==t;)s.push(a),a=n.charAt(o),ct.test(a)?o++:(a=t,i===0&&l(gt));else s=t;return s!==t&&(m=e,s=ye()),e=s,i--,e===t&&(s=t,i===0&&l(Ut)),e}function ze(){let e,s,a;return i++,e=o,x(),s=$(),s!==t?(n.charCodeAt(o)===37?(a=q,o++):(a=t,i===0&&l(Ht)),a!==t?(m=e,e=we(s)):(o=e,e=t)):(o=e,e=t),i--,e===t&&i===0&&l(Bt),e}function Ge(){let e,s,a;return i++,e=o,x(),s=$(),s!==t?(n.substr(o,2)===J?(a=J,o+=2):(a=t,i===0&&l(Qt)),a!==t?(m=e,e=xe(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,x(),s=$(),s!==t?(n.substr(o,2)===g?(a=g,o+=2):(a=t,i===0&&l(Vt)),a!==t?(m=e,e=be(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,x(),s=$(),s!==t?(n.substr(o,2)===h?(a=h,o+=2):(a=t,i===0&&l(Wt)),a!==t?(m=e,e=ve(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,x(),s=$(),s!==t?(n.substr(o,2)===C?(a=C,o+=2):(a=t,i===0&&l(Zt)),a!==t?(m=e,e=Ae(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,x(),s=$(),s!==t?(n.substr(o,2)===k?(a=k,o+=2):(a=t,i===0&&l(te)),a!==t?(m=e,e=Me(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,x(),s=$(),s!==t?(n.substr(o,2)===rt?(a=rt,o+=2):(a=t,i===0&&l(ee)),a!==t?(m=e,e=$e(s)):(o=e,e=t)):(o=e,e=t)))))),i--,e===t&&i===0&&l(Kt),e}function Te(){let e,s,a;return i++,e=o,s=$(),s!==t?(n.substr(o,3)===st?(a=st,o+=3):(a=t,i===0&&l(re)),a!==t?(m=e,e=Ce(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,s=$(),s!==t?(n.substr(o,3)===ot?(a=ot,o+=3):(a=t,i===0&&l(se)),a!==t?(m=e,e=Ee(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,s=$(),s!==t?(n.substr(o,4)===at?(a=at,o+=4):(a=t,i===0&&l(oe)),a!==t?(m=e,e=Fe(s)):(o=e,e=t)):(o=e,e=t),e===t&&(e=o,s=$(),s!==t?(n.substr(o,4)===ut?(a=ut,o+=4):(a=t,i===0&&l(ae)),a!==t?(m=e,e=Re(s)):(o=e,e=t)):(o=e,e=t)))),i--,e===t&&(s=t,i===0&&l(ne)),e}function De(){let e,s;return i++,e=o,x(),s=$(),s!==t?(m=e,e=Se(s)):(o=e,e=t),i--,e===t&&i===0&&l(ue),e}function Le(){let e,s,a,c;if(i++,e=o,n.charCodeAt(o)===35?(s=jt,o++):(s=t,i===0&&l(ce)),s!==t){if(a=[],c=n.charAt(o),lt.test(c)?o++:(c=t,i===0&&l(mt)),c!==t)for(;c!==t;)a.push(c),c=n.charAt(o),lt.test(c)?o++:(c=t,i===0&&l(mt));else a=t;a!==t?(m=e,e=Oe()):(o=e,e=t)}else o=e,e=t;return e===t&&(e=o,s=V(),s!==t&&(m=e,s=_e(s)),e=s,e===t&&(e=o,s=bt(),s!==t&&(m=e,s=ke()),e=s)),i--,e===t&&(s=t,i===0&&l(ie)),e}function $(){let e,s,a,c,p,d,y,v;for(e=o,s=n.charAt(o),ft.test(s)?o++:(s=t,i===0&&l(dt)),s===t&&(s=null),a=o,c=[],p=n.charAt(o),N.test(p)?o++:(p=t,i===0&&l(P));p!==t;)c.push(p),p=n.charAt(o),N.test(p)?o++:(p=t,i===0&&l(P));if(n.charCodeAt(o)===46?(p=qt,o++):(p=t,i===0&&l(le)),p!==t){if(d=[],y=n.charAt(o),N.test(y)?o++:(y=t,i===0&&l(P)),y!==t)for(;y!==t;)d.push(y),y=n.charAt(o),N.test(y)?o++:(y=t,i===0&&l(P));else d=t;d!==t?(c=[c,p,d],a=c):(o=a,a=t)}else o=a,a=t;if(a===t)if(a=[],c=n.charAt(o),N.test(c)?o++:(c=t,i===0&&l(P)),c!==t)for(;c!==t;)a.push(c),c=n.charAt(o),N.test(c)?o++:(c=t,i===0&&l(P));else a=t;if(a!==t){if(c=o,n.charCodeAt(o)===101?(p=Jt,o++):(p=t,i===0&&l(fe)),p!==t){if(d=n.charAt(o),ft.test(d)?o++:(d=t,i===0&&l(dt)),d===t&&(d=null),y=[],v=n.charAt(o),N.test(v)?o++:(v=t,i===0&&l(P)),v!==t)for(;v!==t;)y.push(v),v=n.charAt(o),N.test(v)?o++:(v=t,i===0&&l(P));else y=t;y!==t?(p=[p,d,y],c=p):(o=c,c=t)}else o=c,c=t;c===t&&(c=null),m=e,e=Ne()}else o=e,e=t;return e}function Ue(e,s){return e.map(function(a){return a[s]})}function Be(e,s,a){return[e].concat(Ue(s,a))}T=M();const Z=T!==t&&o===n.length;function vt(){throw T!==t&&o<n.length&&l(Ye()),Ie(H,E<n.length?Pe(E):null,E<n.length?wt(E,E+1):wt(E,E))}return r.peg$library?{peg$result:T,peg$currPos:o,peg$FAILED:t,peg$maxFailExpected:H,peg$maxFailPos:E,peg$success:Z,peg$throw:Z?void 0:vt}:Z?T:void vt()}function It(n){if(!n||n.length===0)return null;if(typeof n=="string"){const t=Mt(n);return t&&t.length!==0?t:null}const r=n.map(t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new b("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:Mt(t.value)}});r.sort((t,u)=>u.effects.length-t.effects.length);for(let t=0;t<r.length-1;t++){if(!ln(r[t].effects,r[t+1].effects))throw new b("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:r[t].effects,b:r[t+1].effects});fn(r[t].effects,r[t+1].effects)}return r.sort((t,u)=>u.scale-t.scale),r}function Mt(n){let r;if(!n)return[];try{r=pn(n)}catch(t){throw new b("effect:invalid-syntax","Invalid effect syntax",{value:n,error:t})}return r.map(t=>gn(t))}function gn(n){try{switch(n.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return mn(n);case"opacity":return dn(n);case"hue-rotate":return yn(n);case"blur":return wn(n);case"drop-shadow":return xn(n);case"bloom":return bn(n)}}catch(r){throw r.details.filter=n,r}throw new b("effect:unknown-effect",`Effect '${n.name}' is not supported`,{effect:n})}function mn(n){let r=1;return G(n.parameters,1),n.parameters.length===1&&(r=F(n.parameters[0])),new U(n.name,r)}function dn(n){let r=1;return G(n.parameters,1),n.parameters.length===1&&(r=F(n.parameters[0])),new Pt(r)}function yn(n){let r=0;return G(n.parameters,1),n.parameters.length===1&&(r=En(n.parameters[0])),new kt(r)}function wn(n){let r=0;return G(n.parameters,1),n.parameters.length===1&&(r=nt(n.parameters[0]),B(r,n.parameters[0])),new Rt(r)}function xn(n){const r=[];let t=null;for(const u of n.parameters)if(u.type==="color"){if(r.length&&Object.freeze(r),t)throw new b("effect:type-error","Accepts only one color",{});t=Fn(u)}else{const f=nt(u);if(Object.isFrozen(r))throw new b("effect:type-error","<length> parameters not consecutive",{lengths:r});r.push(f),r.length===3&&B(f,u)}if(r.length<2||r.length>3)throw new b("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${r.length}}`,{lengths:r});return new Ot(r[0],r[1],r[2]||0,t||Xt("black"))}function bn(n){let r=1,t=0,u=0;return G(n.parameters,3),n.parameters[0]&&(r=F(n.parameters[0])),n.parameters[1]&&(t=nt(n.parameters[1]),B(t,n.parameters[1])),n.parameters[2]&&(u=F(n.parameters[2])),new Et(r,t,u)}function G(n,r){if(n.length>r)throw new b("effect:type-error",`Function supports up to ${r} parameters, Actual: ${n.length}`,{parameters:n})}function Q(n){if(n.type==="color")return"<color>";if(n.unit){if(n.unit in et)return"<length>";if(n.unit in tt)return"<angle>";if(n.unit==="%")return"<percentage>"}return"<double>"}function B(n,r){if(n<0)throw new b("effect:type-error",`Negative values are not allowed, Actual: ${n}`,{term:r})}function vn(n){if(n.type!=="quantity"||n.unit!==null)throw new b("effect:type-error",`Expected <double>, Actual: ${Q(n)}`,{term:n})}function An(n){if(n.type!=="quantity"||n.unit!==null&&n.unit!=="%")throw new b("effect:type-error",`Expected <double> or <percentage>, Actual: ${Q(n)}`,{term:n})}const tt={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Mn(n){if(n.type!=="quantity"||!(n.value===0&&n.unit===null||n.unit&&tt[n.unit]!=null))throw new b("effect:type-error",`Expected <angle>, Actual: ${Q(n)}`,{term:n})}const et={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function $n(n){if(n.type!=="quantity"||!(n.value===0&&n.unit===null||n.unit&&et[n.unit]!=null))throw new b("effect:type-error",`Expected <length>, Actual: ${Q(n)}`,{term:n})}function F(n){An(n);const r=n.value;return B(r,n),n.unit==="%"?.01*r:r}function Cn(n){return vn(n),B(n.value,n),n.value}function En(n){return Mn(n),n.value*tt[n.unit]||0}function nt(n){return $n(n),n.value*et[n.unit]||0}function Fn(n){switch(n.colorType){case"hex":return Qe(n.value);case"named":return Xt(n.value);case"function":return On(n.value)}}function Xt(n){if(!Ve(n))throw new b("effect:unknown-color",`color '${n}' isn't valid`,{namedColor:n});return We(n)}const Rn=/^rgba?/i,Sn=/^hsla?/i;function On(n){if(G(n.parameters,4),Rn.test(n.name))return[F(n.parameters[0]),F(n.parameters[1]),F(n.parameters[2]),n.parameters[3]?F(n.parameters[3]):1];if(Sn.test(n.name))return Ze(Cn(n.parameters[0]),F(n.parameters[1]),F(n.parameters[2]),n.parameters[3]?F(n.parameters[3]):1);throw new b("effect:syntax-error",`Invalid color function '${n.name}'`,{colorFunction:n})}function Jn(n,r,t){try{return kn(n)}catch(u){t?.messages?.push(u)}return null}function zn(n,r,t,u){try{const f=_n(n);He(t,f,r)}catch(f){u.messages&&u.messages.push(f)}}function _n(n){const r=It(n);return r?hn(r)?r.map(t=>t.toJSON()):r.map(({scale:t,effects:u})=>({scale:t,value:u.map(f=>f.toJSON())})):null}function kn(n){if(!n||n.length===0)return null;if(Nn(n)){const r=[];for(const t of n)r.push({scale:t.scale,value:$t(t.value)});return r}return $t(n)}function Nn(n){const r=n[0];return!!r&&"scale"in r}function $t(n){if(!n?.length)return"";const r=[];for(const t of n){let u=[];switch(t.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":u=[O(t,"amount")];break;case"blur":u=[O(t,"radius","pt")];break;case"hue-rotate":u=[O(t,"angle","deg")];break;case"drop-shadow":u=[O(t,"xoffset","pt"),O(t,"yoffset","pt"),O(t,"blurRadius","pt"),Pn(t,"color")];break;case"bloom":u=[O(t,"strength"),O(t,"radius","pt"),O(t,"threshold")]}const f=`${t.type}(${u.filter(Boolean).join(" ")})`;It(f),r.push(f)}return r.join(" ")}function O(n,r,t){if(n[r]==null)throw new b("effect:missing-parameter",`Missing parameter '${r}' in ${n.type} effect`,{effect:n});return t?n[r]+t:""+n[r]}function Pn(n,r){if(n[r]==null)throw new b("effect:missing-parameter",`Missing parameter '${r}' in ${n.type} effect`,{effect:n});const t=n[r];return`rgba(${t[0]||0}, ${t[1]||0}, ${t[2]||0}, ${t[3]/255||0})`}export{Jn as Y,zn as z};
