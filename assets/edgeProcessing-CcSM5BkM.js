import{e as H}from"./deduplicate-Lzwo1kX7.js";import{Q as R}from"./InterleavedLayout-DekhjWxm.js";import{RegularEdgeInstancesLayout as q,SilhouetteEdgeInstancesLayout as D,EdgeInputBufferLayout as O}from"./bufferLayouts-BXxs92no.js";import{ae as P}from"./jsonMap-Bs3hmeCU.js";import{u as Q,A as j}from"./vec32-DAazN8eR.js";import{n as z}from"./collectionUtils-DO-P7c3V.js";import{e as E,d as G}from"./edgePreprocessing-D-eyqYfP.js";import"./mathUtils-PIGhLnI9.js";import"./Indices-D0_UQPPr.js";import"./BufferView-DWcptWNd.js";import"./Polygon-Brg2ZzgS.js";import"./Extent-B4u1bcyL.js";import"./Point-fJINO2ru.js";import"./reader-DcGs6kKN.js";import"./index-ClordG0R.js";import"./aaBoundingRect-5dP796IU.js";import"./vec42-BKpTaQMj.js";import"./vec2f64-rIxtbMRN.js";import"./vec4f64-DPb6J-GU.js";import"./types-BKo2foNY.js";import"./enums-B4pqBiXb.js";import"./VertexElementDescriptor-BlxU8vCE.js";import"./reactiveUtils-SO2Ko3sy.js";import"./SimpleObservable-CvFyr0NA.js";function W(e,o,r){const s=o/3,a=new Uint32Array(r+1),p=new Uint32Array(r+1),l=(t,n)=>{t<n?a[t+1]++:p[n+1]++};for(let t=0;t<s;t++){const n=e[3*t],c=e[3*t+1],i=e[3*t+2];l(n,c),l(c,i),l(i,n)}let I=0,b=0;for(let t=0;t<r;t++){const n=a[t+1],c=p[t+1];a[t+1]=I,p[t+1]=b,I+=n,b+=c}const f=new Uint32Array(6*s),u=a[r],B=(t,n,c)=>{if(t<n){const i=a[t+1]++;f[2*i]=n,f[2*i+1]=c}else{const i=p[n+1]++;f[2*u+2*i]=t,f[2*u+2*i+1]=c}};for(let t=0;t<s;t++){const n=e[3*t],c=e[3*t+1],i=e[3*t+2];B(n,c,t),B(c,i,t),B(i,n,t)}const U=(t,n)=>{const c=2*t,i=n-t;for(let m=1;m<i;m++){const w=f[c+2*m],y=f[c+2*m+1];let d=m-1;for(;d>=0&&f[c+2*d]>w;d--)f[c+2*d+2]=f[c+2*d],f[c+2*d+3]=f[c+2*d+1];f[c+2*d+2]=w,f[c+2*d+3]=y}};for(let t=0;t<r;t++)U(a[t],a[t+1]),U(u+p[t],u+p[t+1]);const v=new Int32Array(3*s),N=(t,n)=>t===e[3*n]?0:t===e[3*n+1]?1:t===e[3*n+2]?2:-1,A=(t,n)=>{const c=N(t,n);v[3*n+c]=-1},k=(t,n,c,i)=>{const m=N(t,n);v[3*n+m]=i;const w=N(c,i);v[3*i+w]=n};for(let t=0;t<r;t++){let n=a[t];const c=a[t+1];let i=p[t];const m=p[t+1];for(;n<c&&i<m;){const w=f[2*n],y=f[2*u+2*i];w===y?(k(t,f[2*n+1],y,f[2*u+2*i+1]),n++,i++):w<y?(A(t,f[2*n+1]),n++):(A(y,f[2*u+2*i+1]),i++)}for(;n<c;)A(t,f[2*n+1]),n++;for(;i<m;)A(f[2*u+2*i],f[2*u+2*i+1]),i++}return v}const _=.7;let V=class{updateSettings(o){this.settings=o,this._edgeHashFunction=o.reducedPrecision?K:J}write(o,r,s){L.seed=this._edgeHashFunction(s);const a=L.getIntRange(0,255),p=L.getIntRange(0,this.settings.variants-1),l=L.getFloat(),I=255*(.5*T(-(1-Math.min(l/_,1))+Math.max(0,l-_)/(1-_),1.2)+.5);o.position0.setVec(r,s.position0),o.position1.setVec(r,s.position1),o.componentIndex.set(r,s.componentIndex),o.variantOffset.set(r,a),o.variantStroke.set(r,p),o.variantExtension.set(r,I)}};const g=new Float32Array(6),h=new Uint32Array(g.buffer),$=new Uint32Array(1);function J(e){return g[0]=e.position0[0],g[1]=e.position0[1],g[2]=e.position0[2],g[3]=e.position1[0],g[4]=e.position1[1],g[5]=e.position1[2],$[0]=31*(31*(31*(31*(31*(166811+h[0])+h[1])+h[2])+h[3])+h[4])+h[5],$[0]}function K(e){const o=g;o[0]=x(e.position0[0]),o[1]=x(e.position0[1]),o[2]=x(e.position0[2]),o[3]=x(e.position1[0]),o[4]=x(e.position1[1]),o[5]=x(e.position1[2]),$[0]=5381;for(let r=0;r<h.length;r++)$[0]=31*$[0]+h[r];return $[0]}const C=1e4;function x(e){return Math.round(e*C)/C}function T(e,o){return Math.abs(e)**o*Math.sign(e)}class X{constructor(){this._commonWriter=new V}updateSettings(o){this._commonWriter.updateSettings(o)}allocate(o){return q.createBuffer(o)}write(o,r,s){this._commonWriter.write(o,r,s),Q(S,s.faceNormal0,s.faceNormal1),j(S,S);const{typedBuffer:a,typedBufferStride:p}=o.normalCompressed;E(a,r,S[0],S[1],S[2],p)}}class Y{constructor(){this._commonWriter=new V}updateSettings(o){this._commonWriter.updateSettings(o)}allocate(o){return D.createBuffer(o)}write(o,r,s){this._commonWriter.write(o,r,s);{const{typedBuffer:a,typedBufferStride:p}=o.normalCompressed;E(a,r,s.faceNormal0[0],s.faceNormal0[1],s.faceNormal0[2],p)}{const{typedBuffer:a,typedBufferStride:p}=o.normal2Compressed;E(a,r,s.faceNormal1[0],s.faceNormal1[1],s.faceNormal1[2],p)}}}const S=z(),L=new P;function Bt(e){const o=Z(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return M.updateSettings(e.writerSettings),F.updateSettings(e.writerSettings),G(o,M,F)}function Z(e,o,r,s){if(o){const l=W(r,s,e.count);return new tt(r,s,l,e)}const a=H(e.buffer,e.stride/4,{originalIndices:r}),p=W(a.indices,s,a.uniqueCount);return{faces:a.indices,facesLength:a.indices.length,neighbors:p,vertices:O.createView(a.buffer)}}class tt{constructor(o,r,s,a){this.faces=o,this.facesLength=r,this.neighbors=s,this.vertices=a}}const M=new X,F=new Y,Nt=R().vec3f("position0").vec3f("position1"),_t=R().vec3f("position0").vec3f("position1").u16("componentIndex");export{Bt as extract,_t as extractComponentsEdgeLocationsLayout,Z as extractEdgeInformation,Nt as extractEdgeLocationsLayout};
