const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/geometryEngine-CugHcx4E-yvuPstSU.js","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/Point-BfTTZoMu-BAT2Wq6O.js","assets/index-CTl7hdrJ.js","assets/index-Cv2ko1Ob.css","assets/reader-DcGs6kKN-DHJfK-tm.js","assets/geometryEngineBase-BQTefT4Y-m-Q4mmSQ.js","assets/_commonjsHelpers-DCkdB7M8-DwXtFsJ3.js","assets/Extent-CgDMOSRD-CU1qE5Kr.js","assets/Polyline-CoiTLswR-BLagWJLS.js","assets/Polygon-D6wEPb3W-CpL9Efjx.js","assets/aaBoundingRect-CjwcS2F3-D7aII9DY.js","assets/mathUtils-PIGhLnI9-B1tKUlUb.js","assets/I3SQueryResultGeometry-CiT4lFOy-Dm4JBcX2.js","assets/jsonUtils-CmpazY1u-ateEpj4Q.js","assets/FeatureSet-BF7daP96-BqhMUjXs.js","assets/Graphic-DgGzDmqW-CFzg0c4i.js","assets/getPopupProvider-CmskPttI-C4PqyuPF.js","assets/collectionUtils-jDyktm0P-ArdXNs6F.js","assets/reactiveUtils-SO2Ko3sy-BCLX8Jdy.js","assets/SimpleObservable-CvFyr0NA-DXpoMYph.js","assets/lengthUtils-Dt1_RvOO-bleznLOi.js","assets/date-IqUzANpt-bLKO9IDT.js","assets/Color-CERqXxxY-BuYn26eI.js","assets/Layer-DZvC7bne-m1cEC_yw.js","assets/typeUtils-DqrRcjBx-ZWdHcSIJ.js","assets/createFeatureId-CVwTD0fV-3fKpJDrk.js","assets/typeUtils-CXW_VpOn-BoSnXkME.js","assets/lineMarkers-CDwLe3J6-CNUjJvs3.js","assets/PolygonSymbol3D-BXRHZiCQ-Vi0-2Gvc.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js","assets/screenUtils-BitdhK1O-L0FLPAMi.js","assets/opacityUtils-DuFH0EC9-DWspTgn2.js","assets/aaBoundingBox-Cn49X7ge-DORLZxoS.js","assets/DoubleArray-DExKNiTh-CvVpHySW.js","assets/mat4f64-q_b6UJoq-Dh6sWB_w.js","assets/Font-BwmnW7d2-D-oIm_Md.js","assets/SimpleFillSymbol-CDawtd9z-CWD2KI2D.js","assets/SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js","assets/PictureMarkerSymbol-CaSh-vZk-BNpExnAb.js","assets/TextSymbol-hRGhyDHs-C0NgASym.js","assets/Field-Cm_ZejYW-CwJZmSru.js","assets/fieldType-DVUzXtk_-tUuvnZJM.js","assets/meshUtils-DPfwf6VG-C7w8GH4_.js","assets/Mesh-CkDBRbaq-CjU57N0E.js","assets/axisAngleDegrees-CjbXmycq-LMRXo165.js","assets/mat4-C96X-Nn0-Do6fKsNS.js","assets/quat-B7J5v7rV-i-DOMCm_.js","assets/quatf64-CCm9z-pX-CQ7_sSji.js","assets/vec32-CewSdTn3-DHOFKD0R.js","assets/vec42-B8VM4vXb-BnA9MysM.js","assets/MeshComponent-Ccgxjntc-CO8Xga6n.js","assets/imageUtils-142g71N8-CjUugWaS.js","assets/meshProperties-DWLWd_LJ-DdGPdsWo.js","assets/MeshLocalVertexSpace-BGd1IdEs-DqCdtROz.js","assets/MeshTransform-Bl0zl104-DPLjEW5o.js","assets/MeshVertexAttributes-CsRRGxwu-Tc1AQMgh.js","assets/meshVertexSpaceUtils-CtG7DPVT-V_uCtHpB.js","assets/triangulationUtils-D34y65Gu-uORqNaLm.js","assets/earcut-D9gy186--DqxOpTir.js","assets/Indices-D0_UQPPr-t1Qev6md.js","assets/plane-BNdSPG2o-Cq7jmU6w.js","assets/vector-B8ZDYGQ6-B1uNywRb.js","assets/vec2f64-rIxtbMRN-Kai9mK1i.js","assets/vec4f64-DPb6J-GU-C7c2DqbZ.js","assets/deduplicate-Lzwo1kX7-CSf-1ZcR.js","assets/projectPointToVector-DL7Z4uvb-BbcUuq8O.js","assets/projectionUtils-BGH_5_I3-BySNUA-B.js","assets/vertexSpaceConversion-DwAXLcxI-Cu_SOyoj.js","assets/spatialReferenceEllipsoidUtils-D2JabnKt-Cip58jmo.js","assets/computeTranslationToOriginAndRotation-Bjd4esRf-CXUng2L4.js","assets/vec3-B_phcnZY-DHC7I6xa.js","assets/BufferView-Cj2sQaht-DuP-iLZg.js","assets/vec4-B7mYuNMQ-ChTBJPnP.js","assets/External-DqWxNHeL-Cv6s9Dhc.js","assets/infoFor3D-DhzudQro-CCYgWfsv.js"])))=>i.map(i=>d[i]);
import{H as Y,_ as K}from"./index-CTl7hdrJ.js";import{q as ee,v as I,c as ue,bD as ce,bE as pe,Y as p,H as d,G as te}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{s as de}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{J as E,S as $,V as U}from"./TemporalSceneLayerView-B-MmOgDo-AG1ksN3O.js";import{r as ye}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{aT as ge,aj as A,f as W,a5 as he,a0 as me,a1 as fe,a6 as je}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{W as C,O as D,L as N}from"./vec32-CewSdTn3-DHOFKD0R.js";import{M as G}from"./collectionUtils-jDyktm0P-ArdXNs6F.js";import{L as _e}from"./WhereClause-BSVqskBz-DANRwfyr.js";import{L as we,W as q}from"./projectionUtils-BGH_5_I3-BySNUA-B.js";import{X as V}from"./projectBoundingSphere-B69Mxmv9-93ObKDbx.js";import{x as M}from"./projectVectorToVector-Csv3NYZI-BsIKHfQD.js";import{l as se}from"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import{L as be,V as ve,S as Se}from"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import{y as Re}from"./DoubleArray-DExKNiTh-CvVpHySW.js";import{g as xe}from"./sphere-DLQ6p7mp-DmnRpHXV.js";import{_ as Fe}from"./FeatureFilter-G4_pWMVe-vo0uU6rO.js";import{Q as Ie,N as Ee}from"./I3SUtil-BtVE6TXz-Cfu4PxXY.js";import{z as Oe}from"./Extent-CgDMOSRD-CU1qE5Kr.js";import{a6 as Ce}from"./ShadowCastClear.glsl-CeOT_rAo-iOFMl8eB.js";import{h as De}from"./QueryEngine-J0SYKhS8-CFA9lsZ6.js";import{m as Ge}from"./FieldsIndex-CimK-TqD-CrSnohIk.js";import{c as Me}from"./FeatureSet-BF7daP96-BqhMUjXs.js";import{o as Qe}from"./Query-BlS0WPDF-BdshFBMz.js";import{O as T,P as ke}from"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import{J as z}from"./I3SBinaryReader-ZmgM2p_h-BnxBvCpV.js";const P=(t,e=P,s=e.f||(e.f=["assets/geometryEngine-CugHcx4E.js","assets/jsonMap-Bs3hmeCU.js","assets/Point-BfTTZoMu.js","assets/reader-DcGs6kKN.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css","assets/geometryEngineBase-BQTefT4Y.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/Extent-CgDMOSRD.js","assets/Polyline-CoiTLswR.js","assets/Polygon-D6wEPb3W.js","assets/aaBoundingRect-CjwcS2F3.js","assets/mathUtils-PIGhLnI9.js","assets/I3SQueryResultGeometry-CiT4lFOy.js","assets/jsonUtils-CmpazY1u.js","assets/FeatureSet-BF7daP96.js","assets/Graphic-DgGzDmqW.js","assets/getPopupProvider-CmskPttI.js","assets/collectionUtils-jDyktm0P.js","assets/reactiveUtils-SO2Ko3sy.js","assets/SimpleObservable-CvFyr0NA.js","assets/lengthUtils-Dt1_RvOO.js","assets/date-IqUzANpt.js","assets/Color-CERqXxxY.js","assets/Layer-DZvC7bne.js","assets/typeUtils-DqrRcjBx.js","assets/createFeatureId-CVwTD0fV.js","assets/typeUtils-CXW_VpOn.js","assets/lineMarkers-CDwLe3J6.js","assets/PolygonSymbol3D-BXRHZiCQ.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x.js","assets/screenUtils-BitdhK1O.js","assets/opacityUtils-DuFH0EC9.js","assets/aaBoundingBox-Cn49X7ge.js","assets/DoubleArray-DExKNiTh.js","assets/mat4f64-q_b6UJoq.js","assets/Font-BwmnW7d2.js","assets/SimpleFillSymbol-CDawtd9z.js","assets/SimpleMarkerSymbol-BGAFRS9_.js","assets/PictureMarkerSymbol-CaSh-vZk.js","assets/TextSymbol-hRGhyDHs.js","assets/Field-Cm_ZejYW.js","assets/fieldType-DVUzXtk_.js","assets/meshUtils-DPfwf6VG.js","assets/Mesh-CkDBRbaq.js","assets/axisAngleDegrees-CjbXmycq.js","assets/mat4-C96X-Nn0.js","assets/quat-B7J5v7rV.js","assets/quatf64-CCm9z-pX.js","assets/vec32-CewSdTn3.js","assets/vec42-B8VM4vXb.js","assets/MeshComponent-Ccgxjntc.js","assets/imageUtils-142g71N8.js","assets/meshProperties-DWLWd_LJ.js","assets/MeshLocalVertexSpace-BGd1IdEs.js","assets/MeshTransform-Bl0zl104.js","assets/MeshVertexAttributes-CsRRGxwu.js","assets/meshVertexSpaceUtils-CtG7DPVT.js","assets/triangulationUtils-D34y65Gu.js","assets/earcut-D9gy186-.js","assets/Indices-D0_UQPPr.js","assets/plane-BNdSPG2o.js","assets/vector-B8ZDYGQ6.js","assets/vec2f64-rIxtbMRN.js","assets/vec4f64-DPb6J-GU.js","assets/deduplicate-Lzwo1kX7.js","assets/projectPointToVector-DL7Z4uvb.js","assets/projectionUtils-BGH_5_I3.js","assets/vertexSpaceConversion-DwAXLcxI.js","assets/spatialReferenceEllipsoidUtils-D2JabnKt.js","assets/computeTranslationToOriginAndRotation-Bjd4esRf.js","assets/vec3-B_phcnZY.js","assets/BufferView-Cj2sQaht.js","assets/vec4-B7mYuNMQ.js","assets/External-DqWxNHeL.js","assets/infoFor3D-DhzudQro.js"]))=>t.map(r=>s[r]);let g=class extends ee{constructor(t){super(t),this._projectionEngineLoaded=!1}initialize(){ye(()=>this.viewFilter?.geometry||this.layerFilter!=null).then(()=>this.loadAsyncModule(Y(()=>K(()=>import("./geometryEngine-CugHcx4E-yvuPstSU.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),P([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(t=>{this.destroyed||(this._geometryEngine=t)})))}get sortedObjectIds(){if(this.viewFilter?.objectIds==null)return null;const t=Re(this.viewFilter.objectIds);return t.sort(),t}get parsedWhereClause(){const t=this.viewFilter?.where;if(t==null||!t)return null;try{return _e.create(t,{fieldsIndex:this.layerFieldsIndex})}catch(e){I.getLogger(this).error(`Failed to parse filter where clause: ${e}`)}return null}addFilters(t,e,s,r){const i=this.sortedObjectIds;i!=null&&t.push(l=>Ie(i,!0,l)),this.addSqlFilter(t,this.parsedWhereClause),this.addTimeFilter(t,this.viewFilter?.timeExtent);const n=E(this._layerMaskGeometries),a=this._geometryEngine,o=()=>I.getLogger(this);if(n!=null&&this.layerFilter!=null&&a!=null){const l=this.layerFilter.spatialRelationship;t.push((y,c)=>X(o,a,y,c,r,e,s,n,l))}const u=E(this._viewMaskGeometries);if(u!=null&&this.viewFilter!=null&&a!=null){const l=this.viewFilter.spatialRelationship;t.push((y,c)=>X(o,a,y,c,r,e,s,u,l))}}isMBSGeometryVisible(t,e,s){const r=E(this._layerMaskGeometries),i=this._geometryEngine;if(r!=null&&this.layerFilter!=null&&i!=null){const a=this.layerFilter.spatialRelationship,o=r[0].spatialReference||e;return V(t,s,O,o)?H(i,O,r,o,a):(I.getLogger(this).warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}const n=E(this._viewMaskGeometries);if(n!=null&&this.viewFilter!=null&&i!=null){const a=this.viewFilter.spatialRelationship,o=n[0].spatialReference||e;return V(t,s,O,o)?H(i,O,n,o,a):(I.getLogger(this).warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){const t=E(this._viewMaskGeometries),e=E(this._layerMaskGeometries);return t==null||e==null?t||e:e.concat(t)}get _layerMaskGeometries(){const t=this.layerFilter;return t==null?null:this._geometryEngine==null?$:t.spatialRelationship==="disjoint"?t.geometries.map(e=>({type:"polygon",rings:e.rings,spatialReference:e.spatialReference,cache:{}})):[t.geometries.reduce((e,s)=>(e.rings=[...e.rings,...s.rings],e),{type:"polygon",rings:[],spatialReference:t.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(this.viewFilter==null)return null;const{geometry:t}=this.viewFilter;if(t==null)return null;if(this.viewFilter==null||this._geometryEngine==null)return $;const{distance:e,units:s}=this.viewFilter,r=this.viewFilter.spatialRelationship,i=t.type==="mesh"?t.extent:t;if(e==null||e===0)return Q(this._geometryEngine,i,r);const n=s||ge(i.spatialReference);if(i.spatialReference.isWGS84){const u=this._geometryEngine.geodesicBuffer(i,e,n);return Q(this._geometryEngine,u,r)}const a=A(i,W.WGS84);if(a!=null){const u=A(this._geometryEngine.geodesicBuffer(a,e,n),i.spatialReference);return Q(this._geometryEngine,u,r)}if(!this._projectionEngineLoaded&&(this.loadAsyncModule(we().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let o=null;try{o=q(i,W.WGS84)}catch{}if(o)try{o=q(this._geometryEngine.geodesicBuffer(o,e,n),i.spatialReference)}catch{o=null}return o||I.getLogger(this).error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${i.spatialReference.wkid}) to WGS84.`),Q(this._geometryEngine,o,r)}get updating(){return U(this._layerMaskGeometries)||U(this._viewMaskGeometries)}static checkSupport(t){return t!=null&&(!!Le(t.spatialRelationship)||(I.getLogger(this.prototype).warn(`Filters with spatialRelationship other than ${re.join(", ")} are not supported for mesh scene layers`),!1))}};p([d()],g.prototype,"layerFilter",void 0),p([d({type:Fe})],g.prototype,"viewFilter",void 0),p([d()],g.prototype,"layerFieldsIndex",void 0),p([d()],g.prototype,"loadAsyncModule",void 0),p([d()],g.prototype,"addSqlFilter",void 0),p([d()],g.prototype,"addTimeFilter",void 0),p([d({readOnly:!0})],g.prototype,"sortedObjectIds",null),p([d({readOnly:!0})],g.prototype,"parsedWhereClause",null),p([d({readOnly:!0})],g.prototype,"parsedGeometry",null),p([d({readOnly:!0})],g.prototype,"_layerMaskGeometries",null),p([d({readOnly:!0})],g.prototype,"_viewMaskGeometries",null),p([d()],g.prototype,"updating",null),p([d()],g.prototype,"_projectionEngineLoaded",void 0),p([d()],g.prototype,"_geometryEngine",void 0),g=p([te("esri.views.3d.layers.i3s.I3SMeshViewFilter")],g);const re=(t=>t)(["contains","intersects","disjoint"]);function Le(t){return t!=null&&re.includes(t)}function Q(t,e,s){if(e==null)return null;if(s==="disjoint"&&e.type==="polygon"){const r=e.rings.length,i=e.spatialReference,n=new Array(r);for(let u=0;u<r;++u){const l=be(1/0,1/0,-1/0,-1/0);ve(l,e.rings[u]),n[u]={type:"polygon",rings:[e.rings[u]],spatialReference:i,cache:{},aabr:l}}n.sort((u,l)=>u.aabr[0]-l.aabr[0]);const a=new Set,o=new pe;for(let u=0;u<n.length;++u){const l=n[u],y=l.aabr[0];a.forEach(c=>{if(y>=c.aabr[2])return void a.delete(c);if(l.aabr[1]>c.aabr[3]||l.aabr[3]<c.aabr[1]||!t.intersects(l,c))return;l.rings=l.rings.concat(c.rings),Se(l.aabr,c.aabr,l.aabr),l.cache={},a.delete(c);const m=ce(n,c,n.length,o);n.splice(m,1)}),a.add(l)}for(const u of n)u.aabr=void 0;return n}return[e]}function H(t,e,s,r,i){if(e[3]>=.5*(e[2]+he(r).radius))return!0;const n=ie(t,e,r);return s.every(a=>ne(t,a,n,i)!==1)}function X(t,e,s,r,i,n,a,o,u){const l=o[0].spatialReference||n.spatialReference;if(!V(r.node.serviceMbsInIndexSR,a,O,l))return void t().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const y=ie(e,O,l),c=Be(u,n,l,i,r.objectHandle),m=u==="intersects";let h=null;for(const _ of o){if(s.length===0)return;switch(ne(e,_,y,u)){case 1:return m&&(r.weaklyRemovedIds=r.weaklyRemovedIds?.concat(s)??s.slice()),void(s.length=0);case 0:continue}Ee(s,r.featureIds,w=>!!Ne(e,_,w,c)||(m&&(h||=[],h.push(r.featureIds[w])),!1))}h&&(r.weaklyRemovedIds=r.weaklyRemovedIds?.concat(h)??h)}const O=xe(0,0,0,0);function Be(t,e,s,r,i){const n=e.renderSpatialReference,a=new Map,o={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:s};o.rings[0][3]=o.rings[0][0];const u={indices:null,data:null,stride:0,startIndex:0,endIndex:0};let l,y;switch(t){case"intersects":l=(c,m,h)=>c.intersects(m,h)?0:2,y=J;break;case"contains":l=(c,m,h)=>c.contains(m,h)?2:1,y=J;break;default:l=(c,m,h)=>c.disjoint(m,h)?2:1,y=ae}return{collection:r,object:i,type:t,maskSR:s,renderSR:n,aabbCache:a,triangle:o,positions:u,triangleTest:l,geometryTest:y}}function ie(t,e,s){const r={type:"point",x:e[0],y:e[1],hasZ:!1,hasM:!1,spatialReference:s},i=!me(s)&&!fe(s),n=Number.isNaN(e[3])?0:de(e[3],0,2*je.radius),a=i?t.buffer(r,n,1):t.geodesicBuffer(r,n,1);return a.type="polygon",a}function ne(t,e,s,r){switch(r){case"intersects":case"contains":return J(t,e,s);case"disjoint":return ae(t,e,s)}}function J(t,e,s){return t.intersects(e,s)?t.contains(e,s)?0:2:1}function ae(t,e,s){return t.intersects(e,s)?t.contains(e,s)?1:2:0}function Ne(t,e,s,r){const{collection:i,object:n,renderSR:a,maskSR:o,geometryTest:u,aabbCache:l}=r;let y=l.get(s);if(!y){const S=i.getObjectTransform(n);i.getComponentAabb(n,s,v);const j=[G(v[0],v[1],0),G(v[0],v[4],0),G(v[3],v[4],0),G(v[3],v[1],0)];for(let f=0;f<4;++f)C(j[f],j[f],S.rotationScale),D(j[f],j[f],S.position),M(j[f],a,j[f],o);y={type:"polygon",rings:[j],spatialReference:o,cache:{}},y.rings[0][4]=y.rings[0][0],l.set(s,y)}switch(u(t,e,y)){case 1:return!1;case 0:return!0}const{triangle:c,triangleTest:m,positions:h}=r,_=c.rings[0][0],w=c.rings[0][1],x=c.rings[0][2],F=i.getObjectTransform(n);i.getComponentPositions(n,s,h);const{indices:k,data:b,stride:L,startIndex:oe,endIndex:le}=h;for(let S=oe;S<le;S+=3){const j=L*k[S],f=L*k[S+1],B=L*k[S+2];switch(N(_,b[j],b[j+1],b[j+2]),N(w,b[f],b[f+1],b[f+2]),N(x,b[B],b[B+1],b[B+2]),C(_,_,F.rotationScale),C(w,w,F.rotationScale),C(x,x,F.rotationScale),D(_,_,F.position),D(w,w,F.position),D(x,x,F.position),M(_,a,_,o),M(w,a,w,o),M(x,a,x,o),m(t,e,c)){case 1:return!1;case 0:return!0}}return r.type!=="intersects"}const v=se(),Te=De;let R=class extends ee{constructor(t){super(t)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=ue(this._dataQueryEngineInstance),this._set("layerView",null)}get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return new Qe({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}async executeQueryForCount(t,e){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),e)}async executeQueryForExtent(t,e){const{count:s,extent:r}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),e);return{count:s,extent:Oe.fromJSON(r)}}async executeQueryForIds(t,e){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),e)}async executeQuery(t,e){const s=this._ensureQueryJSON(t),r=await this._dataQueryEngine.executeQuery(s,e);if(t?.returnGeometry){const{processQueryGeometries:i}=await Y(()=>K(()=>import("./I3SQueryResultGeometry-CiT4lFOy-Dm4JBcX2.js"),__vite__mapDeps([13,2,3,4,1,5,14,8,9,10,11,12,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75])),P([13,2,1,3,4,5,14,8,9,10,11,12,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75]));return i(this.layerView,r)}return Me.fromJSON(r)}_ensureQueryJSON(t){return t==null?this.defaultQueryJSON:t.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const t=this.layer.objectIdField||Ce,e="esriGeometryPolygon",s=this.layer.fieldsIndex?.toJSON()||new Ge([]),r=this.layerView.view.resourceController.scheduler,i=this.spatialReference.toJSON(),n=this.priority,a=this.spatialIndex;return this._dataQueryEngineInstance=new Te({hasZ:!0,hasM:!1,geometryType:e,fieldsIndex:s,timeInfo:null,spatialReference:i,featureIdInfo:{type:"object-id",fieldName:t},featureStore:a,scheduler:r,priority:n}),this._dataQueryEngineInstance}};p([d({constructOnly:!0})],R.prototype,"layerView",void 0),p([d({constructOnly:!0})],R.prototype,"priority",void 0),p([d({constructOnly:!0})],R.prototype,"spatialIndex",void 0),p([d()],R.prototype,"spatialReference",null),p([d()],R.prototype,"layer",null),p([d()],R.prototype,"defaultQueryJSON",null),R=p([te("esri.views.3d.layers.i3s.I3SQueryEngine")],R);class yt{constructor(e){this._objectIdField=e.objectIdField,this._getFeatureExtent=e.getFeatureExtent}getObjectId(e){return e.id}getAttributes(e){const{meta:s,index:r}=e,i={};this._objectIdField&&(i[this._objectIdField]=e.id);const n=s.attributeInfo?.attributeData;if(n!=null)for(const a of Object.keys(n))i[a]=z(n[a],r);return i}getAttribute(e,s){if(s===this._objectIdField)return e.id;const{meta:r,index:i}=e,n=r.attributeInfo?.attributeData;return n!=null?z(n[s],i):null}getGeometry(e){if(e.geometry)return e.geometry;const[s,r,i,n,a,o]=this._getFeatureExtent(e,Z);return new T([5,5],[s,r,i,n,r,i,n,a,i,s,a,i,s,r,i,s,r,o,n,r,o,n,a,o,s,a,o,s,r,o])}getCentroid(e,s){if(e.geometry)return ke(new T,e.geometry,s.hasZ,s.hasM);const[r,i,n,a,o,u]=this._getFeatureExtent(e,Z);return new T([0],[(r+a)/2,(i+o)/2,(n+u)/2])}cloneWithGeometry(e,s){const{id:r,index:i,meta:n}=e;return new Ve(r,i,n,s)}getMetadata(e){return e}}class Ve{constructor(e,s,r,i){this.id=e,this.index=s,this.meta=r,this.geometry=i}get usedMemory(){return 32+(this.geometry?.usedMemory??0)}}const Z=se();export{Ve as A,R,g,yt as p};
