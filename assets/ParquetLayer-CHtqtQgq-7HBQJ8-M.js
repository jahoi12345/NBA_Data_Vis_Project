import{l as b,bh as I,I as S,v as y,o as d,Y as r,H as o,G as q,K as c}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{j as _,A as F}from"./getPopupProvider-CmskPttI-CzUWpGwk.js";import{Y as j,R as m,k as P}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{k as R}from"./MultiOriginJSONSupport-Bd1TKmh_-BHNF5tHX.js";import{j as h}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{u as T}from"./reader-DcGs6kKN-DHJfK-tm.js";import{z as x}from"./Extent-CgDMOSRD-Bod5LY6s.js";import{m as J,f as N}from"./Point-BfTTZoMu-DeJwQYfh.js";import{m as $}from"./Graphic-DgGzDmqW-d1CNicxz.js";import{e as E,r as z}from"./GraphicOrigin-uE6TDXc9-DqbdmNAV.js";import{o as L}from"./Layer-DZvC7bne-D3VLDrab.js";import{G as C}from"./workers-BEkgoq8Q-BM_Hz460.js";import{M as k,a as D,u as G,p as Q,g as u}from"./parquetUtils-CmGs5KEq-CMUTnQBB.js";import{c as U}from"./FeatureSet-BF7daP96-B_JvMbY7.js";import{y as Y}from"./BlendLayer-HE_aYHHW-D0es7Iiq.js";import{i as H}from"./CustomParametersMixin-Dshqz1Zp-BFC165kX.js";import{E as M}from"./DisplayFilteredLayer-DyjtPayS-DLMYIA49.js";import{n as V}from"./FeatureEffectLayer-BG_KTtPw-C05GQDNc.js";import{L as A}from"./FeatureReductionLayer-Bhh5MvS_-6_Dufsno.js";import{C as K,v as W,I as B,L as X}from"./OperationalLayer-B6zbJ5nR-DyK_ztCk.js";import{m as Z}from"./OrderedLayer-DQAUgUTV-CpnQmtbN.js";import{s as ee}from"./ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js";import{j as te}from"./TemporalLayer-D4R0YvXo-PSBzKw25.js";import{e as re}from"./FeatureTemplate-Bur8tORn-C24tlGMe.js";import{o as ie}from"./Field-Cm_ZejYW-CwJZmSru.js";import{h as oe}from"./fieldProperties-BoJj55FN-DI1Lssr9.js";import{r as f,l as se}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import{e as ae,i as pe}from"./labelingInfo-BYG2hiVF-B7-dv03v.js";import{e as ne}from"./typeUtils-DDFS4uuz-B7KgP61w.js";import{o as g}from"./Query-BlS0WPDF-jdXS_Qhy.js";import{S as le}from"./popupUtils-D4UavgYz-DI7Mb3me.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./index-B0z_nLWi.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import"./typeUtils-DqrRcjBx-DZ6_Gsbu.js";import"./typeUtils-CXW_VpOn-BGgLp_TK.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-BjPAY2LA.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./aaBoundingBox-Cn49X7ge-BcYPaJ58.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./Font-BwmnW7d2-Dwh3xjKw.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./PictureMarkerSymbol-CaSh-vZk-xhjZ61bb.js";import"./TextSymbol-hRGhyDHs-CoS7dSjf.js";import"./intl-DRFqUect-DPhFaHB2.js";import"./parquet-BvPtb2Qg-CVHFozQb.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./mat4-C96X-Nn0-BrMLOLCb.js";import"./FeatureEffect-mVCOF1v6--fvFHZv2.js";import"./FeatureFilter-G4_pWMVe-D0hu4KAy.js";import"./FeatureReductionSelection-Du7o8OIG-DmruV-ou.js";import"./featureLayerUtils-FKjLNPl_-Cv8vWd4i.js";import"./asyncUtils-w6KfWU41-HenJ0UOu.js";import"./SimpleRenderer-CEmCWePp-BJ25mYcH.js";import"./commonProperties-DbO613LF-CHjBvYhj.js";import"./colorRamps-DswZzxkO-BqSFavfl.js";import"./ColorStop-De5gQTjr-C1lw16u9.js";import"./visualVariableUtils-ma4r7Z2K-Df6C3Hkh.js";import"./defaults3D-C2hXSee1-CTj29-Ly.js";import"./defaults-BDN9qxeN-C-EfxQM4.js";import"./UniqueValueRenderer-JPjz9Qvs-Duu1CubQ.js";import"./RendererLegendOptions-ByGHYLtx-Bwoo6l33.js";import"./NormalizationBinParametersMixin-BK9wNkI3-BKYeOhDN.js";import"./jsonUtils-BCGKNxno-DZ1Xr_O8.js";import"./ElevationInfo-Cw2HaA6E-CuK5hJ96.js";import"./unitConversionUtils-4vB4Ezlp-DnY5MDxd.js";import"./TimeInfo-D7ssmbZO-Burc-nDV.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./ClassBreaksRenderer-BvgdqtTq-D2fU8Sng.js";import"./LRUCache-fy84PBMi-Y56WPIvD.js";import"./vec42-B8VM4vXb-B6OGOEI9.js";import"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./jsonUtils-CmpazY1u-6pDLj5sx.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./Queue-CYlrXMwB-CYJTUII-.js";import"./locationUtils-BujNe57r-CEsJep6e.js";import"./layerContainerType-CSXZNpHb-BIF7XAYP.js";import"./jsonUtils-CY6YsQMo-LM0PY-PG.js";import"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./scaleUtils-yfx9kKWT-D9SVsyM-.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./displayFilterUtils-CIXGrQzt-XEoxkZ3i.js";import"./MD5-MtSiOt06-jWr180Yc.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./FieldsIndex-CimK-TqD--24JoCkp.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./labelUtils-BtizwBfq-Zegx4520.js";import"./layerUtils-DZGhvm-W-CfyHx1TZ.js";import"./jsonUtils-C9q_FK4K-GRCbm_Pe.js";import"./DictionaryScriptEvaluator-G73uSGpN-ErvAW-Hm.js";import"./Version-BtYZEj58-LyRHDnSJ.js";import"./ArcadeExpression-BlIRq-oN-VZkrwLVE.js";import"./TimeOnly-BERR31kg-CQiLyUZi.js";import"./enum-BzLwmiID-CcyIdWlQ.js";import"./utils-DX2muIr3-DiPfFKSl.js";import"./heatmapUtils-B-AXnq0l-BF3Q_jd2.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./QueueProcessor-D8z0mMzA-GcdBlDoB.js";import"./ReactiveMap-B0by2bYu-DCsCfMj5.js";import"./signal-BX9ezF8a-cf1Pn6io.js";import"./featureQueryAll-BfDWA5Wx-BKksFkIA.js";import"./defaultsJSON-GKolV7NZ-GKolV7NZ.js";import"./diffUtils-wTC1YzlE-DCTUTUs8.js";import"./styleUtils-DWvicjTN-DL6_BIk4.js";const ue=Symbol("isParquetGraphicOrigin");var v;class me extends E{get[(v=ue,_)](){return this.layer}get[$](){return this.layer}get[z](){return this.layer}constructor(t){super(),this[v]=!0,this.type="parquet",this.layer=t}get id(){return this.layer.id}}let l=class extends P{constructor(e){super(e),this.type="parquet"}load(e){const t=e!=null?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){this._connection?.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{y.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t?.signal})}async queryFeatures(e,t={}){const s=await this.queryFeaturesJSON(e,{signal:t?.signal});return U.fromJSON(s)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t?.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t?.signal})}async queryExtent(e,t){if(this.layer.encoding==null)return y.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const s=await this._proxy.queryExtent(e.toJSON(),{signal:t?.signal});return{count:s.count,extent:x.fromJSON(s.extent)}}async _initialize(e){this._connection=await C("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),d(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:t,capabilities:s}=await this._proxy.load({urls:this.layer.urls.items,fields:this.layer.fields?.map(a=>a.toJSON()),geometryType:this.layer.geometryType?k(this.layer.geometryType):null,spatialReference:this.layer.spatialReference?.toJSON(),encoding:this.layer.encoding?.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});d(e),this.sourceJSON=t,this.capabilities=s}};r([o()],l.prototype,"type",void 0),r([o({constructOnly:!0})],l.prototype,"layer",void 0),r([o()],l.prototype,"sourceJSON",void 0),r([o()],l.prototype,"capabilities",void 0),l=r([q("esri.layers.graphics.sources.ParquetSource")],l);const w=oe(),O="__OBJECTID",ye={types:{key:"type",base:Q,typeMap:{wkb:G,location:D}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let i=class extends M(A(V(Y(Z(te(ee(K(R(H(j(L))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new me(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=O,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!b("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new m}destroy(){this.source?.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([h(()=>this.urls,t=>this.source?.updateFiles(t.items)),h(()=>this.customParameters,t=>this.source?.setCustomParameters(t))]),this}get capabilities(){return this.source?.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,s,a){const p=e.filter(n=>!(n.name===O&&n.type==="oid")).map(n=>n.toJSON(a));I(s,p,t)}get isTable(){return this.encoding==null}set renderer(e){f(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new m(e.type==="files"?e.urls:[])}writeUrls(e,t,s,a){const p=[];if(e?.length){a={blockedRelativeUrls:a?.blockedRelativeUrls};for(let n of e)n=J(n,a),n&&p.push(n)}p.length?t.source={type:"files",urls:p}:a.messages?.push(new S("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return le(this,e)}createQuery(){const e=new g;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new l({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const s=await this.source.queryFeatures(this._normalizeQuery(e),t),a=this.graphicOrigin;if(s?.features)for(const p of s.features)p.layer=p.sourceLayer=this,p.origin=a;return s}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return g.from(e)??this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),f(this.renderer,this.fieldsIndex),se(this.timeInfo,this.fieldsIndex),this.spatialReference==null&&(this.spatialReference=N.WGS84)}};r([o({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([o({type:String})],i.prototype,"copyright",void 0),r([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([o()],i.prototype,"displayOptimization",void 0),r([o({type:[ie],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([c("fields")],i.prototype,"writeFields",null),r([o(w.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([o(ye)],i.prototype,"encoding",void 0),r([o({type:x,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([o({type:u.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:u.read},write:{writer:u.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:u.read}}}}})],i.prototype,"geometryType",void 0),r([o({readOnly:!0,clonable:!1})],i.prototype,"graphicOrigin",void 0),r([o(W)],i.prototype,"labelsVisible",void 0),r([o({type:[pe],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ae},write:!0}})],i.prototype,"labelingInfo",void 0),r([o(B)],i.prototype,"legendEnabled",void 0),r([o()],i.prototype,"file",void 0),r([o({type:String,readOnly:!0})],i.prototype,"objectIdField",void 0),r([o({type:["ParquetLayer"]})],i.prototype,"operationalLayerType",void 0),r([o(w.outFields)],i.prototype,"outFields",void 0),r([o(X)],i.prototype,"popupEnabled",void 0),r([o({type:F,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([o({types:ne,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],i.prototype,"renderer",null),r([o({type:l,readOnly:!0,cast:null,json:{read:!1}})],i.prototype,"source",void 0),r([o({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],i.prototype,"spatialReference",void 0),r([o({type:[re]})],i.prototype,"templates",void 0),r([o()],i.prototype,"title",void 0),r([o({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([o({type:m.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],i.prototype,"urls",void 0),r([T("urls")],i.prototype,"readUrls",null),r([c("urls")],i.prototype,"writeUrls",null),i=r([q("esri.layers.ParquetLayer")],i);const gr=i;export{gr as default};
