import{_ as w,a as y,d as c,aC as h,g as O,w as b,o as T}from"./jsonMap-Bs3hmeCU.js";import{l as v,w as d,a as $,j as C}from"./reactiveUtils-SO2Ko3sy.js";import{r as g}from"./InteractiveToolBase-Cg9kZ4Js.js";import{d as p}from"./asyncUtils-w6KfWU41.js";let u=class extends g{constructor(t){super(t)}initialize(){this.addHandles(v(()=>this.analysisViewData.visible,t=>this.visible=t,d))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};u=w([y("esri.views.interactive.AnalysisToolBase")],u);function A(t,a){t.interactive=!0;const{tool:e,view:i}=t;i.activeTool=e;let s=b(a,()=>{i.activeTool===e&&(i.activeTool=null)});return p(async n=>{await C(()=>!t.tool?.active,n),s=T(s)},a)}function z(t,a){return v(()=>t.interactive,()=>_(t,a),d)}function _(t,a){t.interactive?j(t,a):f(t)}function j(t,a){f(t);const{view:e,analysis:i}=t,s=new a({view:e,analysis:i,analysisViewData:t});return t.tool=s,e.tools.add(s),s}function f(t){const{view:a,tool:e}=t;e!=null&&(a.tools.remove(e),t.tool=null)}function D(t,a){const e=t.userOperation,i=p(async s=>{if(e){const o=e.promise.catch(()=>{});e?.abort(),await o,c(s)}const n=A(t,{signal:s}),l=a?.shouldRejectOnCancel??(()=>!0),m=h([$(()=>t.tool,"cancel",()=>{l()&&n.abort()})]),{tool:r}=t;try{r&&(r.resetCreated(),a?.onToolActivated?.(r)),await n.promise,c(s)}catch(o){if(s.aborted||!O(o)||l())throw o}finally{m?.remove()}},{signal:a?.abortOptions?.signal});return t.userOperation=i,i.promise.finally(()=>{t.userOperation===i&&(t.userOperation=null)})}async function B(t,a){const e=t.analysis.clone();return await D(t,{abortOptions:a?.placementOptions,onToolActivated:a?.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:i}=t;return!i.valid||i.equals(e)}}),{}}export{B as d,f,z as m,u as o,D as y};
