import{Y as m,G as g,I as l}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{s as I,C as b}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import{m as u,h as v}from"./popupUtils-BKHMiD6K-CUN0lBkb.js";const L=y=>{const d=y;let a=class extends d{_validateFetchPopupFeatures(t){const{layer:s}=this,{popupEnabled:p}=s;if(!p)throw new l("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s});if(!u(s,t))throw new l("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s})}async prepareFetchPopupFeatures(t){}async fetchPopupFeaturesFromGraphics(t,s){if(this._validateFetchPopupFeatures(s),t.length===0)return[];const p=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer;let n=[];"fieldsIndex"in this.layer&&(n=I(this.layer.fieldsIndex,await v(p,u(this.layer,s)))),await this.prepareFetchPopupFeatures(n);const c=new Set,o=[],r=[];for(const e of t)b(e,n,c)?r.push(e):o.push(e);if(r.length===0)return o;const i=new Map;for(let e=0;e<t.length;e++)i.set(t[e].getObjectId()??0,e);const h=await this.whenGraphicAttributes(r,[...c]).catch(()=>r).then(e=>o.concat(e));return h.sort((e,f)=>{const w=e.getObjectId()??0,F=i.get(w)??0,P=f.getObjectId()??0;return F-(i.get(P)??0)}),h}};return a=m([g("esri.views.3d.layers.support.PopupSceneLayerView")],a),a};export{L as j};
