import{a as f,w as m,m as S}from"./screenUtils-BitdhK1O-L0FLPAMi.js";import{o as F}from"./vec2f64-rIxtbMRN-Kai9mK1i.js";import{F as g,$ as x,x as y,I as $,A as O,k as h,O as k}from"./vec32-CewSdTn3-DHOFKD0R.js";import{t as i}from"./collectionUtils-jDyktm0P-ArdXNs6F.js";import{b as E}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{$ as I}from"./projectionUtils-BGH_5_I3-BySNUA-B.js";import{P as b,K as A,x as B,X as T}from"./plane-BNdSPG2o-Cq7jmU6w.js";import{x as z,n as D}from"./sphere-DLQ6p7mp-DmnRpHXV.js";import{v as C,E as K}from"./vector-B8ZDYGQ6-B1uNywRb.js";import{B as U}from"./elevationInfoUtils-B8MpdRMP-CN_w2fPT.js";import{E as v}from"./ShadowCastClear.glsl-CeOT_rAo-iOFMl8eB.js";import{z as q,_ as H}from"./Texture-CFNZjV2R-lGBztxVp.js";import{v as G}from"./InteractiveToolBase-DXh7kfgV-R_Z6wqPu.js";function J(e,r){return P(e,()=>r)}function cn(e){return P(e,r=>r.plane)}function P(e,r){const t=i(),o=i();let l=!1;return n=>{const s=r(n);if(n.action==="start"){const c=m(n.screenStart,S(C.get())),u=v(e.state.camera,c,w);u!=null&&(l=b(s,u,t))}if(!l)return null;const a=m(n.screenEnd,S(C.get())),d=v(e.state.camera,a,w);return d==null?null:b(s,d,o)?{...n,renderStart:t,renderEnd:o,plane:s,ray:d}:null}}function L(e,r,t=0,o=null,l=null){let n=null;return s=>{if(s.action==="start"&&(n=e.sceneIntersectionHelper.intersectElevationFromScreen(f(s.screenStart.x,s.screenStart.y),r,t,l),n!=null&&o!=null&&!I(n,n,o))||n==null)return null;const a=e.sceneIntersectionHelper.intersectElevationFromScreen(f(s.screenEnd.x,s.screenEnd.y),r,t,l);return a!=null&&(o==null||I(a,a,o))?{...s,mapStart:n,mapEnd:a}:null}}function N(e,r,t,o=null,l=null){return L(e,t,U(r,e,t),o,l)}function dn(e,r,t,o){const l=t.toMap(e.screenStart);return l!=null?N(r,l,t.elevationInfo,o):null}function Q(e,r){const t=R,o=M,l=A();e.renderCoordsHelper.worldUpAtPosition(r,t);const n=g(B(l),t,x(o,r,e.state.camera.eye));return g(n,n,t),T(r,n,l)}function pn(e,r,t){let o=null;const l=new G;return l.next(J(e,Q(e,r))).next(V(e,r)).next(X(e,t)).next(n=>{n.mapEnd.x=n.mapStart.x,n.mapEnd.y=n.mapStart.y,o=n}),n=>(o=null,l.execute(n),o)}function V(e,r){const t=i(),o=y(r);e.renderCoordsHelper.worldUpAtPosition(r,t);const l=i(),n=i(),s=a=>(x(a,a,r),K(t,a,a),e.viewingMode==="global"&&y(a)*Math.sign(O(t,a))<.001-o&&x(a,h(a,t,.001),r),k(a,a,r),a);return a=>(a.renderStart=s($(l,a.renderStart)),a.renderEnd=s($(n,a.renderEnd)),a)}function mn(e,r){const t=o=>{const l=m(o,S(_)),n=v(e.state.camera,l,w);return n==null?null:D(r,n,R,M)?.[0]};return o=>{const l=t(o.screenStart);if(l==null)return null;const n=t(o.screenEnd);return n==null?null:{...o,renderStart:l,renderEnd:n}}}function X(e,r){const t=e.renderCoordsHelper;return o=>{const l=t.fromRenderCoords(o.renderStart,new E({spatialReference:r})),n=t.fromRenderCoords(o.renderEnd,new E({spatialReference:r}));return l!=null&&n!=null?{...o,mapStart:l,mapEnd:n}:null}}function fn(e){let r=null;return t=>{switch(t.action){case"start":r=e.disableDisplay();break;case"end":case"cancel":r!=null&&(r.remove(),r=null)}return t}}function Sn(e,r=null){const t=new q(e.state.viewingMode);t.options.selectionMode=!0,t.options.store=0,t.options.hud=!1;const o=f(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},n=i(),s=r??e.spatialReference,a=c=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(H):l.exclude.delete(H),e.sceneIntersectionHelper.intersectIntersectorScreen(m(c,o),t,l);const u=t.results.min;let p;if(u.getIntersectionPoint(n))p=u.intersector===7?0:1;else{if(!t.results.ground.getIntersectionPoint(n))return null;p=0}return{location:e.renderCoordsHelper.fromRenderCoords(n,new E({spatialReference:s})),surfaceType:p}};let d;return c=>{if(c.action==="start"){const p=a(c.screenStart);d=p!=null?p.location:null}if(d==null)return null;const u=a(c.screenEnd);return u?.location!=null?{...c,mapStart:d,mapEnd:u.location,surfaceType:u.surfaceType}:null}}const _=F(),R=i(),M=i(),w=z();export{J as B,N as O,X as Q,Sn as S,cn as c,dn as d,pn as f,mn as m,fn as p};
