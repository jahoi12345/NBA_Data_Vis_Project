import{x as Dt,c as M,q as at,v as At,b as xt,Y as n,H as r,G as I}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{s as Tt}from"./getDefaultUnitForView-BIGim07z-DyM4eekL.js";import{s as Ht}from"./AnalysisView3D-zhHEgrUR-DZ8OICjY.js";import{s as z,by as Gt,a9 as lt,bq as $t}from"./ShadowCastClear.glsl-CeOT_rAo-BEYyVrmo.js";import{j as P,W as Rt,l as O,o as B,s as jt}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{bz as kt,af as It,bq as ut,bp as Wt,b as Ft}from"./Point-BfTTZoMu-DeJwQYfh.js";import{N as W,G as Bt,I as qt,a as Qt,B as dt,q as Ut,e as Nt}from"./ShadedColorMaterial.glsl-Cdsx30m0-BzzDoTK3.js";import{r as Yt,M as Zt,P as Jt,S as Q,o as Kt}from"./euclideanLengthMeasurementUtils-CpHh36Dt-Ct4GxOU1.js";import{V as Xt}from"./intl-DRFqUect-DPhFaHB2.js";import{c as ht,a as St,n as st,e as ct,i as nt,s as te}from"./colorUtils-CeIi7j7j-C2WVx6th.js";import{E as ee,y as ie}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{i as U,T as se,B as pt,q as ne,F as mt}from"./quantityFormatUtils-WvkXaau6-BdljHfvV.js";import{g as Mt,y as ot}from"./screenUtils-BitdhK1O-L0FLPAMi.js";import{j as gt}from"./Polygon-D6wEPb3W-D2MPjRU4.js";import{k as re,O as ae,I as oe,$ as Vt,h as le,F as Ot,a as ue,L as N,l as Y,v as de,V as Z}from"./vec32-CewSdTn3-VRto2OOh.js";import{t as C}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{$ as J,k as vt,E as j,P as _t}from"./Segment-DyJXA5Sk-ByhPeua0.js";import{n as he}from"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import{_ as yt}from"./vec42-B8VM4vXb-B6OGOEI9.js";import{o as wt,e as K}from"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import{z as F}from"./vector-B8ZDYGQ6-DRILJdcx.js";import{aZ as ce,u as pe,o as q,a2 as me,Y as ge,w as ve,N as _e,B as ye,F as we,al as fe,aU as be,ao as Pe,ay as Le,aO as Ce,aT as X,ca as ft}from"./Texture-CFNZjV2R-CxGjQ8pI.js";import{M as Se,l as Me,x as Ve}from"./RealisticTree.glsl-WN9nrQUl-QZiY3aPA.js";import{l as bt,y as tt,n as k}from"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import{H as Oe}from"./index-B0z_nLWi.js";import{p as Ee}from"./InterleavedLayout-B7roQAzV-CdGz7mlm.js";import{E as ze}from"./enums-B4pqBiXb-BO-3hS_8.js";import{G as De,o as Ae}from"./SnappingVisualizer3D-BUM9kaD3-CbKiGHEy.js";import{r as et}from"./lineStippleUtils-CCavR4OV-DESXkwZW.js";import{m as xe}from"./elevationInfoUtils-B8MpdRMP-CDlK86wO.js";import{r as Te}from"./UpdatingHandles-D2RI_3Hb-dwLPjVun.js";import{U as He}from"./measurementUtils-C1dpMJBr-CQSGKAus.js";import{p as Ge,S as $e}from"./dragEventPipeline3D-DqqdeG4y-VV3Rp8Vu.js";import{F as Pt}from"./Color-CERqXxxY-BuYn26eI.js";import{x as Re}from"./frustum-CMzahy3--B-DC1Co-.js";import{H as je}from"./LaserlinePath.glsl-DfE4imRj-NE31_VCm.js";import{z as ke,f as Ie,B as We,u as Fe}from"./analysisViewUtils-Z_Z4rbWk-DeDBcjbG.js";import{S as Be,Z as qe,d as Qe}from"./EditGeometryOperations-DZvKpTU8-DnyvzBdp.js";import{J as Ue,e as Ne}from"./InteractiveToolBase-DXh7kfgV-B5EAl8tr.js";import{g as Ye}from"./SnappingContext-CApcAey_-Bfkkm4s2.js";import{r as Ze}from"./SnappingDragPipelineStep-Uh4sAWwf-B8_f2Way.js";import{v as Je}from"./SnappingManagerPool-DdmH-hls-D0aqF7h-.js";import"./mat4-C96X-Nn0-BrMLOLCb.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./typeUtils-DqrRcjBx-DZ6_Gsbu.js";import"./modeUtils-BA-mAwuS-DSb1K26b.js";import"./sanitizerUtils-BT_8V5US-CWQWUwZQ.js";import"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./workers-BEkgoq8Q-BM_Hz460.js";import"./PooledRBush-Dco5QkUp-DX3CMhf3.js";import"./GraphicsCollection-Bk6M0b7D-Dk6KdmO7.js";import"./Graphic-DgGzDmqW-d1CNicxz.js";import"./getPopupProvider-CmskPttI-CzUWpGwk.js";import"./Layer-DZvC7bne-D3VLDrab.js";import"./typeUtils-CXW_VpOn-BGgLp_TK.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-BjPAY2LA.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./aaBoundingBox-Cn49X7ge-BcYPaJ58.js";import"./Font-BwmnW7d2-Dwh3xjKw.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./PictureMarkerSymbol-CaSh-vZk-xhjZ61bb.js";import"./TextSymbol-hRGhyDHs-CoS7dSjf.js";import"./HeightModelInfo-D5IdRvJ2-23y6MRiu.js";import"./projectionUtils-BGH_5_I3-DGwchVO8.js";import"./spatialReferenceEllipsoidUtils-D2JabnKt-Ce3ED0lc.js";import"./TilemapCache-CjhKW_vj-8gKqgQfa.js";import"./LRUCache-fy84PBMi-Y56WPIvD.js";import"./asyncUtils-w6KfWU41-HenJ0UOu.js";import"./Map-AEYszeHg-ZEOzAMWa.js";import"./Basemap-CL_uaRmk-O3l-dbYk.js";import"./PortalItem-DnxMlRVo-CI4Ns2_M.js";import"./writeUtils-DEFpwIW1-AHZYPaSV.js";import"./CollectionFlattener-D6h2Fkvj-WVl2BXw-.js";import"./resourceExtension-DOTCeiZj-C2WIbjQM.js";import"./PolygonCollection-HNNpnBH7-5UHgGprq.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./Query-BlS0WPDF-jdXS_Qhy.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./normalizeUtils-85zLqeMi-C1bdAKNn.js";import"./normalizeUtilsCommon-CnhQye_A-UWhaH-kt.js";import"./ElevationQuery-DzlYa4L4-DkUTW9Ak.js";import"./TileInfo-Bz7QlefV-CdK7c8ef.js";import"./vec2f64-rIxtbMRN-Kai9mK1i.js";import"./vec3f32-WCVSSNPR-9V6Uhrx-.js";import"./Scheduler-CNrsbccs-Bcg8fWoS.js";import"./Indices-D0_UQPPr-t1Qev6md.js";import"./sphere-DLQ6p7mp-DyEe1Vll.js";import"./constants-D67WmGms-H7IOwEdB.js";import"./quat-B7J5v7rV-CZ9akUv-.js";import"./quatf64-CCm9z-pX-CQ7_sSji.js";import"./projectVectorToVector-Csv3NYZI-DpBtmQMN.js";import"./floatRGBA-D-Q4FzNN-DQhowfyr.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./TileKey-C44YQC4_-BW7BBbYp.js";import"./unitConversionUtils-4vB4Ezlp-DnY5MDxd.js";import"./BufferView-Cj2sQaht-avJ4OGB_.js";import"./orientedBoundingBox-BLEx7wLU-ByGP9QG1.js";import"./vec2f32-CaVKkSa6-BjkBmyoj.js";import"./Octree-DckBBpQ7-CkRPu4UJ.js";import"./axisAngleDegrees-CjbXmycq-DcVVDR1-.js";import"./edgePreprocessing-D_eX-fWy-DqE-06Ss.js";import"./vec3-B_phcnZY-DHC7I6xa.js";import"./vec33-CWJeyzxV-Me4sF5XB.js";import"./ColorMaterial.glsl-rhi0cQVb-DVm6kWLC.js";import"./utils-DTE-xBiC-uxMmcNif.js";import"./geodeticLengthOperator-ysQZ6ofQ-ChYlynyx.js";import"./TextOverlayItem-OzxvglQU-B38vHCEh.js";import"./MeshLocalVertexSpace-BGd1IdEs-C0HJG4wR.js";import"./ExtendedLineVisualElement-B_Ze482f-1sZ0lLhF.js";import"./EngineVisualElement-DP9Jiq6V-Dztd1hg5.js";import"./allLayerSnapping-DASGx2Wx-CwdhFVIb.js";import"./jsonUtils-CmpazY1u-6pDLj5sx.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./projectPointToVector-DL7Z4uvb-CPbOlZdQ.js";import"./scaleUtils-yfx9kKWT-D9SVsyM-.js";import"./layerUtils-DZGhvm-W-CfyHx1TZ.js";import"./tagSymbols-BPcGfZon-BPcGfZon.js";import"./Queue-CYlrXMwB-CYJTUII-.js";import"./signal-BX9ezF8a-cf1Pn6io.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./ReactiveMap-B0by2bYu-DCsCfMj5.js";import"./TablesMixin-Q80MT3nU-CBB9B-b6.js";import"./plane-BNdSPG2o-DTV5z6SO.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./VertexElementDescriptor-BlxU8vCE-BwuKQkTU.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import"./computeTranslationToOriginAndRotation-Bjd4esRf-vJ4LbdOU.js";import"./layerViewUtils-BTa15X3o-BjQlX2q8.js";import"./dehydratedFeatures-Ql-uVzLq-aoK2987s.js";import"./quantizationUtils-Ceq-Uxsu-DjgKK_0s.js";import"./featureConversionUtils-BDA_FXJx-CDxX1Wik.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./HUDIntersectorResult-1xTExS7z-dL9SFL6u.js";import"./intersectorUtilsConversions-pLQPEbcN-Ck-nyNYa.js";import"./Intersector-DS9YtyQY-DMoYp6i0.js";import"./DefaultLoadingContext-DXgBe4GE-Unnb_XgV.js";import"./wosrLoader-CIPfz1Cl-DlmQQkMX.js";import"./Version-BtYZEj58-LyRHDnSJ.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./config-Dg972SSE-D9DBKeq5.js";import"./GeometryUtils-C354xUs0-BLAznQrw.js";import"./definitions-Dvg4hMIw-CdK2DzFN.js";import"./WorkerHandle-B930SiRy-DglEKt53.js";import"./capabilities-Bi6C4OG6-CpURufko.js";import"./imageUtils-142g71N8-Wj0XNClb.js";import"./videoUtils-Dwx3AEgj-CduhpDRk.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./quickselect-QQC62dOK-Br2Ahhru.js";import"./meshVertexSpaceUtils-CtG7DPVT-kybwngCt.js";import"./TileKey-CXWFOqOI-Lra6v-mg.js";import"./loadAll-BCyxerwc-B4Lp8wGC.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./persistable-CdoDQOTR-BklJqWTn.js";import"./MD5-MtSiOt06-jWr180Yc.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw-DH8sdIsE.js";import"./utils-CylVuxNi--x86XOjU.js";import"./utils-Dpg4yj1D-CeFz2JVC.js";import"./types-BKo2foNY-DE0QfIFp.js";import"./labelUtils-BtizwBfq-Zegx4520.js";import"./ArcadeExpression-BlIRq-oN-VZkrwLVE.js";import"./TimeOnly-BERR31kg-CQiLyUZi.js";import"./enum-BzLwmiID-CcyIdWlQ.js";import"./FieldsIndex-CimK-TqD--24JoCkp.js";import"./VisualElement-By4iq8p4-ZBataKFH.js";import"./line-DShd3yGd-HKPw0I1T.js";import"./geometry2dUtils-B4vDf2wH-DzgYge1I.js";import"./PointVisualElement-pF4jjqm_-CfTxywah.js";import"./rotate-CKztRS_J-BAJoscjo.js";import"./curveOperationUtils-BGqPT1bh-DTx58Z-T.js";import"./PointSnappingHint-w5twIXP5-BTP6hNJz.js";import"./dehydratedFeatureComparison-faNSTYzo-N4d2j25_.js";import"./TriangleMaterial-BIKWylXl-CXByzRQi.js";import"./geodeticCurveType-CirnHLSB-CirnHLSB.js";let H=class extends at{constructor(t){super(t)}initialize(){this.addHandles([P(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:t,startPoint:e})=>{t.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(e)},O),P(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:t,endPoint:e})=>{t.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(e)},O),P(()=>({result:this._computedResult,viewData:this.viewData}),({result:t,viewData:e})=>{e.result=t},O)])}_applyProjectionAndElevationAlignment(t){if(t==null)return t;const{spatialReference:e,elevationProvider:i}=this.view;return Bt(t,e,i)??(qt(this.analysis,t.spatialReference,At.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:i,unit:s}=this.viewData;if(t==null||e==null)return null;const o=Jt(t,e),a=this.geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(t,e);if(o==null)return null;let u,p;switch(i){case 0:p=a!=null?"geodesic":"euclidean",u=a??o.horizontal;break;case 2:if(a==null)return null;p="geodesic",u=a;break;case 1:p="euclidean",u=o.horizontal}let d=o.direct,l=o.vertical;const h=ut(d.value,d.unit,s),c=ut(u.value,u.unit,s),m=Wt(l.value,l.unit,s);return d=z(d,h),u=z(u,c),l=z(l,m),{mode:p,directDistance:d,horizontalDistance:u,verticalDistance:l}}};n([r({constructOnly:!0})],H.prototype,"view",void 0),n([r({constructOnly:!0})],H.prototype,"analysis",void 0),n([r({constructOnly:!0})],H.prototype,"viewData",void 0),n([r({constructOnly:!0})],H.prototype,"geodesicLengthMeasurementUtils",void 0),n([r()],H.prototype,"_computedResult",null),H=n([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],H);function Et(t){const e=new Le,{vertex:i,fragment:s}=e;Ce(i,t),i.uniforms.add(new tt("width",a=>a.width)),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("length","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),i.main.add(k`vec3 bitangent = normal;
vtc = uv0;
vlength = length;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;`),s.uniforms.add(new tt("outlineSize",a=>a.outlineSize),new X("outlineColor",a=>a.outlineColor),new tt("stripeLength",a=>a.stripeLength),new X("stripeEvenColor",a=>a.stripeEvenColor),new X("stripeOddColor",a=>a.stripeOddColor));const o=1/Math.sqrt(2);return s.code.add(k`
    const float INV_SQRT2 = ${k.float(o)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      }
      if (d < outlineSize) {
        return outlineColor;
      }
      return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
    }`),s.main.add(k`
    vec2 ntc = vec2(vtc.x / vradius, vtc.y);
    vec4 color = arrowColor(ntc, vlength / vradius);
    if (color.a < ${k.float(q)}) {
      discard;
    }
    fragColor = color;`),e}const Ke=Object.freeze(Object.defineProperty({__proto__:null,build:Et},Symbol.toStringTag,{value:"Module"}));class Xe extends _e{constructor(e,i){super(e,i,new ye(Ke,()=>Oe(()=>Promise.resolve().then(()=>yi),void 0)),zt.locations),this.primitiveType=ze.TRIANGLE_STRIP}initializePipeline(e){return we({blending:e.transparent?Pe(e.oitPass):null,polygonOffset:e.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:513},depthWrite:be,colorWrite:fe})}}const zt=Ee().vec3f("position").vec3f("normal").vec2f("uv0").f32("length");class rt extends ge{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1}}n([ft()],rt.prototype,"polygonOffsetEnabled",void 0),n([ft()],rt.prototype,"transparent",void 0);class ti extends pe{constructor(e){super(e,ii),this._configuration=new rt,this.intersectDraped=void 0,this.produces=new Map([[2,i=>!this._transparent&&bt(i)],[8,i=>this._transparent&&bt(i)]])}getConfiguration(e,i){return super.getConfiguration(e,i,this._configuration),this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.oitPass=i.oitPass,this._configuration}get visible(){const{outlineColor:e,stripeEvenColor:i,stripeOddColor:s}=this.parameters;return e[3]>=q||i[3]>=q||s[3]>=q}intersect(){}createGLMaterial(e){return new ei(e)}createBufferWriter(){return new li}get _transparent(){const{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}}let ei=class extends ve{beginSlot(t){return this.getTechnique(Xe,t)}};class ii extends me{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=K(1,.5,0,1),this.stripeEvenColor=K(1,1,1,1),this.stripeOddColor=K(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const si=C(),ni=C(),ri=C(),ai=C(),oi=C();class li{constructor(){this.layout=zt}elementCount(e){return 2*(e.get("position").indices.length/2+1)}write(e,i,s,o,a,u){const{data:p,indices:d}=s.get("position"),l=s.get("normal").data,h=p.length/3;d&&d.length!==2*(h-1)&&console.warn("MeasurementArrowMaterial does not support indices");const c=si,m=ni,v=ri,f=ai,V=oi,E=a.position,D=a.normal,A=a.uv0;let x=0;for(let S=0;S<h;++S){const G=3*S;if(N(c,p[G],p[G+1],p[G+2]),S<h-1){const $=3*(S+1);N(m,p[$],p[$+1],p[$+2]),N(V,l[$],l[$+1],l[$+2]),Y(V,V),Vt(v,m,c),Y(v,v),Ot(f,V,v),Y(f,f)}const T=de(c,m);e&&i&&(Z(c,c,e),Z(m,m,e),Z(f,f,i));const b=u+2*S,L=b+1;E.setVec(b,c),E.setVec(L,c),D.setVec(b,f),D.setVec(L,f),A.set(b,0,x),A.set(b,1,-1),A.set(L,0,x),A.set(L,1,1),S<h-1&&(x+=T)}const R=a.length;for(let S=0;S<2*h;++S)R.set(u+S,x);return null}}class ui extends Qt{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=C(),this._originTransform=he(),this._arrowCenter=C(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=wt(),this._contrastColor=wt(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial?.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const i=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:i})}}get color(){return this._color}set color(e){nt(e,this._color)||(yt(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){nt(e,this._color)||(yt(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){const e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e;this._arrowMaterial=new ti({outlineColor:e,stripeEvenColor:s,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new xt,this._handles.add(P(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=M(this._handles)}forEachMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(this._geometry?.startRenderSpace==null||this._geometry.endRenderSpace==null)return;const i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.transformation=this._originTransform,e.addGeometry(i),this._viewChanged()}_createArrowGeometry(e,i,s,o){const a=this.view,u=a.renderCoordsHelper,p=[],d=[],l=(h,c)=>{const m=F.get();Vt(m,h,s),p.push(m),d.push(c)};if(o.type==="euclidean"){o.eval(.5,this._arrowCenter);const h=F.get();if(u.worldUpAtPosition(this._arrowCenter,h),di(e,i,h)){const{heading:c,tilt:m}=a.camera,{direction:v}=Gt(a,e,c,m,hi);oe(h,v)}l(e,h),l(i,h)}else{o.eval(.5,this._arrowCenter);const h=this._arrowSubdivisions+1&-2;for(let c=0;c<h;++c){const m=c/(h-1),v=F.get(),f=F.get();o.eval(m,v),u.worldUpAtPosition(v,f),l(v,f)}}return Se(this._arrowMaterial,p,d)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&this._geometry!=null){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;const e=this._color,i=this._contrastColor,s=this._stripesEnabled?i:e,o=e,a=e;this._arrowMaterial.setParameters({stripeEvenColor:s,outlineColor:o,stripeOddColor:a})}}function di(t,e,i){const s=le(Lt,e,t),o=Ot(Lt,s,i);return ue(o)===0}const Lt=C(),hi=ce();let w=class extends at{get _parameters(){const t=this.view.effectiveTheme,{accentColor:e,textColor:i}=t,s=ht(e),o=St(e,.75),a=ht(st(e)),u=st(i,160);return{accentColor:s,contrastColor:a,translucentAccentColor:o,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:ct(u,.6),textCalloutColor:ct(u,.5)}}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if(t==null||e==null||t.equals(e))return 0;const i=this.analysisView.result;if(i==null)return 1;if(this.actualVisualizedMeasurement==="geodesic")return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?3:1;const{verticalDistance:s,horizontalDistance:o}=i,a=z(s,"meters").value,u=z(o,"meters").value;return Math.min(a/u,u/a)<this.triangleCollapseRatioThreshold?1:2}get actualVisualizedMeasurement(){const{measurementMode:t,result:e}=this.analysisView;switch(t){case 0:return e!=null&&z(e.horizontalDistance,"meters").value>Zt?"geodesic":"euclidean";case 1:return"euclidean";case 2:return"geodesic"}}get allowVisualElementsOrientationChange(){return this._triangleOrientationOverride==null}set allowVisualElementsOrientationChange(t){this._triangleOrientationOverride==null!==t&&(this._triangleOrientationOverride==null?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return this.actualVisualizedMeasurement==="geodesic"?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=C(),this._endPosition=C(),this._cornerPosition=C(),this._startPositionAtSeaLevel=C(),this._endPositionAtSeaLevel=C(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=0,this.triangleCollapseRatioThreshold=.03}initialize(){const t={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:e,guideStippleLengthPixels:i,triangleLineWidth:s,geodesicProjectionLineWidth:o,directLabelFontSize:a,verticalLabelFontSize:u,horizontalLabelFontSize:p}=this._parameters;this._segmentVisualElement=new ui({...t,geometry:null,renderOccluded:4}),this._triangleVisualElement=new W({...t,width:s,renderOccluded:4}),this._rightAngleQuad=new De({...t,renderOccluded:4});const d={...t,polygonOffset:!0,renderOccluded:4};this._projectedGeodesicLine=new W({...d,width:o,stipplePattern:et(i)}),this._geodesicStartHint=new W({...d,width:e,stipplePattern:et(i)}),this._geodesicEndHint=new W({...d,width:e,stipplePattern:et(i)}),this._segmentLabel=new J({...t,fontSize:a}),this._verticalLabel=new J({...t,fontSize:u}),this._horizontalLabel=new J({...t,fontSize:p}),this.addHandles([P(()=>{const{elevationAlignedStartPoint:l,elevationAlignedEndPoint:h}=this.analysisView,c=this.view;return{view:c,camera:c.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:l,elevationAlignedEndPoint:h,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},l=>this._updateGeometryAndViewMode(l),O),P(()=>({visible:this.visible,viewMode:this.viewMode}),l=>this._updateVisualElementVisibility(l),O),P(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),l=>this._updateLabelText(l),O),P(()=>({visible:this.visible,viewMode:this.viewMode}),l=>this._updateLabelVisibility(l),O),P(()=>this._measurementArrowStripeLength,l=>this._updateSegmentStripeLength(l),O),Rt(()=>this._updateMessageBundle()),P(()=>this._parameters,({textBackgroundColor:l,textCalloutColor:h,textColor:c,translucentAccentColor:m,accentColor:v,contrastColor:f})=>{const{_segmentLabel:V,_verticalLabel:E,_horizontalLabel:D,_triangleVisualElement:A,_rightAngleQuad:x,_projectedGeodesicLine:R,_geodesicStartHint:S,_geodesicEndHint:G,_segmentVisualElement:T}=this;V.backgroundColor=l,V.calloutColor=h,V.textColor=c,E.backgroundColor=l,E.calloutColor=h,E.textColor=c,D.backgroundColor=l,D.calloutColor=h,D.textColor=c,A.color=m,x.color=m,R.color=m,S.color=m,G.color=m,T.color=v,T.contrastColor=f},B)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=M(this._segmentVisualElement),this._triangleVisualElement=M(this._triangleVisualElement),this._rightAngleQuad=M(this._rightAngleQuad),this._projectedGeodesicLine=M(this._projectedGeodesicLine),this._geodesicStartHint=M(this._geodesicStartHint),this._geodesicEndHint=M(this._geodesicEndHint),this._segmentLabel=M(this._segmentLabel),this._verticalLabel=M(this._verticalLabel),this._horizontalLabel=M(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:t,viewMode:e}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(e){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:t,camera:e,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,orientation:a,visualizedMeasurement:u,stripeLength:p}){const d=t.renderCoordsHelper;if(d==null||s==null||o==null||s.equals(o))return;let l=this._startPosition,h=this._endPosition;d.toRenderCoords(s,l),d.toRenderCoords(o,h);const c=a===1?1:-1,m=c*(d.getAltitude(h)-d.getAltitude(l));m<0&&(l=this._endPosition,h=this._startPosition);const v=u==="geodesic"?new vt(this._startPosition,this._endPosition,d.spatialReference):new j(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=v,this._updateSegmentStripeLength(p),i){case 1:this._updateSegment(v,a);break;case 2:this._updateSegmentAndTriangle({view:t,camera:e,segment:v,orientation:a,startPosition:l,endPosition:h,deltaSign:c,altitudeDelta:m});break;case 3:this._updateSegmentAndProjection({view:t,orientation:a,startPosition:l,endPosition:h})}}_updateSegment(t,e){this._segmentLabel.anchor=e===1?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:t},camera:e,segment:i,orientation:s,startPosition:o,endPosition:a,deltaSign:u,altitudeDelta:p}){const d=this._cornerPosition;t.worldUpAtPosition(o,d),re(d,d,u*Math.abs(p)),ae(d,d,o),this._triangleVisualElement.geometry=[[[o[0],o[1],o[2]],[d[0],d[1],d[2]],[a[0],a[1],a[2]]]],this._rightAngleQuad.geometry={previous:o,center:d,next:a};const l=new j(o,d),h=new j(d,a),c=ci(o,a,d,s,e);c&&(this._segmentLabel.anchor=c.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:l,sampleLocation:"center"},this._verticalLabel.anchor=c.vertical,this._horizontalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._horizontalLabel.anchor=c.horizontal)}_updateSegmentAndProjection({view:{renderCoordsHelper:t},orientation:e,startPosition:i,endPosition:s}){t.setAltitude(this._startPositionAtSeaLevel,0,i),t.setAltitude(this._endPositionAtSeaLevel,0,s);const o=new vt(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(o),this._geodesicStartHint.setGeometryFromSegment(new j(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new j(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:o,sampleLocation:"center"},this._segmentLabel.anchor=e===1?"top":"bottom"}_updateLabelText({text:t,visualizedMeasurement:e}){t!=null?(this._segmentLabel.text=e==="euclidean"?t.directDistance:t.horizontalDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:t,viewMode:e}){const i=this._segmentLabel,s=this._horizontalLabel,o=this._verticalLabel;if(i.visible=!1,s.visible=!1,o.visible=!1,t)switch(e){case 1:case 3:i.visible=!0;break;case 2:i.visible=!0,s.visible=!0,o.visible=!0}}get _labelsText(){if(this.destroyed)return null;const t=this.messages,e=this.analysisView.result;if(e==null||t==null)return null;const{directDistance:i,horizontalDistance:s,verticalDistance:o}=e,a=this.analysisView.unit,u=p=>({directDistance:"",horizontalDistance:"",verticalDistance:"",...p});switch(a){case"metric":return u({directDistance:i&&mt(t,i),horizontalDistance:s&&mt(t,s),verticalDistance:o&&ne(t,o)});case"imperial":return u({directDistance:i&&pt(t,i),horizontalDistance:s&&pt(t,s),verticalDistance:o&&se(t,o)});default:return u({directDistance:i&&U(t,i,a),horizontalDistance:s&&U(t,s,a),verticalDistance:o&&U(t,o,a)})}}_updateSegmentStripeLength(t){const e=this._segmentVisualElement;t!=null?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(this._triangleOrientationOverride!=null)return this._triangleOrientationOverride;const t=this.visualElementOrientation;return t===0?this.view.state.camera.aboveGround?1:2:t}_requiresGeodesicGuideAt(t){const e=this.view;if(!e?.state)return!1;const i=e.state.camera,s=e.renderCoordsHelper;if(!s)return!1;const o=i.computeScreenPixelSizeAt(t);return s.getAltitude(t)/o>=10}get _measurementArrowStripeLength(){const{result:t,unit:e}=this.analysisView;if(t==null)return null;let i=null;const s=t.directDistance;switch(e){case"metric":i=s&&z(s,"meters");break;case"imperial":i=s&&z(s,kt(s.value,s.unit));break;default:i=s&&z(s,e)}return i==null?null:ee(i.value/30)*It(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,Xt("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){}};function ci(t,e,i,s,o){const a=Q(t,i,o,gi),u=Q(t,e,o,vi);if(a==null||u==null)return null;const p=o.projectToRenderScreen(i,pi),d=o.projectToRenderScreen(e,mi),l={segment:"bottom",horizontal:"top",vertical:p==null||d==null||p[0]<d[0]?"left":"right"};if(gt(a,u)>=Ct){const h=Math.sign(a[1])===Math.sign(u[1]);l.segment=h?_t(l.vertical):l.vertical}else{const h=_i;Q(i,e,o,h),gt(h,u)>=Ct&&(l.segment=Math.sign(h[0])===Math.sign(u[0])?_t(l.horizontal):l.horizontal)}if(s===2){const h=c=>c==="top"?"bottom":"top";l.segment=h(l.segment),l.horizontal=h(l.horizontal),l.vertical=h(l.vertical)}return l}n([r()],w.prototype,"_parameters",null),n([r()],w.prototype,"_triangleOrientationOverride",void 0),n([r()],w.prototype,"messages",void 0),n([r()],w.prototype,"view",void 0),n([r()],w.prototype,"analysis",void 0),n([r()],w.prototype,"analysisView",void 0),n([r()],w.prototype,"loadingMessages",void 0),n([r()],w.prototype,"visible",null),n([r()],w.prototype,"viewMode",null),n([r()],w.prototype,"actualVisualizedMeasurement",null),n([r()],w.prototype,"visualElementOrientation",void 0),n([r()],w.prototype,"triangleCollapseRatioThreshold",void 0),n([r()],w.prototype,"allowVisualElementsOrientationChange",null),n([r()],w.prototype,"labels",null),n([r()],w.prototype,"_labelsText",null),n([r()],w.prototype,"_actualVisualElementsOrientation",null),n([r()],w.prototype,"_measurementArrowStripeLength",null),w=n([I("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],w);const Ct=Math.cos(ie(12)),pi=Mt(),mi=Mt(),gi=ot(),vi=ot(),_i=ot();let _=class extends at{constructor(t){super(t),this.cursorPoint=null,this._visible=!1,this._laserLine=null,this.laserLineEnabled=!0,this._lastDraggedHandle=null}initialize(){this._laserLine=new je({view:this.view,attached:!0,isDecoration:!0}),this._updateVisibility(this._visible),this._connectToAnalysisView(),this.addHandles(P(()=>this._params,({laserLineGlowColor:t,laserLineInnerColor:e,laserLineGlobalAlpha:i})=>{const s=this._laserLine,o=s.style;s.style={...o,innerColor:e,glowColor:t,globalAlpha:i}}))}destroy(){this._laserLine=M(this._laserLine)}get _params(){const{accentColor:t}=this.view.effectiveTheme;return{laserLineGlowColor:Pt.toUnitRGB(t),laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:Pt.toUnitRGB(st(t)),laserLineInnerWidth:.75,laserLineGlobalAlpha:.75*t.a,handleColor:St(t,.5),handleRadius:5}}get visible(){return this._visible}set visible(t){t?this.show():this.hide()}get testData(){}get _cursorPosition(){const t=C(),e=this.cursorPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _startPosition(){const t=C(),e=this.analysis.startPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _endPosition(){const t=C(),e=this.analysis.endPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _laserLineParams(){const t=this._focusPosition,{active:e,lineState:i}=this.toolState,s=this.analysisViewData,o=this.laserLineEnabled&&!!t&&i!=="measured"&&e;if(!o||!this.visible||s==null||s.destroyed)return{heightManifoldTarget:null,pointDistanceLine:null,lineVerticalPlaneSegment:null};const a=s.actualVisualizedMeasurement,u=this.view.viewingMode!=="local"&&o&&!!this.analysis.startPoint&&a==="geodesic",p=o&&s.viewMode===2;return{heightManifoldTarget:a==="euclidean"?t:null,pointDistanceLine:u?this._pointDistanceLine:null,lineVerticalPlaneSegment:p?Re(this._startPosition,this._endPosition):null}}get _focusPosition(){const{lineState:t}=this.toolState,e=this.analysisViewData,i=e!=null&&!e.destroyed&&e.measurementMode===1&&e.viewMode===1;switch(t){case"drawing":return i?this._startPosition:this.analysis.endPoint?this._endPosition:this._startPosition;case"editing":return i?this._lastDraggedHandle==="start"?this._endPosition:this._startPosition:this._lastDraggedHandle==="start"?this._startPosition:this._endPosition;default:return this.cursorPoint!=null?this._cursorPosition:null}}get _pointDistanceLine(){return{origin:this.toolState.lineState==="drawing"||this._lastDraggedHandle==="end"?this._startPosition:this._endPosition,target:this._focusPosition}}createManipulators(){const t=this._params,{view:e}=this,i=()=>{const c=Ut(t.handleColor),m=[new Nt(Me(c,1,32,32))],v=new dt({view:e,renderObjects:m});return v.available=!1,v.radius=t.handleRadius,[v,c]},[s,o]=i(),[a,u]=i(),p=new dt({view:this.view,available:!1,interactive:!1});this.analysis.startPoint!=null&&(s.location=this.analysis.startPoint,s.available=!0),this.analysis.endPoint!=null&&(a.location=this.analysis.endPoint,a.available=!0);const d=()=>{let c=this._lastDraggedHandle;s.grabbing&&!a.grabbing&&(c="start"),a.grabbing&&!s.grabbing&&(c="end"),s.grabbing||a.grabbing||(c=null),this._lastDraggedHandle=c},l=s.events.on("grab-changed",d),h=a.events.on("grab-changed",d);return this.addHandles([l,h,P(()=>te(this._params.handleColor),c=>{o.setParameters({color:c}),u.setParameters({color:c})},{equals:nt})],"manipulators"),{start:s,end:a,cursor:p}}show(){this.destroyed||this._visible||this._updateVisibility(!0)}hide(){!this.destroyed&&this._visible&&this._updateVisibility(!1)}_connectToAnalysisView(){this.removeHandles("analysis-view"),this.addHandles([P(()=>this.analysisViewData?.destroyed,t=>{t&&this.removeHandles("analysis-view")},B),P(()=>[this.toolState.lineState==="measured",this.analysisViewData],([t,e])=>{e==null||e.destroyed||(e.allowVisualElementsOrientationChange=!t)},B),P(()=>this._laserLineParams,t=>{const e=this._laserLine;e.heightManifoldTarget=t.heightManifoldTarget,e.pointDistanceLine=t.pointDistanceLine,e.lineVerticalPlaneSegment=t.lineVerticalPlaneSegment},B)],"analysis-view")}_updateVisibility(t){this.initialized&&(this._visible=t,t&&(this._laserLine.style={innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha}),this._laserLine.visible=t)}};n([r({constructOnly:!0})],_.prototype,"view",void 0),n([r()],_.prototype,"_params",null),n([r({constructOnly:!0})],_.prototype,"analysis",void 0),n([r({constructOnly:!0})],_.prototype,"analysisViewData",void 0),n([r()],_.prototype,"cursorPoint",void 0),n([r()],_.prototype,"toolState",void 0),n([r()],_.prototype,"visible",null),n([r()],_.prototype,"testData",null),n([r()],_.prototype,"_visible",void 0),n([r()],_.prototype,"_laserLine",void 0),n([r({constructOnly:!0})],_.prototype,"laserLineEnabled",void 0),n([r()],_.prototype,"_cursorPosition",null),n([r()],_.prototype,"_startPosition",null),n([r()],_.prototype,"_endPosition",null),n([r()],_.prototype,"_lastDraggedHandle",void 0),n([r()],_.prototype,"_laserLineParams",null),n([r()],_.prototype,"_focusPosition",null),n([r()],_.prototype,"_pointDistanceLine",null),_=n([I("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DView")],_);let y=class extends Fe{constructor(t){super(t),this._updatingHandles=new Te,this._snappingManagerResult=null,this._emulatedDrag=null,this.lineState="initial",this.removeIncompleteOnCancel=!1,this.startPointSurfaceLocation=null,this.endPointSurfaceLocation=null,this.cursorPointSurfaceLocation=null,this.startManipulator=null,this.endManipulator=null,this.cursorManipulator=null,this._getSnappingContext=xe(e=>new Ye({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Be(new qe("point",Qe(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Ae}))}initialize(){const{view:t,analysis:e,analysisViewData:i,visible:s}=this;this.measurementView=new _({toolState:this,view:t,analysis:e,analysisViewData:i,visible:s});const{start:o,end:a,cursor:u}=this.measurementView.createManipulators(),p=(d,l,h)=>{const c=Ue(d,(m,v,f,V)=>{const E=Ge(m),D=this._ensureSnappingManager(),A=this._getSnappingContext(V),x=this._updatingHandles,{lineState:R}=this;f=f.next(E).next(Ne(this,[h,l])).next(b=>{if(l!=="cursorPoint"){const L=this.analysis[l];L!=null&&(m.location=L)}return b});const S=$e(this.view),G=b=>{const L=S(b);return L||this.lineState!=="drawing"&&this.lineState!=="initial"||(this[l]=null,this[h]=null),L};let T=v.next(E).next(G);if(V!=="touch"||R==="editing"){const{snappingStep:b,cancelSnapping:L}=Ze({snappingManager:D,snappingContext:A,updatingHandles:x});f=f.next(L),T=T.next(...b)}T.next(b=>b.action!=="start"?b:null).next(b=>{const L=Ve(b.mapEnd,new Ft);this[l]=L,m.location=L,this[h]=this._surfaceLocation(L,b.surfaceType)})});return l==="cursorPoint"?[c]:[c,d.events.on("grab-changed",()=>{const m=o.grabbing||a.grabbing;this.lineState=m?"editing":"measured"}),P(()=>this.analysis[l],m=>{m&&(d.location=m)})]};this.startManipulator=o,this.endManipulator=a,this.cursorManipulator=u,this.manipulators.add(o),this.manipulators.add(a),this.manipulators.add(u),this.addHandles([...p(o,"startPoint","startPointSurfaceLocation"),...p(a,"endPoint","endPointSurfaceLocation"),...p(u,"cursorPoint","cursorPointSurfaceLocation"),jt(()=>this.state==="measured",()=>{this.finishToolCreation(),this.active&&(this.view.activeTool=null)},O),P(()=>({startPointAvailable:this.startPoint!=null,endPointAvailable:this.endPoint!=null}),({startPointAvailable:d,endPointAvailable:l})=>{this.startManipulator.available=d,this.endManipulator.available=l},O)]),Kt(this)}destroy(){this._updatingHandles=M(this._updatingHandles),this.measurementView=M(this.measurementView)}get _snappingManager(){return this._snappingManagerResult?.snappingManager}_ensureSnappingManager(){if(this._snappingManagerResult==null){const t=Je(this.view);this._snappingManagerResult=t,this.addHandles(t)}return this._snappingManagerResult.snappingManager}get state(){const{analysis:t}=this;if(t.startPoint==null&&t.endPoint==null)return"ready";const{lineState:e}=this;return this.validMeasurement&&e!=="editing"&&e!=="drawing"?"measured":"measuring"}get cursor(){return!this.active||this.state!=="ready"&&this.lineState==="measured"?null:"crosshair"}get startPoint(){return this.analysis.startPoint}set startPoint(t){this.analysis.startPoint=t}get endPoint(){return this.analysis.endPoint}set endPoint(t){this.analysis.endPoint=t}get cursorPoint(){return this.measurementView.cursorPoint}set cursorPoint(t){this.measurementView.cursorPoint=t}get snappingOptions(){return this._snappingManager?.options}get validMeasurement(){return this.analysis.startPoint!=null&&this.analysis.endPoint!=null}get updating(){return this._updatingHandles.updating||!!this._snappingManager?.updating}resetCreated(){super.resetCreated(),this.lineState="initial",this.cursorPoint=null,this.state==="measured"&&this.finishToolCreation()}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onDeactivate(){this._emulatedDrag?.cancel(),this._emulatedDrag=null}onInputEvent(t){switch(t.type){case"immediate-click":this._handleImmediateClick(t);break;case"pointer-move":this._handlePointerMove(t)}}_handlePointerMove(t){if(!this.active||this.view.navigating)return;const{pointerType:e}=t;if(e!=="mouse")return;const i=lt(t),{lineState:s,cursorManipulator:o,endManipulator:a}=this;let u=!1;this.cursorPoint==null&&(this._emulatedDrag?.cancel(),this._emulatedDrag=it(o,e,i),u=!0),s==="initial"&&(this._emulatedDrag?.update(i),u=!0),s==="drawing"&&(a.events.emit("drag",{action:"update",start:i,screenPoint:i}),u=!0),u&&t.stopPropagation()}_handleImmediateClick(t){if(!this.active||!He(t))return;const e=lt(t),{pointerType:i}=t,{cursorManipulator:s,startManipulator:o,endManipulator:a,lineState:u}=this;let p=!1;switch(this.cursorPoint==null&&(this._emulatedDrag?.cancel(),this._emulatedDrag=it(s,i,e)),u){case"initial":if(this._emulatedDrag?.update(e),this.cursorPoint!=null){this._emulatedDrag?.end(e),this._emulatedDrag=null,this.endPoint=null;const{cursorPoint:d}=this;this.startPoint=d,this.startPointSurfaceLocation=this.cursorPointSurfaceLocation,o.location=d,o.interactive=!1,a.interactive=!1,this.lineState="drawing",this._emulatedDrag=it(a,i,e),p=!0}break;case"drawing":this._emulatedDrag?.update(e),this.endPoint!=null&&(this._emulatedDrag?.end(e),this._emulatedDrag=null,o.interactive=!0,a.interactive=!0,this.lineState="measured",p=!0)}p&&t.stopPropagation()}_surfaceLocation(t,e){return e===0?"on-the-surface":(t.z??0)>=this._getElevation(t)?"above-the-surface":"below-the-surface"}_getElevation(t){return this.view.basemapTerrain.ready?$t(this.view.elevationProvider,t)??0:0}get test(){}};function it(t,e,i){return t.events.emit("drag",{action:"start",pointerType:e,start:i,screenPoint:i}),{update:s=>t.events.emit("drag",{action:"update",start:s,screenPoint:s}),end:s=>t.events.emit("drag",{action:"end",start:s,screenPoint:s}),cancel:()=>t.events.emit("drag",{action:"cancel"})}}n([r()],y.prototype,"_snappingManagerResult",void 0),n([r()],y.prototype,"_snappingManager",null),n([r({readOnly:!0})],y.prototype,"state",null),n([r()],y.prototype,"lineState",void 0),n([r({readOnly:!0})],y.prototype,"cursor",null),n([r()],y.prototype,"startPoint",null),n([r()],y.prototype,"endPoint",null),n([r()],y.prototype,"cursorPoint",null),n([r({constructOnly:!0})],y.prototype,"analysis",void 0),n([r({constructOnly:!0})],y.prototype,"analysisViewData",void 0),n([r()],y.prototype,"measurementView",void 0),n([r()],y.prototype,"removeIncompleteOnCancel",void 0),n([r({constructOnly:!0})],y.prototype,"view",void 0),n([r({readOnly:!0})],y.prototype,"validMeasurement",null),n([r({value:null})],y.prototype,"startPointSurfaceLocation",void 0),n([r({value:null})],y.prototype,"endPointSurfaceLocation",void 0),n([r({value:null})],y.prototype,"cursorPointSurfaceLocation",void 0),n([r()],y.prototype,"updating",null),y=n([I("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],y);let g=class extends Ht{constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.tool=null,this.result=null,this.measurementMode=0,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null,this.userOperation=null}initialize(){const{analysis:t,view:e}=this;this._analysisVisualization=new w({view:e,analysis:t,analysisView:this}),this.addResolvingPromise(Yt().then(i=>{this.destroyed||(this._analysisController=new H({view:e,analysis:t,viewData:this,geodesicLengthMeasurementUtils:i}))})),this.addHandles(ke(this,y))}destroy(){Ie(this),this.userOperation=Dt(this.userOperation),this._analysisController=M(this._analysisController),this._analysisVisualization=M(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get visible(){return super.visible}set visible(t){super.visible=t}get interactive(){return super.interactive}set interactive(t){super.interactive=t}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??Tt(this.view)}get testData(){}place(t){return We(this,{placementOptions:t})}};n([r()],g.prototype,"_analysisVisualization",void 0),n([r()],g.prototype,"_analysisController",void 0),n([r()],g.prototype,"updating",null),n([r({readOnly:!0})],g.prototype,"type",void 0),n([r({constructOnly:!0,nonNullable:!0})],g.prototype,"analysis",void 0),n([r()],g.prototype,"tool",void 0),n([r()],g.prototype,"result",void 0),n([r()],g.prototype,"measurementMode",void 0),n([r()],g.prototype,"elevationAlignedStartPoint",void 0),n([r()],g.prototype,"elevationAlignedEndPoint",void 0),n([r({readOnly:!0})],g.prototype,"viewMode",null),n([r({readOnly:!0})],g.prototype,"actualVisualizedMeasurement",null),n([r()],g.prototype,"visualElementOrientation",null),n([r()],g.prototype,"allowVisualElementsOrientationChange",null),n([r()],g.prototype,"triangleCollapseRatioThreshold",null),n([r({readOnly:!0})],g.prototype,"directLabelText",null),n([r({readOnly:!0})],g.prototype,"horizontalLabelText",null),n([r({readOnly:!0})],g.prototype,"verticalLabelText",null),n([r()],g.prototype,"unit",null),n([r()],g.prototype,"userOperation",void 0),g=n([I("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],g);const kr=g,yi=Object.freeze(Object.defineProperty({__proto__:null,build:Et},Symbol.toStringTag,{value:"Module"}));export{kr as default};
