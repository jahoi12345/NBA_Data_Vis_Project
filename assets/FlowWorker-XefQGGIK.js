import{_ as d,a as g}from"./jsonMap-Bs3hmeCU.js";import{f as h,d as w}from"./dataUtils-529e9ykD.js";import{x as _,f as D}from"./loadUtils-Cq4a_Jkv.js";import"./mathUtils-PIGhLnI9.js";import"./Extent-BhRcB6A3.js";import"./Point-C1MrKtFQ.js";import"./reader-DcGs6kKN.js";import"./index-DJqVgRZI.js";import"./aaBoundingRect-CirBGiM6.js";import"./FeatureTileDescriptor-DNymLrRS.js";import"./Cyclical-BLSxUpe7.js";let m=class{constructor(){this._tileData=new Map}async generateStreamlines(r){const{flowData:o,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:f}=r,n=c(h(l,o),l,t.modelSize,e,f);return{result:{streamlines:n},transferList:n?.map(i=>i.vertices.buffer)}}async generateTiledStreamlines(r){const{flowDataTiles:o,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:f,startPositions:n}=r;this._updateTileData(o,l);const i=c(_(f,this._tileData,t),f,t.modelSize,e,n);return{result:{streamlines:i},transferList:i?.map(s=>s.vertices.buffer)??[]}}_updateTileData(r,o){o&&this._tileData.forEach((t,e)=>{r.get(e)==null&&this._tileData.delete(e)}),r.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};m=d([g("esri.views.3d.support.flow.FlowWorker")],m);const I=m;function c(r,o,t,e,l){if(r==null)return;const f=w(o,r,t[0],t[1],{positions:l}),n=[],i=D(e);for(const{vertices:s,stage:u}of f){const p=new Float32Array(s.length*i);for(let a=0;a<s.length;a++)p[a*i]=s[a].x,p[a*i+1]=s[a].y,p[a*i+2]=s[a].t,e&&(p[a*i+3]=s[a].speed);n.push({vertices:p,stage:u,hasMagnitude:e})}return n}export{I as default};
