import{P as H,F as j,B as M,p as k,f as g,j as X,ak as J,O as K}from"./Point2D-CMz7woHH-BVbGGL7p.js";import{e as w,C as W,u as Z,b4 as ee,L as G,x as te}from"./ProjectionTransformation-PJc9H7Gq-Rbz84pUM.js";import{Envelope2D as D}from"./Envelope2D-mFnl8dXR-MYac-bfa.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./Point-BfTTZoMu-DeJwQYfh.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import"./jsonConverter-DmBmaSz7-DJD4mCIi.js";import{i as ne,s as re}from"./SimpleGeometryCursor-B92kdZ15-B1Z6elF7.js";import{E as oe}from"./Centroid-DZi-eb9F-DAOCr2lr-BiKn_CF1.js";import{M as E}from"./OperatorProximity-BtrIHwA7-CDKSJLqE.js";import{fromGeometry as z,getSpatialReference as U,toPoint as V}from"./apiConverter-BAgvri9D-BZfUOnhv.js";import"./Transformation2D-CrydmBdC-D4jE8w-_.js";import"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./OperatorDefinitions-DP7_WWTp-DP7_WWTp.js";import"./index-B0z_nLWi.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";class se{getOperatorType(){return 10203}accelerateGeometry(e,s,o){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,s){return new I(e,s)}execute(e,s){return new I(null,s).labelPoint(e)}}class I extends re{progress_(){}tock(){return!0}getRank(){return 1}constructor(e,s){super(),this.m_index=-1,this.m_progressCounter=0,this.m_progressTracker=s,this.m_inputGeoms=e}next(){const e=this.m_inputGeoms.next();return e?(H(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.labelPoint(e)):null}getGeometryID(){return this.m_index}labelPoint(e){if(e===null&&j("null pointer is not allowed"),e.getGeometryType()===M.enumPoint)return e;if(e.isEmpty())return new w({vd:e.getDescription()});switch(e.getGeometryType()){case M.enumPolygon:return this.labelPointPolygon(e);case M.enumPolyline:return this.labelPointPolyline(e);case M.enumMultiPoint:return this.labelPointMultiPoint(e);case M.enumEnvelope:return this.labelPointEnvelope(e);default:j("geometry is not supported")}}labelPointPolygon(e){const s=new D;e.queryEnvelope(s);const o=W(null,s,!0).total();let l=null,r=e;if(e.hasNonLinearSegments()){const t=new Z({copy:e}),m=ee(t,.25*o,o);k(m!==e),l=m,r=l}let u=0,d=0;for(let t=0,m=r.getPathCount();t<m;++t){const A=Math.abs(r.calculateRingArea2D(t));A>d&&(d=A,u=t)}const a=new g;if(Math.abs(d)<=2*o*o?a.setNAN():a.assign(oe(r,u)),Number.isNaN(a.x)){const t=new D;return r.queryPathEnvelope(u,t),new w({pt:t.getCenter()})}if(r.getPointCount()<4)return new w({x:a.x,y:a.y});const x=g.getNAN(),n=[x.clone(),x.clone(),x.clone(),x.clone()],f=[Number.NaN,Number.NaN,Number.NaN,Number.NaN],p=[Number.NaN,Number.NaN,Number.NaN,Number.NaN];let v=!1,y=new E().getNearestCoordinate(r,a,!0,!1);if(y.m_distance===0&&(v=!0,n[0]=a,y=new E().getNearestCoordinate(r,a,!1,!1),y.m_distance>.25*s.minDimension()*1.66666666))return new w({x:a.x,y:a.y});f[0]=y.m_distance,p[0]=0;const b=new g;let c=!1,i=.25,N=-1;const _=new D;r.queryPathEnvelope(u,_);do{let t=Number.NaN;if(n[1]=this.calculateParacentroid_(r,X(_.xmin,_.xmax,i),o),n[1].isNAN()||(y=new E().getNearestCoordinate(r,n[1],!1,!1),t=y.m_distance),t>o&&G(r,n[1],o)===1)c=!0,f[1]=t,p[1]=g.sqrDistance(n[1],a);else if(t>N&&(N=t,b.setCoordsPoint2D(n[1])),i-=.01,i<.1){if(!(N>=0))break;c=!0,f[1]=N,n[1]=b,p[1]=g.sqrDistance(n[1],a)}}while(!c);c=!1,i=.5,N=-1;let L=.01,O=1;do{let t=Number.NaN;if(n[2]=this.calculateParacentroid_(r,X(_.xmin,_.xmax,i),o),n[2].isNAN()||(y=new E().getNearestCoordinate(r,n[2],!1,!1),t=y.m_distance),t>o&&G(r,n[2],o)===1)c=!0,f[2]=t,p[2]=g.sqrDistance(n[2],a);else if(t>N&&(N=t,b.setCoordsPoint2D(n[2])),i=.5+L*O,L+=.01,O*=-1,i<.3||i>.7){if(!(N>=0))break;c=!0,f[2]=N,n[2]=b,p[2]=g.sqrDistance(n[2],a)}}while(!c);c=!1,i=.75,N=-1;do{let t=Number.NaN;if(n[3]=this.calculateParacentroid_(r,X(_.xmin,_.xmax,i),o),n[3].isNAN()||(y=new E().getNearestCoordinate(r,n[3],!1,!1),t=y.m_distance),t>o&&G(r,n[3],o)===1)c=!0,f[3]=t,p[3]=g.sqrDistance(n[3],a);else if(t>N&&(N=t,b.setCoordsPoint2D(n[3])),i+=.01,i>.9){if(!(N>=0))break;c=!0,f[3]=N,n[3]=b,p[3]=g.sqrDistance(n[3],a)}}while(!c);const h=[0,1,2,3],S=v?0:1;for(let t=S;t<4;t++)for(let m=S;m<3;m++){const A=p[m],Y=p[m+1];if(J(A,Y)>0){const Q=h[m];h[m]=h[m+1],h[m+1]=Q,p[m]=Y,p[m+1]=A}}let q=S,$=0,C=0;for(let t=S;t<4;t++){switch(t){case 0:C=2*f[h[t]];break;case 1:C=1.66666666*f[h[t]];break;case 2:C=1.33333333*f[h[t]];break;case 3:C=f[h[t]]}C>$&&($=C,q=h[t])}return k(!n[q].isNAN()),new w({x:n[q].x,y:n[q].y})}labelPointPolyline(e){const s=new g;if(e.getPointCount()>2*e.getPathCount()){let o=-1,l=-Number.MAX_VALUE;for(let a=0,x=e.getPathCount();a<x;a++)if(e.getPathSize(a)>2){const n=e.calculatePathLength2D(a);n>l&&(l=n,o=a)}const r=e.getPathStart(o),u=e.getPathEnd(o),d=Math.trunc((r+u)/2);s.assign(e.getXY(d))}else{let o=-Number.MAX_VALUE;const l=e.querySegmentIterator();for(;l.nextPath();)if(l.hasNextSegment()){const r=l.nextSegment(),u=r.calculateLength2D();u>o&&(o=u,s.assign(r.getCoord2D(r.lengthToT(.5*u))))}}return new w({x:s.x,y:s.y})}labelPointMultiPoint(e){const s=new D;e.queryEnvelope(s);const o=s.getCenter(),l=new E().getNearestCoordinate(e,o,!1,!1).m_coordinate;return new w({x:l.x,y:l.y})}labelPointEnvelope(e){const s=e.getCenterXY();return new w({x:s.x,y:s.y})}calculateParacentroid_(e,s,o){const l=new D;e.queryEnvelope(l);const r=new g(s,0);let u=Number.MAX_VALUE,d=Number.MAX_VALUE,a=!1,x=!1;const n=new te;n.setStartXYCoords(r.x,l.ymin-1),n.setEndXYCoords(r.x,l.ymax+1);const f=new D,p=new g,v=new g,y=K(g,2),b=e.querySegmentIterator();for(;b.nextPath();)for(;b.hasNextSegment();){const c=b.nextSegment();if(c.queryEnvelope(f),k(c.isMonotoneQuickAndDirty()),p.setCoordsPoint2D(n.getStartXY()),v.setCoordsPoint2D(n.getEndXY()),f.clipLine(p,v)===0||n.intersect(c,y,null,null,o)!==1)continue;const i=y[0].y;u>d?i<u&&(u=i,a=!0):i<d&&(d=i,x=!0)}return a&&x?r.y=(u+d)/2:r.setNAN(),r}}const T=new se;function ae(P){return T.execute(P,null)}function ie(P){const e=T.executeMany(new ne(P),null);return Array.from(e)}function le(){return T.supportsCurves()}function B(P){return V(ae(z(P)),U(P))}function R(P){const e=P.map(z),s=U(P);return ie(e).map(o=>V(o,s))}const F=le(),Ae=Object.freeze(Object.defineProperty({__proto__:null,execute:B,executeMany:R,supportsCurves:F},Symbol.toStringTag,{value:"Module"})),Me=Object.freeze(Object.defineProperty({__proto__:null,execute:B,executeMany:R,supportsCurves:F},Symbol.toStringTag,{value:"Module"}));export{Ae as c,Me as l};
