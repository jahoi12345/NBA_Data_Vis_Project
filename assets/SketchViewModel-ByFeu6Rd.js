const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingTools-ChPWfBkt.js","assets/jsonMap-Bs3hmeCU.js","assets/Graphic-B5lJuCvi.js","assets/getPopupProvider-mvkAgiBn.js","assets/collectionUtils-yEu3-UXw.js","assets/index-CAyy5ces.js","assets/index-DmB13pS_.css","assets/Point-B6yFWNoR.js","assets/reader-DcGs6kKN.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-D4kxmHSf.js","assets/SimpleObservable-CvFyr0NA.js","assets/lengthUtils-BsZbNiqt.js","assets/date-IqUzANpt.js","assets/Color-CERqXxxY.js","assets/mathUtils-PIGhLnI9.js","assets/Layer-B6AWeI6O.js","assets/jsonUtils-BGiBUdmT.js","assets/Polyline-CiznIgZG.js","assets/Polygon-BUi4eoGW.js","assets/aaBoundingRect-F1Nk1aID.js","assets/typeUtils-BzzgRKyX.js","assets/createFeatureId-CVwTD0fV.js","assets/typeUtils-cI568bV6.js","assets/lineMarkers-CDwLe3J6.js","assets/PolygonSymbol3D-DuQ13Get.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x.js","assets/screenUtils-BitdhK1O.js","assets/opacityUtils-DuFH0EC9.js","assets/aaBoundingBox-CVMQtR0c.js","assets/DoubleArray-DExKNiTh.js","assets/mat4f64-q_b6UJoq.js","assets/Font-DF-HycCW.js","assets/SimpleFillSymbol-CDawtd9z.js","assets/SimpleMarkerSymbol-BGAFRS9_.js","assets/PictureMarkerSymbol-_eQf1cyL.js","assets/TextSymbol-BjfCHbpC.js","assets/SnappingVisualizer2D-ClyNhgNO.js","assets/vec2f64-rIxtbMRN.js","assets/euclideanLengthMeasurementUtils-DjmCP2nz.js","assets/asyncUtils-w6KfWU41.js","assets/projectionUtils-DIbtnzb-.js","assets/elevationInfoUtils-DW7fNUvj.js","assets/unitConversionUtils-BhI4jDV1.js","assets/projectVectorToVector-P-2wsy-w.js","assets/projectPointToVector-DJN8xj-B.js","assets/vec32-BF0cLBAR.js","assets/Query-Dal_c4tA.js","assets/Field-Cm_ZejYW.js","assets/fieldType-DVUzXtk_.js","assets/ShadowCastClear.glsl-9G1ObMeX.js","assets/Texture-BcM9ZALi.js","assets/Indices-D0_UQPPr.js","assets/BufferView-5vCN6AU9.js","assets/vec42-Cr02Pi7P.js","assets/vec4f64-DPb6J-GU.js","assets/sphere-BiyfUvnN.js","assets/mat4-DMghHRAg.js","assets/vector-B05yfH0j.js","assets/quatf64-CCm9z-pX.js","assets/frustum-BV26jp-1.js","assets/plane-B7VfuINA.js","assets/Emissions.glsl-B8XKMjLy.js","assets/enums-B4pqBiXb.js","assets/orientedBoundingBox-ezehkKFt.js","assets/quat-Ao2mrU5h.js","assets/spatialReferenceEllipsoidUtils-CJDHI1w1.js","assets/computeTranslationToOriginAndRotation-BK14f5O2.js","assets/InterleavedLayout-NeYQVO9u.js","assets/types-BKo2foNY.js","assets/VertexElementDescriptor-BlxU8vCE.js","assets/Cyclical-BLSxUpe7.js","assets/HUDIntersectorResult-B_jyrAGm.js","assets/normalizeUtils-9qNRso4M.js","assets/normalizeUtilsCommon-C6mtpeei.js","assets/utils-CIVJ4xuJ.js","assets/utils-CMK6z7yl.js","assets/videoUtils-Dwx3AEgj.js","assets/modeUtils-BQO-Lkkv.js","assets/intl-BY86zs1L.js","assets/uuid-Oe6SV2kF.js","assets/sanitizerUtils-BT_8V5US.js","assets/modeUtils-OCMtRbrJ.css","assets/workers-CpwSXy88.js","assets/Queue-CYlrXMwB.js","assets/PooledRBush-Dco5QkUp.js","assets/quickselect-QQC62dOK.js","assets/GraphicsCollection-DOghpxSR.js","assets/HeightModelInfo-DHIKf3I1.js","assets/RealisticTree.glsl-XUrhiZwO.js","assets/meshVertexSpaceUtils-DUZqeOYR.js","assets/MeshLocalVertexSpace-C1Y-OkHk.js","assets/vec3f32-WCVSSNPR.js","assets/memoryEstimations-Bd726a_p.js","assets/Intersector-CoyLvWqI.js","assets/scaleUtils-CA2vbbgo.js","assets/layerUtils-CIRkC1pU.js","assets/TilemapCache-PuRJnLNa.js","assets/LRUCache-fy84PBMi.js","assets/TileKey-BVNpatnV.js","assets/tagSymbols-BPcGfZon.js","assets/UpdatingHandles-D2RI_3Hb.js","assets/signal-BX9ezF8a.js","assets/Map-vzu4-Gpj.js","assets/Basemap-CnwcXr2z.js","assets/loadAll-B9GTyWP9.js","assets/PortalItem-eLNwGntE.js","assets/writeUtils-BArD5fe9.js","assets/CollectionFlattener-DqqIW8Ln.js","assets/persistable-BhM8_Nvw.js","assets/MD5-MtSiOt06.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-o9xhC_1c.js","assets/PolygonCollection-CeRBzyKs.js","assets/mat4f32-Djp3mnm5.js","assets/TablesMixin-YmY2jgQz.js","assets/timeZoneUtils-BSc7-7qA.js","assets/ReactiveMap-B0by2bYu.js","assets/ElevationQuery-DStHBHni.js","assets/TileInfo-Ed-RyvGY.js","assets/Scheduler-CNrsbccs.js","assets/constants-D67WmGms.js","assets/floatRGBA-CCeie_ny.js","assets/labelUtils-BtizwBfq.js","assets/ArcadeExpression-tLhjkIsm.js","assets/TimeOnly-CyjHJh3J.js","assets/enum-BzLwmiID.js","assets/UnknownTimeZone-B697BDFv.js","assets/FieldsIndex-DldSuWRM.js","assets/TileKey-C44YQC4_.js","assets/layerViewUtils-BTa15X3o.js","assets/vec2f32-CaVKkSa6.js","assets/dehydratedFeatures-CTv_fIM5.js","assets/quantizationUtils-BHf4RTyd.js","assets/featureConversionUtils-BIy1MIBK.js","assets/OptimizedFeature-CwRGZPwv.js","assets/OptimizedFeatureSet-BR8EEvDc.js","assets/Octree-CCWW6e3I.js","assets/intersectorUtilsConversions-DntjJfod.js","assets/DefaultLoadingContext-CD84Ifzv.js","assets/wosrLoader-BBb8Esv0.js","assets/Version-BtYZEj58.js","assets/axisAngleDegrees-BxP7rfWR.js","assets/edgePreprocessing-KwHJ9wld.js","assets/config-Dg972SSE.js","assets/GeometryUtils-Baowv_lX.js","assets/definitions-Dvg4hMIw.js","assets/WorkerHandle-C7Ujx0oh.js","assets/colorUtils-CQgSrs28.js","assets/vec3-B_phcnZY.js","assets/vec33-CWJeyzxV.js","assets/capabilities-Bi6C4OG6.js","assets/imageUtils-Dd3IjdtB.js","assets/utils-DTE-xBiC.js","assets/geometry2dUtils-BvGwGPs_.js","assets/geodeticLengthOperator-RdkkEHwB.js","assets/geodeticCurveType-CirnHLSB.js","assets/SnappingContext-BvD5aBFA.js","assets/PointSnappingHint-JyORqkxJ.js","assets/editPlaneUtils-BcwnN_wr.js","assets/SketchTooltipInfo-D2WdU7X5.js","assets/MeshTransform-DqQ_s6ng.js","assets/a11yUtils-B9mR-UhZ.js","assets/getDefaultUnitForView-DZUX1UK4.js","assets/quantityFormatUtils-D0pfqt-C.js","assets/angularMeasurementUtils-DwnUpjOS.js","assets/GraphicsLayer-DdLh_pWS.js","assets/BlendLayer-DxqnW4p3.js","assets/layerContainerType-CSXZNpHb.js","assets/jsonUtils-giWL1Yhg.js","assets/ScaleRangeLayer-DQr2T3Hh.js","assets/ElevationInfo-DevipqE4.js","assets/dehydratedFeatureComparison-DBf0NwfT.js","assets/createUtils-CAwY8yO0.js","assets/distanceOperator-BxwdsJ2I.js","assets/Point2D-CMz7woHH.js","assets/Distance2DCalculator-CXhBP-8I-BMMI87Nn.js","assets/ProjectionTransformation-PJc9H7Gq.js","assets/Envelope2D-mFnl8dXR.js","assets/Transformation2D-CrydmBdC.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/apiConverter-Ytg2_1KF.js","assets/jsonConverter-SsMqDCzI.js","assets/simplifyOperator-CIq4g5Jt.js","assets/operatorSimplify-5A_MmN4K.js","assets/mat2d-CH0tgjFI.js","assets/mat2df64-DFLy2zOC.js","assets/TooltipInfoWithCoordinates-CFloKzN1.js","assets/InteractiveToolBase-BwRJcqGU.js","assets/EditGeometryOperations-Bwh558hO.js","assets/rotate-ChlapkGo.js","assets/curveOperationUtils-EcbQdUJD.js","assets/SketchOptions-Dguq2sp8.js","assets/diffUtils-DQV540Nb.js","assets/SnappingDragPipelineStep-BFgMF3DA.js","assets/SnappingOperation-ClIdnPwp.js","assets/cimSymbolUtils-DOGwV0lV.js","assets/utils-DX2muIr3.js","assets/GraphicManipulator-HWYqbGwd.js","assets/defaults-CGwYBJxE.js","assets/defaultsJSON-GKolV7NZ.js","assets/drawUtils-D_TvWfIs.js","assets/editingTools-BVH4zz75.js","assets/TextOverlayItem-TShszAHn.js","assets/SnappingVisualizer3D-L8pDZ8jB.js","assets/ExtendedLineVisualElement-Cl_ERCPx.js","assets/EngineVisualElement-DX-_VRJh.js","assets/VisualElement-By4iq8p4.js","assets/LaserlinePath.glsl-AjwGVIQf.js","assets/PointVisualElement-Bx4wd-nN.js","assets/ShadedColorMaterial.glsl-BwXpFFRd.js","assets/line-XkXMUId7.js","assets/ColorMaterial.glsl-lmFExrtG.js","assets/TriangleMaterial-CNoFGBqj.js","assets/settings-DJRPpgXx.js","assets/lineStippleUtils-CCavR4OV.js","assets/OutlineVisualElement-CxzqXN-3.js","assets/line-COHJ5Jtn.js","assets/triangulationUtils-QB8pBzIQ.js","assets/earcut-D9gy186-.js","assets/deduplicate-Lzwo1kX7.js","assets/VerticesVisualElement-9Bdgb6K-.js","assets/SelectedVertexTooltipInfo-BZU1WyuD.js","assets/IViewEvents-tfeuj-u0.js","assets/MoveManipulation-BiFRdJ1Z.js","assets/dragEventPipeline3D-DyY08eH5.js","assets/TranslateTooltipInfo-Dd7QDc5B.js","assets/utils-CKIa5ouR.js","assets/SlicePlaneMaterial.glsl-HQ9eApDy.js","assets/sliceToolConfig-BnawSSVt.js","assets/DefaultLayouts-k-HobCHF.js","assets/Factory-DRTfXcpE.js","assets/RotateManipulator-CN3GtfrH.js","assets/ImageMaterial.glsl-xhHW44N8.js","assets/ExtentScaleTooltipInfo-DzQmklSt.js","assets/GraphicsLayerView3D-DGFcl8K4.js","assets/LayerView3D-BMYhm-ED.js","assets/queryForSymbologySnapping-DIWTsdlx.js","assets/GraphicsProcessor-BDBMU8vd.js","assets/renderingInfoUtils-v8ppskac.js","assets/visualVariableUtils-CxWcPx-y.js","assets/ExtentSet-B_3aOMr4.js","assets/UniqueValueRenderer-BqMY2rMI.js","assets/commonProperties-CBXa9rSu.js","assets/colorRamps-DswZzxkO.js","assets/ColorStop-De5gQTjr.js","assets/jsonUtils-ChUQi1qs.js","assets/defaults3D-BRy__GLn.js","assets/RendererLegendOptions-BsbaFpgh.js","assets/styleUtils-iSHk-Q5b.js","assets/optimizedFeatureQueryEngineAdapter-Bma9_B5X.js","assets/popupUtils-B091A21E.js","assets/Graphics3DObjectStates-r9ARkC66.js","assets/highlightUtils-BBc9bkAj.js","assets/LayerView-BNB0sIJM.js","assets/highlightOptionsUtils-DnZdGRdO.js","assets/GraphicMover-DIzuJjyD.js","assets/Box-BOhoCdw3.js","assets/settings-CdVf-pAF.js","assets/automaticAreaMeasurementUtils-CZV1U9bY.js","assets/geodesicAreaMeasurementUtils-Dm6EI7EI.js","assets/automaticLengthMeasurementUtils-CJp0Gjeq.js","assets/Reshape-DtnKiCrf.js","assets/symbolUtils-DZmAj27W.js","assets/mat2df32-Dpt2CT5P.js"])))=>i.map(i=>d[i]);
import{a1 as le,a5 as ge,w as N,bt as z,d as ve,a6 as W,_ as l,m as y,aC as fe,a as V,u as D,n as j,bu as S,i as _e,s as be,aw as we,ag as B}from"./jsonMap-Bs3hmeCU.js";import{r as Ge}from"./signal-BX9ezF8a.js";import{_ as A}from"./index-CAyy5ces.js";import{O as J}from"./collectionUtils-yEu3-UXw.js";import{a as Z,c as he,l as H,w as P,f as Oe,j as Y}from"./reactiveUtils-SO2Ko3sy.js";import{h as Te}from"./UpdatingHandles-D2RI_3Hb.js";import{R as Ee,a5 as Ae}from"./Point-B6yFWNoR.js";import{J as Se,G as Ce,L as Me,W as ke}from"./projectionUtils-DIbtnzb-.js";import{r as Q}from"./Polygon-BUi4eoGW.js";import He from"./GraphicsLayer-DdLh_pWS.js";import{m as Ie,s as Re,p as De,S as Pe}from"./layerUtils-CIRkC1pU.js";import{d as xe}from"./PolygonSymbol3D-DuQ13Get.js";import{a as Ue,x as I}from"./typeUtils-cI568bV6.js";import{m as Le}from"./SimpleFillSymbol-CDawtd9z.js";import{u as X,m as $e}from"./SimpleMarkerSymbol-BGAFRS9_.js";import{g as Fe}from"./TextSymbol-BjfCHbpC.js";import{l as ce,e as Ve,c as je,r as Ke,n as We}from"./SketchOptions-Dguq2sp8.js";import{e as Ze}from"./Map-vzu4-Gpj.js";import{c as qe,aI as Ne,a8 as O,a9 as ee,ax as b}from"./ShadowCastClear.glsl-9G1ObMeX.js";import{u as de,q as te,a2 as ze}from"./euclideanLengthMeasurementUtils-DjmCP2nz.js";import{u as x}from"./automaticAreaMeasurementUtils-CZV1U9bY.js";import{c as k}from"./automaticLengthMeasurementUtils-CJp0Gjeq.js";let Tt=class{constructor(){this._currentOperationSignal=Ge(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(t,a,o){const i=this._currentOperationSignal.value;i?.stop();const r=new AbortController,c=o?.signal,p=AbortSignal.any([r.signal,c].filter(le)),s=ge();let n=!1;const h=()=>{n||(n=!0,s.reject(W()))},d={type:t,resolve:v=>{n||(n=!0,s.resolve(v))},reject:h,promise:s.promise,stop:()=>r.abort(),handles:[]};this._currentOperationSignal.value=d,d.handles.push(N(c,()=>{r.abort()}),N(p,()=>{z(d.handles),n||h()}));try{return i&&(await i.promise.catch(()=>{}),ve(p)),await a(d,p),await s.promise}finally{z(d.handles),this._currentOperationSignal.value===d&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}};function ae(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}function Be(e){return Je(e).result}function Je(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:1};if(!e.operations)return{result:2};const t=e.operations.data.type,a=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:0,geometry:a}:{result:3}}function Ye(e){if(e.layer?.type!=="graphics")return 1;if(e.geometry==null)return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return t&&t.some(a=>a.type==="object")?0:4}function oe(e,t,a){if(!t||!e?.map)return;const{map:o}=e;o.layers.find(r=>r===t)||o.add(t,a)}function At(e,t){const a=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(o=>{const i=o.layer;return i===a||"sublayers"in i&&i.sublayers!=null&&i.sublayers.includes(a)})}function St(e){return Ze(e)||Ie(e)||Re(e)||De(e)}class ue{constructor(t){this.layer=t}get elevationInfo(){return this.layer.elevationInfo}add(t){this.layer.add(t)}addMany(t){this.layer.addMany(t)}onGraphicsChange(t){const{layer:a}=this;return Z(()=>a.graphics,"change",o=>t(o))}has(t){return t.layer===this.layer}remove(t){this.layer.remove(t)}removeMany(t){this.layer.removeMany(t)}removeAll(){this.layer.removeAll()}}l([y()],ue.prototype,"elevationInfo",null);class ye{constructor(t){this.layer=t}get elevationInfo(){}add(t,a){(this._getSublayerForCreateTool(a)??this._getSublayerForGraphic(t))?.add(t)}addMany(t,a){if(a){const o=this._getSublayerForCreateTool(a);if(o)return void o.addMany(t)}t.forEach(o=>this._getSublayerForGraphic(o)?.add(o))}onGraphicsChange(t){const{layer:a}=this;if(a.sublayers?.length)return fe(a.sublayers?.toArray().map(o=>Z(()=>o.graphics,"change",i=>t(i))))}has(t){const{layer:a}=this;return t.layer===a||t.sourceLayer===a||!!a.sublayers?.some(o=>t.layer===o||t.sourceLayer===o)}remove(t){this._getSublayerForGraphic(t)?.remove(t)}removeMany(t){t.forEach(a=>this._getSublayerForGraphic(a)?.remove(a))}removeAll(){this.layer.sublayers?.forEach(t=>t.removeAll())}_getSublayerForCreateTool(t){const{layer:a}=this;switch(t){case"point":return a.pointLayer;case"polyline":return a.polylineLayer;case"polygon":return a.polygonLayer;case"multipoint":return a.multipointLayer;case"text":return a.textLayer}}_getSublayerForGraphic(t){const{layer:a}=this;if(t?.geometry)switch(t.geometry.type){case"point":return t.symbol?.type==="text"?a.textLayer:a.pointLayer;case"polyline":return a.polylineLayer;case"polygon":return a.polygonLayer;case"multipoint":return a.multipointLayer}}}l([y()],ye.prototype,"elevationInfo",null);let T=class extends he{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){const{activeComponent:e}=this;if(!e)return null;switch(e.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return e.graphicSymbol?.type==="text"?"text":e.geometryType;case"draw-3d":return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};l([y()],T.prototype,"activeComponent",void 0),l([y()],T.prototype,"cancelled",void 0),l([y()],T.prototype,"history",void 0),l([y()],T.prototype,"tool",null),l([y()],T.prototype,"type",void 0),l([y()],T.prototype,"canUndo",null),l([y()],T.prototype,"canRedo",null),l([y()],T.prototype,"onEnd",void 0),l([y()],T.prototype,"undo",null),l([y()],T.prototype,"redo",null),l([y()],T.prototype,"toggleTool",void 0),l([y()],T.prototype,"addToSelection",void 0),l([y()],T.prototype,"removeFromSelection",void 0),T=l([V("esri.widgets.Sketch.support.OperationHandle")],T);let F=class extends T{};l([y()],F.prototype,"activeComponent",void 0),F=l([V("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],F);let C=class extends T{};l([y()],C.prototype,"activeComponent",void 0),C=l([V("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],C);function Qe(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Xe(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return e}}function ie(e){if(e.length>1)return!1;const t=e.at(0)?.geometry;return t?.type==="point"||t?.type==="multipoint"&&t.points.length<2}const re={defaultZ:0},R={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:qe},tool:"transform"},K=Symbol(),se=Symbol();let f=class extends he{constructor(e){super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new He({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new Te,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new X({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Le({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new $e({color:[130,130,130,1],width:2}),this.meshSymbol=new Ue({symbolLayers:new J([new xe])}),this.textSymbol=new Fe({text:"text"}),this.updateGraphics=new J,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new X({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new ce,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:t}=this;if(this.removeHandles(se),!t)return;const a=[t.onGraphicsChange(o=>this._onLayerGraphicsChangeCallback(o)),H(()=>t.elevationInfo,o=>{o!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=o)},P)].filter(le);this.addHandles(a,se)},this._originalPopupEnabled=null,this.defaultCreateOptions=re,this.defaultUpdateOptions=R,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new de}initialize(){this.addHandles([Z(()=>this.view?.map?.layers,"change",e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),H(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),P),H(()=>this.view,e=>{this._defaultSnappingManager=D(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new te({view:e,options:this.snappingOptions})),e.type==="2d"?A(()=>import("./editingTools-ChPWfBkt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202])):e.type==="3d"&&(A(()=>import("./editingTools-BVH4zz75.js"),__vite__mapDeps([203,1,148,14,15,54,19,10,7,8,5,6,20,55,9,46,4,11,42,43,12,13,171,27,39,40,41,18,44,45,16,47,17,21,48,49,50,51,31,52,53,38,56,57,58,59,60,61,62,63,29,30,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,2,3,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,149,150,151,152,153,154,155,156,164,163,204,205,206,207,208,209,210,211,212,213,214,157,158,215,216,217,218,219,220,221,222,223,160,161,162,165,188,159,166,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,189,190,191,192,193,194,195,196,224,225,226,227,228,197,198,229,230,231,232,233,234,235,199,200,201])),A(()=>import("./GraphicsLayerView3D-DGFcl8K4.js"),__vite__mapDeps([236,1,9,237,50,5,6,51,31,46,4,7,8,10,11,19,20,15,52,53,54,38,55,56,57,58,59,60,61,62,14,63,29,30,64,65,66,67,41,18,68,69,70,27,12,13,71,45,44,72,73,74,17,75,76,77,21,78,79,80,81,82,83,84,85,86,87,2,3,16,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,40,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,47,48,49,118,119,120,121,122,123,124,125,126,127,128,129,130,43,131,132,133,134,135,136,137,42,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,238,239,194,240,241,242,243,244,245,246,247,248,200,201,249,250,251,252,253,254,255,256]))))},P),H(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),ze(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=D(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:e}=this;switch(e?.type){case"graphics":return new ue(e);case"map-notes":return new ye(e);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,a=!t&&e&&"tooltip"in e?e.tooltip:null;return a?.visible?a:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...re,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...R,...e,reshapeOptions:{...R.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...R.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=D(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new te({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:o,map:i}=t;o&&this._clearCursor(),i?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const a="view-ready";this.removeHandles(a),e&&this.addHandles(Oe(()=>e.ready,o=>{this.removeHandles(this._viewHandlesKey),o&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},P),a),this._set("view",e)}addGraphic(e){this._layerAdapter?.add(e)}addGraphics(e){this._layerAdapter?.addMany(e)}hasGraphic(e){return!!this._layerAdapter?.has(e)}removeGraphic(e){this._layerAdapter?.remove(e)}removeGraphics(e){this._layerAdapter?.removeMany(e)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=j(this._moduleLoaderAbortController),this._viewReadyAbortController=j(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:a}=this,o=t.toArray();this.removeGraphics(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:a})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.addGraphics(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:a,layer:o}=this;if(!a||this.state==="disabled")throw o||this._logMissingLayer(),W();if(a.activeTool!=null&&(a.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");oe(a,this._internalGraphicsLayer);const i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(i==null||this.destroyed)return void a.map?.remove(this._internalGraphicsLayer);const r=()=>{if(i===this._operationHandle){const c=this.createGraphic,p=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map?.remove(this._internalGraphicsLayer),i.cancelled||c==null||this.addGraphic(c),this._sketchContinuationFlag=!1,this.emit("create",{graphic:c,state:p?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),p||this._sketchContinuationFlag)return;const{creationMode:s}=this;if(s==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(B(this.create(e,t)))}else s==="update"&&c&&this._updatingHandles.addPromise(B(this.update([c])))}};i.on("complete",r),this._operationHandle=i,a.ready&&a.focus()}async place(e,t){return await e.load(),this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:a,view:o,state:i}=this;if(!o||i==="disabled")throw a||this._logMissingLayer(),W();o.activeTool!=null&&(o.activeTool=null);const r=Array.isArray(e)?e:[e];if(e==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(p=>this.hasGraphic(p)?p.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const c=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||c==null||G(c)||(oe(o,this._internalGraphicsLayer),this._setUpdateOperationHandle(c,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:c.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const a of e)a.geometry==null||a.geometry.type==="mesh"||Ee(a.geometry.spatialReference,t.spatialReference)||(Se(a.geometry.spatialReference,t.spatialReference)||Ce()||await Me(),a.geometry=ke(a.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const i=[];t.map.allLayers.forEach(c=>{c.type!=="vector-tile"&&c.type!=="imagery"||i.push(c)});const r=await t.hitTest(e,{exclude:i});return Ne(r.results)}const a=[t.map.ground];t.map.allLayers.forEach(i=>{Pe(i)&&a.push(i)});const o=await t.hitTest(e,{exclude:a});if(o.results.length>0){const i=o.results[0];if(i!=null&&i.type==="graphic"&&i.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(i.distance??0)>-Math.min(3*o.ground.distance,t.viewingMode==="global"?Ae(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return i}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const a=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!a&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},O.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit(ee(e)));let a=null;if(t!=null){const o=t.graphic;this.updateGraphics.includes(o)||this.hasGraphic(o)?(e.stopPropagation(),a=o):this.view?.type!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();a==null||this.updateGraphics.includes(a)||await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const a=this.view;if(!a)return this._logMissingView(),null;const o={hasZ:a.type==="3d",...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,a,o);return i==null?null:(a.tools.add(i),a.activeTool=i,this._setupCreateOperationHandle(i,e))}async _setupDrawGraphicTool(e,t,a){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:o,defaultZ:i,hasZ:r,geometryToPlace:c,graphicProperties:p,mode:s,preserveAspectRatio:n}=a,h=Qe(s,e),d=Xe(e),v=a?.optionsPerTool?.has(e)?a.optionsPerTool.get(e):{},m=v?.preserveAspectRatio??n??e!=="rectangle",u={centered:e!=="rectangle"&&!(e==="circle"&&!m),cursor:o,defaultZ:i,forceUniformSize:m,graphicProperties:{...p,attributes:{...p?.attributes}},geometryToPlace:c,geometryType:d,mode:h,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...v};return t.type==="2d"?this._makeDrawGraphicTool2D(u):this._makeDrawGraphicTool3D(u)}async _makeDrawGraphicTool2D(e){const[t,a,o]=await Promise.all([this._requireModule(A(()=>import("./editingTools-ChPWfBkt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202]))),x(),k()]);return G(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:tt(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:o})}async _makeDrawGraphicTool3D(e){const[t,a,o]=await Promise.all([this._requireModule(A(()=>import("./editingTools-BVH4zz75.js"),__vite__mapDeps([203,1,148,14,15,54,19,10,7,8,5,6,20,55,9,46,4,11,42,43,12,13,171,27,39,40,41,18,44,45,16,47,17,21,48,49,50,51,31,52,53,38,56,57,58,59,60,61,62,63,29,30,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,2,3,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,149,150,151,152,153,154,155,156,164,163,204,205,206,207,208,209,210,211,212,213,214,157,158,215,216,217,218,219,220,221,222,223,160,161,162,165,188,159,166,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,189,190,191,192,193,194,195,196,224,225,226,227,228,197,198,229,230,231,232,233,234,235,199,200,201]))),x(),k()]);return G(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:o})}_setupCreateOperationHandle(e,t){const a=this.view;if(!a)return this._logMissingView(),null;let o=null;const i=e.forceUniformSize,r=e.centered,c=[a.on("key-down",s=>{if(s.key===b.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===b.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==b.vertexAdd||s.repeat)s.key===b.undo?(s.stopPropagation(),p.undo()):s.key===b.redo?(s.stopPropagation(),p.redo()):s.key!==b.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===b.center&&(s.repeat||(e.centered=!r,s.stopPropagation())):(e.forceUniformSize=!i,s.stopPropagation());else{const n=e.drawOperation.geometryType;n!=="polyline"&&n!=="polygon"&&n!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}},O.WIDGET),a.on("key-up",s=>{s.key===b.pan?e.enabled=!0:s.key!==b.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===b.center&&(e.centered=r,s.stopPropagation()):(e.forceUniformSize=i,s.stopPropagation())},O.WIDGET),e.on("vertex-add",s=>{switch(o=o==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:o,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",s=>{this._set("createGraphic",s.graphic),o="complete",s.aborted?p&&p.cancel():p&&p.complete()}),H(()=>this._getGraphicSymbolFromTool(t),s=>{e.graphicSymbol=s})],p=new F({activeComponent:e,type:"create",onEnd:()=>{S(c),a.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(e,t){const{view:a}=this;if(!a)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let i=o.tool??R.tool;if(this.removeGraphics(e),this.addGraphics(e),a.type==="3d"){if(e.length===0)return null;switch(i){case"move":return this._setupMove3DOperation(e,o,a,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,a);case"transform":return this._setupGraphicTransform3DOperation(e,o,a)}}switch(i){case"move":return this._setupMove2DOperation(e,o,a);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,i,o,a);case"transform":return ie(e)&&(i="reshape"),this._setupTransformOrReshape2DOperation(e,i,o,a)}}async _setupMove3DOperation(e,t,a,o,i=!1){const[r,c]=await Promise.all([this._requireModule(A(()=>import("./editingTools-BVH4zz75.js"),__vite__mapDeps([203,1,148,14,15,54,19,10,7,8,5,6,20,55,9,46,4,11,42,43,12,13,171,27,39,40,41,18,44,45,16,47,17,21,48,49,50,51,31,52,53,38,56,57,58,59,60,61,62,63,29,30,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,2,3,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,149,150,151,152,153,154,155,156,164,163,204,205,206,207,208,209,210,211,212,213,214,157,158,215,216,217,218,219,220,221,222,223,160,161,162,165,188,159,166,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,189,190,191,192,193,194,195,196,224,225,226,227,228,197,198,229,230,231,232,233,234,235,199,200,201]))),k()]);if(G(r))return r;const{ManipulatedObject3DGraphic:p,MoveTool3D:s}=r.module,n=new Map,h=()=>{n.forEach(u=>u.destroy()),n.clear()};for(const u of e){const g=new p({view:a,graphic:u}),_=Ve(g);if(_!==0)return h(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${ae(_)}).`),null;n.set(u,g)}const d=new s({view:a,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:c});a.tools.add(d),d.objects.addMany(Array.from(n.values())),i||this.updateGraphics.addMany(e);const v=[],m=new C({activeComponent:d,tool:o,type:"update",onEnd:()=>{S(v),$(a,d),h()},undo:()=>{pe(this.view,d),U(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{L(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:u=>{this.updateGraphics.push(u);const g=new p({view:a,graphic:u});n.set(u,g),d.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:u=>{const g=this.updateGraphics.indexOf(u);if(m.history.undo.forEach(E=>E.updates.splice(g,1)),m.history.redo.forEach(E=>E.updates.splice(g,1)),this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void m.complete();const _=n.get(u);_&&(d.objects.remove(_),_.destroy(),n.delete(u))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||o!=="transform")return;const u=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(u,t,a,!0);g&&!G(g)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(g,t))}});return v.push(...this._getHandlesForComponent(m,t),a.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(m,u,t),O.WIDGET),a.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(m,u)},O.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,a,o=!1){if(e.length===1&&Ye(e[0])===0){const i=e[0],r=i.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(i,t,a);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(i,t,a,o)}return this._setupMove3DOperation(e,t,a,"transform",o)}async _setupPointTransform3DOperation(e,t,a){const o="transform",{enableRotation:i,enableScaling:r,enableZ:c}=t,p=await this._requireModule(A(()=>import("./editingTools-BVH4zz75.js"),__vite__mapDeps([203,1,148,14,15,54,19,10,7,8,5,6,20,55,9,46,4,11,42,43,12,13,171,27,39,40,41,18,44,45,16,47,17,21,48,49,50,51,31,52,53,38,56,57,58,59,60,61,62,63,29,30,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,2,3,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,149,150,151,152,153,154,155,156,164,163,204,205,206,207,208,209,210,211,212,213,214,157,158,215,216,217,218,219,220,221,222,223,160,161,162,165,188,159,166,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,189,190,191,192,193,194,195,196,224,225,226,227,228,197,198,229,230,231,232,233,234,235,199,200,201])));if(G(p))return p;const{TransformTool3D:s,ManipulatedObject3DGraphic:n}=p.module,h=new n({graphic:e,view:a}),d=new s({object:h,view:a,enableRotation:i,enableScaling:r,enableZ:c,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});a.tools.add(d),this.updateGraphics.add(e);const v=[],m=new C({activeComponent:d,tool:o,type:"update",onEnd:()=>{S(v),$(a,d),h.destroy()},undo:()=>{pe(this.view,d),U(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{L(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);G(g)||this._setUpdateOperationHandle(g,t)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),m.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(m,t),a.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(m,u,t),O.WIDGET),a.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(m,u)},O.WIDGET)),m}async _setupPolyTransform3DOperation(e,t,a,o=!1){const i="transform",{enableRotation:r,enableScaling:c,enableZ:p,preserveAspectRatio:s}=t,[n,h]=await Promise.all([this._requireModule(A(()=>import("./editingTools-BVH4zz75.js"),__vite__mapDeps([203,1,148,14,15,54,19,10,7,8,5,6,20,55,9,46,4,11,42,43,12,13,171,27,39,40,41,18,44,45,16,47,17,21,48,49,50,51,31,52,53,38,56,57,58,59,60,61,62,63,29,30,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,2,3,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,149,150,151,152,153,154,155,156,164,163,204,205,206,207,208,209,210,211,212,213,214,157,158,215,216,217,218,219,220,221,222,223,160,161,162,165,188,159,166,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,189,190,191,192,193,194,195,196,224,225,226,227,228,197,198,229,230,231,232,233,234,235,199,200,201]))),k()]);if(G(n))return n;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:v}=n.module,m=this.view?.inputManager?.isModifierKeyDown(b.constraint),u=new d({view:a,graphic:e}),g=new v({object:u,view:a,enableRotation:r,enableScaling:c,enableZ:p,preserveAspectRatio:!!s!=!!m,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:h});a.tools.add(g),o||this.updateGraphics.add(e);const _=[],E=new C({activeComponent:g,tool:i,type:"update",onEnd:()=>{S(_),$(a,g),u.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async w=>{this.updateGraphics.add(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[w],removed:[],type:"selection-change"},type:"update"}),E.onEnd(),E.destroy();const q=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);G(q)||this._setUpdateOperationHandle(q,t)},removeFromSelection:w=>{this.updateGraphics.remove(w),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[w],type:"selection-change"},type:"update"}),E.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const w=await this._setupReshape3DOperation(e,t,a,!0);w&&!G(w)&&(E.onEnd(),E.destroy(),this._setUpdateOperationHandle(w,t))}});return _.push(...this._getHandlesForComponent(E,t),a.on("immediate-click",w=>this._getCommonUpdateOperationClickHandlers(E,w,t),O.WIDGET),a.on("key-down",w=>this._getCommonUpdateOperationKeyDownHandlers(E,w),O.WIDGET),a.on("key-down",w=>{w.key!==b.constraint||w.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,w.stopPropagation())},O.WIDGET),a.on("key-up",w=>{w.key===b.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,w.stopPropagation())},O.WIDGET)),E}async _setupMove2DOperation(e,t,a){const o="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const i=await this._getGraphicMover(e,t,a);if(G(i))return i;const r=new C({activeComponent:i,tool:o,type:"update",onEnd:()=>{this._clearCursor(),S(s),S(p),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();U(r,n),r.refreshComponent(),this._emitUndoEvent({graphics:n,tool:o})},redo:()=>{const n=this.updateGraphics.toArray();L(r,n),r.refreshComponent(),this._emitRedoEvent({graphics:n,tool:o})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const h=this.updateGraphics.indexOf(n);r.history.undo.forEach(v=>v.updates.splice(h,1)),r.history.redo.forEach(v=>v.updates.splice(h,1)),this.updateGraphics.remove(n);const d=this.updateGraphics.toArray();this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?i.graphics=d:r.complete()}});let c=!1;const p=[a.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(r,n,t),O.WIDGET),a.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(r,n),n.key!==b.constraint||n.repeat||(c=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},O.WIDGET),a.on("key-up",n=>{n.key===b.constraint&&c&&(c=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},O.WIDGET)],s=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,a,o=!1){const i="reshape",[r,c,p]=await Promise.all([this._requireModule(A(()=>import("./editingTools-BVH4zz75.js"),__vite__mapDeps([203,1,148,14,15,54,19,10,7,8,5,6,20,55,9,46,4,11,42,43,12,13,171,27,39,40,41,18,44,45,16,47,17,21,48,49,50,51,31,52,53,38,56,57,58,59,60,61,62,63,29,30,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,2,3,22,23,24,25,26,28,32,33,34,35,36,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,149,150,151,152,153,154,155,156,164,163,204,205,206,207,208,209,210,211,212,213,214,157,158,215,216,217,218,219,220,221,222,223,160,161,162,165,188,159,166,167,168,169,170,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,189,190,191,192,193,194,195,196,224,225,226,227,228,197,198,229,230,231,232,233,234,235,199,200,201]))),x(),k()]);if(G(r))return r;const{ManipulatedObject3DGraphic:s,ReshapeTool3D:n}=r.module,h=new s({view:a,graphic:e}),d=Be(h);if(d!==0)return h.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${ae(d)}).`),null;const v=t.reshapeOptions,m=new n({view:a,object:h,enableZVertex:t.enableZ&&v?.vertexOperation==="move",enableZShape:t.enableZ&&v?.shapeOperation==="move",enableMoveObject:v?.shapeOperation==="move"||v?.shapeOperation==="move-xy",enableMidpoints:v?.edgeOperation==="split",enableEdgeOffset:v?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:p});a.tools.add(m),o||this.updateGraphics.add(h.graphic);const u=[],g=new C({activeComponent:m,tool:i,type:"update",onEnd:()=>{S(u),$(a,m),h.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const E=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,a,"transform",!0);G(E)||this._setUpdateOperationHandle(E,t)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;g.onEnd(),g.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,a,!0);G(_)||this._setUpdateOperationHandle(_,t)}});return u.push(...this._getHandlesForComponent(g,t),a.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(g,_,t),O.WIDGET),a.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(g,_)},O.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,a,o){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const i=t==="transform"?await this._getBox(e,a,o):await this._getReshape(e,a,o);if(G(i))return i;const r=new C({activeComponent:i,type:"update",onEnd:()=>{S(p),S(c),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{U(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{L(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async s=>{let n=r.activeComponent;if(n?.type==="reshape"){const h=[...this.updateGraphics,s];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const d=await this._setupTransformOrReshape2DOperation(h,"transform",a,o);if(G(d))return;this._setUpdateOperationHandle(d,a)}else this.updateGraphics.add(s),n.graphics=this.updateGraphics.toArray(),n.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[s],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:s=>{const n=this.updateGraphics.indexOf(s);r.history.undo.forEach(d=>d.updates.splice(n,1)),r.history.redo.forEach(d=>d.updates.splice(n,1)),this.updateGraphics.remove(s);const h=this.updateGraphics.toArray();h.length===0?r.complete():ie(h)?r.toggleTool():r.activeComponent.graphics=h,this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[s],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const s=this.updateGraphics.at(0),n=s.geometry;if(n!=null&&(r.tool==="reshape"&&n.type==="point"||r.tool==="transform"&&n.type==="extent"))return;let h=null;r.tool==="transform"?h=await this._getReshape([s],a,o):r.tool==="reshape"&&(h=await this._getBox([s],a,o)),G(h)||(r.activeComponent?.destroy(),r.activeComponent=h,r.activeComponent&&(S(p),p=this._getHandlesForComponent(r,a)))}}),c=[o.on("immediate-click",s=>this._getCommonUpdateOperationClickHandlers(r,s,a),O.WIDGET),o.on("key-down",s=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,s),s.key===b.constraint&&!s.repeat&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},O.WIDGET),o.on("key-up",s=>{if(s.key===b.constraint&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},O.WIDGET)];let p=this._getHandlesForComponent(r,a);return r}async _getGraphicMover(e,t,a){const{enableMoveAllGraphics:o,highlightOptions:i}=t,r=await this._requireModule(A(()=>import("./GraphicMover-DIzuJjyD.js").then(c=>c.G),__vite__mapDeps([257,1,9,166,87,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,167,168,169,114,57,170,171,43,202,192,50,51,46,52,53,54,38,55,56,58,59,60,61,62,63,64,65,66,67,41,68,69,70,71,45,44,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,88,89,90,91,92,93,94,95,96,97,98,99,100,101,40,102,103,104,105,106,107,108,109,110,111,112,113,115,116,117,47,48,49,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,42,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,199,200,201])));return G(r)?r:new r.module.default({enableMoveAllGraphics:o,highlightName:i?.name,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:e,view:a,callbacks:{onGraphicMoveStart:({dx:c,dy:p,graphic:s})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c,dy:p,mover:s,type:"move-start"},type:"update"})},onGraphicMove:({dx:c,dy:p,graphic:s})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c,dy:p,mover:s,type:"move"},type:"update"}),onGraphicMoveStop:({dx:c,dy:p,graphic:s})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c,dy:p,mover:s,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(e,t,a){const{enableRotation:o,enableScaling:i,highlightOptions:r,preserveAspectRatio:c}=t,[p,s]=await Promise.all([this._requireModule(A(()=>import("./Box-BOhoCdw3.js"),__vite__mapDeps([258,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,50,51,46,52,53,54,38,55,56,57,58,59,60,61,62,63,64,65,66,67,41,68,69,70,71,45,44,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,40,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,47,48,49,118,119,120,121,122,123,124,125,126,127,128,129,130,43,131,132,133,134,135,136,137,42,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,191,202,192,257,166,167,168,169,170,171,199,200,201,259,193,160,161,162,163,164,165,39,153,154,155,156,235,227,260,261,220,262]))),k()]);if(G(p))return p;const n=this.view?.inputManager?.isModifierKeyDown(b.constraint);return new p.module.default({graphics:e,enableRotation:o,enableScaling:i,highlightName:r?.name,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!c!=!!n,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:s,callbacks:{onMoveStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMove:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMoveStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScale:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotate:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"})}})}async _getReshape(e,t,a){const{highlightOptions:o,reshapeOptions:i}=t,r=i?.edgeOperation==="split",c=i?.shapeOperation==="move",p=!!i?.enableCreateCurveFromStraightEdge,[s,n,h]=await Promise.all([this._requireModule(A(()=>import("./Reshape-DtnKiCrf.js"),__vite__mapDeps([263,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,40,182,175,178,177,179,180,181,183,166,87,167,168,169,114,57,170,171,43,37,38,39,41,42,44,45,46,47,48,49,50,51,52,53,54,55,56,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,264,228,197,198,265,186,248,200,201,223,160,161,162,163,164,165,188,202,192,257,199,227,259,190,191,193,260,261,220,262]))),x(),k()]);return G(s)?s:new s.module.default({enableMidpoints:r,enableMovement:c,enableCurveOnMidpoint:p,graphic:e[0],highlightName:o?.name,highlightsEnabled:!!o?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:h,view:a,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:v})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:v},type:"update"}),onMoveStart:({dx:d,dy:v,mover:m,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:v,mover:m,type:u},type:"update"}),onMove:({dx:d,dy:v,mover:m,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:v,mover:m,type:u},type:"update"}),onMoveStop:({dx:d,dy:v,mover:m,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:v,mover:m,type:u},type:"update"}),onVertexAdd:({added:d,type:v,vertices:m})=>{const u=d.map(g=>Q(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:u,vertices:m,type:v},type:"update"})},onVertexRemove:({removed:d,type:v,vertices:m})=>{const u=d.map(g=>Q(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:u,vertices:m,type:v},type:"update"})}}})}_getHandlesForComponent(e,t){const a=e.activeComponent;if(!a)return[];switch(a.type){case"graphic-mover":return[a.on("graphic-click",({graphic:o,viewEvent:i})=>{i.native?.shiftKey&&t.multipleSelectionEnabled&&(i.stopPropagation(),e.removeFromSelection(o))}),a.on("graphic-move-start",o=>e.addToHistory(M(o.allGraphics)))];case"box":return[a.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),a.on("move-start",o=>e.addToHistory(M(o.graphics))),a.on("rotate-start",o=>e.addToHistory(M(o.graphics))),a.on("scale-start",o=>e.addToHistory(M(o.graphics)))];case"reshape":return[a.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),a.on("move-start",o=>e.addToHistory(M([o.mover]))),a.on("reshape-start",o=>e.addToHistory(M([o.graphic]))),a.on("vertex-add",o=>e.addToHistory(M([o.oldGraphic]))),a.on("vertex-remove",o=>e.addToHistory(M([o.oldGraphic])))];case"move-3d":return[a.events.on("record-undo",({updates:o})=>{e.addToHistory({updates:o})}),a.events.on("move-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:o.objects.length>0?o.objects[0].graphic:null,type:"move-start"},type:"update"})}),a.events.on("move",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:o.dx,dy:o.dy,mover:o.objects.length>0?o.objects[0].graphic:null,type:"move"},type:"update"})}),a.events.on("move-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:o.objects.length>0?o.objects[0].graphic:null,type:"move-stop"},type:"update"})}),a.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[a.events.on("record-undo",({updates:o})=>{e.addToHistory({updates:o})}),a.events.on("translate-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move-start"},type:"update"})}),a.events.on("translate-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move-stop"},type:"update"})}),a.events.on("rotate-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,angle:o.angle,type:"rotate-start"},type:"update"})}),a.events.on("rotate-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,angle:o.angle,type:"rotate-stop"},type:"update"})}),a.events.on("scale-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale-start"},type:"update"})}),a.events.on("scale-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale-stop"},type:"update"})}),a.events.on("translate",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move"},type:"update"})}),a.events.on("rotate",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,angle:o.angle,type:"rotate"},type:"update"})}),a.events.on("scale",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale"},type:"update"})}),a.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[a.events.on("reshape",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...o,mover:o.object.graphic},type:"update"})}),a.events.on("move",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...o,mover:o.object.graphic},type:"update"})}),a.events.on("vertex-add",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),a.events.on("vertex-remove",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),a.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,a){const{graphic:o,viewEvent:i}=a;return i.native?.shiftKey&&this.hasGraphic(o)?(i.stopPropagation(),e.removeFromSelection(o)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const a=this.view?.map;this._disablePopup(t);const o=()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),a&&a.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",o)}async _getCommonUpdateOperationClickHandlers(e,t,a){const o=ee(t),i=await t.defer(()=>this._getFirstHit(o));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,a))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,a){const o=!!a.multipleSelectionEnabled;return e.some(i=>i!=null&&!(!o||!this.hasGraphic(i))&&(this.updateGraphics.includes(i)?t.removeFromSelection(i):t.addToSelection(i),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const a=t.key;a===b.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):a===b.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):a===b.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&b.delete.includes(a)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,a=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||a.length===1&&a[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=D(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(K)}_displayCursor(e){this.removeHandles(K),this.view?.container&&e!=null&&this.addHandles(this.view.acquireCursor(e,"high"),K)}_logError(e,t,a){_e.getLogger(this).error(new be(e,t,a))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const a=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:a}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}_onLayerGraphicsChangeCallback(e){if(this._operationHandle!=null){const{updateGraphics:t}=this;for(const a of e.removed)if(t.includes(a)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(a)}}}get test(){}wait(){return Y(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(j(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await we(Y(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",ne("view"))}_logMissingLayer(){this._logError(et,ne("layer"))}};l([y()],f.prototype,"_defaultSnappingManager",void 0),l([y()],f.prototype,"_layerAdapter",null),l([y()],f.prototype,"_operationHandle",void 0),l([y({readOnly:!0})],f.prototype,"_updatingHandles",void 0),l([y({readOnly:!0})],f.prototype,"activeTool",null),l([y({readOnly:!0})],f.prototype,"activeCreateToolDrawMode",null),l([y()],f.prototype,"activeTooltip",null),l([y({types:I})],f.prototype,"activeFillSymbol",void 0),l([y()],f.prototype,"activeLineSymbol",void 0),l([y()],f.prototype,"activeVertexSymbol",void 0),l([y()],f.prototype,"allowDeleteKey",void 0),l([y({readOnly:!0})],f.prototype,"createGraphic",null),l([y()],f.prototype,"defaultCreateOptions",null),l([y()],f.prototype,"defaultUpdateOptions",null),l([y({type:je,nonNullable:!0})],f.prototype,"labelOptions",null),l([y()],f.prototype,"layer",void 0),l([y({types:I})],f.prototype,"pointSymbol",void 0),l([y({types:I})],f.prototype,"polygonSymbol",void 0),l([y({types:I})],f.prototype,"polylineSymbol",void 0),l([y()],f.prototype,"meshSymbol",void 0),l([y()],f.prototype,"textSymbol",void 0),l([y({type:de,nonNullable:!0})],f.prototype,"snappingOptions",null),l([y()],f.prototype,"snappingManager",null),l([y({readOnly:!0})],f.prototype,"state",null),l([y({type:Ke,nonNullable:!0})],f.prototype,"tooltipOptions",null),l([y({readOnly:!0})],f.prototype,"updateGraphics",void 0),l([y()],f.prototype,"updateOnGraphicClick",void 0),l([y()],f.prototype,"updating",null),l([y()],f.prototype,"creationMode",void 0),l([y({type:We,nonNullable:!0})],f.prototype,"valueOptions",null),l([y({types:I})],f.prototype,"vertexSymbol",void 0),l([y({value:null})],f.prototype,"view",null),l([y({constructOnly:!0,type:ce})],f.prototype,"sketchOptions",void 0),f=l([V("esri.widgets.Sketch.SketchViewModel")],f);const et="sketch:missing-property",ne=e=>`Property '${e}' is missing on SketchViewModel.`;function tt(e){return e==="polygon"||e==="rectangle"||e==="circle"}function U(e,t){me("undo",e.history.undo,e.history.redo,t)}function L(e,t){me("redo",e.history.redo,e.history.undo,t)}function me(e,t,a,o){const i=t.pop();if(!i)return;const r=i.updates,c=[];o.forEach((p,s)=>{const n=r[s];n!=null&&("geometry"in n&&n.geometry!=null&&(c.push({geometry:p.geometry}),p.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(c.push({symbol:p.symbol}),p.symbol=n.symbol),"undo"in n&&(c.push(n),n[e](p)))}),a.push({updates:c})}function pe(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function M(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function $(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function G(e){return"requireError"in e&&e.requireError==="aborted"}export{St as a,f as d,At as l,Tt as s,oe as t};
