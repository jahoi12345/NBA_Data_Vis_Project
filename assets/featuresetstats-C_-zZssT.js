import{m as p}from"./TimeOnly-Du0ClqSA.js";import{x as A,l as u}from"./arcade-DfeE-p9c.js";import{n as d}from"./enum-BzLwmiID.js";import{o as l,B as s,t as c,K as w,u as h,z as m,c as S}from"./Dictionary-hE24dHJa.js";import{L as y,i as v}from"./WhereClause-BCLJDkvF.js";import{u as f,s as x,t as I}from"./lengthUtils-Ceo6858g.js";import"./jsonMap-Bs3hmeCU.js";import"./UnknownTimeZone-B697BDFv.js";import"./date-IqUzANpt.js";import"./reactiveUtils-SO2Ko3sy.js";import"./Extent-Bbnm65bN.js";import"./Point-BN8RINcc.js";import"./reader-DcGs6kKN.js";import"./index-C-2WWcaK.js";import"./arcadeEnvironment-DqZGrNFy.js";import"./Feature-pxcCplku.js";import"./jsonUtils-UGNxUp3z.js";import"./Polyline-BtUG5wiC.js";import"./Polygon-BdLNJfwi.js";import"./aaBoundingRect-CrU5VtR_.js";import"./mathUtils-PIGhLnI9.js";import"./featureConversionUtils-yVOZE0te.js";import"./aaBoundingBox-CtkshuSS.js";import"./DoubleArray-DExKNiTh.js";import"./mat4f64-q_b6UJoq.js";import"./OptimizedFeature-CwRGZPwv.js";import"./memoryEstimations-Bd726a_p.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./createFeatureId-CVwTD0fV.js";import"./FieldsIndex-B72TFK42.js";import"./timeZoneUtils-BSc7-7qA.js";import"./aiServices-DBi3_uiS.js";import"./collectionUtils-Dk3LoVuX.js";import"./SimpleObservable-CvFyr0NA.js";import"./commonProperties-DHiB1uzW.js";import"./utils-DBDpKdtI.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-CcvWoc0W.js";import"./Field-Cm_ZejYW.js";import"./Color-CERqXxxY.js";import"./fieldType-DVUzXtk_.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./unitConversion-BRJSqqQ6.js";import"./number-D_FvV3D1.js";import"./hash-CcEbRgUF.js";import"./uuid-Oe6SV2kF.js";async function e(n,r,t,a){if(t.length===1){if(f(t[0]))return u(n,t[0],m(t[1],-1));if(c(t[0]))return u(n,t[0].toArray(),m(t[1],-1))}else if(t.length===2){if(f(t[0]))return u(n,t[0],m(t[1],-1));if(c(t[0]))return u(n,t[0].toArray(),m(t[1],-1));if(s(t[0])){const o=await t[0].load(),i=await F(y.create(t[1],{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}),a,r);return g(r,await t[0].calculateStatistic(n,i,m(t[2],1e3),r.abortSignal))}}else if(t.length===3&&s(t[0])){const o=await t[0].load(),i=await F(y.create(t[1],{fieldsIndex:o.getFieldsIndex(),timeZone:o.dateFieldsTimeZoneDefaultUTC}),a,r);return g(r,await t[0].calculateStatistic(n,i,m(t[2],1e3),r.abortSignal))}return u(n,t,-1)}function g(n,r){return r instanceof v?p.fromReaderAsTimeStampOffset(r.toStorageFormat()):r instanceof Date?p.dateJSAndZoneToArcadeDate(r,S(n)):r}async function F(n,r,t){const a=n.getVariables();if(a.length>0){const o={};for(const i of a)o[i]=r.evaluateIdentifier(t,{name:i});n.parameters=o}return n}function Ft(n){n.mode==="async"&&(n.functions.stdev=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("stdev",r,i,n))},n.functions.variance=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("variance",r,i,n))},n.functions.average=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("mean",r,i,n))},n.functions.mean=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("mean",r,i,n))},n.functions.sum=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("sum",r,i,n))},n.functions.min=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("min",r,i,n))},n.functions.max=function(r,t){return n.standardFunctionAsync(r,t,(a,o,i)=>e("max",r,i,n))},n.functions.count=function(r,t){return n.standardFunctionAsync(r,t,async(a,o,i)=>{if(l(i,1,1,r,t),i[0]==null)return 0;if(s(i[0]))return i[0].count(a.abortSignal);if(f(i[0])||x(i[0]))return i[0].length;if(c(i[0]))return i[0].length();if(w(i[0]))return i[0].entryCount();throw new d(r,"InvalidParameter",t)})},n.functions.isempty=function(r,t){return n.standardFunctionAsync(r,t,async(a,o,i)=>{if(l(i,1,2,a,o),i.length>=2&&!I(i[1]))throw new d(a,"InvalidParameter",o);return m(i[1],!1)?s(i[0])?await i[0].isEmpty(a.abortSignal):A(i[0]):h(i[0])})})}export{Ft as registerFunctions};
