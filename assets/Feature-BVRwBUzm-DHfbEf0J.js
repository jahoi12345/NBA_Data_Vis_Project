import{r as p,J as W,u as Y}from"./TimeOnly-BERR31kg-PKcKegNB.js";import{A as N,u as B,_ as q,x as H,v as k,c as Z,m as O,k as S,a6 as K,o as z,w as c,a7 as Q}from"./Dictionary-B4WY1XGX-DTk60YkO.js";import{u as l}from"./enum-BzLwmiID-CcyIdWlQ.js";import{aO as P}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{c as L,b as v}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{P as T}from"./jsonUtils-CmpazY1u-ateEpj4Q.js";import{F as X}from"./featureConversionUtils-BDA_FXJx-CUwkrHf5.js";import{m as ee}from"./FieldsIndex-CimK-TqD-CrSnohIk.js";import{f as te,J as re,W as ne,Y as se}from"./lengthUtils-Dt1_RvOO-bleznLOi.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import"./index-CTl7hdrJ.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./ImmutableArray-BPVd6ESQ-BGk4ZTNG.js";import"./shared-yd-CR64C-r_XSstFM.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./number-D_FvV3D1-OQFavbmh.js";import"./Polyline-CoiTLswR-BLagWJLS.js";import"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";function ie(e,r,n=null){const t=C(e,!0);if(t.hasm!==void 0&&(t.hasM=t.hasm,delete t.hasm),t.hasz!==void 0&&(t.hasZ=t.hasz,delete t.hasz),t.spatialreference!==void 0&&(t.spatialReference=t.spatialreference,delete t.spatialreference),t.spatialReference||(t.spatialReference=r),t.curverings!==void 0){const s=F(t.curverings,t.hasZ,t.hasM,G);if(s==null)return null;t.curveRings=s.arrays,delete t.curverings,delete t.rings,t.hasZ=s.hasZ,t.hasM=s.hasM}else if(t.rings!==void 0){const s=F(t.rings,t.hasZ,t.hasM,f);if(s==null)return null;t.rings=s.arrays,t.hasZ=s.hasZ,t.hasM=s.hasM}if(t.curvepaths!==void 0){const s=F(t.curvepaths,t.hasZ,t.hasM,G);if(s==null)return null;t.curvePaths=s.arrays,delete t.curvepaths,delete t.paths,t.hasZ=s.hasZ,t.hasM=s.hasM}else if(t.paths!==void 0){const s=F(t.paths,t.hasZ,t.hasM,f);if(s==null)return null;t.paths=s.arrays,t.hasZ=s.hasZ,t.hasM=s.hasM}if(t.points!==void 0){const s=pe(t.points,t.hasZ,t.hasM);if(s==null)return null;t.points=s.array,t.hasZ=s.hasZ,t.hasM=s.hasM}const i=T(t);if(n!=null&&i?.type!==n)throw new l(null,"InvalidParameter",null);return i}function C(e,r=!1){const n={};for(const t of e.keys()){const i=r?t.toLowerCase():t,s=e.attributes[t];n[i]=z(s)?C(s):s}return n}const A=Symbol("NoValue");function g(e){return Array.isArray(e)&&e.length>0?e[0]:c(e)&&e.length()>0?e.get(0):A}function ae(e){const r=g(g(e));return r===A||Array.isArray(r)||c(r)||r instanceof v?e:[e]}const w=0;function J(e){return P(e,w)??w}function $(e){return typeof e=="number"&&!Number.isNaN(e)}const x=null;function R(e){return P(e,x)??x}function U(e){return typeof e=="number"&&!Number.isNaN(e)||e===null}function D(e){return!(e.length<2)&&typeof e[0]=="number"&&!Number.isNaN(e[0])&&typeof e[1]=="number"&&!Number.isNaN(e[1])}function b(e){return D(e)?e.length>2?e.slice(0,2):e:null}function le(e){return D(e)?$(e[2])?e.length>3?e.slice(0,3):e:[e[0],e[1],J(e[2])]:null}function oe(e){return D(e)?e.length>=3&&!U(e[2])?[e[0],e[1],R(e[2])]:e.length>3?e.slice(0,3):e:null}function ue(e){return D(e)?$(e[2])&&U(e[3])?e.length>4?e.slice(0,4):e:[e[0],e[1],J(e[2]),R(e[3])]:null}function _(e){return[e.x,e.y]}function fe(e){return[e.x,e.y,e.z??w]}function ce(e){return[e.x,e.y,e.m??x]}function he(e){return[e.x,e.y,e.z??w,e.m??x]}function de(e,r,n){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==2)throw new l(null,"InvalidParameter",null);const t=f(e[0],r,n);if(t==null)return null;const i=f(e[1],_,b);return i==null?null:{c:[t,i]}}function me(e,r,n){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==4&&e.length!==7)throw new l(null,"InvalidParameter",null);const t=f(e[0],r,n);if(t==null)return null;const i=f(e[1],_,b);if(i==null)return null;const s=e[2];if(s!==0&&s!==1)throw new l(null,"InvalidParameter",null);const a=e[3];if(a!==0&&a!==1)throw new l(null,"InvalidParameter",null);if(e.length===4)return{a:[t,i,s,a]};const o=e[4];if(typeof o!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(o))return null;const m=e[5];if(typeof m!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(m))return null;const h=e[6];if(typeof h!="number")throw new l(null,"InvalidParameter",null);return Number.isNaN(h)?null:{a:[t,i,s,a,o,m,h]}}function ye(e,r,n){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==3)throw new l(null,"InvalidParameter",null);const t=f(e[0],r,n);if(t==null)return null;const i=f(e[1],_,b);if(i==null)return null;const s=f(e[2],_,b);return s==null?null:{b:[t,i,s]}}function j(e,r){return e?r?ue:le:r?oe:b}function V(e,r){return e?r?he:fe:r?ce:_}function f(e,r,n){return Array.isArray(e)?n(e):e instanceof v?r(e):c(e)?n(e.toArray()):null}function G(e,r,n){return Array.isArray(e)?n(e):z(e)?e.hasField("c")?de(e.field("c"),r,n):e.hasField("a")?me(e.field("a"),r,n):e.hasField("b")?ye(e.field("b"),r,n):null:e instanceof v?r(e):c(e)?n(e.toArray()):null}function I(e,r,n,t){const i=[];if(Array.isArray(e))for(const s of e){const a=r(s,n,t);a!=null&&i.push(a)}else if(c(e))for(let s=0;s<e.length();s++){const a=r(e.get(s),n,t);a!=null&&i.push(a)}return i}function y(e,r,n){return Array.isArray(e)?e.length>=r:c(e)?e.length()>=r:e instanceof v&&e[n]}function E(e,r,n){return e===void 0&&r===void 0?{hasZ:y(n,3,"hasZ"),hasM:y(n,4,"hasM")}:e===void 0?r===!0?{hasZ:y(n,4,"hasZ"),hasM:!0}:{hasZ:y(n,3,"hasZ"),hasM:!1}:r===void 0?e===!0?{hasZ:!0,hasM:y(n,4,"hasM")}:{hasZ:!1,hasM:y(n,3,"hasM")}:{hasZ:e===!0,hasM:r===!0}}function pe(e,r,n){const t=g(e);if(t===A)return null;const{hasZ:i,hasM:s}=E(r,n,t);return{array:I(e,f,V(i,s),j(i,s)),hasZ:i,hasM:s}}function F(e,r,n,t){const i=g(g(e=ae(e)));if(i===A)return null;const{hasZ:s,hasM:a}=E(r,n,i),o=V(s,a),m=j(s,a),h=[];if(Array.isArray(e))for(let d=0;d<e.length;d++)h.push(I(e[d],t,o,m));else if(c(e))for(let d=0;d<e.length();d++)h.push(I(e.get(d),t,o,m));return{arrays:h,hasZ:s,hasM:a}}function ge(e){switch(e.type){case"small-integer":case"esriFieldTypeSmallInteger":case"integer":case"esriFieldTypeInteger":case"single":case"esriFieldTypeSingle":case"double":case"esriFieldTypeDouble":case"big-integer":case"esriFieldTypeBigInteger":case"long":case"esriFieldTypeLong":case"oid":case"esriFieldTypeOID":return{name:e.name,type:"number"};case"global-id":case"esriFieldTypeGlobalID":case"guid":case"esriFieldTypeGUID":case"string":case"esriFieldTypeString":return{name:e.name,type:"text"};case"date":case"esriFieldTypeDate":case"timestamp-offset":case"esriFieldTypeTimestampOffset":return{name:e.name,type:"date"};case"date-only":case"esriFieldTypeDateOnly":return{name:e.name,type:"dateOnly"};case"time-only":case"esriFieldTypeTimeOnly":return{name:e.name,type:"time"};default:return null}}function M(e,r,n){if(e==null)return null;switch(r){case"time-only":return O(e)?e:Y.fromReader(e.toString());case"date-only":return S(e)?e:W.fromReader(e.toString());case"timestamp-offset":return Z(e)?e:p.fromReaderAsTimeStampOffset(e.toString());case"date":return Z(e)?e:se(e)?p.dateJSAndZoneToArcadeDate(e,n):p.epochToArcadeDate(e,n);case"geometry":return null;default:return e}}class u{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(r,n){const t=new u;return t.contextTimeZone=n??null,t._geometry=r.geometry!=null?r.geometry:null,r.attributes===void 0||r.attributes===null?t.attributes={}:t.attributes=r.attributes,r._sourceLayer?(t._layer=r._sourceLayer,t._fieldTypesFixed=!1):r._layer?(t._layer=r._layer,t._fieldTypesFixed=!1):r.layer&&"fields"in r.layer?(t._layer=r.layer,t._fieldTypesFixed=!1):r.sourceLayer&&"fields"in r.sourceLayer&&(t._layer=r.sourceLayer,t._fieldTypesFixed=!1),t._layer&&!t._fieldTypesFixed&&(t.fieldsIndex=this.hydrateFieldsIndex(t._layer)),t}static createFromArcadeFeature(r){if(r instanceof u){const t=new u;return t._fieldTypesFixed=r._fieldTypesFixed,t.attributes=r.attributes,t._geometry=r._geometry,t._optimizedGeomDefinition=r._optimizedGeomDefinition,r._layer&&(t._layer=r._layer),t.fieldsIndex=r.fieldsIndex,t.contextTimeZone=r.contextTimeZone,t}const n={};for(const t of r.keys())n[t]=r.field(t);return u.createFromGraphicLikeObject(r.geometry(),n,r.fullSchema(),r.contextTimeZone)}static createFromOptimisedFeature(r,n,t){const i=new u;return i._geometry=r.geometry?{geometry:r.geometry}:null,i._optimizedGeomDefinition=t,i.attributes=r.attributes||{},i._layer=n,i._fieldTypesFixed=!1,i}static createFromArcadeDictionary(r,n){const t=new u;return t.attributes=r.field("attributes"),t.attributes!==null&&t.attributes instanceof N?(t.attributes=t.attributes.attributes,t.attributes===null&&(t.attributes={})):t.attributes={},t._geometry=r.field("geometry"),t._geometry!==null&&(t._geometry instanceof N?t._geometry=ie(t._geometry,n):t._geometry instanceof L||(t._geometry=null)),t}static createFromGraphicLikeObject(r,n,t=null,i){const s=new u;return s.contextTimeZone=i??null,n===null&&(n={}),s.attributes=n,s._geometry=r??null,s._layer=t,s._layer&&(s._fieldTypesFixed=!1,s.fieldsIndex=this.hydrateFieldsIndex(s._layer)),s}static hydrateFieldsIndex(r){return r===null?null:B(r)?r.getFieldsIndex():r.fieldsIndex?r.fieldsIndex:ee.fromLayerJSON({datesInUnknownTimezone:r.datesInUnknownTimezone,fields:r.fields,timeInfo:r.timeInfo,editFieldsInfo:r.editFieldsInfo,dateFieldsTimeReference:r.dateFieldsTimeReference??{timeZone:"UTC",respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(r,n,t=null){n===null&&(n={}),this.attributes=n,this._geometry=r??null,this._layer=t,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(r=!1){this._fieldTypesFixed===!1&&this._fixFieldTypes();const n=q(this.attributes,{useNumbersForDates:r});return'{"geometry":'+(this.geometry()===null?"null":H(this.geometry()))+',"attributes":'+n+"}"}_fixFieldTypes(){if(this._fieldsToFixDataTypes&&this._fieldsToFixDataTypes?.length>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);const r=[],n=this._layer.fields;for(let t=0;t<(n?.length??0);t++){const i=n[t],{name:s,type:a}=i;switch(a){case"date":case"esriFieldTypeDate":r.push({field:s,dataType:"date"});break;case"date-only":case"esriFieldTypeDateOnly":r.push({field:s,dataType:"date-only"});break;case"time-only":case"esriFieldTypeTimeOnly":r.push({field:s,dataType:"time-only"});break;case"timestamp-offset":case"esriFieldTypeTimestampOffset":r.push({field:s,dataType:"timestamp-offset"});break;case"geometry":case"esriFieldTypeGeometry":r.push({field:s,dataType:"geometry"})}}this._fieldsToFixDataTypes=r,r.length>0&&this._fixAllFields(r),this._fieldTypesFixed=!0}isUnknownDateTimeField(r){return this.fieldsIndex?.getTimeZone(r)==="unknown"}_fixAllFields(r){this.attributes={...this.attributes};const n=this.contextTimeZone??"system";for(let t=0;t<r.length;t++){const i=r[t].field,s=r[t].dataType;let a=this.attributes[i];if(a===void 0){for(const o in this.attributes)if(o.toLowerCase()===i.toLowerCase()){a=this.attributes[o],this.attributes[o]=M(a,s,this.isUnknownDateTimeField(o)?"unknown":n);break}}else a!==null&&(this.attributes[i]=M(a,s,this.isUnknownDateTimeField(i)?"unknown":n))}}geometry(){return this._geometry===null||this._geometry instanceof L||(this._optimizedGeomDefinition?(this._geometry=T(X(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=T(this._geometry)),this._geometry}field(r){this._fieldTypesFixed||this._fixFieldTypes();const n=this.attributes[r];if(n!==void 0)return n;const t=r.toLowerCase();for(const i in this.attributes)if(i.toLowerCase()===t)return this.attributes[i];if(this._hasFieldDefinition(t))return null;throw new l(null,"FieldNotFound",null,{key:r})}_hasFieldDefinition(r){if(this._layer===null)return!1;for(let n=0;n<this._layer.fields.length;n++)if(this._layer.fields[n].name.toLowerCase()===r)return!0;return!1}setField(r,n){if(this.immutable)throw new l(null,"Immutable",null);if(n instanceof Date&&(n=this.isUnknownDateTimeField(r)?p.unknownDateJSToArcadeDate(n):p.dateJSToArcadeDate(n)),k(n)===!1)throw new l(null,"TypeNotAllowedInFeature",null);const t=r.toLowerCase();if(this.attributes[r]===void 0){for(const i in this.attributes)if(i.toLowerCase()===t)return void(this.attributes[i]=n);this.attributes[r]=n}else this.attributes[r]=n}hasField(r){const n=r.toLowerCase();if(this.attributes[r]!==void 0)return!0;for(const t in this.attributes)if(t.toLowerCase()===n)return!0;return!!this._hasFieldDefinition(n)}keys(){let r=[];const n={};for(const t in this.attributes)r.push(t),n[t.toLowerCase()]=1;if(this._layer!==null)for(let t=0;t<this._layer.fields.length;t++){const i=this._layer.fields[t];n[i.name.toLowerCase()]!==1&&r.push(i.name)}return r=r.sort(),r}isEmpty(){for(const r in this.attributes)return!1;return!(this._layer!=null&&this._layer.fields.length>0)&&this.geometry()==null}static parseAttributesFromDictionary(r){const n={};for(const t in r.attributes){const i=r.attributes[t];if(!k(i))throw new l(null,"InvalidParameter",null);n[t]=i}return n}static fromJson(r,n){let t=null;r.geometry!==null&&r.geometry!==void 0&&(t=T(r.geometry));const i={};if(r.attributes!==null&&r.attributes!==void 0)for(const s in r.attributes){const a=r.attributes[s];if(a===null)i[s]=a;else{if(!(te(a)||re(a)||ne(a)||Z(a)||O(a)||S(a)))throw new l(null,"InvalidParameter",null);i[s]=a}}return u.createFromGraphicLikeObject(t,i,null,n??null)}fullSchema(){return this._layer}gdbVersion(){if(this._layer===null)return"";const r=this._layer.gdbVersion;return r===void 0?"":r===""&&this._layer.capabilities?.isVersioned?"SDE.DEFAULT":r}castAsJson(r){const n={attributes:{},geometry:r?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null};for(const t in this.attributes){const i=this.attributes[t];i!==void 0&&(n.attributes[t]=K(i,r))}return n}async castAsJsonAsync(r=null,n){return this.castAsJson(n)}}Q(u);const Ke=Object.freeze(Object.defineProperty({__proto__:null,Feature:u,convertAttributeToArcadeValue:M,getArcadeVariableForField:ge},Symbol.toStringTag,{value:"Module"}));export{ge as D,Ke as F,u as I,ie as a,M as w};
