import{m as v,v as x}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{t as w}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{f as S}from"./WorkerHandle-B930SiRy-DglEKt53.js";import{J as j}from"./projectionUtils-BGH_5_I3-DGwchVO8.js";import{x as k}from"./projectVectorToVector-Csv3NYZI-DpBtmQMN.js";class W{constructor(t,o,r,n,a,p){this.layout=t,this.interleavedVertexData=o,this.indices=r,this.hasColors=n,this.hasModifications=a,this.positionData=p}}class A{constructor(t,o,r,n,a,p,f){this.componentOffsets=t,this.featureIds=o,this.anchorIds=r,this.anchors=n,this.transformedGeometry=a,this.globalTrafo=p,this.obb=f}}class D extends S{constructor(t){super("SceneLayerWorker","process",{process:o=>[o.geometryBuffer],project:o=>[o.positions.buffer],transformNormals:o=>[o.normals.buffer]},t,{hasInitialize:!0})}setModifications(t,o,r){const n={context:t,modifications:o,isGeodetic:r};return this.broadcast(n,"setModifications")}setLegacySchema(t,o){const r=JSON.stringify(o);return this.broadcast({context:t,jsonSchema:r},"setLegacySchema")}destroyContext(t){return this.broadcast(t,"destroyContext")}async destroyContextAndSelf(t){await this.destroyContext(t),this.destroy()}project(t,o){return this.invokeMethod("project",t,o)}transformNormals(t,o){return this.invokeMethod("transformNormals",t,o)}}const s=new v({deallocator:null}),l=w();function O(e,t,o){s.clear();let r=1/0,n=1/0,a=-1/0,p=-1/0,f=!1;for(const u of t){const g=u.type==="clip"?2:u.type==="mask"?1:0,h=u.geometry;let m=i=>i;if(h.spatialReference){if(!j(h.spatialReference,o)){x.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("im-modification-projection-failed","Can't project modification polygon into layer spatial reference, ignoring modification",{polygon:h});continue}m=i=>(k(i,h.spatialReference,l,o),l)}else h.hasZ||(l[2]=0,m=i=>(l[0]=i[0],l[1]=i[1],l));f=f||g===1;const y=h.rings.length,M=h.rings.some(i=>i.length<3);if(y===0||M)x.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("im-modification-invalid-polygon","Ignoring invalid modification polygon (no rings or rings with less than 3 vertices).",{polygon:h});else{s.push(g),s.push(y);for(const i of h.rings){s.push(i.length);for(const b of i){const c=m(b);s.push(c[0]),s.push(c[1]),s.push(c[2]),r=Math.min(r,c[0]),n=Math.min(n,c[1]),a=Math.max(a,c[0]),p=Math.max(p,c[1])}}}}e!=null&&(f?(s.push(2),s.push(2),s.push(4),s.push(r-1e-4),s.push(n-1e-4),s.push(0),s.push(a+1e-4),s.push(n-1e-4),s.push(0),s.push(a+1e-4),s.push(p+1e-4),s.push(0),s.push(r-1e-4),s.push(p+1e-4),s.push(0),s.push(4),s.push(e[0]),s.push(e[1]),s.push(0),s.push(e[2]),s.push(e[1]),s.push(0),s.push(e[2]),s.push(e[3]),s.push(0),s.push(e[0]),s.push(e[3]),s.push(0)):(s.push(1),s.push(1),s.push(4),s.push(e[0]),s.push(e[1]),s.push(0),s.push(e[2]),s.push(e[1]),s.push(0),s.push(e[2]),s.push(e[3]),s.push(0),s.push(e[0]),s.push(e[3]),s.push(0))),s.push(3);const d=new Float64Array(s.length);for(let u=0;u<s.length;++u)d[u]=s.at(u);return d}export{D as A,O as D,W as R,A as W};
