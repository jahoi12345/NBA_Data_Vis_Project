import{aw as b,H as d,K as w}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{I as m,J as p,l as h}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{l as g,d as $}from"./collectionUtils-jDyktm0P-ArdXNs6F.js";const c=new Map;async function N(e,n){try{return{data:(await R(e,n)).data,baseUrl:b(e),styleUrl:e}}catch(t){return p(t),null}}function U(e,n,t){const r=n.portal!=null?n.portal:g.getDefault();let o;const l=`${r.url} - ${r.user?.username} - ${e}`,s=c.get(l);if(s)return s;const a=I(e,r,t).then(u=>(o=u,u.fetchData())).then(u=>({data:u,baseUrl:o.itemUrl??"",styleName:e}));return c.set(l,a),a}function I(e,n,t){return n.load(t).then(()=>{const r=new $({disableExtraQuery:!0,query:`owner:${i} AND type:${y} AND typekeywords:"${e}"`});return n.queryItems(r,t)}).then(({results:r})=>{let o=null;const l=e.toLowerCase();if(r&&Array.isArray(r)){for(const s of r)if(s.typeKeywords?.some(a=>a.toLowerCase()===l)&&s.type===y&&s.owner===i){o=s;break}}if(!o)throw new m("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return o.load(t)})}function C(e,n,t){return e?.styleUrl!=null?N(e.styleUrl,t):e?.styleName!=null?U(e.styleName,n,t):Promise.reject(new m("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function D(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function q(e,n){for(const t of n)switch(t){case"cim":if(e.cimRef)return{format:t,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const r=f(e,"gltf_basisu");if(r)return{format:t,url:r};break}case"web-gltf":{const r=f(e,"gltf");if(r)return{format:t,url:r};break}case"web":{const r=f(e,"gltf");if(r)return{format:"web-gltf",url:r};if(e.webRef)return{format:t,url:encodeURI(e.webRef)};break}}}function f(e,n){if(!h("enable-feature:force-wosr"))return e.formatInfos?.find(t=>t.type===n)?.href}function R(e,n){const t={responseType:"json",query:{f:"json"},...n};return d(w(e),t)}const i="esri_en",y="Style",M="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{C as A,D as C,q as D,M,R as k};
