import{am as v,a1 as M}from"./jsonMap-Bs3hmeCU.js";import{O as d}from"./quat-DaxwNZcu.js";import{e as g}from"./quatf64-CCm9z-pX.js";import{Q as y}from"./vec32-DAazN8eR.js";import{t as c,n as h}from"./vec3f32-WCVSSNPR.js";import{f as I}from"./Point-fJINO2ru.js";import{b as w}from"./projectionUtils-DfTR--qY.js";import{u as S,c as l,i as x,f as F}from"./PointCloudWorkerUtil-B5nhJQfN.js";import{G as O}from"./orientedBoundingBox-BGtR3PRL.js";import"./Polygon-Brg2ZzgS.js";import"./Extent-B4u1bcyL.js";import"./aaBoundingRect-5dP796IU.js";import"./mathUtils-PIGhLnI9.js";import"./collectionUtils-DO-P7c3V.js";import"./index-ClordG0R.js";import"./reactiveUtils-SO2Ko3sy.js";import"./reader-DcGs6kKN.js";import"./SimpleObservable-CvFyr0NA.js";import"./vec42-BKpTaQMj.js";import"./Polyline-33xu-nCu.js";import"./PointCloudUniqueValueRenderer-BOl4b0Yd.js";import"./Color-CERqXxxY.js";import"./RendererLegendOptions-D6DGIWXY.js";import"./ColorStop-De5gQTjr.js";import"./I3SBinaryReader-ZmgM2p_h.js";import"./mat4f64-q_b6UJoq.js";import"./vec4f64-DPb6J-GU.js";import"./spatialReferenceEllipsoidUtils-DBzU7sxg.js";import"./computeTranslationToOriginAndRotation-CIogc7ND.js";import"./mat4-DD840M-x.js";import"./plane-DvzqWKXC.js";import"./vector-Ce9hWqc5.js";import"./vec2f64-rIxtbMRN.js";class N{transform(t){const r=this._transform(t),o=[r.points.buffer,r.rgb.buffer];r.pointIdFilterMap!=null&&o.push(r.pointIdFilterMap.buffer);for(const f of r.attributes)"buffer"in f.values&&v(f.values.buffer)&&f.values.buffer!==r.rgb.buffer&&o.push(f.values.buffer);return Promise.resolve({result:r,transferList:o})}_transform(t){const r=S(t.schema,t.geometryBuffer);let o=r.length/3,f=null;const n=new Array,e=l(t.primaryAttributeData,r,o);t.primaryAttributeData!=null&&e&&n.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:e});const m=l(t.modulationAttributeData,r,o);t.modulationAttributeData!=null&&m&&n.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:m});let a=x(t.rendererInfo,e,m,o);if(t.filterInfo&&t.filterInfo.length>0&&t.filterAttributesData!=null){const s=t.filterAttributesData.filter(M).map(i=>{const D=l(i,r,o),b={attributeInfo:i.attributeInfo,values:D};return n.push(b),b});f=new Uint32Array(o),o=F(r,a,f,t.filterInfo,s)}for(const s of t.userAttributesData){const i=l(s,r,o);n.push({attributeInfo:s.attributeInfo,values:i})}3*o<a.length&&(a=new Uint8Array(a.buffer.slice(0,3*o))),J(r,o,t.elevationOffset);const p=z(r,o,O.fromData(t.obbData),I.fromJSON(t.inSR),I.fromJSON(t.outSR));return{obbData:t.obbData,points:p,rgb:a,attributes:n,pointIdFilterMap:f}}}function z(u,t,r,o,f){if(!w(u,o,0,u,f,0,t))throw new Error("Can't reproject");const n=c(r.center),e=h(),m=h(),a=c(r.halfSize);d(A,r.quaternion);const p=new Float32Array(3*t);for(let s=0;s<t;s++){let i=3*s;e[0]=u[i]-n[0],e[1]=u[i+1]-n[1],e[2]=u[i+2]-n[2],y(m,e,A),a[0]=Math.max(a[0],Math.abs(m[0])),a[1]=Math.max(a[1],Math.abs(m[1])),a[2]=Math.max(a[2],Math.abs(m[2])),p[i++]=e[0],p[i++]=e[1],p[i]=e[2]}return r.halfSize=a,p}function J(u,t,r){if(r!==0)for(let o=0;o<t;o++)u[3*o+2]+=r}const A=g();function pt(){return new N}export{pt as default};
