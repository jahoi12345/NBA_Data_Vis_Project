import{M as I,m as P,U as _,Q as C,n as D,q as E,r as M,u as L,v as y,w as V,A as k,B as J}from"./arcade-zfxT_nQK-Bom8OZ03.js";import{F as Ot}from"./arcade-zfxT_nQK-Bom8OZ03.js";import{J as Z,u as z,r as l}from"./TimeOnly-BERR31kg-PKcKegNB.js";import{o as c}from"./arcadeEnvironment-DqZGrNFy-B7LAcj80.js";import{v as O,_ as b,A as f,w as G,c as N,L as R,u as U,l as W}from"./Dictionary-B4WY1XGX-DTk60YkO.js";import{D as j,w as q,I as d}from"./Feature-BVRwBUzm-DHfbEf0J.js";import{u as o}from"./enum-BzLwmiID-CcyIdWlQ.js";import{h as F}from"./ImmutableArray-BPVd6ESQ-BGk4ZTNG.js";import{y as Y,v as B,a2 as Q}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{r as H}from"./isImageryGraphicOrigin-Ccuhb4eK-DL3hfhS7.js";import{r as K}from"./isImageryTileGraphicOrigin-ZR-gBf9D-D2Wlykhy.js";import{L as v,Y as S,Z as X,f as ee,W as te,J as re}from"./lengthUtils-Dt1_RvOO-bleznLOi.js";import{V as ne}from"./rasterFieldUtils-0bNK-dHZ-COz_3SPB.js";import{z as ae}from"./Extent-CgDMOSRD-CU1qE5Kr.js";import{n as ie,o as se}from"./Polyline-CoiTLswR-BLagWJLS.js";import{b as oe}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{P as le}from"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./index-CTl7hdrJ.js";import"./aiServices-BQaMAyiK-DY1ybKXH.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./collectionUtils-jDyktm0P-ArdXNs6F.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./WhereClause-BSVqskBz-DANRwfyr.js";import"./unitConversion-C1kMoaUu-D70TyOlq.js";import"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./shared-yd-CR64C-r_XSstFM.js";import"./streamLayerUtils-DFlbJ4P1-DFlbJ4P1.js";import"./jsonUtils-CmpazY1u-ateEpj4Q.js";import"./number-D_FvV3D1-OQFavbmh.js";import"./hash-CcEbRgUF-DpReY683.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./featureConversionUtils-BDA_FXJx-CUwkrHf5.js";import"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./FieldsIndex-CimK-TqD-CrSnohIk.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./commonProperties-DHiB1uzW-DHiB1uzW.js";import"./utils-CylVuxNi-CqOfmBVG.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";const ue=()=>B.getLogger("esri.arcade.Pixel");function x(e){return e.rasterFields.filter(r=>r.name.startsWith(ne))}class T{constructor(r,t,n){this._graphic=t,this._timeZone=n,this.arcadeDeclaredClass="esri.arcade.Pixel",this._values=new Map,this._fields=new Map(r.map(s=>[c(s.name),s]))}static fromImageryGraphic(r,t){if(!H(r.origin)&&!K(r.origin))throw new o(null,"InvalidParameter",null);return new T(x(r.origin.layer),r,t)}static getDeclaredMembers(r){return x(r).map(t=>v(t.name)&&t.type==="string"?{name:t.name,type:"array",elementType:{type:"text"}}:j(t)).filter(t=>t!=null)}keys(){return Array.from(this._fields.values()).map(r=>r.name).sort()}hasField(r){return this._fields.has(c(r))}field(r){const t=this._fields.get(c(r));if(t==null)throw new o(null,"FieldNotFound",null,{key:r});return Y(this._values,t.name,()=>{const n=this._graphic.getAttribute(t.name);return n==null?null:v(t.name)&&typeof n=="string"?new F(n.split(/,\s*|\s+/)):S(n)||O(n)?q(n,t.type,this._timeZone??"system"):(ue().warn(`Unsupported type for attribute: ${t.name}. Ignoring value.`),null)})}isEmpty(){return this._fields.size<=0}castToText(r=!1){const t={};for(const n of this._fields.values())t[n.name]=this.field(n.name);return b(t,{useNumbersForDates:r})}}const m="Voxel.Position",u="Voxel.LocalTime";function ce(e){const r=e.getAttribute(m);if(typeof r!="string")throw new o(null,"InvalidParameter",null);const t=JSON.parse(r);if(!Array.isArray(t)||typeof t[0]!="number"||typeof t[1]!="number"||typeof t[2]!="number")throw new o(null,"InvalidParameter",null);return new F(t)}function pe(e,r){const t=e.getAttribute(u);if(t==null)return null;if(!S(t))throw new o(null,"InvalidParameter",null);return l.dateJSAndZoneToArcadeDate(t,r)}class yt{constructor(r,t){this._graphic=r,this._timeZone=t,this.arcadeDeclaredClass="esri.arcade.Voxel",this._layer=r.sourceLayer}static getDeclaredMembers(r){return r.fields.map(t=>{switch(t.name){case m:return{name:t.name,type:"array",elementType:{type:"number"}};case u:return{name:t.name,type:"date"};default:switch(t.type){case"string":return{name:t.name,type:"text"};case"double":return{name:t.name,type:"number"}}return null}}).filter(t=>t!=null)}getPosition(){return this._position!==void 0?this._position:this._position=ce(this._graphic)}getLocalTime(){return this._localTime!==void 0?this._localTime:this._localTime=pe(this._graphic,this._timeZone??"system")}keys(){return this._layer.fields.map(r=>r.name).sort()}hasField(r){return this._layer.fieldsIndex.has(r)}field(r){const t=this._layer.fieldsIndex?.get(r)?.name;if(t==null)throw new o(null,"FieldNotFound",null,{key:r});switch(t){case m:return this.getPosition();case u:return this.getLocalTime()}return this._graphic.attributes[t]??null}isEmpty(){return this._layer.fields.length<=0}castToText(r=!1){const t={...this._graphic.attributes};t[m]=this.getPosition(),u in t&&(t[u]=this.getLocalTime());for(const n of Object.keys(t))this._layer.fieldsIndex?.has(n)||delete t[n];return b(t,{useNumbersForDates:r})}}const me={vars:{$feature:"any",$view:"any"}};function fe(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function ht(e){return e==null?null:X(e)||G(e)?"array":N(e)?"date":ee(e)?"text":te(e)?"boolean":re(e)?"number":e instanceof f?"dictionary":R(e)?"feature":e instanceof oe?"point":e instanceof le?"polygon":e instanceof ie?"polyline":e instanceof se?"multipoint":e instanceof ae?"extent":e instanceof Z?"dateOnly":e instanceof z?"time":U(e)?"featureSet":W(e)?"featureSetCollection":null}function p(e){if(!e)return null;try{return P(e)}catch{}return null}function gt(e,r){const t=typeof e=="string"?p(e):e;if(!t)return null;try{return r=r||Q(me),I(t,r)}catch{}return null}function vt(e,r,t){return{vars:{$feature:e==null?new d:d.createFromGraphic(e,t),$view:r?.view},spatialReference:r?.sr,timeZone:t??null}}function xt(e,r,t){return d.createFromGraphicLikeObject(r,e,t,null)}function wt(e,r){e.vars!=null&&(e.vars.$feature=r)}function _t(e,r){let t;try{t=E(e,r)}catch{t=null}return t}function bt(e,r){let t;try{t=e?e(r):null}catch{t=null}return t}function Ft(e,r){try{return e?e(r):Promise.resolve(null)}catch{return Promise.resolve(null)}}const de=["$feature","$aggregatedFeatures","$voxel"].map(e=>c(e));function St(e,r){if(!e)return[];const t=typeof e=="string"?p(e):e;if(!t)return[];const n=new Map;if(Array.isArray(r)||r==null)for(const a of de)n.set(a,r);else for(const[a,i]of r)n.set(c(a),i);const s=M(t).flatMap(({varId:a,memberNamePattern:i})=>{if(!n.has(a))return[];if(i.includes("*")){const g=n.get(a);if(g==null)return[];const A=new RegExp(`^${i.split(/\*+/).map(fe).join(".*")}$`,"i");return g.filter($=>A.test($))}return i.toLowerCase()});return[...new Set(s.sort())]}function Tt(e){return _(e,"$view")}function At(e,r){return!!e&&_(e,r)}function $t(e){if(!e||e.spatialReference==null&&(e.scale==null||e.viewingMode==null))return;let r,t;const{timeProperties:n,timeZone:s}=e;if(n!=null){const{currentStart:a,currentEnd:i}=n;s!=null?(r=a!=null?l.dateJSAndZoneToArcadeDate(a,s):null,t=i!=null?l.dateJSAndZoneToArcadeDate(i,s):null):(r=a!=null?l.dateJSToArcadeDate(a):null,t=i!=null?l.dateJSToArcadeDate(i):null)}return{view:e.viewingMode&&e.scale!=null?new f({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:r!=null||t!=null?new f({__proto__:null,currentStart:r,currentEnd:t,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function It({url:e,spatialReference:r,lrucache:t,interceptor:n}){const s=y();return s?s.createFeatureSetCollectionFromService(e,r,t,n):null}function Pt({layer:e,spatialReference:r,outFields:t,returnGeometry:n,lrucache:s,interceptor:a}){if(e===null)return null;const i=y();return i?i.constructFeatureSet(e,r,t,n??!0,s,a):null}function Ct(e){if(e?.map===null)return null;const r=y();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function Dt(e,r){return f.convertJsonToArcade(e,r)}function Et(e,r,t=[]){return L(e,r,t)}function Mt(){return D()}function Lt(){return C()}function ye(e){return"type"in e&&(e.type==="class-breaks"||e.type==="dictionary"||e.type==="dot-density"||e.type==="pie-chart"||e.type==="simple"||e.type==="unique-value")}function he(e){return e.declaredClass==="esri.layers.support.LabelClass"}function ge(e){return e.declaredClass==="esri.PopupTemplate"}function h(e,r){if(!e)return!1;if(typeof e=="string")return r(e);const t=e;if(ye(t)){if(t.type==="dot-density"){const a=t.attributes?.some(i=>r(i.valueExpression));if(a)return a}const n=t.visualVariables,s=!!n&&n.some(a=>{let i=r(a.valueExpression);return a.type==="size"&&(w(a.minSize)&&(i=i||r(a.minSize.valueExpression)),w(a.maxSize)&&(i=i||r(a.maxSize.valueExpression))),i});return!(!("valueExpression"in t)||!r(t.valueExpression))||s}if(he(t)){const n=t.labelExpressionInfo?.expression;return!(!n||!r(n))||!1}return!!ge(t)&&(!!t.expressionInfos&&t.expressionInfos.some(n=>r(n.expression))||Array.isArray(t.content)&&t.content.some(n=>n.type==="expression"&&r(n.expressionInfo?.expression)))}function ve(e){const r=p(e);return!!r&&k(r)}function Vt(e){return h(e,ve)}function xe(e){const r=p(e);return!!r&&J(r)}function kt(e){return h(e,xe)}function Jt(e){return h(e,r=>{const t=p(r);return!!t&&V(t)})}function w(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}export{f as Dictionary,T as Pixel,yt as Voxel,Ot as arcade,d as arcadeFeature,Pt as convertFeatureLayerToFeatureSet,Dt as convertJsonToArcade,Ct as convertMapToFeatureSetCollection,It as convertServiceUrlToWorkspace,vt as createExecContext,xt as createFeature,gt as createFunction,p as createSyntaxTree,Tt as dependsOnView,Lt as enableFeatureSetOperations,Mt as enableGeometryOperations,_t as evalSyntaxTree,Ft as executeAsyncFunction,bt as executeFunction,St as extractFieldNames,ht as getArcadeType,$t as getViewInfo,Vt as hasGeometryFunctions,kt as hasGeometryOperations,At as hasVariable,Et as loadScriptDependencies,Jt as requiresTrack,wt as updateExecContext};
