const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-CIQv1nLi.js","assets/Point-62ir3Nzl.js","assets/jsonMap-Bs3hmeCU.js","assets/reader-DcGs6kKN.js","assets/index-CB_zX-aI.js","assets/index-DJhoxO8W.css","assets/Point2D-CMz7woHH.js","assets/Envelope2D-mFnl8dXR.js","assets/ProjectionTransformation-PJc9H7Gq.js","assets/Transformation2D-CrydmBdC.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/Extent-Cs-ESnE1.js","assets/Polyline-CUSonZ4c.js","assets/Polygon-BbQMC1ht.js","assets/aaBoundingRect-DfeeUq5j.js","assets/mathUtils-PIGhLnI9.js","assets/jsonConverter-BXIkXJ1n.js","assets/apiConverter-BP3G-060.js"])))=>i.map(i=>d[i]);
import{s as ot,d as L,a1 as Ie,ba as rt,aI as nt,bH as at,g as lt,_ as a,m as u,a as D,l as Z,b9 as ut,Y as O,ak as ne,aC as Oe,o as pt,ac as ct,u as oe,V as ee,bO as Ge,f as ht,n as mt,ag as ce,ad as dt}from"./jsonMap-Bs3hmeCU.js";import{e as yt}from"./AnalysisView3D-zhHEgrUR.js";import{l as P,U as le,w as x,a as ft}from"./reactiveUtils-SO2Ko3sy.js";import{af as ue,F as Q,f as Te,Q as W,a8 as vt,b as gt,a5 as _t,bp as wt,bq as bt}from"./Point-62ir3Nzl.js";import{I as Pt,o as $t}from"./vec32-zHQcyKRA.js";import{f as St,n as be,O as Me}from"./collectionUtils-CB98pReO.js";import{b as Et,S as Dt}from"./sphere-DGD4QNOm.js";import{r as Le}from"./ElevationQuery-C16QuML_.js";import{bd as Rt,be as xt,f as ze,bf as kt,a8 as Pe,bg as Ct}from"./ShadowCastClear.glsl-BGPoo-07.js";import{u as Vt}from"./Texture-CAvBvljT.js";import{f as It}from"./intersectorUtilsConversions-Cv_V2i_M.js";import{h as Ot,t as $e,u as Gt,U as qe,c as Tt}from"./elevationInfoUtils-OU8rgnDX.js";import{P as Mt,o as Ae}from"./mathUtils-PIGhLnI9.js";import{y as ye,m as Lt}from"./Polyline-CUSonZ4c.js";import{aj as zt,ak as qt,ay as At}from"./Polygon-BbQMC1ht.js";import{_ as Ut}from"./index-CB_zX-aI.js";import{N as Se,W as me,X as Ht}from"./projectionUtils-ClsoIho7.js";import{R as Zt,M as Ft,b as Nt,j as Ue}from"./euclideanLengthMeasurementUtils-Cd4JOoc8.js";import{_ as jt}from"./floatRGBA-D95YiFWR.js";import{f as Wt}from"./Scheduler-CNrsbccs.js";import{b as Qt}from"./settings-CBe1rIVY.js";import{R as He}from"./OutlineVisualElement-DGuo8XYr.js";import{u as fe}from"./Color-CERqXxxY.js";import{l as Ze}from"./throttle-D_a5zHdu.js";import{r as Bt,u as Yt}from"./vec4f64-DPb6J-GU.js";import{j as Xt}from"./createUtils-BfFtfNYM.js";import{d as Fe}from"./asyncUtils-w6KfWU41.js";import{e as Jt}from"./LRUCache-fy84PBMi.js";import{e as Kt}from"./getDefaultUnitForView-BfT_njB8.js";import{c as ve}from"./ElevationInfo-DqQyVbKu.js";import{o as ei}from"./Map-DoBsBAGU.js";import{_ as ti}from"./Graphic-CkB18CDi.js";import{h as ii}from"./UpdatingHandles-D2RI_3Hb.js";import si from"./GraphicsLayer-BzsoYYl-.js";import{n as oi}from"./typeUtils-D0MaDvT3.js";import{m as ri}from"./SimpleMarkerSymbol-BGAFRS9_.js";import{s as ni,d as ai}from"./SketchViewModel-MZH8bHBQ.js";import"./reader-DcGs6kKN.js";import"./Extent-Cs-ESnE1.js";import"./SimpleObservable-CvFyr0NA.js";import"./mat4-Bjnccznk.js";import"./vector-knXISDaK.js";import"./mat4f64-q_b6UJoq.js";import"./quatf64-CCm9z-pX.js";import"./vec2f64-rIxtbMRN.js";import"./aaBoundingRect-DfeeUq5j.js";import"./TileKey-zev9cGPe.js";import"./jsonUtils-alsySR4T.js";import"./typeUtils-BR_JAZOz.js";import"./modeUtils-BF30GgRz.js";import"./intl-BIQN36K8.js";import"./date-IqUzANpt.js";import"./uuid-Oe6SV2kF.js";import"./sanitizerUtils-BT_8V5US.js";import"./screenUtils-BitdhK1O.js";import"./lengthUtils-Cm-zragw.js";import"./workers-VgzaPqUK.js";import"./Queue-CYlrXMwB.js";import"./PooledRBush-Dco5QkUp.js";import"./quickselect-QQC62dOK.js";import"./GraphicsCollection-mGxi3VN1.js";import"./HeightModelInfo-CNRqlD7K.js";import"./spatialReferenceEllipsoidUtils-BGTSZp-L.js";import"./projectPointToVector-B1tbWJiK.js";import"./RealisticTree.glsl-DAhEIR1w.js";import"./BufferView-CdBDKeBv.js";import"./vec42-fTNpW1Xv.js";import"./Emissions.glsl-B8XKMjLy.js";import"./InterleavedLayout-KZk0acs8.js";import"./types-BKo2foNY.js";import"./enums-B4pqBiXb.js";import"./VertexElementDescriptor-BlxU8vCE.js";import"./aaBoundingBox-DO0Hqciy.js";import"./DoubleArray-DExKNiTh.js";import"./meshVertexSpaceUtils-BZiL5Bbc.js";import"./MeshLocalVertexSpace-De2t7DNQ.js";import"./projectVectorToVector-CDqzCeaL.js";import"./vec3f32-WCVSSNPR.js";import"./Indices-D0_UQPPr.js";import"./plane-CAH7O3r1.js";import"./orientedBoundingBox-CbUQAgG7.js";import"./quat-CCdR5JrD.js";import"./computeTranslationToOriginAndRotation-CTVG2hGD.js";import"./memoryEstimations-Bd726a_p.js";import"./HUDIntersectorResult-Ds4yeNc-.js";import"./Intersector-BFu7YAUe.js";import"./frustum-Cq95H2HO.js";import"./scaleUtils-m8EJvm5m.js";import"./layerUtils-4EQ207Ij.js";import"./Layer-BLV7fz0K.js";import"./TilemapCache-DrtAz5a3.js";import"./tagSymbols-BPcGfZon.js";import"./signal-BX9ezF8a.js";import"./CollectionFlattener-C1ewYzfL.js";import"./timeZoneUtils-BSc7-7qA.js";import"./ReactiveMap-B0by2bYu.js";import"./Query-98igen-k.js";import"./Field-Cm_ZejYW.js";import"./fieldType-DVUzXtk_.js";import"./TablesMixin-MGFFfhKn.js";import"./normalizeUtils-BTK6arYa.js";import"./Cyclical-BLSxUpe7.js";import"./normalizeUtilsCommon-BRJdiLvx.js";import"./utils-uBZTDKaj.js";import"./utils-tSEVTzcz.js";import"./TileInfo-fM6eYiPH.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x.js";import"./opacityUtils-DuFH0EC9.js";import"./constants-D67WmGms.js";import"./PolygonSymbol3D-Dla3O-pf.js";import"./lineMarkers-CDwLe3J6.js";import"./Font-BYMGzku7.js";import"./layerViewUtils-BTa15X3o.js";import"./unitConversionUtils-BSQ4LGUO.js";import"./vec2f32-CaVKkSa6.js";import"./dehydratedFeatures-BBoTEZJ8.js";import"./quantizationUtils-BSWXSK29.js";import"./featureConversionUtils-DlTGrdYn.js";import"./OptimizedFeature-CwRGZPwv.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./createFeatureId-CVwTD0fV.js";import"./Octree-vaE3elxD.js";import"./DefaultLoadingContext-BnNmzeR1.js";import"./wosrLoader-B8RYB0d4.js";import"./Version-BtYZEj58.js";import"./axisAngleDegrees-D1LL0HZb.js";import"./edgePreprocessing-CBVaMT5L.js";import"./TileKey-C44YQC4_.js";import"./config-Dg972SSE.js";import"./GeometryUtils-BUMmi0hw.js";import"./definitions-Dvg4hMIw.js";import"./WorkerHandle-IsvMxqHu.js";import"./colorUtils-CfxFVJbg.js";import"./vec3-B_phcnZY.js";import"./vec33-CWJeyzxV.js";import"./capabilities-Bi6C4OG6.js";import"./imageUtils-DRSdxeif.js";import"./videoUtils-Dwx3AEgj.js";import"./utils-DTE-xBiC.js";import"./geometry2dUtils-D-hxoYKh.js";import"./geodeticLengthOperator-CC2ukcsv.js";import"./geodeticCurveType-CirnHLSB.js";import"./labelUtils-BtizwBfq.js";import"./ArcadeExpression-BKKJxDUn.js";import"./TimeOnly-DbBUn0Ig.js";import"./enum-BzLwmiID.js";import"./UnknownTimeZone-B697BDFv.js";import"./FieldsIndex-DoTtx8Ak.js";import"./lineStippleUtils-CCavR4OV.js";import"./EngineVisualElement-DBP6v2o3.js";import"./VisualElement-By4iq8p4.js";import"./LaserlinePath.glsl-B_28jNcs.js";import"./line-DzJxYxSt.js";import"./line-Dcl4F6AZ.js";import"./triangulationUtils-DA80_6V0.js";import"./earcut-D9gy186-.js";import"./deduplicate-Lzwo1kX7.js";import"./distanceOperator-jqSOkiaB.js";import"./Point2D-CMz7woHH.js";import"./Distance2DCalculator-CXhBP-8I-BMMI87Nn.js";import"./ProjectionTransformation-PJc9H7Gq.js";import"./Envelope2D-mFnl8dXR.js";import"./Transformation2D-CrydmBdC.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-BP3G-060.js";import"./jsonConverter-BXIkXJ1n.js";import"./simplifyOperator-GU91fZE2.js";import"./operatorSimplify-5A_MmN4K.js";import"./mat2d-CHHYfmUW.js";import"./mat2df64-DFLy2zOC.js";import"./Basemap-BI8rdNrf.js";import"./loadAll-CleWBL8j.js";import"./PortalItem-QIiqvhel.js";import"./writeUtils-D0J7VXri.js";import"./persistable-AW3PLevT.js";import"./MD5-MtSiOt06.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw.js";import"./resourceExtension-3aprB2zB.js";import"./PolygonCollection-BQYUC051.js";import"./mat4f32-Djp3mnm5.js";import"./getPopupProvider-mckaq9Ri.js";import"./BlendLayer-CEHruVkx.js";import"./layerContainerType-CSXZNpHb.js";import"./jsonUtils-Bref6UUL.js";import"./ScaleRangeLayer-DQr2T3Hh.js";import"./SimpleFillSymbol-CDawtd9z.js";import"./PictureMarkerSymbol-CjQJkY_m.js";import"./TextSymbol-Ck-WHI2u.js";import"./SketchOptions-Dguq2sp8.js";import"./automaticAreaMeasurementUtils-DTAbpcBX.js";import"./geodesicAreaMeasurementUtils-D05-2vvY.js";import"./automaticLengthMeasurementUtils-CwXO_zBR.js";function E(t,e){let i,s=!1;function o(...n){const r=t.apply(this,n);return s&&i!==void 0&&e?.(i,r)?i:(s=!0,i=r,r)}return o}function Ne(t){return t?.map?.allLayers?.toArray().filter(e=>(e.type!=="graphics"||!e.internal)&&e.visible).map(e=>e.uid)??[]}let je={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:je.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:ue(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function H(){return je}const li={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};let ie=class extends ot{constructor(e,i,s){super(e,i,s),this.name="unknown",this.name=e}},ae=class extends ie{constructor(){super("too-complex","The input geometry has too many points.")}},We=class extends ie{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class ui extends ie{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let pi=class extends ie{constructor(){super("unknown","Unknown error.")}};async function ci(t,e,i,s,o,n,r){let l,p,c;const h=t.spatialReference,m=h.isGeographic||h.isWebMercator;let d=0;if(!m){const{execute:v}=await Ut(()=>import("./lengthOperator-CIQv1nLi.js").then(_=>_.l),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]));L(r),d=v(t,{unit:"meters"}),L(r)}const y=1/Q(s);if(m){await Se([{source:h,dest:s},{source:h,dest:Te.WGS84}],r);const v=Ei(t);l=Zt([v],"meters")[0];const _=Ee(l,o);if(xe(t,l,_)>n)throw new ae;const f=De(v,e,i);({densifiedPath:p,distances:c}=gi(f,_,y)),p=me(p,s)}else{await Se([{source:h,dest:s}],r),l=d;const v=Ee(l,o);if(xe(t,l,v)>n)throw new ae;const _=De(t,e,i);({densifiedPath:p,distances:c}=vi(_,v,y)),L(r),p=me(p,s)}return{densifiedPath:p,pathLength:l*y,distances:c}}function Ee(t,e){const i=t/e.densificationMaxSamples;return Math.max(e.samplingDistance,i)}function De(t,e,i){if(e==null)return Re(t);const s=t.spatialReference,o=e.mode,n=Ot(e,s);let r=null;switch(i.type){case"2d":r=hi(t,o,n);break;case"3d":r=mi(t,o,n,i)}return r==null?Re(t):new ye({hasZ:!0,hasM:!1,spatialReference:s,paths:Qe(t.paths,r)})}function hi({hasZ:t},e,i){return e==="absolute-height"?t?([s,o,n])=>[s,o,n+i]:([s,o])=>[s,o,i]:null}function mi({spatialReference:t,hasZ:e},i,s,{elevationProvider:o}){const n=(r,l,p,c)=>o?.getElevation(r,l,p,t,c)??0;switch(i){case"on-the-ground":return([r,l])=>[r,l,n(r,l,0,"ground")];case"absolute-height":return e?([r,l,p])=>[r,l,p+s]:([r,l])=>[r,l,s];case"relative-to-ground":return e?([r,l,p])=>[r,l,p+n(r,l,p,"ground")+s]:([r,l])=>[r,l,n(r,l,0,"ground")+s];case"relative-to-scene":return e?([r,l,p])=>[r,l,p+n(r,l,p,"scene")+s]:([r,l])=>[r,l,n(r,l,0,"scene")+s];default:return null}}function Re(t){return t.hasZ?new ye({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:Qe(t.paths,([e,i])=>[e,i])}):t}function Qe(t,e){const i=t.length,s=new Array(i);for(let o=0;o<i;++o){const n=t[o],r=n.length,l=new Array(n.length);s[o]=l;for(let p=0;p<r;++p)l[p]=e(n[p])}return s}function Be(t){return ge(t)&&t.paths.some(e=>e.length>1)}function di(t){return yi(t)&&Be(t.geometry)}function yi(t){return Ye(t)&&ge(t?.geometry)}function ge(t){return!Ye(t)&&t!=null&&t.type==="polyline"}function Ye(t){return t!=null&&"geometry"in t}function fi(t){const e=t?.layer;return e!=null&&e.type==="graphics"&&e.internal}function Xe(t,e,i,s,o){const{spatialReference:n,hasZ:r}=t,l={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:n,metersPerSR:Q(n)},p=[],c=[];let h=0;for(let m=0;m<t.paths.length;++m){const d=t.paths[m],y=new Array,v=new Array;let _=0;for(let f=1;f<d.length;++f){const w=d[f-1],R=d[f],S=s(l,w,R);let k;for(k=_;k<S.distance&&!Mt(k,S.distance);k+=e)y.push(o(S,k)),v.push((h+k)*i);_=k-S.distance,h+=S.distance,y.push(R),v.push(h*i)}p[m]=y,c[m]=v}return{densifiedPath:new ye({spatialReference:n,hasZ:r,paths:p}),distances:c}}function vi(t,e,i){const{hasZ:s}=t;return Xe(t,e,i,wi,s?Si:$i)}function gi(t,e,i){const{hasZ:s}=t;return Xe(t,e,i,_i,s?Pi:bi)}function _i(t,e,i){return t.distance=0,Nt(t,e,i,t.spatialReference),t.from=e,t.to=i,t}function wi(t,e,i){return t.from=e,t.to=i,t.distance=zt(i,e)*t.metersPerSR,t}function bi({from:t,azimuth:e,spatialReference:i},s){return Ue([0,0],t,e,s,i)}function Pi({from:t,to:e,azimuth:i,distance:s,spatialReference:o},n){const r=n/s,l=[0,0,Ae(t[2],e[2],r)];return Ue(l,t,i,n,o),l}function $i({from:t,to:e,distance:i},s){return qt([0,0],t,e,s/i)}function Si({from:t,to:e,distance:i},s){return Pt([0,0,0],t,e,s/i)}function Ei(t){return Ft(t.spatialReference)?t:me(t,Te.WGS84)}function Je(t){return t.paths.reduce((e,i)=>e+i.length,0)}function xe(t,e,i){return Je(t)+Math.floor(e/i)+Math.max(0,t.paths.reduce(s=>1+s,0)-1)}function Di(t,e){const i=t.length;if(i===0)return null;const s=t[0],o=s.sampledZ;let n=o,r=o,l=0,p=0,c=null,h=null,m=o??0,d=0,y=0,v=o!=null?1:0,_=0,f=0;const w=Q(e),R=W(e),S=H().minSlopeSampleDistance/w,k=2*S,z=new ke,G=new ke,pe=()=>{st(),z.copy(G),G.reset()},we=(C,J)=>{pe(),C>0&&C-z.start<=k&&(C=z.start+S),G.restart(C,J)},st=()=>{if(z.isHole||G.isHole)return;const C=G.avgElevation-z.avgElevation,J=G.start-z.start,K=C*R,q=J*w,A=ue(Math.atan2(K,q),"radians","degrees");A>0?(d+=A,c=U(c,A),_++):A<0&&(y-=A,h=U(h,-A),f++)};s.sampledZ!=null&&we(s.distance,s.sampledZ);for(let C=1;C<i;++C){const J=t[C-1],K=t[C],q=K.sampledZ;if(q==null){G.isHole||pe();continue}v++,m+=q,n=_e(n,q),r=U(r,q),G.isHole||K.distance-G.start>=S?we(K.distance,q):G.insert(q);const A=J.sampledZ;if(A!=null){const se=q-A;se>0?l+=se:se<0&&(p-=se)}}return pe(),v===0?null:{maxDistance:t[i-1].distance,minElevation:n,maxElevation:r,avgElevation:v===0?null:m/v,elevationGain:l,elevationLoss:p,maxPositiveSlope:c,maxNegativeSlope:h,avgPositiveSlope:_===0?null:d/_,avgNegativeSlope:f===0?null:y/f}}function Ri(t){const e=t.filter(Ie),i=e.length;if(i===0)return null;const s=e[0];if(i===1)return s;let o=s.maxDistance,n=s.minElevation,r=s.maxElevation,l=s.maxPositiveSlope,p=s.maxNegativeSlope;for(let c=1;c<e.length;++c){const h=e[c];o=U(o,h.maxDistance),n=_e(n,h.minElevation),r=U(r,h.maxElevation),l=U(l,h.maxPositiveSlope),p=U(p,h.maxNegativeSlope)}return{maxDistance:o,minElevation:n,maxElevation:r,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:p,avgPositiveSlope:null,avgNegativeSlope:null}}function xi(t){let e=null,i=null,s=null;for(const o of t){if(o==null)continue;const{statistics:n,spatialReference:r}=o;if(n==null)continue;const l=Q(r);e=U(e,he(n.maxDistance,l));const p=W(r);s=_e(s,he(n.minElevation,p)),i=U(i,he(n.maxElevation,p))}return{minDistance:0,maxDistance:e??0,minElevation:s??0,maxElevation:i??0}}function _e(t,e){return e==null?t:t!=null?Math.min(t,e):e}function U(t,e){return e==null?t:t!=null?Math.max(t,e):e}function he(t,e){return t!=null&&e!=null?t*e:null}let ke=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,i){this._start=e,this._sampleCount=1,this._totalElevation=i}insert(e){++this._sampleCount,this._totalElevation+=e}};function ki(t,e,i=[]){if(t>=e||(i.push(t),e-t<2))return i;const s=e-1;i.push(s);const o=de(t+1,s);for(;;){const n=o.next();if(n.done)break;i.push(n.value)}return i}function*de(t,e){if(t>=e)return;const i=t+Math.floor((e-t)/2);yield i;const s=de(t,i),o=de(i+1,e);for(;;){const n=s.next(),r=o.next();if(n.done&&r.done)break;n.done||(yield n.value),r.done||(yield r.value)}}async function*Ci(t,e){const{view:i,geometry:s,elevationInfo:o,providers:n,options:r}=t,l=i.spatialReference;if(!l||s==null||!Be(s))throw new We;const p=n.length;if(p===0)return null;const c=Math.round(r.maxTotalSamples/p);if(Je(s)>c)throw new ae;const h=await ci(s,o,i,l,r,c,e);L(e);let m=0;const d=new Array(p),y=new Array(p);for(let f=0;f<p;f++){const w=Mi(h);d[f]=w,m+=w.samples.length;const R={...t,provider:n[f],result:w,densificationResult:h};y[f]=Vi(R,e)[Symbol.iterator]()}if(m>r.maxTotalSamples)throw new ae;const v=await Promise.all(y.map(f=>{const w=f.next();return w.done===!0?Promise.resolve(null):w.value}));L(e);for(let f=0;f<p;f++)d[f]=v[f];yield d,await nt(t.delayAfterPreview??H().delayAfterPreviewMillis,null,e.signal),L(e);const _=[];try{let f;do{f=!1;for(let w=0;w<p;w++){const R=y[w].next();R.done===!1&&(_.push({resultPromise:R.value,index:w}),f=!0)}}while(f)}finally{y.forEach(f=>f.return?.())}for(const{resultPromise:f,index:w}of _)d[w]=await f,L(e),yield d;for(const f of d)f!=null&&(f.progress=1);yield d}function*Vi(t,e){const{densificationResult:i}=t,s={...t,abortOptions:e,densificationResult:i},o=ki(0,s.result.samples.length),n=o.slice(0,s.provider.numSamplesForPreview);yield Ce(s,n,!0);const r=at(o,s.provider.numSamplesPerChunk);for(const l of r)yield Ce(s,l,!1)}async function Ce({densificationResult:t,result:e,provider:i,queue:s,abortOptions:o,cache:n},r,l){const{densifiedPath:p,pathLength:c}=t,h=e.spatialReference,{samples:m}=e,d=[];for(let y=0;y<r.length;y++){const v=m[r[y]];d[y]=[...v.coordinate]}try{return await s.push({geometry:new Lt({spatialReference:h,points:d,hasZ:p.hasZ}),provider:i,indices:r,preview:l,result:e,parameters:{...H().defaultQueryOptions(),minDemResolution:Math.round(l?c/i.numSamplesForPreview:c/m.length),cache:n}},o),{...e}}catch(y){return lt(y)?null:li}}function Ii(t){return new jt({priority:Wt.ELEVATION_PROFILE,concurrency:1,scheduler:t,process:async e=>{L(e.parameters);try{await Oi(e)}catch(i){rt(i)}}})}async function Oi({geometry:t,provider:e,indices:i,preview:s,result:o,parameters:n}){if(i.length===0)return;const r=(await qi(e,t,n)).geometry,{hasZ:l,points:p}=r,c=n.noDataValue,{samples:h}=o;for(let m=0;m<i.length;m++){const d=h[i[m]];if(d.isHole)continue;const y=l?p[m][2]:null;y===null||y===c?d.sampledZ=null:(o.hasZ=!0,d.sampledZ=y),d.sampled=!0}Gi(h),o.progress=s?0:o.progress+i.length/h.length,o.statistics=Di(o.samples,o.spatialReference)}function Gi(t){const e=t.length-1;let i=0;for(let s=1;s<=e;s++)(t[s].sampled||s===e)&&(Ti(t,i,s),i=s)}function Ti(t,e,i){if(i-e===1)return;const s=t[e],o=s.sampledZ,n=t[i],r=n.sampledZ;if(o==null||r==null){for(let c=e+1;c<i;c++)t[c].sampledZ=null;return}const l=s.distance,p=n.distance-l;for(let c=e+1;c<i;c++){const h=t[c],m=(h.distance-l)/p;h.sampledZ=Ae(o,r,m)}}function Mi({densifiedPath:t,distances:e}){const i=t.spatialReference,s=vt(i),o=t.paths,n=o.length,r=[];let l=null,p=0;for(let c=0;c<n;c++){const h=o[c],m=h.length,d=e[c];for(let y=0;y<m;y++){const v=h[y],_=d[y];s&&(v[0]=At(v[0],s.valid[0],s.valid[1])),l&&y===0&&Li(r,l,v,p,_),r.push(zi(v,_)),l=v,p=_}}return{progress:0,samples:r,hasZ:!1,statistics:null,spatialReference:i}}function Li(t,e,i,s,o){t.push(Ve(e,s)),t.push(Ve(i,o))}function zi(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!1,isHole:!1}}function Ve(t,e){return{coordinate:t,distance:e,sampledZ:null,sampled:!0,isHole:!0}}async function qi(t,e,i){try{return await t.queryElevation(e,i)}catch{throw new ui}}function Ai(t,e,i){if(!t||t.length===0)return;const s=t.length-1,o=t[0];if(e<=i(o))return o;const n=t[s];if(e>=i(n))return n;let r=0,l=0,p=s;for(;r<p;){l=r+Math.floor((p-r)/2);const c=t[l],h=i(c);if(h===e)return c;if(e<h){if(l>0){const m=t[l-1],d=i(m);if(e>d)return e-d>=h-e?c:m}p=l}else{if(l<s){const m=t[l+1],d=i(m);if(e<d)return e-h>=d-e?m:c}r=l+1}}return t[l]}function Ke(t){return t>.999999?1:t}function Ui(t,e){if(t==null||e==null)return null;const{samples:i,spatialReference:s}=t,{distance:o,elevation:n}=e,r=Q(s),l=W(s),p=i.length,c=new Array(p);for(let h=0;h<p;++h){const m=i[h],d=m.sampledZ,y=m.coordinate;c[h]={x:y[0],y:y[1],z:d,distance:et(m.distance,r,o),elevation:B(d,l,n)}}return c}function Hi(t,e){if(t==null||e==null||t.statistics==null||t.spatialReference==null)return null;const{distance:i,elevation:s}=e,{statistics:o,spatialReference:n}=t,r=Q(n),l=W(n);return{maxDistance:et(o.maxDistance,r,i),minElevation:B(o.minElevation,l,s),maxElevation:B(o.maxElevation,l,s),avgElevation:B(o.avgElevation,l,s),elevationGain:B(o.elevationGain,l,s),elevationLoss:B(o.elevationLoss,l,s),maxPositiveSlope:o.maxPositiveSlope,maxNegativeSlope:o.maxNegativeSlope,avgPositiveSlope:o.avgPositiveSlope,avgNegativeSlope:o.avgNegativeSlope}}function et(t,e,i){return t==null?null:ue(t*e,"meters",i)}function B(t,e,i){return t==null?null:ue(t*e,"meters",i)}let V=class extends St{constructor(e){super(e),this._getSamplesMemoized=$e((i,s)=>Ui(i,s)),this._getStatisticsMemoized=$e((i,s)=>Hi(i,s)),this.rawResult=null}get available(){const{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Ke(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;const{rawResult:i,samples:s}=this;if(s==null||i==null)return null;const o=s.length;if(o===0)return null;const n=s[o-1].distance,r=Ai(s,e*n,h=>h.distance);if(r==null)return null;const{x:l,y:p,z:c}=r;return c==null?null:new gt({x:l,y:p,z:c,spatialReference:i.spatialReference})}};a([u()],V.prototype,"available",null),a([u({readOnly:!0})],V.prototype,"profile",null),a([u({readOnly:!0})],V.prototype,"progress",null),a([u()],V.prototype,"samples",null),a([u()],V.prototype,"statistics",null),a([u({constructOnly:!0})],V.prototype,"computation",void 0),a([u()],V.prototype,"rawResult",void 0),a([u()],V.prototype,"hoveredPoint",null),V=a([D("esri.views.analysis.ElevationProfile.ElevationProfileResult")],V);let $=class extends Z{constructor(t){super(t),this.result=new V({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([P(()=>{const{geometry:t,elevationInfo:e}=this.controller.analysis;return[t,e]},()=>this.onInvalidate(this),le)])}setResult(t){this.result.rawResult=t}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return H().defaultDemResolution}};a([u({constructOnly:!0})],$.prototype,"controller",void 0),a([u({constructOnly:!0})],$.prototype,"profile",void 0),a([u({constructOnly:!0})],$.prototype,"onInvalidate",void 0),a([u()],$.prototype,"result",void 0),a([u({readOnly:!0})],$.prototype,"progress",null),a([u()],$.prototype,"hoveredPoint",null),a([u()],$.prototype,"available",null),a([u()],$.prototype,"numSamplesForPreview",void 0),a([u()],$.prototype,"numSamplesPerChunk",void 0),a([u({readOnly:!0})],$.prototype,"minDemResolution",null),$=a([D("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],$);const Zi=2e5;let T=class extends ${constructor(){super(...arguments),this.type="scene",this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getStableElevationDependencies=E(()=>{const e=this._view;return e?{view:e,stationary:e.stationary,geometry:this.controller?.analysis.geometry,visibleLayerIds:this._getStableLayerIds(),maxIntersectionDistance:this._maxIntersectionDistance,intersectOptions:this._intersectOptions,spatialReference:this._getStableSpatialReference()}:null},O),this._getStableSpatialReference=E(()=>this._view?.spatialReference,ne),this._getStableLayerIds=E(()=>Ne(this._view),O),this._getStablePointCloudLayers=E(()=>{const e=this._view;return e?e.allLayerViews.toArray().filter(i=>i.layer?.type==="point-cloud").map(i=>i.layer):[]},O),this._vecA=be(),this._vecB=be(),this._ray=Et()}get minDemResolution(){const e=this._view;if(!e)return null;const i=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return i==null?null:i*W(e.spatialReference)}initialize(){const e=()=>this.onInvalidate(this);return this.addHandles([P(()=>this._queryElevationDependencies,e,le),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:i,signal:s}){const o=this._queryElevationDependencies;if(o==null)throw new Error(`${this.declaredClass}: no dependencies`);const n=this._intersector;if(n==null)throw new Error(`${this.declaredClass}: no view`);const{intersectOptions:r,view:l,spatialReference:p}=o,c=l.renderCoordsHelper,h=l.sceneIntersectionHelper,m=this._vecA,d=this._vecA,y=this._vecB,v=this._ray;if(!p)return{geometry:e,noDataValue:i};const _=await Le.fromGeometry(e).project(p,s);if(!_)return{geometry:e,noDataValue:i};const f=_.coordinates,w=f.length;for(let R=0;R<w;++R){const S=f[R];$t(y,S.x,S.y,S.z??0),c.toRenderCoords(y,p,y),c.setAltitude(m,Zi,y);const k=Dt(m,y,v);h.computeIntersection(k,n,!0,r);const z=Fi(o,n.results.all);z?(z.getIntersectionPoint(d),c.fromRenderCoords(d,d,p),S.z=d[2]):S.z=i}return{geometry:_.export(),noDataValue:i}}get _queryElevationDependencies(){return this._getStableElevationDependencies()}get _intersectOptions(){const e=this._view;if(!e||e.destroyed)return{};const{include:i,exclude:s}=this.profile;return Rt(e,{include:i,exclude:[...this._pointCloudLayers,...ut(s)?s:s?[s]:[]]})}get _pointCloudLayers(){return this._getStablePointCloudLayers()}get _view(){const e=this.controller.view;return e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?_t(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(!e)return null;const i=new Vt(e.state.viewingMode),s=i.options;return s.hud=!1,s.invisibleTerrain=!1,s.backfacesTerrain=!1,s.selectionMode=!1,s.store=2,i}};function Fi({intersectOptions:t,maxIntersectionDistance:e,view:i},s){const o=t.graphics,n=!(!o?.include&&!o?.exclude);for(const r of s)if(r.withinDistance(e)){if(n){const l=It(r,i);if(l!=null&&!xt(o,l))continue}return r}return null}a([u({readOnly:!0})],T.prototype,"minDemResolution",null),a([u()],T.prototype,"_queryElevationDependencies",null),a([u()],T.prototype,"_intersectOptions",null),a([u()],T.prototype,"_pointCloudLayers",null),a([u()],T.prototype,"_view",null),a([u()],T.prototype,"_maxIntersectionDistance",null),a([u()],T.prototype,"_intersector",null),T=a([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineSceneComputation")],T);function Ni(t){return Oe([P(()=>{const{analysis:e,sketchGraphic:i,toolState:s,visible:o}=t.analysisViewData,{geometryVisualizationVisible:n}=e.viewOptions;return{geometryVisualizationVisible:n,geometry:e.geometry,sketchGraphic:i,toolState:s,visible:o}},({geometryVisualizationVisible:e,sketchGraphic:i,toolState:s,visible:o})=>{if(t.remove(),o)return e&&i!=null&&s!=="reshaping"&&s!=="sketching"?t.show(i):void 0},x)])}let Y=class extends Z{constructor(e){super(e),this._visualElementHandle=null}initialize(){this._settings=new Qt({getTheme:()=>this.view.effectiveTheme}),this.addHandles(Ni({analysisViewData:this.analysisViewData,remove:()=>this._remove(),show:e=>this._show(e)}))}destroy(){this._remove()}get updating(){return!1}_remove(){this._visualElementHandle=pt(this._visualElementHandle)}_show(e){this._remove();const{view:i}=this,s=new He({view:i,geometry:this.analysisViewData.analysis.geometry,attached:!1,renderOccluded:8,isDecoration:!0}),o=[P(()=>this.analysisViewData.analysis.elevationInfo,n=>{s.elevationInfo=n,s.isDraped=Gt(!0,n)==="on-the-ground"},x),P(()=>this.analysisViewData.analysis.geometry,n=>{s.geometry=n}),i.maskOccludee(e),ct(s)];this._settings.visualElements.lineObjects.outline.apply(s),s.attached=!0,this._visualElementHandle=Oe(o)}};a([u({constructOnly:!0})],Y.prototype,"view",void 0),a([u({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),a([u()],Y.prototype,"updating",null),Y=a([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileGeometryVisualization3D")],Y);function ji(t,e){t??=[];const i=t.length-1,s=[];let o=[];for(let n=0;n<=i;n++){const{x:r,y:l,z:p}=t[n];p!=null&&o.push([r,l,p]),n!==i&&p!=null||!o.length||(s.push(o),o=[])}return Xt(s,e,!0)}let M=class extends Z{constructor(t){super(t),this._updateGeometryThrottled=Ze(e=>{if(!e)return;const{samples:i,spatialReference:s}=e,o=i!=null&&i.length>0;this._visualElement.geometry=o?ji(i,s):null},H().profileLinesUpdateThrottleMillis)}initialize(){this._visualElement=new He({view:this.view,elevationInfo:qe,innerWidth:0,innerColor:Bt(0,0,0,0),width:3,falloff:0,renderOccluded:16,isDecoration:!0}),this.addHandles([P(()=>({color:this._result?.computation.profile.color,visible:this._effectiveVisible}),({color:t,visible:e})=>{t&&(this._visualElement.color=Yt(fe.toUnitRGBA(t))),this._visualElement.visible=e},x),P(()=>this.analysisViewData.analysis.geometry,()=>{this._visualElement.geometry=null},x),P(()=>this._geometryUpdateParameters,t=>this._updateGeometryThrottled(t),x),this._updateGeometryThrottled])}destroy(){this._visualElement.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){const{analysisViewData:t,_result:e}=this;return t.visible&&e!=null&&e.available&&e.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){return this._effectiveVisible&&this.analysisViewData.progress!==1?null:{samples:this._result?.samples,spatialReference:this.view.spatialReference}}};a([u()],M.prototype,"view",void 0),a([u()],M.prototype,"analysisViewData",void 0),a([u()],M.prototype,"getResult",void 0),a([u()],M.prototype,"updating",null),a([u()],M.prototype,"_result",null),a([u()],M.prototype,"_effectiveVisible",null),a([u()],M.prototype,"_geometryUpdateParameters",null),M=a([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineVisualization3D")],M);let F=class extends Z{constructor(e){super(e),this.position=null,this.color=new fe("#ffffff"),this.element=Wi()}initialize(){this.addHandles([P(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},x),P(()=>this.color.toCss(),e=>{this.element.style.background=e},x)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:e,view:i}=this;i.type==="3d"?(i.commitProperty("size"),i.commitProperty("camera")):i.commitProperty("center");const s=i?.spatialReference,o=s?Ht(e,s).geometry:null;return o&&i?.ready?i.toScreen(o):null}};function Wi(){const t=document.createElement("div"),{size:e,borderStyle:i,borderColor:s,borderWidth:o,boxShadow:n}=H().hoveredPointsStyle,{style:r}=t;return r.display="block",r.position="absolute",r.top="0",r.left="0",r.contain="strict",r.boxSizing="border-box",r.width=`${e}px`,r.height=`${e}px`,r.marginTop=`-${e/2}px`,r.marginLeft=`-${e/2}px`,r.border=`${i} ${o}px ${s}`,r.borderRadius=`${e}px`,r.boxShadow=n,t}a([u()],F.prototype,"position",void 0),a([u({type:fe})],F.prototype,"color",void 0),a([u()],F.prototype,"view",void 0),a([u()],F.prototype,"_screenLocation",null),F=a([D("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],F);let N=class extends Z{constructor(e){super(e),this._hoveredPoints=new Me}initialize(){const{analysisViewData:e}=this,{analysis:i}=e;this.addHandles([P(()=>{const{hoveredPoints:s,visible:o,updating:n}=e;return o?n?null:s.map((r,l)=>{const p=i.profiles.at(l);return p?.viewOptions.hoveredPointVisible===!0&&r!=null?{hoveredPoint:r,color:p.color}:null}).filter(r=>!!r):[]},s=>this._update(s),x),P(()=>i.geometry,()=>this._update([]),x)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;const{view:i,_hoveredPoints:s}=this,o=e.length;for(;s.length>o;)s.pop()?.destroy();for(;s.length<o;){const n=new F({view:i});s.push(n)}for(let n=0;n<o;++n){const r=e[n],l=s.at(o-1-n);l.position=r.hoveredPoint,l.color=r.color}}};a([u()],N.prototype,"view",void 0),a([u()],N.prototype,"analysisViewData",void 0),a([u()],N.prototype,"_hoveredPoints",void 0),a([u()],N.prototype,"updating",null),N=a([D("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],N);let X=class extends Z{constructor(t){super(t)}initialize(){const{view:t,analysisViewData:e}=this;this._hoveredPointsVisualization=new N({view:t,analysisViewData:e}),this._geometryVisualization=new Y({view:t,analysisViewData:e}),this._lineVisualizations=ze(()=>this.analysisViewData.analysis.profiles,i=>new M({view:t,analysisViewData:e,getResult:()=>e.results.find(s=>s.computation.profile===i)}))}destroy(){this._geometryVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy()}get updating(){return this._geometryVisualization.updating||this._lineVisualizations.some(t=>t.updating)}};a([u()],X.prototype,"view",void 0),a([u()],X.prototype,"analysisViewData",void 0),a([u()],X.prototype,"updating",null),X=a([D("esri.views.3d.analysis.ElevationProfile.ElevationProfileVisualization3D")],X);let g=class extends Z{constructor(t){super(t),this.error=null,this._getStableEffectiveUnits=E(()=>{const e=xi(this._activeComputations.map(o=>o.result.rawResult)),i=this.analysis.displayUnits,s=Kt(this.view);return{distance:bt(e.maxDistance,"meters",i.distance??s),elevation:wt(e.maxElevation,"meters",i.elevation??s)}},O),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=E(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),O),this._getStableGenerationParameters=E(()=>{const{view:e,analysis:i}=this;return e?.ready&&this._queue?{view:e,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type==="3d"?e.slice.plane:null}:null},O),this._getStableElevationInfo=E(()=>this.analysis.elevationInfo??Qi,ne),this._getStableOptions=E(()=>{const{densificationMaxSamples:e,defaultDemResolution:i,maxTotalSamples:s}=H();let o=this._minDemResolution??i;return o=parseFloat(o.toFixed(2)),{samplingDistance:o,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:s}},O),this._updateThrottled=Ze(e=>this._update(e),H().updateThrottleMillis)}initialize(){this._computationsCollection=ze(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),P(()=>this._updateParameters,e=>this._updateThrottled(e),x),this._updateThrottled]);const t=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=Ii(t?.scheduler),t?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=oe(this._queue),this._currentTileCache=oe(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let t=0,e=0;for(const i of this._activeComputations)t++,e+=i.progress;return Ke(t>0?e/t:0)}get updating(){const{progress:t}=this,e=!!this._queue?.updating,i=this._updateThrottled.hasPendingUpdates(),s=this._updateTask!=null&&!this._updateTask.finished;return e||i||s||t>0&&t<1}get results(){return this._computations.map(t=>t.result)}get statistics(){return Ri(this._activeComputations.map(t=>t.result.statistics))}get hoveredPoints(){return this._computations.map(t=>t.hoveredPoint)}onElevationChange(t){const{view:e}=this;return e?.type==="3d"?ft(()=>e.elevationProvider,"elevation-change",t,{onListenerAdd:t,onListenerRemove:t}):ee()}get _tileCache(){this._currentTileCache=oe(this._currentTileCache);const t=this.view;if(t?.type==="3d"){const e=t.basemapTerrain?.elevationQueryCache;if(e!=null)return e}return this._currentTileCache==null&&(this._currentTileCache=new kt(new Jt(20971520))),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(t=>t.profile.enabled&&t.available)}get _minDemResolution(){const t=this._minDemResolutions;return t.length>0?Ge(t):null}get _minDemResolutions(){const t=[];for(const{minDemResolution:e}of this._activeComputations)e!=null&&t.push(e);return t}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:t,activeComputations:e,generationParameters:i}){this._abortUpdate(),t&&(i!=null?this._updateTask=Fe(async s=>{this.error=null;const o=e.filter(n=>!this._isComputationValid(n,i));try{if(!i.geometryIsValid)throw new We;const n=Ci({...i,providers:o},{signal:s});let r=!1;for await(const l of n){L(s),r||(this._clearInvalidResults(i),r=!0);for(let p=0;p<o.length;p++)o[p].setResult(l[p])}for(const l of o)this._parametersPerComputation.set(l,i)}catch(n){ht(n),this._abortUpdate(),this.error=n instanceof ie?n:new pi,o.forEach(r=>{r.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=mt(this._updateTask)}_isComputationValid(t,e){return this._parametersPerComputation.has(t)&&this._parametersPerComputation.get(t)===e}_invalidateComputation(t){this._parametersPerComputation.delete(t),this._updateThrottled(this._updateParameters)}_clearInvalidResults(t){for(const e of this._computations)this._isComputationValid(e,t)||(e.clearResult(),this._parametersPerComputation.delete(e))}_clearResults(){for(const t of this._computations)t.clearResult(),this._parametersPerComputation.delete(t)}};a([u({constructOnly:!0})],g.prototype,"analysis",void 0),a([u({constructOnly:!0})],g.prototype,"analysisViewData",void 0),a([u({constructOnly:!0})],g.prototype,"computationFactory",void 0),a([u({constructOnly:!0})],g.prototype,"view",void 0),a([u()],g.prototype,"error",void 0),a([u({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),a([u()],g.prototype,"progress",null),a([u()],g.prototype,"updating",null),a([u()],g.prototype,"results",null),a([u()],g.prototype,"statistics",null),a([u()],g.prototype,"hoveredPoints",null),a([u()],g.prototype,"_updateTask",void 0),a([u()],g.prototype,"_queue",void 0),a([u()],g.prototype,"_tileCache",null),a([u()],g.prototype,"_computationsCollection",void 0),a([u()],g.prototype,"_computations",null),a([u()],g.prototype,"_activeComputations",null),a([u({readOnly:!0})],g.prototype,"_minDemResolution",null),a([u()],g.prototype,"_minDemResolutions",null),a([u()],g.prototype,"_updateParameters",null),a([u()],g.prototype,"_generationParameters",null),a([u()],g.prototype,"elevationInfo",null),a([u()],g.prototype,"_options",null),g=a([D("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const Qi=new ve({...qe});function tt(t){if(t==null)return null;if(ei(t))return it(t);const e=t.tileInfo;if(e==null)return null;const i=e.lods?.at(-1);return i==null?null:i.resolution*Q(e.spatialReference)}function it(t){if(t==null)return null;const e=t.layers.items.map(Bi).filter(Ie);return Ge(e)??null}function Bi(t){return t&&"tileInfo"in t?tt(t):null}let j=class extends ${constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=E(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),O),this._getStableGroundLayers=E(()=>this._ground?.layers?.toArray(),O)}get minDemResolution(){return it(this._ground)}get available(){return this._ground?.layers.some(e=>e.visible)===!0}initialize(){this.addHandles([P(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,i){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:o}=s;if(o==null)throw new Error("No ground configured in the view");const n=await o.queryElevation(e,i),r=W(e.spatialReference),l=W(o.layers.at(0).spatialReference);if(r!==l){const p=n.geometry;p.points=p.points.map(([c,h,m])=>[c,h,m===i.noDataValue?m:m*l/r])}return n}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};a([u()],j.prototype,"minDemResolution",null),a([u()],j.prototype,"available",null),a([u()],j.prototype,"_queryElevationDependencies",null),a([u()],j.prototype,"_ground",null),j=a([D("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],j);let re=class extends ${constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=E(()=>{const{view:e}=this.controller;if(!e)return null;const i=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:i,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},O),this._getStableElevationInfo=E(()=>this.controller.elevationInfo,ne),this._getStableSpatialReference=E(()=>this.controller.view?.spatialReference,ne),this._getStableLayerIds=E(()=>{const{view:e}=this.controller;return e.type!=="3d"?[]:Ne(e)},O)}initialize(){const e=()=>this.onInvalidate(this);this.addHandles([P(()=>this._queryElevationDependencies,e,le),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:i,signal:s}){const o=this._queryElevationDependencies;if(o==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:n,spatialReference:r}=o;if(this._requiresElevationAlignment&&n.type==="3d"&&r){const l=await Le.fromGeometry(e).project(r,s);if(!l)return{geometry:e,noDataValue:i};const p=n.elevationProvider;return l.coordinates.forEach(c=>{c.z=p.getElevation(c.x,c.y,0,r,"ground")??0}),{geometry:l.export(),noDataValue:i}}return{geometry:e,noDataValue:i}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};a([u()],re.prototype,"_queryElevationDependencies",null),re=a([D("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],re);let te=class extends ${constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return tt(this.profile.source)}get available(){const{source:t}=this.profile;return!!t&&(t.visible==null||t.visible)&&(t.layers==null||t.layers.some(e=>e.visible))}initialize(){this.addHandles(P(()=>this.profile.source,()=>this.onInvalidate(this),le))}queryElevation(t,e){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(t,e)}};a([u({readOnly:!0})],te.prototype,"minDemResolution",null),a([u()],te.prototype,"available",null),te=a([D("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],te);let I=class extends Z{constructor(t){super(t),this._sketchViewModels=new Me,this._updatingHandles=new ii,this._operationManager=new ni}initialize(){const{view:t}=this;this._graphicsLayer=new si({listMode:"hide",internal:!0}),this.addHandles([P(()=>({map:t.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:i,state:s,geometryVisualizationVisible:o,visible:n})=>{Xi(e,i);const r=this.sketchGraphic;switch(r&&(r.visible=n),s){case"idle":case"reshaping-disabled":r&&!o&&(r.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":ce(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},x),P(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},x)])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>oe(e));const t=this._graphicsLayer;this.view.map?.remove(t),t.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(t){t!==this._get("sketchGraphic")&&(this._set("sketchGraphic",t),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:t,interactive:e}=this.analysisViewData;if(!t)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?e?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(t=>t.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(t=>t.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Yi(this.view.type)}place(t){return this._operationManager.start("place",async e=>{const i=this._createSketchViewModel(),s=this._analysis.clone();this._ensureUpdatedSketchGraphic();const o=this.sketchGraphic,n=this._analysis.elevationInfo,r=ee(()=>{this.sketchGraphic===o&&(this._graphicsLayer.elevationInfo=n)}),l=i.on("create",p=>{switch(p.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=p.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),e.stop();break;case"cancel":e.stop()}});e.handles.push(l,ee(()=>(l.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?dt(t)||s.equals(this._analysis)?e.reject():void e.resolve({}):(this._clear(),e.reject()))),r),this._graphicsLayer.elevationInfo=Ji,await this._updatingHandles.addPromise(ce(i.create("polyline")))},t)}async pickFeature(t){return this._operationManager.start("pick-feature",async e=>{const{view:i}=this;i.closePopup();let s=null;const o=r=>{r.defer(async()=>{s?.abort(),s=Fe(async l=>{const{results:p}=await i.hitTest(r);L(l);let c=null;for(const h of p)if(h.type==="graphic"&&di(h.graphic)&&!fi(h.graphic)){c=h.graphic;break}c?(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=c.geometry,this._analysis.elevationInfo=new ve({...Tt(c)}),e.resolve({feature:c}),e.stop()):e.reject()}),await s.promise})},n=r=>{Ct(r)&&(e.reject(),e.stop())};e.handles.push(i.on("immediate-click",o,Pe.TOOL),i.on("key-down",n,Pe.TOOL),i.acquireCursor("crosshair","high"),ee(()=>{s?.abort(),e.reject()})),i.focus()},t)}_startReshape(){const t=this._createSketchViewModel();return this._sketchViewModels.add(t),this._operationManager.start("reshape",async e=>{const i=()=>{const o=this._ensureUpdatedSketchGraphic();return o?this._updatingHandles.addPromise(t.update(o,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const s=t.on("update",o=>{this._updateAnalysisFromSketchGraphic(),o.state==="complete"&&(this.state==="reshaping"?ce(i()):e.resolve())});e.handles.push(s,ee(()=>{s.remove(),this._sketchViewModels.remove(t),t.destroy(),e.resolve()})),await i()})}_createSketchViewModel(){return new ai({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:t}=this._analysis;if(!t)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const e=this.sketchGraphic??=new ti({symbol:this._lineSymbol,geometry:t});return e.geometry=t,this._addSketchGraphic(e),e}_addSketchGraphic(t){const{graphics:e}=this._graphicsLayer;e.includes(t)||e.add(t),e.length!==1&&e.removeMany(e.filter(i=>i!==t))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let t=this.sketchGraphic?.geometry;ge(t)||(t=null);const e=this._analysis;e.geometry!==t&&(e.geometry=t)}};function Yi(t){if(t==="2d"){const e={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new oi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...e,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new ri({color:[0,0,0,0]})}function Xi(t,e){e&&(e.removeFromParent(),t?.add(e))}a([u({constructOnly:!0})],I.prototype,"analysisViewData",void 0),a([u({constructOnly:!0})],I.prototype,"view",void 0),a([u()],I.prototype,"sketchGraphic",null),a([u({nonNullable:!0})],I.prototype,"state",null),a([u()],I.prototype,"updating",null),a([u()],I.prototype,"_sketching",null),a([u()],I.prototype,"_analysis",null),a([u()],I.prototype,"_lineSymbol",null),I=a([D("esri.views.analysis.ElevationProfile.ElevationProfileTool")],I);const Ji=new ve({mode:"on-the-ground",offset:0});let b=class extends yt{constructor(t){super(t),this.type="elevation-profile-view-3d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:t,view:e}=this;this._controller=new g({analysis:t,analysisViewData:this,view:e,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new j(i);case"input":return new re(i);case"query":return new te(i);case"scene":return new T(i)}}}}),this._visualization=new X({view:e,analysisViewData:this}),this._sketchTool=new I({view:e,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:"meters",elevation:"meters"}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(t){super.interactive=t}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return this._controller?.updating===!0||this._visualization?.updating===!0||this._sketchTool?.updating===!0}get visible(){return super.visible}set visible(t){super.visible=t}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??"idle"}place(t){return this._sketchTool.place(t)}pickFeature(t){return this._sketchTool.pickFeature(t)}};a([u({readOnly:!0})],b.prototype,"type",void 0),a([u({constructOnly:!0,nonNullable:!0})],b.prototype,"analysis",void 0),a([u({readOnly:!0})],b.prototype,"effectiveDisplayUnits",null),a([u({readOnly:!0})],b.prototype,"error",null),a([u()],b.prototype,"hoveredPosition",void 0),a([u()],b.prototype,"hoveredPoints",null),a([u({readOnly:!0})],b.prototype,"progress",null),a([u({readOnly:!0})],b.prototype,"results",null),a([u({readOnly:!0})],b.prototype,"statistics",null),a([u({readOnly:!0})],b.prototype,"updating",null),a([u()],b.prototype,"sketchGraphic",null),a([u()],b.prototype,"toolState",null),a([u()],b.prototype,"_controller",void 0),a([u()],b.prototype,"_visualization",void 0),a([u()],b.prototype,"_sketchTool",void 0),b=a([D("esri.views.3d.analysis.ElevationProfileAnalysisView3D")],b);const Fn=b;export{Fn as default};
