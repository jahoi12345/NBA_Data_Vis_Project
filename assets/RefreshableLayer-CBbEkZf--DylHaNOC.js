import{Y as o,H as h,aU as c,a as d,v as p,bb as v,G as y}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{s as g}from"./Point-BfTTZoMu-DeJwQYfh.js";import{e as b}from"./layerContainerType-CSXZNpHb-BIF7XAYP.js";import{R as I}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{i as w}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";const n=new I,i=new WeakMap;function C(e){R(e)&&n.push(new WeakRef(e))}function D(e){const s=n.find(t=>t.deref()===e);s&&n.remove(s)}function R(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function m(e,s){return Number.isFinite(e)&&Number.isFinite(s)?s<=0?e:m(s,e%s):0}let l=0,f=0;function T(){const e=Date.now();let s=!1;for(const t of n){const r=t.deref();r?r.refreshInterval&&e-(i.get(r)??0)+5>=6e4*r.refreshInterval&&(i.set(r,e),r.refresh(e)):s=!0}if(s)for(let t=n.length-1;t>=0;t--)n.at(t).deref()||n.removeAt(t)}v(()=>{const e=Date.now();let s=0;for(const t of n){const r=t.deref();r&&(s=m(Math.round(6e4*r.refreshInterval),s),r.refreshInterval?i.get(r)||i.set(r,e):i.delete(r))}if(s!==f){if(f=s,clearInterval(l),f===0)return void(l=0);l=setInterval(T,f)}},w);function O(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const u=.1,k=e=>{const s=e;let t=class extends s{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=c(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||C(this)},()=>{})}destroy(){D(this)}castRefreshInterval(r){return r>=u?r:r<=0?0:u}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){d(this._debounceHasDataChanged()).then(a=>{a&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:a})},a=>{p.getLogger(this).error(a),this.emit("refresh",{dataChanged:!1,error:a})})}async hasDataChanged(){return!0}get test(){}};return o([h({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:b}}}}})],t.prototype,"refreshInterval",void 0),o([g("refreshInterval")],t.prototype,"castRefreshInterval",null),o([h({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),o([h({readOnly:!0})],t.prototype,"refreshParameters",null),t=o([y("esri.layers.mixins.RefreshableLayer")],t),t};export{O as N,k as O};
