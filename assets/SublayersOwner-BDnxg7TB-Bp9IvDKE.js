const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeatureLayer-BRWpcy_W-D7AhvLUt.js","assets/index-B0z_nLWi.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/getPopupProvider-CmskPttI-CzUWpGwk.js","assets/collectionUtils-jDyktm0P-BDP2Oq99.js","assets/Point-BfTTZoMu-DeJwQYfh.js","assets/reader-DcGs6kKN-DHJfK-tm.js","assets/reactiveUtils-SO2Ko3sy-BCLX8Jdy.js","assets/Extent-CgDMOSRD-Bod5LY6s.js","assets/SimpleObservable-CvFyr0NA-DXpoMYph.js","assets/lengthUtils-Dt1_RvOO-j3MEdmHu.js","assets/date-IqUzANpt-bLKO9IDT.js","assets/Color-CERqXxxY-BuYn26eI.js","assets/mathUtils-PIGhLnI9-B1tKUlUb.js","assets/Layer-DZvC7bne-D3VLDrab.js","assets/MultiOriginJSONSupport-Bd1TKmh_-BHNF5tHX.js","assets/layerContainerType-CSXZNpHb-BIF7XAYP.js","assets/FormTemplate-DuPZvaVv-DtJsNdqp.js","assets/Field-Cm_ZejYW-CwJZmSru.js","assets/fieldType-DVUzXtk_-tUuvnZJM.js","assets/Graphic-DgGzDmqW-d1CNicxz.js","assets/jsonUtils-CmpazY1u-6pDLj5sx.js","assets/Polyline-CoiTLswR-DTxpB2Yg.js","assets/Polygon-D6wEPb3W-D2MPjRU4.js","assets/aaBoundingRect-CjwcS2F3-ri8bmh30.js","assets/typeUtils-DqrRcjBx-DZ6_Gsbu.js","assets/createFeatureId-CVwTD0fV-3fKpJDrk.js","assets/typeUtils-CXW_VpOn-BGgLp_TK.js","assets/lineMarkers-CDwLe3J6-CNUjJvs3.js","assets/PolygonSymbol3D-BXRHZiCQ-BjPAY2LA.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js","assets/screenUtils-BitdhK1O-L0FLPAMi.js","assets/opacityUtils-DuFH0EC9-DWspTgn2.js","assets/aaBoundingBox-Cn49X7ge-BcYPaJ58.js","assets/DoubleArray-DExKNiTh-CvVpHySW.js","assets/mat4f64-q_b6UJoq-Dh6sWB_w.js","assets/Font-BwmnW7d2-Dwh3xjKw.js","assets/SimpleFillSymbol-CDawtd9z-CWD2KI2D.js","assets/SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js","assets/PictureMarkerSymbol-CaSh-vZk-xhjZ61bb.js","assets/TextSymbol-hRGhyDHs-CoS7dSjf.js","assets/GraphicOrigin-uE6TDXc9-DqbdmNAV.js","assets/isFeatureGraphicOrigin-YA2hudPe-Bk2FjH_E.js","assets/workers-BEkgoq8Q-BM_Hz460.js","assets/Queue-CYlrXMwB-CYJTUII-.js","assets/intl-DRFqUect-DPhFaHB2.js","assets/editsZScale-D3N5iH_c-CCATcpvE.js","assets/queryZScale-CRP3Sh_E-F3y679Wx.js","assets/projectionUtils-BGH_5_I3-DGwchVO8.js","assets/FeatureSet-BF7daP96-B_JvMbY7.js","assets/APIKeyMixin--YGbad8e-DJ-JJTX5.js","assets/ArcGISService-SIwch9bz-DEFXc423.js","assets/BlendLayer-HE_aYHHW-D0es7Iiq.js","assets/jsonUtils-CY6YsQMo-LM0PY-PG.js","assets/mat4f32-Djp3mnm5-DzYG3LYB.js","assets/mat4-C96X-Nn0-BrMLOLCb.js","assets/CustomParametersMixin-Dshqz1Zp-BFC165kX.js","assets/DisplayFilteredLayer-DyjtPayS-DLMYIA49.js","assets/scaleUtils-yfx9kKWT-D9SVsyM-.js","assets/uuid-Oe6SV2kF-IYX19xBA.js","assets/displayFilterUtils-CIXGrQzt-XEoxkZ3i.js","assets/EditBusLayer-rxUbWTiY-BxA39RQ7.js","assets/FeatureEffectLayer-BG_KTtPw-C05GQDNc.js","assets/FeatureEffect-mVCOF1v6--fvFHZv2.js","assets/FeatureFilter-G4_pWMVe-D0hu4KAy.js","assets/Query-BlS0WPDF-jdXS_Qhy.js","assets/FeatureLayerBase-BUeDgO3U-q6RnYMdc.js","assets/HeightModelInfo-D5IdRvJ2-23y6MRiu.js","assets/OperationalLayer-B6zbJ5nR-DyK_ztCk.js","assets/ElevationInfo-Cw2HaA6E-CuK5hJ96.js","assets/unitConversionUtils-4vB4Ezlp-DnY5MDxd.js","assets/timeZoneUtils-BSc7-7qA-BAv3h8mh.js","assets/featureLayerUtils-FKjLNPl_-Cv8vWd4i.js","assets/asyncUtils-w6KfWU41-HenJ0UOu.js","assets/featureQueryAll-BfDWA5Wx-BKksFkIA.js","assets/layerUtils-DZGhvm-W-CfyHx1TZ.js","assets/SimpleRenderer-CEmCWePp-BJ25mYcH.js","assets/commonProperties-DbO613LF-CHjBvYhj.js","assets/colorRamps-DswZzxkO-BqSFavfl.js","assets/ColorStop-De5gQTjr-C1lw16u9.js","assets/visualVariableUtils-ma4r7Z2K-Df6C3Hkh.js","assets/jsonUtils-C9q_FK4K-GRCbm_Pe.js","assets/defaults3D-C2hXSee1-CTj29-Ly.js","assets/defaults-BDN9qxeN-C-EfxQM4.js","assets/defaultsJSON-GKolV7NZ-GKolV7NZ.js","assets/UniqueValueRenderer-JPjz9Qvs-Duu1CubQ.js","assets/diffUtils-wTC1YzlE-DCTUTUs8.js","assets/RendererLegendOptions-ByGHYLtx-Bwoo6l33.js","assets/styleUtils-DWvicjTN-DL6_BIk4.js","assets/NormalizationBinParametersMixin-BK9wNkI3-BKYeOhDN.js","assets/LayerFloorInfo-CTubHTci-DciGdwJt.js","assets/multiLayerServiceUtils-CpHWiXA7-HO_F3Kjq.js","assets/Relationship-CrANqG2c-DiHDOAEy.js","assets/serviceCapabilitiesUtils-BV_pcUiO-Dw-u7_oZ.js","assets/infoFor3D-DhzudQro-CCYgWfsv.js","assets/portalItemUtils-CaPNUJg6-CXDHI5LA.js","assets/FeatureReductionLayer-Bhh5MvS_-6_Dufsno.js","assets/FeatureReductionSelection-Du7o8OIG-DmruV-ou.js","assets/labelingInfo-BYG2hiVF-B7-dv03v.js","assets/labelUtils-BtizwBfq-Zegx4520.js","assets/jsonUtils-BCGKNxno-DZ1Xr_O8.js","assets/typeUtils-DDFS4uuz-B7KgP61w.js","assets/ClassBreaksRenderer-BvgdqtTq-D2fU8Sng.js","assets/LRUCache-fy84PBMi-Y56WPIvD.js","assets/DictionaryScriptEvaluator-G73uSGpN-ErvAW-Hm.js","assets/Version-BtYZEj58-LyRHDnSJ.js","assets/FieldsIndex-CimK-TqD--24JoCkp.js","assets/UnknownTimeZone-B697BDFv-CBbtul7O.js","assets/ArcadeExpression-BlIRq-oN-VZkrwLVE.js","assets/TimeOnly-BERR31kg-CQiLyUZi.js","assets/enum-BzLwmiID-CcyIdWlQ.js","assets/utils-DX2muIr3-DiPfFKSl.js","assets/heatmapUtils-B-AXnq0l-BF3Q_jd2.js","assets/vec42-B8VM4vXb-B6OGOEI9.js","assets/vec4f64-DPb6J-GU-C7c2DqbZ.js","assets/MD5-MtSiOt06-jWr180Yc.js","assets/OrderedLayer-DQAUgUTV-CpnQmtbN.js","assets/PortalLayer-CbFNhtZ4-Doeialq-.js","assets/PortalItem-DnxMlRVo-CI4Ns2_M.js","assets/RefreshableLayer-CBbEkZf--DylHaNOC.js","assets/ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js","assets/TemporalLayer-D4R0YvXo-PSBzKw25.js","assets/TimeInfo-D7ssmbZO-Burc-nDV.js","assets/TrackableLayer-B-086Hm8-C0H4r_hG.js","assets/FeatureTemplate-Bur8tORn-C24tlGMe.js","assets/FeatureType-CFJlAOcG-DepIzvPz.js","assets/fieldProperties-BoJj55FN-DI1Lssr9.js","assets/TitleCreator-BosRD8XX-Cm4g2hqp.js","assets/sanitizerUtils-BT_8V5US-CWQWUwZQ.js","assets/versionUtils-BfuZvWmP-RYMRQmOM.js","assets/styleUtils-CZJC3pZm-BNE6B1Si.js","assets/popupUtils-D4UavgYz-DI7Mb3me.js"])))=>i.map(i=>d[i]);
import{H as ue,_ as pe}from"./index-B0z_nLWi.js";import{Y as o,H as n,b2 as A,aa as C,b7 as J,v as I,I as h,aL as ye,l as de,L as ce,a2 as T,o as Q,y as he,G as V,aG as q,K as w,aD as H}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{A as fe,H as M,V as z,p as K,f as te,s as me}from"./Point-BfTTZoMu-DeJwQYfh.js";import{c as be}from"./Version-BtYZEj58-LyRHDnSJ.js";import{u as m}from"./reader-DcGs6kKN-DHJfK-tm.js";import{z as re}from"./Extent-CgDMOSRD-Bod5LY6s.js";import{$ as ge,L as Se,X as ve}from"./OperationalLayer-B6zbJ5nR-DyK_ztCk.js";import{R as W}from"./portalItemUtils-CaPNUJg6-CXDHI5LA.js";import{R as $,k as je}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{r as we}from"./CollectionFlattener-D6h2Fkvj-WVl2BXw-.js";import{j as Z,i as X}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{A as Ie}from"./getPopupProvider-CmskPttI-CzUWpGwk.js";import{x as Oe}from"./Layer-DZvC7bne-D3VLDrab.js";import{k as xe}from"./MultiOriginJSONSupport-Bd1TKmh_-BHNF5tHX.js";import{r as De,G as Le}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import{G as N}from"./typeUtils-DqrRcjBx-DZ6_Gsbu.js";import{e as ae,r as ie}from"./GraphicOrigin-uE6TDXc9-DqbdmNAV.js";import{u as Fe}from"./QueryTask-DtLshCh_-CZwCFWQz.js";import{w as Te,s as Pe}from"./OrderedLayer-DQAUgUTV-CpnQmtbN.js";import{o as _e,p as Ce}from"./featureLayerUtils-FKjLNPl_-Cv8vWd4i.js";import{o as Be}from"./FeatureType-CFJlAOcG-DepIzvPz.js";import{o as Ee}from"./Field-Cm_ZejYW-CwJZmSru.js";import{m as qe}from"./FieldsIndex-CimK-TqD--24JoCkp.js";import{r as Re,i as Ae}from"./labelingInfo-BYG2hiVF-B7-dv03v.js";import{e as Me}from"./LayerFloorInfo-CTubHTci-DciGdwJt.js";import{e as Ne}from"./Relationship-CrANqG2c-DiHDOAEy.js";import{U as Ue}from"./serviceCapabilitiesUtils-BV_pcUiO-Dw-u7_oZ.js";import{g as U,o as ke,y as Y}from"./Query-BlS0WPDF-jdXS_Qhy.js";import{t as Ve,e as $e}from"./typeUtils-DDFS4uuz-B7KgP61w.js";import{J as Ge}from"./utils-CylVuxNi--x86XOjU.js";import{S as Je}from"./popupUtils-D4UavgYz-DI7Mb3me.js";import{B as Qe}from"./typeUtils-CXW_VpOn-BGgLp_TK.js";import{c as He}from"./sublayerUtils-BEQnBRaB-BKtQCtZt.js";const oe=(e,s=oe,t=s.f||(s.f=["assets/FeatureLayer-BRWpcy_W.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU.js","assets/getPopupProvider-CmskPttI.js","assets/collectionUtils-jDyktm0P.js","assets/Point-BfTTZoMu.js","assets/reader-DcGs6kKN.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-CgDMOSRD.js","assets/SimpleObservable-CvFyr0NA.js","assets/lengthUtils-Dt1_RvOO.js","assets/date-IqUzANpt.js","assets/Color-CERqXxxY.js","assets/mathUtils-PIGhLnI9.js","assets/Layer-DZvC7bne.js","assets/MultiOriginJSONSupport-Bd1TKmh_.js","assets/layerContainerType-CSXZNpHb.js","assets/FormTemplate-DuPZvaVv.js","assets/Field-Cm_ZejYW.js","assets/fieldType-DVUzXtk_.js","assets/Graphic-DgGzDmqW.js","assets/jsonUtils-CmpazY1u.js","assets/Polyline-CoiTLswR.js","assets/Polygon-D6wEPb3W.js","assets/aaBoundingRect-CjwcS2F3.js","assets/typeUtils-DqrRcjBx.js","assets/createFeatureId-CVwTD0fV.js","assets/typeUtils-CXW_VpOn.js","assets/lineMarkers-CDwLe3J6.js","assets/PolygonSymbol3D-BXRHZiCQ.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x.js","assets/screenUtils-BitdhK1O.js","assets/opacityUtils-DuFH0EC9.js","assets/aaBoundingBox-Cn49X7ge.js","assets/DoubleArray-DExKNiTh.js","assets/mat4f64-q_b6UJoq.js","assets/Font-BwmnW7d2.js","assets/SimpleFillSymbol-CDawtd9z.js","assets/SimpleMarkerSymbol-BGAFRS9_.js","assets/PictureMarkerSymbol-CaSh-vZk.js","assets/TextSymbol-hRGhyDHs.js","assets/GraphicOrigin-uE6TDXc9.js","assets/isFeatureGraphicOrigin-YA2hudPe.js","assets/workers-BEkgoq8Q.js","assets/Queue-CYlrXMwB.js","assets/intl-DRFqUect.js","assets/editsZScale-D3N5iH_c.js","assets/queryZScale-CRP3Sh_E.js","assets/projectionUtils-BGH_5_I3.js","assets/FeatureSet-BF7daP96.js","assets/APIKeyMixin--YGbad8e.js","assets/ArcGISService-SIwch9bz.js","assets/BlendLayer-HE_aYHHW.js","assets/jsonUtils-CY6YsQMo.js","assets/mat4f32-Djp3mnm5.js","assets/mat4-C96X-Nn0.js","assets/CustomParametersMixin-Dshqz1Zp.js","assets/DisplayFilteredLayer-DyjtPayS.js","assets/scaleUtils-yfx9kKWT.js","assets/uuid-Oe6SV2kF.js","assets/displayFilterUtils-CIXGrQzt.js","assets/EditBusLayer-rxUbWTiY.js","assets/FeatureEffectLayer-BG_KTtPw.js","assets/FeatureEffect-mVCOF1v6.js","assets/FeatureFilter-G4_pWMVe.js","assets/Query-BlS0WPDF.js","assets/FeatureLayerBase-BUeDgO3U.js","assets/HeightModelInfo-D5IdRvJ2.js","assets/OperationalLayer-B6zbJ5nR.js","assets/ElevationInfo-Cw2HaA6E.js","assets/unitConversionUtils-4vB4Ezlp.js","assets/timeZoneUtils-BSc7-7qA.js","assets/featureLayerUtils-FKjLNPl_.js","assets/asyncUtils-w6KfWU41.js","assets/featureQueryAll-BfDWA5Wx.js","assets/layerUtils-DZGhvm-W.js","assets/SimpleRenderer-CEmCWePp.js","assets/commonProperties-DbO613LF.js","assets/colorRamps-DswZzxkO.js","assets/ColorStop-De5gQTjr.js","assets/visualVariableUtils-ma4r7Z2K.js","assets/jsonUtils-C9q_FK4K.js","assets/defaults3D-C2hXSee1.js","assets/defaults-BDN9qxeN.js","assets/defaultsJSON-GKolV7NZ.js","assets/UniqueValueRenderer-JPjz9Qvs.js","assets/diffUtils-wTC1YzlE.js","assets/RendererLegendOptions-ByGHYLtx.js","assets/styleUtils-DWvicjTN.js","assets/NormalizationBinParametersMixin-BK9wNkI3.js","assets/LayerFloorInfo-CTubHTci.js","assets/multiLayerServiceUtils-CpHWiXA7.js","assets/Relationship-CrANqG2c.js","assets/serviceCapabilitiesUtils-BV_pcUiO.js","assets/infoFor3D-DhzudQro.js","assets/portalItemUtils-CaPNUJg6.js","assets/FeatureReductionLayer-Bhh5MvS_.js","assets/FeatureReductionSelection-Du7o8OIG.js","assets/labelingInfo-BYG2hiVF.js","assets/labelUtils-BtizwBfq.js","assets/jsonUtils-BCGKNxno.js","assets/typeUtils-DDFS4uuz.js","assets/ClassBreaksRenderer-BvgdqtTq.js","assets/LRUCache-fy84PBMi.js","assets/DictionaryScriptEvaluator-G73uSGpN.js","assets/Version-BtYZEj58.js","assets/FieldsIndex-CimK-TqD.js","assets/UnknownTimeZone-B697BDFv.js","assets/ArcadeExpression-BlIRq-oN.js","assets/TimeOnly-BERR31kg.js","assets/enum-BzLwmiID.js","assets/utils-DX2muIr3.js","assets/heatmapUtils-B-AXnq0l.js","assets/vec42-B8VM4vXb.js","assets/vec4f64-DPb6J-GU.js","assets/MD5-MtSiOt06.js","assets/OrderedLayer-DQAUgUTV.js","assets/PortalLayer-CbFNhtZ4.js","assets/PortalItem-DnxMlRVo.js","assets/RefreshableLayer-CBbEkZf-.js","assets/ScaleRangeLayer-DQr2T3Hh.js","assets/TemporalLayer-D4R0YvXo.js","assets/TimeInfo-D7ssmbZO.js","assets/TrackableLayer-B-086Hm8.js","assets/FeatureTemplate-Bur8tORn.js","assets/FeatureType-CFJlAOcG.js","assets/fieldProperties-BoJj55FN.js","assets/TitleCreator-BosRD8XX.js","assets/sanitizerUtils-BT_8V5US.js","assets/versionUtils-BfuZvWmP.js","assets/styleUtils-CZJC3pZm.js","assets/popupUtils-D4UavgYz.js"]))=>e.map(r=>t[r]),Es=e=>{const s=e;let t=class extends s{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0,this._allLayersAndTablesMap=null}readCapabilities(r,a){const i=a.capabilities&&a.capabilities.split(",").map(ne=>ne.toLowerCase().trim());if(!i)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const u=this.type,p=u!=="tile"&&!!a.supportsDynamicLayers,y=i.includes("query"),d=i.includes("map"),v=!!a.exportTilesAllowed,j=i.includes("tilemap"),b=i.includes("data"),S=u!=="tile"&&(!a.tileInfo||p),x=u!=="tile"&&(!a.tileInfo||p),D=u!=="tile",c=u!=="tile"&&p&&a.currentVersion>=11.1,f=a.cimVersion?be.parse(a.cimVersion):null,L=f?.greaterEqual(1,4)??!1,F=f?.greaterEqual(2,0)??!1;return{operations:{supportsExportMap:d,supportsExportTiles:v,supportsIdentify:y,supportsQuery:b,supportsTileMap:j},exportMap:d?{supportsArcadeExpressionForLabeling:L,supportsCIMSymbols:F,supportsDynamicLayers:p,supportsSublayerOrderBy:c,supportsSublayerDefinitionExpression:x,supportsSublayerVisibility:S,supportsSublayersChanges:D}:null,exportTiles:v?{maxExportTilesCount:+a.maxExportTilesCount}:null}}readVersion(r,a){let i=a.currentVersion;return i||(i=a.hasOwnProperty("capabilities")||a.hasOwnProperty("tables")?10:a.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),i}async fetchRelatedService(r){const a=this.portalItem;if(!a||!W(a))return null;this._relatedFeatureServicePromise||(this._relatedFeatureServicePromise=a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},r).then(u=>u.find(p=>p.type==="Feature Service")??null,()=>null));const i=await this._relatedFeatureServicePromise;return Q(r),i?{itemId:i.id,url:i.url}:null}async fetchSublayerInfo(r,a){const{source:i}=r;if(this?.portalItem&&this.type==="tile"&&i?.type==="map-layer"&&W(this.portalItem)&&r.originIdOf("url")<2){const y=await this.fetchRelatedService(a);y&&(r.url=z(y.url,i.mapLayerId.toString()),r.layerItemId=y.itemId)}const{url:u}=r;let p;if(i.type==="data-layer")p=(await M(u,{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey},...a})).data;else if(u&&r.originIdOf("url")>2)try{const y=await this._fetchAllLayersAndTablesFromService(u),d=K(u)?.sublayer??i.mapLayerId;p=y.get(d)}catch{}else{let y=r.id;i?.type==="map-layer"&&(y=i.mapLayerId);try{p=(await this.fetchAllLayersAndTables(a)).get(y)}catch{}}return p}async fetchAllLayersAndTables(r){return this._fetchAllLayersAndTablesFromService(this.parsedUrl?.path,r)}async _fetchAllLayersAndTablesFromService(r,a){await this.load(a),this._allLayersAndTablesMap||=new Map;const i=K(r),u=he(this._allLayersAndTablesMap,i?.url.path,()=>M(z(i?.url.path,"/layers"),{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(y=>{const d=new Map,{layers:v,tables:j}=y.data,b=[...v??[],...j??[]];for(const S of b)d.set(S.id,S);return{result:d}},y=>({error:y}))),p=await u;if(Q(a),"result"in p)return p.result;throw p.error}};return o([n({readOnly:!0})],t.prototype,"capabilities",void 0),o([m("service","capabilities",["capabilities","cimVersion","currentVersion","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],t.prototype,"readCapabilities",null),o([n({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),o([n({type:re})],t.prototype,"fullExtent",void 0),o([n(ge)],t.prototype,"id",void 0),o([n({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),o([n(Se)],t.prototype,"popupEnabled",void 0),o([n({type:te})],t.prototype,"spatialReference",void 0),o([n({readOnly:!0})],t.prototype,"version",void 0),o([m("service","version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],t.prototype,"readVersion",null),t=o([V("esri.layers.mixins.ArcGISMapService")],t),t},ze=Symbol("isMapImageGraphicOriginSymbol");var ee;let Ke=class extends ae{get[(ee=ze,ie)](){return this.layer}constructor(e,s){super(),this[ee]=!0,this.type="map-image",this.layer=e,this.sublayer=s}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}};const We=Symbol("isTileGraphicOriginSymbol");var se;class Ze extends ae{get[(se=We,ie)](){return this.layer}constructor(s,t){super(),this[se]=!0,this.type="tile",this.layer=s,this.sublayer=t}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}}var B;function R(e){return e?.type==="esriSMS"}function G(e,s,t){const r=t.minimumWritableOrigin||t.origin;return!!r&&e.originIdOf(s)>=A(r)}function O(e,s,t){const r=G(this,s,t);return{ignoreOrigin:!0,allowNull:r,enabled:!!t&&t.layer?.type==="map-image"&&(t.writeSublayerStructure||r)}}function k(e,s,t){return{enabled:!!t&&t.layer?.type==="tile"&&(G(this,s,t)||this._isOverridden(s))}}function g(e,s,t){return{ignoreOrigin:!0,enabled:t&&t.writeSublayerStructure||!1}}function E(e,s,t){return{ignoreOrigin:!0,enabled:!!t?.writeSublayerStructure&&this.originIdOf(s)>2}}function P(e,s,t){return{ignoreOrigin:!0,enabled:!!t&&(t.writeSublayerStructure||G(this,s,t))}}let Xe=0;const Ye=new Set(["layer","parent","loaded","loadStatus","loadError","loadWarnings"]);let l=class extends xe(Oe(je)){static{B=this}constructor(e){super(e),this.attributeTableTemplate=null,this.capabilities=void 0,this.maxScaleRange={minScale:0,maxScale:0},this.fields=null,this.fullExtent=null,this.geometryType=null,this.globalIdField=null,this.isTable=!1,this.legendEnabled=!0,this.objectIdField=null,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.spatialReference=null,this.title=null,this.typeIdField=null,this.type="sublayer",this.types=null,this._lastParsedUrl=null}async load(e){return this.addResolvingPromise(this.reload(e)),this}readCapabilities(e,s){s=s.layerDefinition||s;const{attachment:t,operations:{supportsQuery:r,supportsQueryAttachments:a},query:{supportsFormatPBF:i,supportsOrderBy:u,supportsPagination:p},data:{supportsAttachment:y},queryRelated:d}=Ue(s,this.url);return{attachment:{supportsOrderByFields:t?.supportsOrderByFields??!1,supportsResize:t?.supportsResize??!1,supportsTypeWildcard:t?.supportsTypeWildcard??!1},exportMap:{supportsModification:!!s.canModifyLayer},operations:{supportsQuery:r,supportsQueryAttachments:a},data:{supportsAttachment:y},query:{supportsFormatPBF:i,supportsOrderBy:u,supportsPagination:p},queryRelated:d}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(e){this._setAndNotifyLayer("definitionExpression",e)}get effectiveScaleRange(){const{minScale:e,maxScale:s}=this;return{minScale:e,maxScale:s}}readMaxScaleRange(e,s){return{minScale:(s=s.layerDefinition||s).minScale??0,maxScale:s.maxScale??0}}get fieldsIndex(){return new qe(this.fields||[])}set floorInfo(e){this._setAndNotifyLayer("floorInfo",e)}readGlobalIdFieldFromService(e,s){if((s=s.layerDefinition||s).globalIdField)return s.globalIdField;if(s.fields){for(const t of s.fields)if(t.type==="esriFieldTypeGlobalID")return t.name}}get graphicOrigin(){if(!this.layer)return null;switch(this.layer.type){case"tile":return new Ze(this.layer,this);case"map-image":return new Ke(this.layer,this)}}get id(){return this._get("id")??Xe++}set id(e){this._get("id")!==e&&(this.layer?.capabilities?.exportMap?.supportsDynamicLayers!==!1?this._set("id",e):this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"))}readIsTable(e,s){return s.type==="Table"}set labelingInfo(e){this._setAndNotifyLayer("labelingInfo",e)}writeLabelingInfo(e,s,t,r){e&&e.length&&(s.layerDefinition={drawingInfo:{labelingInfo:e.map(a=>a.write({},r))}})}set labelsVisible(e){this._setAndNotifyLayer("labelsVisible",e)}set layer(e){this._set("layer",e),this.sublayers?.forEach(s=>s.layer=e)}set listMode(e){this._set("listMode",e)}set minScale(e){this._setAndNotifyLayer("minScale",e)}readMinScale(e,s){return s.minScale||s.layerDefinition?.minScale||0}set maxScale(e){this._setAndNotifyLayer("maxScale",e)}readMaxScale(e,s){return s.maxScale||s.layerDefinition?.maxScale||0}readObjectIdFieldFromService(e,s){return(s=s.layerDefinition||s).objectIdField?s.objectIdField:s.fields?.find(t=>t.type==="esriFieldTypeOID")?.name}set opacity(e){this._setAndNotifyLayer("opacity",e)}readOpacity(e,s){const{layerDefinition:t}=s;return 1-.01*(t?.transparency??t?.drawingInfo?.transparency??0)}writeOpacity(e,s,t,r){s.layerDefinition={drawingInfo:{transparency:100-100*e}}}set orderBy(e){this._setAndNotifyLayer("orderBy",e)}writeParent(e,s){this.parent&&this.parent!==this.layer?s.parentLayerId=ye(this.parent.id):s.parentLayerId=-1}get queryTask(){if(!this.layer)return null;const{capabilities:e,fieldsIndex:s,layer:t,url:r}=this,{spatialReference:a}=t,i="gdbVersion"in t?t.gdbVersion:void 0,u=de("featurelayer-pbf")&&e?.query.supportsFormatPBF;return new Fe({fieldsIndex:s,gdbVersion:i,pbfSupported:u,queryAttachmentsSupported:e?.operations?.supportsQueryAttachments??!1,sourceSpatialReference:a,url:r})}set renderer(e){if(De(e,this.fieldsIndex),e){for(const s of e.symbols)if(Qe(s)){I.getLogger(this).warn("Sublayer renderer should use 2D symbols");break}}this._setAndNotifyLayer("renderer",e)}get source(){return this._get("source")||new U({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer("source",e)}set sublayers(e){this._handleSublayersChange(e,this._get("sublayers")),this._set("sublayers",e)}castSublayers(e){return ce($.ofType(B),e)}writeSublayers(e,s,t){this.sublayers?.length&&(s[t]=this.sublayers.map(r=>r.id).toArray().reverse())}readTitle(e,s){return s.layerDefinition?.name??s.name}readTypeIdField(e,s){let t=(s=s.layerDefinition||s).typeIdField;if(t&&s.fields){t=t.toLowerCase();const r=s.fields.find(a=>a.name.toLowerCase()===t);r&&(t=r.name)}return t}get url(){const e=this.layer?.parsedUrl??this._lastParsedUrl,s=this.source;if(!e)return null;if(this._lastParsedUrl=e,s?.type==="map-layer")return`${e.path}/${s.mapLayerId}`;const t={layer:JSON.stringify({source:this.source})};return`${e.path}/dynamicLayer?${fe(t)}`}set url(e){this._overrideIfSome("url",e)}set visible(e){this._setAndNotifyLayer("visible",e)}writeVisible(e,s,t,r){s[t]=this.getAtOrigin("defaultVisibility","service")||e}clone(){const{store:e}=C(this),s=new B;return C(s).store=e.clone(Ye),this.commitProperty("url"),s._lastParsedUrl=this._lastParsedUrl,s}createPopupTemplate(e){return Je(this,e)}createQuery(){return new ke({returnGeometry:!0,where:this.definitionExpression||"1=1"})}async createFeatureLayer(){if(this.hasOwnProperty("sublayers"))return null;const e=(await ue(async()=>{const{default:a}=await pe(()=>import("./FeatureLayer-BRWpcy_W-D7AhvLUt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132]));return{default:a}},oe([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132]))).default,{layer:s,url:t}=this;let r;if(t&&this.originIdOf("url")>2)r=new e({url:t});else{if(!s?.parsedUrl)throw new h("createFeatureLayer:missing-information","Cannot create a FeatureLayer without a url or a parent layer");{const a=s.parsedUrl;r=new e({url:a.path}),a&&this.source&&(this.source.type==="map-layer"?r.layerId=this.source.mapLayerId:r.dynamicDataSource=this.source)}}return s?.refreshInterval!=null&&(r.refreshInterval=s.refreshInterval),this.definitionExpression&&(r.definitionExpression=this.definitionExpression),this.floorInfo&&(r.floorInfo=T(this.floorInfo)),this.originIdOf("labelingInfo")>2&&(r.labelingInfo=T(this.labelingInfo)),this.originIdOf("labelsVisible")>0&&(r.labelsVisible=this.labelsVisible),this.originIdOf("legendEnabled")>0&&(r.legendEnabled=this.legendEnabled),this.originIdOf("visible")>0&&(r.visible=this.visible),this.originIdOf("minScale")>0&&(r.minScale=this.minScale),this.originIdOf("maxScale")>0&&(r.maxScale=this.maxScale),this.originIdOf("opacity")>0&&(r.opacity=this.opacity),this.originIdOf("popupTemplate")>0&&(r.popupTemplate=T(this.popupTemplate)),this.originIdOf("renderer")>2&&(r.renderer=T(this.renderer)),this.source?.type==="data-layer"&&(r.dynamicDataSource=this.source.clone()),this.originIdOf("title")>0&&(r.title=this.title),s?.type==="map-image"&&s.originIdOf("customParameters")>0&&(r.customParameters=s.customParameters),s?.type==="tile"&&s.originIdOf("customParameters")>0&&(r.customParameters=s.customParameters),r}getField(e){return this.fieldsIndex.get(e)}getFeatureType(e){return _e(this.types,this.typeIdField,e)}getFieldDomain(e,s){const t=s?.feature,r=this.getFeatureType(t);if(r){const a=r.domains&&r.domains[e];if(a&&a.type!=="inherited")return a}return this._getLayerDomain(e)}async queryAttachments(e,s){await this.load(),e=Ce.from(e);const t=this.capabilities;if(!t?.data?.supportsAttachment)throw new h("queryAttachments:not-supported","this layer doesn't support attachments");const{attachmentTypes:r,objectIds:a,globalIds:i,num:u,size:p,start:y,where:d}=e;if(!t?.operations?.supportsQueryAttachments&&(r?.length>0||i?.length>0||p?.length>0||u||y||d))throw new h("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a?.length||i?.length||d))throw new h("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);return!t?.attachment?.supportsOrderByFields&&e.orderByFields?.length&&((e=e.clone()).orderByFields=null),this.queryTask.executeAttachmentQuery(e,s)}async queryFeatureCount(e=this.createQuery(),s){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new h("queryFeatureCount:not-supported","this layer doesn't support queries.");if(!this.url)throw new h("queryFeatureCount:not-supported","this layer has no url.");const t=this.layer?.apiKey;return await this.queryTask.executeForCount(e,{...s,query:{...this.layer?.customParameters,token:t}})}async queryFeatures(e=this.createQuery(),s){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new h("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new h("queryFeatures:not-supported","this layer has no url.");const t=await this.queryTask.execute(e,{...s,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(t?.features){const r=this.graphicOrigin;for(const a of t.features)a.sourceLayer=this,a.origin=r}return t}async queryObjectIds(e=this.createQuery(),s){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new h("queryObjectIds:not-supported","this layer doesn't support queries.");if(!this.url)throw new h("queryObjectIds:not-supported","this layer has no url.");const t=this.layer?.apiKey;return await this.queryTask.executeForIds(e,{...s,query:{...this.layer?.customParameters,token:t}})}async queryRelatedFeatures(e,s){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new h("queryRelatedFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new h("queryRelatedFeatures:not-supported","this layer has no url.");const t=this.layer?.apiKey;return await this.queryTask.executeRelationshipQuery(e,{...s,query:{...this.layer?.customParameters,token:t}})}async queryRelatedFeaturesCount(e,s){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new h("queryRelatedFeaturesCount:not-supported","this layer doesn't support queries.");if(!this.capabilities.queryRelated.supportsCount)throw new h("queryRelatedFeaturesCount:not-supported","this layer doesn't support query related counts.");if(!this.url)throw new h("queryRelatedFeaturesCount:not-supported","this layer has no url.");const t=this.layer?.apiKey;return await this.queryTask.executeRelationshipQueryForCount(e,{...s,query:{...this.layer?.customParameters,token:t}})}async reload(e){if(this.loadStatus==="not-loaded")return this.load(e).then(()=>{});const{layer:s,url:t}=this;if(!s&&!t)throw new h("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});const r=s?await s.fetchSublayerInfo(this,e):(await M(t,{query:{f:"json"},...e})).data;if(this.loaded&&this.originIdOf("url")>2){const a=new Set(["drawingInfo","maxScale","minScale","name"]);if(r!=null)for(const i of Object.keys(r))a.has(i)&&delete r[i]}r&&(this.sourceJSON={...this.sourceJSON,...r},this.read({layerDefinition:r},{origin:"service",layer:s,url:Ge(t)}))}toExportImageJSON(e){const s={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:"mapLayer"}},t=Le(e,this.definitionExpression);t!=null&&(s.definitionExpression=t);const r=["renderer","labelingInfo","opacity","labelsVisible"].reduce((a,i)=>(a[i]=this.originIdOf(i),a),{});if(Object.keys(r).some(a=>r[a]>2)){const a=s.drawingInfo={};if(r.renderer>2&&(a.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>2&&(a.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>2)if(this.labelingInfo){!this.loaded&&this.labelingInfo?.some(u=>!u.labelPlacement)&&I.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.`,{sublayer:this});let i=this.labelingInfo;this.geometryType!=null&&(i=Re(this.labelingInfo,N.toJSON(this.geometryType))),a.showLabels=!0,a.labelingInfo=i.filter(u=>u.labelPlacement).map(u=>u.toJSON({origin:"service",layer:this.layer}))}else a.showLabels=!1;r.opacity>2&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer)}return(this.layer?.capabilities?.exportMap?.supportsSublayerOrderBy??!1)&&this.originIdOf("orderBy")>2&&(s.orderBy=this.orderBy?.map(a=>a.toJSON())??null),s}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,s=>{s.color||s.style!=="esriSMSX"&&s.style!=="esriSMSCross"||(s.outline?.color?s.color=s.outline.color:s.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(e,s){if(e){const t=("uniqueValueInfos"in e?e.uniqueValueInfos:"classBreakInfos"in e?e.classBreakInfos:null)??[];for(const r of t)R(r.symbol)&&s(r.symbol);"symbol"in e&&R(e.symbol)&&s(e.symbol),"defaultSymbol"in e&&R(e.defaultSymbol)&&s(e.defaultSymbol)}}_setAndNotifyLayer(e,s){const t=this.layer,r=this._get(e);let a,i;switch(e){case"definitionExpression":case"floorInfo":a="supportsSublayerDefinitionExpression";break;case"minScale":case"maxScale":case"visible":a="supportsSublayerVisibility";break;case"labelingInfo":case"labelsVisible":case"opacity":case"renderer":case"source":a="supportsDynamicLayers",i="supportsModification";break;case"orderBy":a="supportsSublayerOrderBy",i="supportsModification"}const u=C(this).getDefaultOrigin();if(u!=="service"){if(a&&this.layer?.capabilities?.exportMap?.[a]===!1)return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${a}'`);if(i&&this.capabilities?.exportMap[i]===!1)return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${i}'`)}e!=="source"||this.loadStatus==="not-loaded"?(this._set(e,s),u!=="service"&&r!==s&&t?.emit&&t.emit("sublayer-update",{propertyName:e,target:this})):this._logLockedError(e,"'source' can't be changed after calling sublayer.load()")}_handleSublayersChange(e,s){s&&(s.forEach(t=>{t.parent=null,t.layer=null}),this.removeAllHandles()),e&&(e.forEach(t=>{t.parent=this,t.layer=this.layer}),this.addHandles([e.on("after-add",({item:t})=>{t.parent=this,t.layer=this.layer}),e.on("after-remove",({item:t})=>{t.parent=null,t.layer=null}),e.on("before-changes",t=>{(this.layer?.capabilities?.exportMap?.supportsSublayersChanges??1)||(I.getLogger(this).error(new h("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),t.preventDefault())})]))}_logLockedError(e,s){const{layer:t,declaredClass:r}=this;I.getLogger(r).error(new h("sublayer:locked",`Property '${String(e)}' can't be changed on Sublayer from the layer '${t?.id}'`,{reason:s,sublayer:this,layer:t}))}_getLayerDomain(e){return this.fieldsIndex.get(e)?.domain??null}static{this.test={isMapImageLayerOverridePolicy:e=>e===E||e===g||e===O,isTileImageLayerOverridePolicy:e=>e===k}}};o([n({type:ve,json:{name:"attributeTableInfo",write:{overridePolicy:O},origins:{"web-scene":{write:!1}}}})],l.prototype,"attributeTableTemplate",void 0),o([n({readOnly:!0})],l.prototype,"capabilities",void 0),o([m("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],l.prototype,"readCapabilities",null),o([n()],l.prototype,"defaultPopupTemplate",null),o([n({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:O}}})],l.prototype,"definitionExpression",null),o([n({readOnly:!0})],l.prototype,"effectiveScaleRange",null),o([m("service","maxScaleRange",["minScale","maxScale"])],l.prototype,"readMaxScaleRange",null),o([n({type:[Ee],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],l.prototype,"fields",void 0),o([n({readOnly:!0})],l.prototype,"fieldsIndex",null),o([n({type:Me,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:O},origins:{"web-scene":{read:!1,write:!1}}}})],l.prototype,"floorInfo",null),o([n({type:re,json:{read:{source:"layerDefinition.extent"}}})],l.prototype,"fullExtent",void 0),o([n({type:N.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:N.read}}}}})],l.prototype,"geometryType",void 0),o([n({type:String})],l.prototype,"globalIdField",void 0),o([m("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],l.prototype,"readGlobalIdFieldFromService",null),o([n({readOnly:!0})],l.prototype,"graphicOrigin",null),o([n({type:q,json:{write:{ignoreOrigin:!0}}})],l.prototype,"id",null),o([n({readOnly:!0})],l.prototype,"isTable",void 0),o([m("service","isTable",["type"])],l.prototype,"readIsTable",null),o([n({value:null,type:[Ae],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:E}}})],l.prototype,"labelingInfo",null),o([w("labelingInfo")],l.prototype,"writeLabelingInfo",null),o([n({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:g}}})],l.prototype,"labelsVisible",null),o([n({value:null})],l.prototype,"layer",null),o([n({type:String,json:{write:{overridePolicy:k}}})],l.prototype,"layerItemId",void 0),o([n({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:P}}})],l.prototype,"legendEnabled",void 0),o([n({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],l.prototype,"listMode",null),o([n({type:Number,value:0,json:{write:{overridePolicy:g}}})],l.prototype,"minScale",null),o([m("minScale",["minScale","layerDefinition.minScale"])],l.prototype,"readMinScale",null),o([n({type:Number,value:0,json:{write:{overridePolicy:g}}})],l.prototype,"maxScale",null),o([m("maxScale",["maxScale","layerDefinition.maxScale"])],l.prototype,"readMaxScale",null),o([n()],l.prototype,"objectIdField",void 0),o([m("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],l.prototype,"readObjectIdFieldFromService",null),o([n({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:g}}})],l.prototype,"opacity",null),o([m("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],l.prototype,"readOpacity",null),o([w("opacity")],l.prototype,"writeOpacity",null),o([n({value:null,type:[Pe],json:{name:"layerDefinition.orderBy",read:{reader:Te},write:{overridePolicy:O},origins:{"web-scene":{read:!1,write:!1}}}})],l.prototype,"orderBy",null),o([n({json:{type:q,write:{target:"parentLayerId",writerEnsuresNonNull:!0,overridePolicy:g}}})],l.prototype,"parent",void 0),o([w("parent")],l.prototype,"writeParent",null),o([n({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,s)=>!s.disablePopup},write:{target:"disablePopup",overridePolicy:P,writer(e,s,t){s[t]=!e}}}})],l.prototype,"popupEnabled",void 0),o([n({type:Ie,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:P}}})],l.prototype,"popupTemplate",void 0),o([n({readOnly:!0})],l.prototype,"queryTask",null),o([n({type:[Ne],readOnly:!0,json:{origins:{service:{read:{source:"layerDefinition.relationships"}}}}})],l.prototype,"relationships",void 0),o([n({types:$e,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:E},origins:{"web-scene":{types:Ve,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:E}}}}})],l.prototype,"renderer",null),o([n({types:{key:"type",base:null,typeMap:{"data-layer":Y,"map-layer":U}},cast(e){if(e){if("mapLayerId"in e)return H(U,e);if("dataSource"in e)return H(Y,e)}return e},json:{name:"layerDefinition.source",write:{overridePolicy:g}}})],l.prototype,"source",null),o([n()],l.prototype,"sourceJSON",void 0),o([n({type:te,json:{origins:{service:{read:{source:"layerDefinition.extent.spatialReference"}}}}})],l.prototype,"spatialReference",void 0),o([n({value:null,json:{type:[q],write:{target:"subLayerIds",allowNull:!0,overridePolicy:g}}})],l.prototype,"sublayers",null),o([me("sublayers")],l.prototype,"castSublayers",null),o([w("sublayers")],l.prototype,"writeSublayers",null),o([n({type:String,json:{name:"name",write:{overridePolicy:P}}})],l.prototype,"title",void 0),o([m("service","title",["name","layerDefinition.name"])],l.prototype,"readTitle",null),o([n({type:String})],l.prototype,"typeIdField",void 0),o([n({json:{read:!1},readOnly:!0,value:"sublayer"})],l.prototype,"type",void 0),o([m("typeIdField",["layerDefinition.typeIdField"])],l.prototype,"readTypeIdField",null),o([n({type:[Be],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],l.prototype,"types",void 0),o([n({type:String,json:{name:"layerUrl",write:{overridePolicy:k}}})],l.prototype,"url",null),o([n({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:g}}})],l.prototype,"visible",null),o([w("visible")],l.prototype,"writeVisible",null),l=B=o([V("esri.layers.support.Sublayer")],l);function es(e,s){const t=[],r={};return e&&e.forEach(a=>{const i=new l;if(i.read(a,s),r[i.id]=i,a.parentLayerId!=null&&a.parentLayerId!==-1){const u=r[a.parentLayerId];u.sublayers||(u.sublayers=[]),u.sublayers.unshift(i)}else t.unshift(i)}),t}const _=$.ofType(l);function le(e,s){e&&e.forEach(t=>{s(t),t.sublayers&&t.sublayers.length&&le(t.sublayers,s)})}const qs=e=>{const s=e;let t=class extends s{constructor(...r){super(...r),this.allSublayers=new we({getCollections:()=>[this.sublayers],getChildrenFunction:a=>a.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{},6:{}},this.subtables=null,this.addHandles([Z(()=>this.sublayers,(a,i)=>this._handleSublayersChange(a,i),X),Z(()=>this.subtables,(a,i)=>this._handleSublayersChange(a,i),X)])}destroy(){this.allSublayers.destroy()}readSublayers(r,a){if(!a||!r)return;const{sublayersSourceJSON:i}=this,u=A(a.origin);if(u<2||(i[u]={context:a,visibleLayers:r.visibleLayers||i[u].visibleLayers,layers:r.layers||i[u].layers},u>2))return;this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);const{sublayers:p,origin:y}=this.createSublayersForOrigin("web-document"),d=C(this);d.setDefaultOrigin(y),this._set("sublayers",new _(p)),d.setDefaultOrigin("user")}findSublayerById(r){return this.allSublayers.find(a=>a.id===r)}createServiceSublayers(){return this.createSublayersForOrigin("service").sublayers}createSublayersForOrigin(r){let a;const i=A(r==="web-document"?"web-map":r);let u=2,p=this.sublayersSourceJSON[2].layers,y=this.sublayersSourceJSON[2].context,d=null;const v=[3,4,5].filter(c=>c<=i);for(const c of v){const f=this.sublayersSourceJSON[c];He(f.layers)&&(u=c,p=f.layers,y=f.context,f.visibleLayers&&(d={visibleLayers:f.visibleLayers,context:f.context}))}const j=[3,4,5].filter(c=>c>u&&c<=i);let b=null;for(const c of j){const{layers:f,visibleLayers:L,context:F}=this.sublayersSourceJSON[c];f&&(b={layers:f,context:F},a??=c),L&&(d={visibleLayers:L,context:F})}const S=es(p,y),x=new Map,D=new Set;if(b)for(const c of b.layers)x.set(c.id,c);if(d?.visibleLayers)for(const c of d.visibleLayers)D.add(c);return le(S,c=>{b&&c.read(x.get(c.id),b.context),d&&c.read({defaultVisibility:D.has(c.id)},d.context)}),{origin:J(u),originWithPartialOverrides:a?J(a):null,sublayers:new _({items:S})}}read(r,a){super.read(r,a),this.readSublayers(r,a)}_handleSublayersChange(r,a){a&&(a.forEach(i=>{i.parent=null,i.layer=null}),this.removeHandles("sublayers-owner")),r&&(r.forEach(i=>{i.parent=this,i.layer=this}),this.addHandles([r.on("after-add",({item:i})=>{i.parent=this,i.layer=this}),r.on("after-remove",({item:i})=>{i.parent=null,i.layer=null})],"sublayers-owner"),this.type==="tile"&&this.addHandles(r.on("before-changes",i=>{I.getLogger("esri.layers.TileLayer").error(new h("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this})),i.preventDefault()}),"sublayers-owner"))}};return o([n({readOnly:!0})],t.prototype,"allSublayers",void 0),o([n({readOnly:!0,type:$.ofType(l)})],t.prototype,"serviceSublayers",void 0),o([n({value:null,type:_,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0),o([n({readOnly:!0})],t.prototype,"sublayersSourceJSON",void 0),o([n({type:_,json:{read:{source:"tables"}}})],t.prototype,"subtables",void 0),t=o([V("esri.layers.mixins.SublayersOwner")],t),t};export{qs as $,Es as E,l};
