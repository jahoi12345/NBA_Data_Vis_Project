import{Y as F}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{I as m,aK as b,a7 as h,Y as r,H as l,G as d}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{f}from"./Point-BfTTZoMu-DeJwQYfh.js";import{o as k}from"./Field-Cm_ZejYW-CwJZmSru.js";import{r as P}from"./locationUtils-BujNe57r-CEsJep6e.js";import{Z as q,H as v,J as x}from"./parquet-BvPtb2Qg-CVHFozQb.js";let p=class extends F(h){constructor(e){super(e),this.type=null}};r([l({type:["wkb","location"],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],p.prototype,"type",void 0),p=r([d("esri.layers.support.ParquetEncodingBase")],p);let a=class extends p{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};r([l({type:["location"]})],a.prototype,"type",void 0),r([l({type:String,json:{name:"yField",write:{isRequired:!0}}})],a.prototype,"latitudeFieldName",void 0),r([l({type:String,json:{name:"xField",write:{isRequired:!0}}})],a.prototype,"longitudeFieldName",void 0),a=r([d("esri.layers.support.ParquetEncodingLocation")],a);let u=class extends p{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};r([l({type:["wkb"]})],u.prototype,"type",void 0),r([l({type:["counter-clockwise"],json:{write:!0}})],u.prototype,"orientation",void 0),r([l({type:String,json:{name:"field",write:{isRequired:!0}}})],u.prototype,"primaryFieldName",void 0),u=r([d("esri.layers.support.ParquetEncodingWkb")],u);const g=new b({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function Y(e){return g.toJSON(e)}function Z(e){return g.fromJSON(e)}async function _(e,n={}){if(e.urls.length<1)throw new m("parquet:bad-input","At least one url must be specified",e);if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;const i=await q(e.urls.getItemAt(0),{getCustomParameters:()=>n.customParameters}),o=v(i),t={...e,file:i};t.fields==null&&(t.fields=i.fields().map(s=>k.fromJSON({name:s.name,alias:s.name,type:s.type}))),t.encoding==null&&(t.encoding=z(o,t.fields));const c=x(i);if(c)switch(c.mode){case"z":t.displayOptimization={mode:"z"};break;case"xz":{const s=c.multiscale;if(!s)throw new m("parquet:bad-format","XZ display optimization requires multiscale geometries");t.displayOptimization={mode:"xz",multiscale:s};break}}if(!t.encoding)return t;switch(t.encoding.type){case"location":t.spatialReference==null&&(t.spatialReference=f.WGS84),t.geometryType==null&&(t.geometryType="point");break;case"wkb":{if(!o)return t;const s=o.primary_column,y=o.columns[s];if(t.geometryType||(t.geometryType=S(y)),t.spatialReference||(t.spatialReference=G(y)),t.fields)for(const w of Object.keys(o.columns))t.fields=t.fields.filter(N=>N.name!==w)}}return t}function z(e,n){if(e!=null){const o=e.primary_column,t=e.columns[o];return new u({primaryFieldName:o,orientation:t.orientation==="counterclockwise"?"counter-clockwise":null})}const i=P(n.map(o=>o.name));return i.latitudeFieldName&&i.longitudeFieldName?new a({latitudeFieldName:i.latitudeFieldName,longitudeFieldName:i.longitudeFieldName}):null}function R(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}function S(e){const{geometry_types:n}=e,i=new Set;for(const o of n){const t=R(o);t&&i.add(t)}if(i.size>1)throw new m("parquet:unsupported","Parquet mixed geometry types are not supported",{geometryTypes:i});return i.size===1?i.values().next().value:void 0}function G(e){const n=e.crs?.id?.code;return n&&typeof n=="number"?new f({wkid:n}):void 0}export{Z as A,_ as L,Y as M,a,g,p,u};
