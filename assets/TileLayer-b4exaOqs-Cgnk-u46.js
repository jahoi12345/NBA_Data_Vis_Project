import{J as _,I as u,Y as o,H as a,K as S,G as T}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{f as v,I as b,H as c,A as w,p as O,g as $,d as R,_ as A,s as I}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{A as U}from"./loadAll-BCyxerwc-DK9uHnLK.js";import{k as W}from"./MultiOriginJSONSupport-Bd1TKmh_-BHNF5tHX.js";import{u as P}from"./reader-DcGs6kKN-DHJfK-tm.js";import{o as L}from"./Layer-DZvC7bne-m1cEC_yw.js";import{o as M}from"./APIKeyMixin--YGbad8e-DJ-JJTX5.js";import{w as j}from"./ArcGISCachedService-DdpDXeQC-CX5w9bM8.js";import{$ as C,E as D,l as N}from"./SublayersOwner-BDnxg7TB-DBdAiHYc.js";import{c as k}from"./ArcGISService-SIwch9bz-BD00xz4C.js";import{y as B}from"./BlendLayer-HE_aYHHW-CZa4IAJu.js";import{i as J}from"./CustomParametersMixin-Dshqz1Zp-BFC165kX.js";import{C as G,f as q}from"./OperationalLayer-B6zbJ5nR-sYdHUfAL.js";import{z as E}from"./PortalLayer-CbFNhtZ4-CCXE0v4V.js";import{O as H}from"./RefreshableLayer-CBbEkZf--CC_b3xaQ.js";import{s as K}from"./ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js";import{w as y}from"./imageBitmapUtils-BP4sA6iR-DQ78ujMy.js";import{s as V}from"./ElevationInfo-Cw2HaA6E-Br1RWTYu.js";import"./index-CTl7hdrJ.js";import"./asyncUtils-w6KfWU41-HenJ0UOu.js";import"./collectionUtils-jDyktm0P-ArdXNs6F.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./TileInfo-Bz7QlefV-tjhen9qQ.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./TilemapCache-CjhKW_vj-BYOTuKe8.js";import"./LRUCache-fy84PBMi-Y56WPIvD.js";import"./projectionUtils-BGH_5_I3-BySNUA-B.js";import"./Polyline-CoiTLswR-BLagWJLS.js";import"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./CollectionFlattener-D6h2Fkvj-qnUHjb1M.js";import"./getPopupProvider-CmskPttI-C4PqyuPF.js";import"./lengthUtils-Dt1_RvOO-bleznLOi.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./typeUtils-DqrRcjBx-ZWdHcSIJ.js";import"./GraphicOrigin-uE6TDXc9-DqbdmNAV.js";import"./QueryTask-DtLshCh_-BDkI4_Zx.js";import"./Query-BlS0WPDF-BdshFBMz.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./normalizeUtils-85zLqeMi-DCF9gKvo.js";import"./pbf-2SIhMekG-LK438LAR.js";import"./normalizeUtilsCommon-CnhQye_A-zWtr51r8.js";import"./FeatureSet-BF7daP96-BqhMUjXs.js";import"./Graphic-DgGzDmqW-CFzg0c4i.js";import"./typeUtils-CXW_VpOn-BoSnXkME.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-Vi0-2Gvc.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./Font-BwmnW7d2-D-oIm_Md.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./PictureMarkerSymbol-CaSh-vZk-BNpExnAb.js";import"./TextSymbol-hRGhyDHs-C0NgASym.js";import"./OrderedLayer-DQAUgUTV-CpnQmtbN.js";import"./featureLayerUtils-FKjLNPl_-DLktjSPx.js";import"./SimpleRenderer-CEmCWePp-xiwnMlto.js";import"./commonProperties-DbO613LF-DeJ_ZDUB.js";import"./colorRamps-DswZzxkO-BqSFavfl.js";import"./ColorStop-De5gQTjr-C1lw16u9.js";import"./visualVariableUtils-ma4r7Z2K-C4Gu8Tj6.js";import"./defaults3D-C2hXSee1-DVT6WkAf.js";import"./defaults-BDN9qxeN-CCVK4JpS.js";import"./UniqueValueRenderer-JPjz9Qvs-C1w5-GWR.js";import"./RendererLegendOptions-ByGHYLtx-C9PvCikc.js";import"./NormalizationBinParametersMixin-BK9wNkI3-BKYeOhDN.js";import"./FeatureType-CFJlAOcG-Dk8Ixr4n.js";import"./FeatureTemplate-Bur8tORn-iLlvjnYm.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./labelingInfo-BYG2hiVF-Dmkr19gA.js";import"./LayerFloorInfo-CTubHTci-DKf2wu5F.js";import"./Relationship-CrANqG2c-DztISWOP.js";import"./typeUtils-DDFS4uuz-Cx8qHFHN.js";import"./ClassBreaksRenderer-BvgdqtTq-DxMHNS7X.js";import"./vec42-B8VM4vXb-BnA9MysM.js";import"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./mat4-C96X-Nn0-Do6fKsNS.js";import"./PortalItem-DnxMlRVo-Dhq4alsp.js";import"./unitConversionUtils-4vB4Ezlp-B0eWR3Ls.js";import"./TileInfoTilemapCache-B40skWYU-CeKS3ZnT.js";import"./Version-BtYZEj58-LyRHDnSJ.js";import"./portalItemUtils-CaPNUJg6-JsqddoLx.js";import"./FieldsIndex-CimK-TqD-CrSnohIk.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./serviceCapabilitiesUtils-BV_pcUiO-CjqWUbfp.js";import"./infoFor3D-DhzudQro-CCYgWfsv.js";import"./utils-CylVuxNi-CqOfmBVG.js";import"./popupUtils-D4UavgYz-4fibcgIL.js";import"./sublayerUtils-BEQnBRaB-BKtQCtZt.js";import"./layerContainerType-CSXZNpHb-BIF7XAYP.js";import"./jsonUtils-CY6YsQMo-SliJcuqs.js";import"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./layerUtils-DZGhvm-W-DLw3QMll.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./TileKey-CXWFOqOI-CcilLir8.js";import"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./executeForIds-CuyQNBvQ-BEkKvDan.js";import"./query-DeNEvEsQ-piAD5C2I.js";import"./pbfQueryUtils-DlZBMNQk-B4EJfzeq.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./jsonUtils-CmpazY1u-ateEpj4Q.js";import"./queryZScale-CRP3Sh_E-0yf18ElE.js";import"./executeQueryJSON-DgYznOlB-DXG9oqHS.js";import"./featureConversionUtils-BDA_FXJx-CUwkrHf5.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import"./utils-Dpg4yj1D-BVnuoMV8.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./featureQueryAll-BfDWA5Wx-ZgjJqs6l.js";import"./jsonUtils-C9q_FK4K-Cuz7ImzI.js";import"./defaultsJSON-GKolV7NZ-GKolV7NZ.js";import"./diffUtils-wTC1YzlE-JuqUWoWa.js";import"./styleUtils-DWvicjTN-DYvOM9HS.js";import"./labelUtils-BtizwBfq-Zegx4520.js";import"./DictionaryScriptEvaluator-G73uSGpN-Cn2sp0hZ.js";import"./ArcadeExpression-BlIRq-oN-DGzfhzBj.js";import"./TimeOnly-BERR31kg-PKcKegNB.js";import"./enum-BzLwmiID-CcyIdWlQ.js";import"./utils-DX2muIr3-DiPfFKSl.js";import"./heatmapUtils-B-AXnq0l-G7fD8L97.js";var d;const f=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];let i=d=class extends B(K(C(j(D(G(E(k(W(H(M(J(L)))))))))))){constructor(...e){super(...e),this.listMode="show",this.elevationInfo=new V({mode:"on-the-ground"}),this.isReference=null,this.operationalLayerType="ArcGISTiledMapServiceLayer",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type="tile",this.url=null}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(_).then(()=>this._fetchService(r))),Promise.resolve(this)}get attributionDataUrl(){const e=this.parsedUrl?.path.toLowerCase();return e?this._getDefaultAttribution(this._getMapName(e)):null}get hasAttributionData(){return super.hasAttributionData}readSpatialReference(e,r){return(e=e||r.tileInfo?.spatialReference)&&v.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const l=e.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).toArray(),p=[],m={writeSublayerStructure:!1,...s};l.forEach(n=>{const h=n.write({},m);p.push(h)}),p.some(n=>Object.keys(n).length>1)&&(r.layers=p)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl?.path)}castTileServers(e){return Array.isArray(e)?e.map(r=>b(r).path):null}fetchTile(e,r,t,s={}){const{signal:l}=s,p=this.getTileUrl(e,r,t),m={responseType:"image",signal:l,query:{...this.refreshParameters}};return c(p,m).then(n=>n.data)}async fetchImageBitmapTile(e,r,t,s={}){const{signal:l}=s;if(this.fetchTile!==d.prototype.fetchTile){const h=await this.fetchTile(e,r,t,s);return y(h,e,r,t,l)}const p=this.getTileUrl(e,r,t),m={responseType:"blob",signal:l,query:{...this.refreshParameters}},{data:n}=await c(p,m);return y(n,e,r,t,l)}getTileUrl(e,r,t){const s=!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile,l=w({...this.parsedUrl?.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),p=this.tileServers;return`${p&&p.length?p[r%p.length]:this.parsedUrl?.path}/tile/${e}/${r}/${t}${l?"?"+l:""}`}loadAll(){return U(this,e=>{e(this.allSublayers)})}_fetchService(e){return new Promise((r,t)=>{if(this.sourceJSON){if(this.sourceJSON.bandCount!=null&&this.sourceJSON.pixelSizeX!=null)throw new u("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");return void r({data:this.sourceJSON})}if(!this.parsedUrl)throw new u("tile-layer:undefined-url","layer's url is not defined");const s=O(this.parsedUrl.path);if(s!=null&&s.serverType==="ImageServer")throw new u("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r,t)}).then(r=>{let t=this.url;if(r.ssl&&(t=this.url=t.replace(/^http:/i,"https:")),this.sourceJSON=r.data,this.read(r.data,{origin:"service",url:this.parsedUrl}),this.version===10.1&&!$(t))return this._fetchServerVersion(t,e).then(s=>{this.read({currentVersion:s})}).catch(()=>{})})}_fetchServerVersion(e,r){if(!R(e))return Promise.reject();const t=e.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return c(t,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:r}).then(s=>{if(s.data?.currentVersion)return s.data.currentVersion;throw new u("tile-layer:version-not-available","Server did not provide a version")})}_getMapName(e){const r=e.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/mapserver/i);return r?r[2]:void 0}_getDefaultAttribution(e){if(e==null)return null;let r;e=e.toLowerCase();for(let t=0,s=f.length;t<s;t++)if(r=f[t],r.toLowerCase().includes(e))return A("//static.arcgis.com/attribution/"+r);return null}_getDefaultTileServers(e){if(e==null)return[];const r=e.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i)!==-1,t=e.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i)!==-1;return r||t?[e,e.replace(r?/server\.arcgisonline/i:/services\.arcgisonline/i,r?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile[g]}};o([a({readOnly:!0})],i.prototype,"attributionDataUrl",null),o([a({type:["show","hide","hide-children"]})],i.prototype,"listMode",void 0),o([a({json:{read:!0,write:!0}})],i.prototype,"blendMode",void 0),o([a()],i.prototype,"elevationInfo",void 0),o([a({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],i.prototype,"isReference",void 0),o([a({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],i.prototype,"operationalLayerType",void 0),o([a({type:Boolean})],i.prototype,"resampling",void 0),o([a()],i.prototype,"sourceJSON",void 0),o([a({type:v})],i.prototype,"spatialReference",void 0),o([P("spatialReference",["spatialReference","tileInfo"])],i.prototype,"readSpatialReference",null),o([a({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],i.prototype,"path",void 0),o([a({readOnly:!0})],i.prototype,"sublayers",void 0),o([S("sublayers",{layers:{type:[N]}})],i.prototype,"writeSublayers",null),o([a({json:{read:!1,write:!1}})],i.prototype,"popupEnabled",void 0),o([a()],i.prototype,"tileServers",null),o([I("tileServers")],i.prototype,"castTileServers",null),o([a({readOnly:!0,json:{read:!1}})],i.prototype,"type",void 0),o([a(q)],i.prototype,"url",void 0),i=d=o([T("esri.layers.TileLayer")],i);const g=Symbol("default-fetch-tile");i.prototype.fetchTile[g]=!0;const ht=i;export{ht as default};
