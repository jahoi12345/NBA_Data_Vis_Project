const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/projectOperator-CFFr8mgh-EQbqEAcS.js","assets/index-B0z_nLWi.js","assets/index-Cv2ko1Ob.css","assets/operatorProject-Bdt6eBEq--TZLvI50.js","assets/SimpleGeometryCursor-B92kdZ15-B1Z6elF7.js","assets/Point-BfTTZoMu-DeJwQYfh.js","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/reader-DcGs6kKN-DHJfK-tm.js","assets/geographicTransformationUtils-B7SH_2kC-tQ6lG0RS.js","assets/projectionUtils-BGH_5_I3-DGwchVO8.js","assets/SimpleObservable-CvFyr0NA-DXpoMYph.js","assets/collectionUtils-jDyktm0P-BDP2Oq99.js","assets/reactiveUtils-SO2Ko3sy-BCLX8Jdy.js","assets/Extent-CgDMOSRD-Bod5LY6s.js","assets/Polyline-CoiTLswR-DTxpB2Yg.js","assets/Polygon-D6wEPb3W-D2MPjRU4.js","assets/aaBoundingRect-CjwcS2F3-ri8bmh30.js","assets/mathUtils-PIGhLnI9-B1tKUlUb.js"])))=>i.map(i=>d[i]);
import{H as re,_ as ie}from"./index-B0z_nLWi.js";import{e as _e,ab as Se,I as me}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{b as k,F as C,a9 as j,aa as T,f as Ee,ab as ke,a8 as Ge,ac as ae,ad as Te}from"./Point-BfTTZoMu-DeJwQYfh.js";import{z as W}from"./Extent-CgDMOSRD-Bod5LY6s.js";import{P as Q}from"./Polygon-D6wEPb3W-D2MPjRU4.js";import{Q as je}from"./projectionUtils-BGH_5_I3-DGwchVO8.js";const Z=(e,n=Z,s=n.f||(n.f=["assets/projectOperator-CFFr8mgh.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css","assets/operatorProject-Bdt6eBEq.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/Point-BfTTZoMu.js","assets/jsonMap-Bs3hmeCU.js","assets/reader-DcGs6kKN.js","assets/geographicTransformationUtils-B7SH_2kC.js","assets/projectionUtils-BGH_5_I3.js","assets/SimpleObservable-CvFyr0NA.js","assets/collectionUtils-jDyktm0P.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-CgDMOSRD.js","assets/Polyline-CoiTLswR.js","assets/Polygon-D6wEPb3W.js","assets/aaBoundingRect-CjwcS2F3.js","assets/mathUtils-PIGhLnI9.js"]))=>e.map(o=>s[o]);function O(){if(!ee)throw new me("rasterprojectionhelper-project","projection operator is not loaded")}const le=(e,n,s,o=0)=>{if(s[0]===1)return[0,0];let i=1,t=-1,r=1,c=-1;for(let u=0;u<e.length;u+=2)isNaN(e[u])||(i=i>e[u]?e[u]:i,t=t>e[u]?t:e[u],r=r>e[u+1]?e[u+1]:r,c=c>e[u+1]?c:e[u+1]);const{cols:l,rows:a}=n,f=(t-i)/l/s[0],d=(c-r)/a/s[1],m=2*o;let h=0,x=!1,y=[0,0];for(let u=0;u<l-3;u++){for(let R=0;R<a-3;R++){const g=u*a*2+2*R,p=(e[g]+e[g+4]+e[g+4*a]+e[g+4*a+4])/4,w=(e[g+1]+e[g+5]+e[g+4*a+1]+e[g+4*a+5])/4,M=Math.abs((p-e[g+2*a+2])/f),P=Math.abs((w-e[g+2*a+3])/d);if(M+P>h&&(h=M+P,y=[M,P]),m&&h>m){x=!0;break}}if(x)break}return y},Ne={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},F=32,q=4,H=q,J=new Map,K=new Map,U=500,Ce=39.37,ve=96;let B,E,I,ee=!1;async function Xe(){return B||(B=Se(),E=await re(()=>ie(()=>import("./projectOperator-CFFr8mgh-EQbqEAcS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),Z([0,1,2,3,4,5,6,7])),I=await re(()=>ie(()=>import("./geographicTransformationUtils-B7SH_2kC-tQ6lG0RS.js"),__vite__mapDeps([8,1,2,5,6,7,9,10,11,12,13,14,15,16,17])),Z([8,1,2,5,6,7,9,10,11,12,13,14,15,16,17])),E.isLoaded()||await E.load(),I.isLoaded()||await I.load(),ee=!0,B.resolve()),B.promise}function Oe(e,n,s){if(O(),s){const o=E.execute(e,n);return I.getTransformation(n,e.spatialReference,o)}return I.getTransformation(e.spatialReference,n,e)}function Qe(e,n,s,o){const i=e.spatialReference;if(!i||!n||i.equals(n))return e;O();const t=s.center,r=new W({xmin:t.x-e.x/2,xmax:t.x+e.x/2,ymin:t.y-e.y/2,ymax:t.y+e.y/2,spatialReference:i}),c=E.execute(r,n,{geographicTransformation:o}),l=N(n);return c==null||l!=null&&c.width>=l?A(e,i,n):{x:c.width,y:c.height}}function A(e,n,s){const o=C(n)/C(s);return{x:e.x*o,y:e.y*o}}function Le(e,n,s){const{spatialReference:o}=s;if(!o||!n||o.equals(n))return e;if(o.isGeographic&&n.isGeographic)return A(e,o,n);if(O(),!ee)throw new me("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:i,y:t}=e;const r=(i+t)/2*C(o);let c=1;r>30&&(c=30/r,i*=c,t*=c);const l=256,a=i*l/2,f=t*l/2,{x:d,y:m}=s.center,h=[];for(let b=0;b<=l;b++)h.push([d-a,m-f+b*t]);for(let b=1;b<=l;b++)h.push([d-a+b*i,m+f]);for(let b=1;b<=l;b++)h.push([d+a,m+f-b*t]);for(let b=1;b<l;b++)h.push([d+a-b*i,m-f]);h.push(h[0]);const x=new Q({rings:[h],spatialReference:o}),y=E.execute(x,n);if(!y)return A(e,o,n);const u=y.extent,R=N(n);if(u==null||R!=null&&u.width>=R)return A(e,o,n);const g=De(y.rings),p=i*t*l*l,w=Math.sqrt(g/p)/c,M={x:u.width/c/l,y:u.height/c/l},P={x:i*w,y:t*w},G=M.x*M.y;return Math.abs(G-P.x*P.y)/G<.1?M:P}function ze(e,n){return(typeof e=="number"?e:(e.x+e.y)/2)*C(n)*ve*Ce}function en(e,n){const{pixelSize:s,extent:o}=e;return ze(Le(s,n,o),n)}function S(e,n=.01){return C(e)?n/C(e):0}function ce(e,n,s,o=!0){const i=e.spatialReference;if(i.equals(n))return e;O();const t=E.execute(e,n,{geographicTransformation:s});return o&&t&&he([e],[t],i,n),t}function he(e,n,s,o){const i=Y(s,!0),t=Y(o,!0),r=S(s,U),c=S(o,U);if(r&&i!=null&&t!=null)for(let l=0;l<e.length;l++){const a=n[l];if(!a)continue;const{x:f}=e[l],{x:d}=a;d>=t[1]-c&&Math.abs(f-i[0])<r?a.x-=t[1]-t[0]:d<=t[0]+c&&Math.abs(f-i[1])<r&&(a.x+=t[1]-t[0])}}function Ie(e){const{inSR:n,outSR:s,preferPE:o}=e;if(n.equals(s)){const{points:i}=ne(e,null);return i}return n.isWebMercator&&s.isWGS84||n.isWGS84&&s.isWebMercator?Ae(e):o&&(n.isGeographic||v(n)!=null)?Be(e):We(e)}function We(e){const{points:n}=ne(e,null),{inSR:s,outSR:o,datumTransformation:i}=e,t=n.map(c=>new k(c[0],c[1],s)),r=E.executeMany(t,o,{geographicTransformation:i});return i&&he(t,r,s,o),r.map(c=>c?[c.x,c.y]:[NaN,NaN])}function Be(e){const{inSR:n,outSR:s,datumTransformation:o}=e,i=v(n),{points:t,mask:r}=ne(e,i);if(!n.isGeographic){const l=n.wkid?j.coordsys(n.wkid):j.fromString(n.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,n.wkt2||n.wkt);ae.projToGeog(l,t.length,t)}if(o!=null&&o.steps.length){let l;if(s.isGeographic&&(l=t.map(([a])=>a>179.9955?1:a<-179.9955?-1:0)),o.steps.forEach(a=>{const f=a.wkid?j.geogtran(a.wkid):j.fromString(T.PE_TYPE_GEOGTRAN,a.wkt);Te.geogToGeog(f,t.length,t,null,a.isInverse?T.PE_TRANSFORM_2_TO_1:T.PE_TRANSFORM_1_TO_2)}),l)for(let a=0;a<t.length;a++){const f=l[a],d=t[a][0],m=d>179.9955?1:d<-179.9955?-1:0;f&&m&&f!==m&&(t[a][0]=f>0?d+360:d-360)}}if(!s.isGeographic){const l=v(s,!0),a=l!=null&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90];Fe(t,a);const f=s.wkid?j.coordsys(s.wkid):j.fromString(s.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,s.wkt2||s.wkt);ae.geogToProj(f,t.length,t)}let c=t;if(r&&t.length!==r.length){c=[];for(let l=0,a=0;l<r.length;l++)r[l]?c.push(t[a++]):c.push([NaN,NaN])}return c}function Ae(e){const{cols:n,rows:s,xres:o,yres:i,usePixelCenter:t,inSR:r,outSR:c}=e;let{xmin:l,ymax:a}=e;t&&(l+=o/2,a-=i/2);const f=[],d=[],m=Math.max(n,s);for(let x=0;x<m;x++){const y=l+o*Math.min(n,x),u=a-i*Math.min(s,x),R=je(new k({x:y,y:u,spatialReference:r}),r,c);x<=n&&f.push(R.x),x<=s&&d.push(R.y)}const h=[];for(let x=0;x<n;x++)for(let y=0;y<s;y++)h.push([f[x],d[y]]);return h}function v(e,n=!1){let s=e.wkid||e.wkt2||e.wkt;if(!s||e.isGeographic)return null;if(s=String(s),J.has(s)){const r=J.get(s);return n?r?.gcs:r?.pcs}const o=e.wkid?j.coordsys(e.wkid):j.fromString(e.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,e.wkt2||e.wkt),i=fe(o,S(e,1e-4)),t=fe(o,0,!0);return J.set(s,{pcs:i,gcs:t}),n?t:i}function fe(e,n=0,s=!1){const o=ke.generate(e),i=s?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!o||!i?.length)return null;let t=!1,r=i.find(u=>u.getInclusive()===1&&u.getKind()===1);if(!r){if(r=i.find(u=>u.getInclusive()===1&&u.getKind()===0),!r)return null;t=!0}const c=s?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),l=o.isPannableRectangle(),a=r.getCoord();if(t)return{isEnvelope:t,isPannable:l,vertices:a,coef:null,bbox:[a[0][0]-n,a[0][1]-n,a[1][0]+n,a[1][1]+n],poleLocation:c};let f=0;const d=[];let[m,h]=a[0],[x,y]=a[0];for(let u=0,R=a.length;u<R;u++){f++,f===R&&(f=0);const[g,p]=a[u],[w,M]=a[f];if(M===p)d.push([g,w,p,M,2]);else{const P=(w-g)/(M-p||1e-4),G=g-P*p;p<M?d.push([P,G,p,M,0]):d.push([P,G,M,p,1])}m=m<g?m:g,h=h<p?h:p,x=x>g?x:g,y=y>p?y:p}return{isEnvelope:!1,isPannable:l,vertices:a,coef:d,bbox:[m,h,x,y],poleLocation:c}}function ne(e,n){const s=[],{cols:o,rows:i,xres:t,yres:r,usePixelCenter:c}=e;let{xmin:l,ymax:a}=e;if(c&&(l+=t/2,a-=r/2),n==null){for(let h=0;h<o;h++)for(let x=0;x<i;x++)s.push([l+t*h,a-r*x]);return{points:s}}const f=new Uint8Array(o*i);if(n.isEnvelope){const{bbox:[h,x,y,u]}=n;for(let R=0,g=0;R<o;R++){const p=l+t*R,w=n.isPannable||p>=h&&p<=y;for(let M=0;M<i;M++,g++){const P=a-r*M;w&&P>=x&&P<=u&&(s.push([p,P]),f[g]=1)}}return{points:s,mask:f}}const d=n.coef,m=[];for(let h=0;h<i;h++){const x=a-r*h,y=[],u=[];for(let g=0;g<d.length;g++){const[p,w,M,P,G]=d[g];if(x===M&&M===P)y.push(p),y.push(w),u.push(2),u.push(2);else if(x>=M&&x<=P){const b=p*x+w;y.push(b),u.push(G)}}let R=y;if(y.length>2){let g=u[0]===2?0:u[0],p=y[0];R=[];for(let w=1;w<u.length;w++)u[w]===2&&w!==u.length-1||(u[w]!==g&&(R.push(g===0?Math.min(p,y[w-1]):Math.max(p,y[w-1])),g=u[w],p=y[w]),w===u.length-1&&R.push(u[w]===0?Math.min(p,y[w]):Math.max(p,y[w])));R.sort((w,M)=>w-M)}else y[0]>y[1]&&(R=[y[1],y[0]]);m.push(R)}for(let h=0,x=0;h<o;h++){const y=l+t*h;for(let u=0;u<i;u++,x++){const R=a-r*u,g=m[u];if(g.length===2)y>=g[0]&&y<=g[1]&&(s.push([y,R]),f[x]=1);else if(g.length>2){let p=!1;for(let w=0;w<g.length;w+=2)if(y>=g[w]&&y<=g[w+1]){p=!0;break}p&&(s.push([y,R]),f[x]=1)}}}return{points:s,mask:f}}function Fe(e,n){const[s,o]=n;for(let i=0;i<e.length;i++){const t=e[i][1];(t<s||t>o)&&(e[i]=[NaN,NaN])}}function pe(e,n){const s=N(e[0].spatialReference);if(e.length<2||s==null||(n=n??S(e[0].spatialReference),(e=e.filter(c=>c.width>n)).length===1))return e[0];let{xmin:o,xmax:i,ymin:t,ymax:r}=e[0];for(let c=1;c<e.length;c++){const l=e[c];i=l.xmax+s*c,t=Math.min(t,l.ymin),r=Math.max(r,l.ymax)}return new W({xmin:o,xmax:i,ymin:t,ymax:r,spatialReference:e[0].spatialReference})}function ge(e,n,s=null,o=!0){const i=e.spatialReference;if(i.equals(n)||!n)return e;const t=ye(e),r=N(i,!0),c=N(n);if(t===0||r==null||c==null){const f=X(e,n,s,o);if(f&&r==null&&c!=null&&Math.abs(f.width-c)<S(n)&&E.isLoaded()){const d=v(i);if(d!=null&&d.poleLocation===0&&e.width<(d.bbox[2]-d.bbox[0])/2)return qe(e,n)||f}return f}const l=e.clone().normalize();if(l.length===1&&e.xmax<r&&e.xmax-r/2>S(i)){const{xmin:f,xmax:d}=e;for(let m=0;m<=t;m++){const h=m===0?f:-r/2,x=m===t?d-r*m:r/2;l[m]=new W({xmin:h,xmax:x,ymin:e.ymin,ymax:e.ymax,spatialReference:i})}}const a=l.map(f=>X(f,n,s,o)).filter(_e);return a.length===0?null:pe(a)}function nn(e,n,s){if(e.type==="extent"){const{xmin:o,ymin:i,xmax:t,ymax:r,spatialReference:c}=e;e=new Q({rings:[[[o,r],[t,r],[t,i],[o,i],[o,r]]],spatialReference:c})}return e.spatialReference.equals(n)?e:(O(),E.execute(e,n,{geographicTransformation:s}))}function qe(e,n){const s=N(n);if(s==null)return null;let{xmin:o,ymin:i,xmax:t,ymax:r}=e;const c=e.spatialReference,l=new Q({spatialReference:c,rings:[[[o,i],[t,i],[t,r],[o,r],[o,i]]]}),a=E.execute(l,n);if(a.rings.length!==2||!a.rings[0].length||!a.rings[1].length)return null;const{rings:f}=a,d=S(c),m=new W({spatialReference:n});for(let h=0;h<2;h++){o=t=f[h][0][0],i=r=f[h][0][1];for(let x=0;x<f[h].length;x++)o=o>f[h][x][0]?f[h][x][0]:o,t=t<f[h][x][0]?f[h][x][0]:t,i=i>f[h][x][1]?f[h][x][1]:i,r=r<f[h][x][1]?f[h][x][1]:r;if(h===0)m.ymin=i,m.ymax=r,m.xmin=o,m.xmax=t;else if(m.ymin=Math.min(m.ymin,i),m.ymax=Math.max(m.ymax,r),Math.abs(t-s/2)<d)m.xmin=o,m.xmax=m.xmax+s;else{if(!(Math.abs(o+s/2)<d))return null;m.xmax=t+s}}return m}function X(e,n,s,o=!0,i=!0){const t=e.spatialReference;if(t.equals(n)||!n)return e;O();const r=E.execute(e,n,{geographicTransformation:s});if(i&&n.isWebMercator&&r&&(r.ymax=Math.min(20037508342787e-6,r.ymax),r.ymin=Math.max(-20037508342787e-6,r.ymin),r.ymin>=r.ymax))return null;if(!o||!r)return r;const c=Y(t,!0),l=Y(n,!0);if(c==null||l==null)return r;const a=S(t,.001),f=S(t,U),d=S(n,.001);if(Math.abs(r.xmin-l[0])<d&&Math.abs(r.xmax-l[1])<d){const m=Math.abs(e.xmin-c[0]),h=Math.abs(c[1]-e.xmax);if(m<a&&h>f){r.xmin=l[0];const x=[];x.push(new k(e.xmax,e.ymin,t)),x.push(new k(e.xmax,(e.ymin+e.ymax)/2,t)),x.push(new k(e.xmax,e.ymax,t));const y=x.map(u=>ce(u,n,s)).filter(u=>!isNaN(u?.x)).map(u=>u.x);r.xmax=Math.max.apply(null,y)}if(h<a&&m>f){r.xmax=l[1];const x=[];x.push(new k(e.xmin,e.ymin,t)),x.push(new k(e.xmin,(e.ymin+e.ymax)/2,t)),x.push(new k(e.xmin,e.ymax,t));const y=x.map(u=>ce(u,n,s)).filter(u=>!isNaN(u?.x)).map(u=>u.x);r.xmin=Math.min.apply(null,y)}}else{const m=S(n,.001);Math.abs(r.xmin-l[0])<m&&(r.xmin=l[0]),Math.abs(r.xmax-l[1])<m&&(r.xmax=l[1])}return r}function N(e,n=!1){if(!e)return null;const s=n?20037508342787e-6:20037508342788905e-9;return e.isWebMercator?2*s:e.wkid&&e.isGeographic?360:2*Ne[e.wkid]||null}function Y(e,n=!1){if(e.isGeographic)return[-180,180];const s=N(e,n);return s!=null?[-s/2,s/2]:null}function ue(e,n,s,o){let i=(e-n)/s;return i-Math.floor(i)!==0?i=Math.floor(i):o&&(i-=1),i}function ye(e,n=!1){const s=N(e.spatialReference);if(s==null)return 0;const o=n?0:-(s/2),i=S(e.spatialReference),t=!n&&Math.abs(e.xmax-s/2)<i?s/2:e.xmax,r=!n&&Math.abs(e.xmin+s/2)<i?-s/2:e.xmin;return ue(t,o,s,!0)-ue(r,o,s,!1)}function tn(e){const n=e.storageInfo.origin.x,s=N(e.spatialReference,!0);if(s==null)return{originX:n,halfWorldWidth:null,pyramidsInfo:null};const o=s/2,{nativePixelSize:i,storageInfo:t,extent:r}=e,{maximumPyramidLevel:c,blockWidth:l,pyramidScalingFactor:a}=t;let f=i.x;const d=[],m=e.transform!=null&&e.transform.type==="gcs-shift",h=n+(m?0:o),x=m?s-n:o-n;for(let y=0;y<=c;y++){const u=(r.xmax-n)/f/l,R=u-Math.floor(u)===0?u:Math.ceil(u),g=x/f/l,p=g-Math.floor(g)===0?g:Math.ceil(g),w=Math.floor(h/f/l),M=Math.round(h/f)%l,P=(l-Math.round(x/f)%l)%l;d.push({resolutionX:f,blockWidth:l,datasetColumnCount:R,worldColumnCountFromOrigin:p,leftMargin:M,rightPadding:P,originColumnOffset:w}),f*=a}return{originX:n,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:m}}function Ue(e){if(!e||e.isGeographic)return e;const n=String(e.wkid||e.wkt2||e.wkt);let s;return K.has(n)?s=K.get(n):(s=(e.wkid?j.coordsys(e.wkid):j.fromString(T.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),K.set(n,s)),new Ee({wkid:s})}function sn(e){const n=e.isAdaptive&&e.spacing==null;let s=e.spacing||[F,F],o=V(e),i={cols:o.size[0]+1,rows:o.size[1]+1};const t=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let r=o.outofBoundPointCount===o.offsets.length/2||n&&t?[0,0]:le(o.offsets,i,s,H);const c=(r[0]+r[1])/2,l=e.projectedExtent.spatialReference,a=e.srcBufferExtent.spatialReference;if(n&&(t||c>H)&&(l.isGeographic||v(l),s=[q,q],o=V({...e,spacing:s}),i={cols:o.size[0]+1,rows:o.size[1]+1},r=le(o.offsets,i,s,H)),o.error=r,s[0]>1&&(o.coefficients=xe(o.offsets,i,t)),e.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(a.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:s};else{const f=v(l);if(f!=null&&!f.isEnvelope){const d=Ue(l),m=ge(e.projectedExtent,d),{offsets:h}=V({...e,srcBufferExtent:m,spacing:s}),x=xe(h,i,t);o.gcsGrid={offsets:h,coefficients:x,spacing:s}}}return o}function V(e){const{projectedExtent:n,srcBufferExtent:s,pixelSize:o,datumTransformation:i,rasterTransform:t}=e,r=n.spatialReference,c=s.spatialReference;O();const{xmin:l,ymin:a,xmax:f,ymax:d}=n,m=N(c),h=m!=null&&(e.hasWrapAround||t?.type==="gcs-shift"),x=e.spacing||[F,F],y=x[0]*o.x,u=x[1]*o.y,R=x[0]===1,g=Math.ceil((f-l)/y-.1/x[0])+(R?0:1),p=Math.ceil((d-a)/u-.1/x[1])+(R?0:1),w=Ie({cols:g,rows:p,xmin:l,ymax:d,xres:y,yres:u,inSR:r,outSR:c,datumTransformation:i,preferPE:x[0]<=q,usePixelCenter:R}),M=[];let P,G=0;const b=R?-1:NaN,{xmin:te,xmax:D,ymax:de,width:we,height:Me}=s,Re=S(c,U),Pe=m!=null&&te>0&&D>m/2,se=v(r),be=se!=null&&se.poleLocation>0;for(let L=0;L<g;L++){const $=[];for(let z=0;z<p;z++){let _=w[L*p+z];if(h&&_[0]>D&&_[0]>m/2-Re?_[0]-=m:h&&L===0&&_[0]<0&&Pe&&!t&&(_[0]+=m),!_||isNaN(_[0])||isNaN(_[1]))M.push(b),M.push(b),$.push(null),G++;else{if(t){const oe=t.inverseTransform(new k({x:_[0],y:_[1],spatialReference:c}));_=[oe.x,oe.y]}$.push(_),L>0&&h&&P[z]&&_[0]<P[z][0]&&(_[0]+=m,be&&_[0]>D&&_[0]>m&&(_[0]-=m)),M.push((_[0]-te)/we),M.push((de-_[1])/Me)}}P=$}return{offsets:M,error:null,coefficients:null,outofBoundPointCount:G,spacing:x,size:R?[g,p]:[g-1,p-1]}}function xe(e,n,s){const{cols:o,rows:i}=n,t=new Float32Array((o-1)*(i-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),c=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<o-1;l++){for(let a=0;a<i-1;a++){let f=l*i*2+2*a;const d=e[f],m=e[f+1],h=e[f+2],x=e[f+3];f+=2*i;const y=e[f],u=e[f+1],R=e[f+2],g=e[f+3];let p=0,w=12*(a*(o-1)+l);for(let M=0;M<3;M++)t[w++]=r[p++]*d+r[p++]*h+r[p++]*R;p=0;for(let M=0;M<3;M++)t[w++]=r[p++]*m+r[p++]*x+r[p++]*g;p=0;for(let M=0;M<3;M++)t[w++]=c[p++]*d+c[p++]*y+c[p++]*R;p=0;for(let M=0;M<3;M++)t[w++]=c[p++]*m+c[p++]*u+c[p++]*g}if(s)for(let a=0;a<t.length;a++)isNaN(t[a])&&(t[a]=-1)}return t}function Ye(e,n){const s=e.clone().normalize();return s.length===1?s[0]:pe(s,n)}function on(e){const{spatialReference:n}=e,s=Ge(n);if(!s)return e;const[o,i]=s.valid,t=i-o;let r=0;if(e.xmin<o){const c=o-e.xmin;r=Math.ceil(c/t)}else if(e.xmin>i){const c=e.xmin-i;r=-Math.ceil(c/t)}return new W({spatialReference:e.spatialReference,xmin:e.xmin+r*t,ymin:e.ymin,xmax:e.xmax+r*t,ymax:e.ymax})}function rn(e,n,s){const{storageInfo:o,pixelSize:i}=n;let t=0,r=!1;const{pyramidResolutions:c}=o,l=o.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,a=(e.x+e.y)/2/l;if(c!=null&&c.length){const x=c[c.length-1],y=(x.x+x.y)/2,u=(i.x+i.y)/2;if(a<=u)t=0;else if(a>=y)t=c.length,r=a/y>8;else{let g,p=u;for(let w=1;w<=c.length;w++){if(g=(c[w-1].x+c[w-1].y)/2,a<=g){a===g?t=w:s==="down"?(t=w-1,r=a/p>8):t=s==="up"||a-p>g-a||a/p>2?w:w-1;break}p=g}}const R=t===0?i:c[t-1];return r&&Math.min(R.x,R.y)*C(n.spatialReference)>19567&&(r=!1),{pyramidLevel:t,pyramidResolution:new k({x:R.x,y:R.y,spatialReference:n.spatialReference}),excessiveReading:r}}const f=Math.log(e.x/i.x)/Math.LN2,d=Math.log(e.y/i.y)/Math.LN2,m=n.storageInfo.maximumPyramidLevel||0;t=s==="down"?Math.floor(Math.min(f,d)):s==="up"?Math.ceil(Math.max(f,d)):Math.round((f+d)/2),t<0?t=0:t>m&&(r=t>m+3,t=m);const h=2**t;return{pyramidLevel:t,pyramidResolution:new k({x:h*n.nativePixelSize.x,y:h*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:r}}function an(e,n,s=!1){const{pixelSize:o,extent:i}=e,t=Oe(i,n,!1),r=ge(Ye(i,(o.x+o.y)/16),n,t);return!r||s||ye(r)===0?r:X(i,n,t)}function De(e){let n=0;for(const s of e){const o=s.length;let i=s[0][0]*(s[1][1]-s[o-2][1]);for(let t=1;t<o-1;t++)i+=s[t][0]*(s[t+1][1]-s[t-1][1]);n+=i/2}return Math.abs(n)}export{en as H,Qe as U,Xe as V,nn as Z,ce as a,on as e,ye as g,sn as n,rn as o,ge as p,an as r,tn as t,N as v,Oe as z};
