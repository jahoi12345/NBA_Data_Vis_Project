const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CatalogLayer-ZciLBojT-Cmen6I0X.js","assets/index-B0z_nLWi.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/Point-BfTTZoMu-DeJwQYfh.js","assets/reader-DcGs6kKN-DHJfK-tm.js","assets/collectionUtils-jDyktm0P-BDP2Oq99.js","assets/reactiveUtils-SO2Ko3sy-BCLX8Jdy.js","assets/Extent-CgDMOSRD-Bod5LY6s.js","assets/SimpleObservable-CvFyr0NA-DXpoMYph.js","assets/MultiOriginJSONSupport-Bd1TKmh_-BHNF5tHX.js","assets/Layer-DZvC7bne-D3VLDrab.js","assets/date-IqUzANpt-bLKO9IDT.js","assets/LRUCache-fy84PBMi-Y56WPIvD.js","assets/ReactiveMap-B0by2bYu-DCsCfMj5.js","assets/signal-BX9ezF8a-cf1Pn6io.js","assets/BlendLayer-HE_aYHHW-D0es7Iiq.js","assets/layerContainerType-CSXZNpHb-BIF7XAYP.js","assets/jsonUtils-CY6YsQMo-LM0PY-PG.js","assets/Color-CERqXxxY-BuYn26eI.js","assets/mathUtils-PIGhLnI9-B1tKUlUb.js","assets/screenUtils-BitdhK1O-L0FLPAMi.js","assets/mat4f32-Djp3mnm5-DzYG3LYB.js","assets/mat4-C96X-Nn0-BrMLOLCb.js","assets/Polygon-D6wEPb3W-D2MPjRU4.js","assets/aaBoundingRect-CjwcS2F3-ri8bmh30.js","assets/ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js","assets/OperationalLayer-B6zbJ5nR-DyK_ztCk.js","assets/ElevationInfo-Cw2HaA6E-CuK5hJ96.js","assets/lengthUtils-Dt1_RvOO-j3MEdmHu.js","assets/unitConversionUtils-4vB4Ezlp-DnY5MDxd.js","assets/opacityUtils-DuFH0EC9-DWspTgn2.js","assets/OrderedLayer-DQAUgUTV-CpnQmtbN.js","assets/utils-BEeBypEk-DQLTC4jR.js","assets/ClassBreaksDefinition-BGOzyovZ-K0U0wKo_.js","assets/getPopupProvider-CmskPttI-CzUWpGwk.js","assets/FormTemplate-DuPZvaVv-DtJsNdqp.js","assets/Field-Cm_ZejYW-CwJZmSru.js","assets/fieldType-DVUzXtk_-tUuvnZJM.js","assets/Graphic-DgGzDmqW-d1CNicxz.js","assets/jsonUtils-CmpazY1u-6pDLj5sx.js","assets/Polyline-CoiTLswR-DTxpB2Yg.js","assets/typeUtils-DqrRcjBx-DZ6_Gsbu.js","assets/createFeatureId-CVwTD0fV-3fKpJDrk.js","assets/typeUtils-CXW_VpOn-BGgLp_TK.js","assets/lineMarkers-CDwLe3J6-CNUjJvs3.js","assets/PolygonSymbol3D-BXRHZiCQ-BjPAY2LA.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js","assets/aaBoundingBox-Cn49X7ge-BcYPaJ58.js","assets/DoubleArray-DExKNiTh-CvVpHySW.js","assets/mat4f64-q_b6UJoq-Dh6sWB_w.js","assets/Font-BwmnW7d2-Dwh3xjKw.js","assets/SimpleFillSymbol-CDawtd9z-CWD2KI2D.js","assets/SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js","assets/PictureMarkerSymbol-CaSh-vZk-xhjZ61bb.js","assets/TextSymbol-hRGhyDHs-CoS7dSjf.js","assets/GraphicOrigin-uE6TDXc9-DqbdmNAV.js","assets/FeatureEffectLayer-BG_KTtPw-C05GQDNc.js","assets/FeatureEffect-mVCOF1v6--fvFHZv2.js","assets/FeatureFilter-G4_pWMVe-D0hu4KAy.js","assets/Query-BlS0WPDF-jdXS_Qhy.js","assets/labelingInfo-BYG2hiVF-B7-dv03v.js","assets/labelUtils-BtizwBfq-Zegx4520.js","assets/layerUtils-DZGhvm-W-CfyHx1TZ.js","assets/defaults-BDN9qxeN-C-EfxQM4.js","assets/defaultsJSON-GKolV7NZ-GKolV7NZ.js","assets/jsonUtils-C9q_FK4K-GRCbm_Pe.js","assets/defaults3D-C2hXSee1-CTj29-Ly.js","assets/SimpleRenderer-CEmCWePp-BJ25mYcH.js","assets/commonProperties-DbO613LF-CHjBvYhj.js","assets/colorRamps-DswZzxkO-BqSFavfl.js","assets/ColorStop-De5gQTjr-C1lw16u9.js","assets/visualVariableUtils-ma4r7Z2K-Df6C3Hkh.js","assets/typeUtils-DDFS4uuz-B7KgP61w.js","assets/ClassBreaksRenderer-BvgdqtTq-D2fU8Sng.js","assets/RendererLegendOptions-ByGHYLtx-Bwoo6l33.js","assets/DictionaryScriptEvaluator-G73uSGpN-ErvAW-Hm.js","assets/Version-BtYZEj58-LyRHDnSJ.js","assets/FieldsIndex-CimK-TqD--24JoCkp.js","assets/UnknownTimeZone-B697BDFv-CBbtul7O.js","assets/timeZoneUtils-BSc7-7qA-BAv3h8mh.js","assets/ArcadeExpression-BlIRq-oN-VZkrwLVE.js","assets/TimeOnly-BERR31kg-CQiLyUZi.js","assets/enum-BzLwmiID-CcyIdWlQ.js","assets/utils-DX2muIr3-DiPfFKSl.js","assets/heatmapUtils-B-AXnq0l-BF3Q_jd2.js","assets/vec42-B8VM4vXb-B6OGOEI9.js","assets/vec4f64-DPb6J-GU-C7c2DqbZ.js","assets/UniqueValueRenderer-JPjz9Qvs-Duu1CubQ.js","assets/diffUtils-wTC1YzlE-DCTUTUs8.js","assets/styleUtils-DWvicjTN-DL6_BIk4.js","assets/popupUtils-D4UavgYz-DI7Mb3me.js","assets/FeatureLayerSource-BCS6pPRe-RSkKYiMw.js","assets/uuid-Oe6SV2kF-IYX19xBA.js","assets/MeshLocalVertexSpace-BGd1IdEs-C0HJG4wR.js","assets/meshVertexSpaceUtils-CtG7DPVT-kybwngCt.js","assets/vec32-CewSdTn3-VRto2OOh.js","assets/External-DqWxNHeL-BMl9kTYf.js","assets/infoFor3D-DhzudQro-CCYgWfsv.js","assets/projectionUtils-BGH_5_I3-DGwchVO8.js","assets/MeshTransform-Bl0zl104-SaBiGlTx.js","assets/quat-B7J5v7rV-CZ9akUv-.js","assets/quatf64-CCm9z-pX-CQ7_sSji.js","assets/axisAngleDegrees-CjbXmycq-DcVVDR1-.js","assets/editingSupport-DvBiDsO_-ChSwHhBh.js","assets/normalizeUtils-85zLqeMi-C1bdAKNn.js","assets/Cyclical-BLSxUpe7-Bj8R2Yk-.js","assets/normalizeUtilsCommon-CnhQye_A-UWhaH-kt.js","assets/utils-CylVuxNi--x86XOjU.js","assets/utils-Dpg4yj1D-CeFz2JVC.js","assets/EditBusLayer-rxUbWTiY-BxA39RQ7.js","assets/clientSideDefaults-3DdoYkYX-n_psRtPH.js","assets/QueryEngineCapabilities-DJC_YILC-CshvWf3J.js","assets/QueryTask-DtLshCh_-CZwCFWQz.js","assets/executeForIds-CuyQNBvQ-B6yiG3wW.js","assets/query-DeNEvEsQ-DfFlUyui.js","assets/pbfQueryUtils-DlZBMNQk-rXCy_evW.js","assets/pbf-2SIhMekG-LK438LAR.js","assets/memoryEstimations-Bd726a_p-0cVCY2Jz.js","assets/OptimizedFeature-CwRGZPwv-Ddclhn0A.js","assets/OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js","assets/queryZScale-CRP3Sh_E-F3y679Wx.js","assets/executeQueryJSON-DgYznOlB-CNRcR1CA.js","assets/FeatureSet-BF7daP96-B_JvMbY7.js","assets/featureConversionUtils-BDA_FXJx-CDxX1Wik.js","assets/featureLayerUtils-FKjLNPl_-Cv8vWd4i.js","assets/asyncUtils-w6KfWU41-HenJ0UOu.js","assets/featureQueryAll-BfDWA5Wx-BKksFkIA.js","assets/NormalizationBinParametersMixin-BK9wNkI3-BKYeOhDN.js","assets/editsZScale-D3N5iH_c-CCATcpvE.js","assets/APIKeyMixin--YGbad8e-DJ-JJTX5.js","assets/ArcGISService-SIwch9bz-DEFXc423.js","assets/CustomParametersMixin-Dshqz1Zp-BFC165kX.js","assets/DisplayFilteredLayer-DyjtPayS-DLMYIA49.js","assets/scaleUtils-yfx9kKWT-D9SVsyM-.js","assets/displayFilterUtils-CIXGrQzt-XEoxkZ3i.js","assets/FeatureLayerBase-BUeDgO3U-q6RnYMdc.js","assets/HeightModelInfo-D5IdRvJ2-23y6MRiu.js","assets/LayerFloorInfo-CTubHTci-DciGdwJt.js","assets/multiLayerServiceUtils-CpHWiXA7-HO_F3Kjq.js","assets/Relationship-CrANqG2c-DiHDOAEy.js","assets/serviceCapabilitiesUtils-BV_pcUiO-Dw-u7_oZ.js","assets/portalItemUtils-CaPNUJg6-CXDHI5LA.js","assets/PortalLayer-CbFNhtZ4-Doeialq-.js","assets/PortalItem-DnxMlRVo-CI4Ns2_M.js","assets/RefreshableLayer-CBbEkZf--DylHaNOC.js","assets/TemporalLayer-D4R0YvXo-PSBzKw25.js","assets/TimeInfo-D7ssmbZO-Burc-nDV.js","assets/FeatureType-CFJlAOcG-DepIzvPz.js","assets/FeatureTemplate-Bur8tORn-C24tlGMe.js","assets/fieldProperties-BoJj55FN-DI1Lssr9.js","assets/versionUtils-BfuZvWmP-RYMRQmOM.js","assets/FeatureLayer-BRWpcy_W-D7AhvLUt.js","assets/isFeatureGraphicOrigin-YA2hudPe-Bk2FjH_E.js","assets/workers-BEkgoq8Q-BM_Hz460.js","assets/Queue-CYlrXMwB-CYJTUII-.js","assets/intl-DRFqUect-DPhFaHB2.js","assets/FeatureReductionLayer-Bhh5MvS_-6_Dufsno.js","assets/FeatureReductionSelection-Du7o8OIG-DmruV-ou.js","assets/jsonUtils-BCGKNxno-DZ1Xr_O8.js","assets/MD5-MtSiOt06-jWr180Yc.js","assets/TrackableLayer-B-086Hm8-C0H4r_hG.js","assets/TitleCreator-BosRD8XX-Cm4g2hqp.js","assets/sanitizerUtils-BT_8V5US-CWQWUwZQ.js","assets/styleUtils-CZJC3pZm-BNE6B1Si.js","assets/OrientedImageryLayer-CHf2Vuve-CIJ6_VfZ.js"])))=>i.map(i=>d[i]);
import{H as C,_ as B}from"./index-B0z_nLWi.js";import{e as q,I as c,ar as J,a9 as Z}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{p as v}from"./originUtils-CPX8CCAY-UgTmEqwz.js";import{V as $,I as O,J as H,U as X,j as W,g as _,E as K,v as g,u as w}from"./utils-CwBq5UrM-BVXQXOAP.js";import{p as f}from"./Point-BfTTZoMu-DeJwQYfh.js";import{F as Q,O as ss}from"./fetchService-Bb67nyFD-BmjCOSQ9.js";import{V as es}from"./layerUtils-DZGhvm-W-CfyHx1TZ.js";import{u as ts}from"./jsonContext-C00-qqFg-CYWXvsTY.js";import{_ as F,T as y,A as u,a as as,y as rs}from"./portalItemUtils-CaPNUJg6-CXDHI5LA.js";import"./collectionUtils-jDyktm0P-BDP2Oq99.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./PortalItem-DnxMlRVo-CI4Ns2_M.js";import"./Layer-DZvC7bne-D3VLDrab.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./projectionUtils-BGH_5_I3-DGwchVO8.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw-DH8sdIsE.js";import"./saveUtils-BO8L-Vl8-DLYtj2dR.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";const h=(s,e=h,t=e.f||(e.f=["assets/CatalogLayer-ZciLBojT.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU.js","assets/Point-BfTTZoMu.js","assets/reader-DcGs6kKN.js","assets/collectionUtils-jDyktm0P.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-CgDMOSRD.js","assets/SimpleObservable-CvFyr0NA.js","assets/MultiOriginJSONSupport-Bd1TKmh_.js","assets/Layer-DZvC7bne.js","assets/date-IqUzANpt.js","assets/LRUCache-fy84PBMi.js","assets/ReactiveMap-B0by2bYu.js","assets/signal-BX9ezF8a.js","assets/BlendLayer-HE_aYHHW.js","assets/layerContainerType-CSXZNpHb.js","assets/jsonUtils-CY6YsQMo.js","assets/Color-CERqXxxY.js","assets/mathUtils-PIGhLnI9.js","assets/screenUtils-BitdhK1O.js","assets/mat4f32-Djp3mnm5.js","assets/mat4-C96X-Nn0.js","assets/Polygon-D6wEPb3W.js","assets/aaBoundingRect-CjwcS2F3.js","assets/ScaleRangeLayer-DQr2T3Hh.js","assets/OperationalLayer-B6zbJ5nR.js","assets/ElevationInfo-Cw2HaA6E.js","assets/lengthUtils-Dt1_RvOO.js","assets/unitConversionUtils-4vB4Ezlp.js","assets/opacityUtils-DuFH0EC9.js","assets/OrderedLayer-DQAUgUTV.js","assets/utils-BEeBypEk.js","assets/ClassBreaksDefinition-BGOzyovZ.js","assets/getPopupProvider-CmskPttI.js","assets/FormTemplate-DuPZvaVv.js","assets/Field-Cm_ZejYW.js","assets/fieldType-DVUzXtk_.js","assets/Graphic-DgGzDmqW.js","assets/jsonUtils-CmpazY1u.js","assets/Polyline-CoiTLswR.js","assets/typeUtils-DqrRcjBx.js","assets/createFeatureId-CVwTD0fV.js","assets/typeUtils-CXW_VpOn.js","assets/lineMarkers-CDwLe3J6.js","assets/PolygonSymbol3D-BXRHZiCQ.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x.js","assets/aaBoundingBox-Cn49X7ge.js","assets/DoubleArray-DExKNiTh.js","assets/mat4f64-q_b6UJoq.js","assets/Font-BwmnW7d2.js","assets/SimpleFillSymbol-CDawtd9z.js","assets/SimpleMarkerSymbol-BGAFRS9_.js","assets/PictureMarkerSymbol-CaSh-vZk.js","assets/TextSymbol-hRGhyDHs.js","assets/GraphicOrigin-uE6TDXc9.js","assets/FeatureEffectLayer-BG_KTtPw.js","assets/FeatureEffect-mVCOF1v6.js","assets/FeatureFilter-G4_pWMVe.js","assets/Query-BlS0WPDF.js","assets/labelingInfo-BYG2hiVF.js","assets/labelUtils-BtizwBfq.js","assets/layerUtils-DZGhvm-W.js","assets/defaults-BDN9qxeN.js","assets/defaultsJSON-GKolV7NZ.js","assets/jsonUtils-C9q_FK4K.js","assets/defaults3D-C2hXSee1.js","assets/SimpleRenderer-CEmCWePp.js","assets/commonProperties-DbO613LF.js","assets/colorRamps-DswZzxkO.js","assets/ColorStop-De5gQTjr.js","assets/visualVariableUtils-ma4r7Z2K.js","assets/typeUtils-DDFS4uuz.js","assets/ClassBreaksRenderer-BvgdqtTq.js","assets/RendererLegendOptions-ByGHYLtx.js","assets/DictionaryScriptEvaluator-G73uSGpN.js","assets/Version-BtYZEj58.js","assets/FieldsIndex-CimK-TqD.js","assets/UnknownTimeZone-B697BDFv.js","assets/timeZoneUtils-BSc7-7qA.js","assets/ArcadeExpression-BlIRq-oN.js","assets/TimeOnly-BERR31kg.js","assets/enum-BzLwmiID.js","assets/utils-DX2muIr3.js","assets/heatmapUtils-B-AXnq0l.js","assets/vec42-B8VM4vXb.js","assets/vec4f64-DPb6J-GU.js","assets/UniqueValueRenderer-JPjz9Qvs.js","assets/diffUtils-wTC1YzlE.js","assets/styleUtils-DWvicjTN.js","assets/popupUtils-D4UavgYz.js","assets/FeatureLayerSource-BCS6pPRe.js","assets/uuid-Oe6SV2kF.js","assets/MeshLocalVertexSpace-BGd1IdEs.js","assets/meshVertexSpaceUtils-CtG7DPVT.js","assets/vec32-CewSdTn3.js","assets/External-DqWxNHeL.js","assets/infoFor3D-DhzudQro.js","assets/projectionUtils-BGH_5_I3.js","assets/MeshTransform-Bl0zl104.js","assets/quat-B7J5v7rV.js","assets/quatf64-CCm9z-pX.js","assets/axisAngleDegrees-CjbXmycq.js","assets/editingSupport-DvBiDsO_.js","assets/normalizeUtils-85zLqeMi.js","assets/Cyclical-BLSxUpe7.js","assets/normalizeUtilsCommon-CnhQye_A.js","assets/utils-CylVuxNi.js","assets/utils-Dpg4yj1D.js","assets/EditBusLayer-rxUbWTiY.js","assets/clientSideDefaults-3DdoYkYX.js","assets/QueryEngineCapabilities-DJC_YILC.js","assets/QueryTask-DtLshCh_.js","assets/executeForIds-CuyQNBvQ.js","assets/query-DeNEvEsQ.js","assets/pbfQueryUtils-DlZBMNQk.js","assets/pbf-2SIhMekG.js","assets/memoryEstimations-Bd726a_p.js","assets/OptimizedFeature-CwRGZPwv.js","assets/OptimizedFeatureSet-BR8EEvDc.js","assets/queryZScale-CRP3Sh_E.js","assets/executeQueryJSON-DgYznOlB.js","assets/FeatureSet-BF7daP96.js","assets/featureConversionUtils-BDA_FXJx.js","assets/featureLayerUtils-FKjLNPl_.js","assets/asyncUtils-w6KfWU41.js","assets/featureQueryAll-BfDWA5Wx.js","assets/NormalizationBinParametersMixin-BK9wNkI3.js","assets/editsZScale-D3N5iH_c.js","assets/APIKeyMixin--YGbad8e.js","assets/ArcGISService-SIwch9bz.js","assets/CustomParametersMixin-Dshqz1Zp.js","assets/DisplayFilteredLayer-DyjtPayS.js","assets/scaleUtils-yfx9kKWT.js","assets/displayFilterUtils-CIXGrQzt.js","assets/FeatureLayerBase-BUeDgO3U.js","assets/HeightModelInfo-D5IdRvJ2.js","assets/LayerFloorInfo-CTubHTci.js","assets/multiLayerServiceUtils-CpHWiXA7.js","assets/Relationship-CrANqG2c.js","assets/serviceCapabilitiesUtils-BV_pcUiO.js","assets/portalItemUtils-CaPNUJg6.js","assets/PortalLayer-CbFNhtZ4.js","assets/PortalItem-DnxMlRVo.js","assets/RefreshableLayer-CBbEkZf-.js","assets/TemporalLayer-D4R0YvXo.js","assets/TimeInfo-D7ssmbZO.js","assets/FeatureType-CFJlAOcG.js","assets/FeatureTemplate-Bur8tORn.js","assets/fieldProperties-BoJj55FN.js","assets/versionUtils-BfuZvWmP.js","assets/FeatureLayer-BRWpcy_W.js","assets/isFeatureGraphicOrigin-YA2hudPe.js","assets/workers-BEkgoq8Q.js","assets/Queue-CYlrXMwB.js","assets/intl-DRFqUect.js","assets/FeatureReductionLayer-Bhh5MvS_.js","assets/FeatureReductionSelection-Du7o8OIG.js","assets/jsonUtils-BCGKNxno.js","assets/MD5-MtSiOt06.js","assets/TrackableLayer-B-086Hm8.js","assets/TitleCreator-BosRD8XX.js","assets/sanitizerUtils-BT_8V5US.js","assets/styleUtils-CZJC3pZm.js","assets/OrientedImageryLayer-CHf2Vuve.js"]))=>s.map(a=>t[a]),S="Feature Service",T="feature-layer-utils",is=`${T}-save`,os=`${T}-save-as`,j=`${T}-saveall`,m=`${T}-saveall-as`;function b(s){return{isValid:es(s)&&(!("dynamicDataSource"in s)||!s.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function D(s,e){const t=ts(s,"portal-item");return e?.isTable&&(t.layerContainerType="tables"),t}function R(s){const e=D(s),t=D(s);return t.layerContainerType="tables",{forLayers:e,forTables:t}}function x(s){const e=[],t=[];for(const{layer:a,layerJSON:o}of s)ls(a)?t.push(o):e.push(o);return{layers:e,tables:t}}function ls(s,e){return s.isTable}function N(s){return x([s])}async function A(s,e){return/\/\d+\/?$/.test(s.url)?N(e[0]):G(e,s)}async function G(s,e){if(s.reverse(),!e)return x(s);const t=await ns(e,s);for(const a of s)z(a.layer,a.layerJSON,t);return ys(t,s),t}async function ns(s,e){let t=await s.fetchData("json");if(us(t)&&!as(s,u.HOSTED_SERVICE))return t;t||={},cs(t);const{layer:{url:a,customParameters:o,apiKey:i}}=e[0];return await ps(t,{url:a??"",customParameters:o,apiKey:i},e.map(r=>r.layer.layerId)),t}function us(s){return!!(s&&Array.isArray(s.layers)&&Array.isArray(s.tables))}function cs(s){s.layers||=[],s.tables||=[]}function ys(s,e){const t=[],a=[];for(const{layer:o}of e){const{isTable:i,layerId:r}=o;i?a.push(r):t.push(r)}L(s.layers,t),L(s.tables,a)}function L(s,e){if(s.length<2)return;const t=[];for(const{id:a}of s)t.push(a);J(t.sort(I),e.slice().sort(I))&&s.sort((a,o)=>{const i=e.indexOf(a.id),r=e.indexOf(o.id);return i<r?-1:i>r?1:0})}function I(s,e){return s<e?-1:s>e?1:0}async function ps(s,e,t){const{url:a,customParameters:o,apiKey:i}=e,{serviceJSON:r,layersJSON:l}=await Q(a,{customParameters:o,apiKey:i}),n=P(s.layers,r.layers,t),p=P(s.tables,r.tables,t);s.layers=n.itemResources,s.tables=p.itemResources;const d=[...n.added,...p.added],Y=l?[...l.layers,...l.tables]:[];await js(s,d,a,Y)}function P(s,e,t){const a=Z(s,e,(i,r)=>i.id===r.id);s=s.filter(i=>!a.removed.some(r=>r.id===i.id));const o=a.added;return o.forEach(({id:i})=>{s.push({id:i})}),{itemResources:s,added:o.filter(({id:i})=>!t.includes(i))}}async function js(s,e,t,a){const o=await ms(e),i=e.map(({id:r,type:l})=>new(o.get(l))({url:t,layerId:r,sourceJSON:a.find(({id:n})=>n===r)}));await Promise.allSettled(i.map(r=>r.load())),i.forEach(r=>{const{layerId:l,loaded:n,defaultPopupTemplate:p}=r;if(!n||p==null)return;const d={id:l,popupInfo:p.toJSON()};z(r,r.operationalLayerType==="ArcGISFeatureLayer"?d:{...d,layerType:r.operationalLayerType},s)})}async function ms(s){const e=[];s.forEach(({type:o})=>{switch(ss(o)){case"CatalogLayer":e.push(C(()=>B(()=>import("./CatalogLayer-ZciLBojT-Cmen6I0X.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151])),h([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151])).then(i=>i.default));break;case"FeatureLayer":e.push(C(()=>B(()=>import("./FeatureLayer-BRWpcy_W-D7AhvLUt.js"),__vite__mapDeps([152,1,2,3,35,6,4,5,7,8,9,29,12,19,20,11,10,17,36,37,38,39,40,41,24,25,42,43,44,45,46,47,21,31,48,49,50,51,52,53,54,55,56,153,154,155,156,129,121,99,123,130,131,16,18,22,23,132,133,134,93,135,110,57,58,59,60,136,137,27,28,30,80,125,126,127,63,68,69,70,71,72,66,67,64,65,88,89,75,90,128,138,139,140,141,98,142,157,158,61,62,159,73,74,13,76,77,78,79,81,82,83,84,85,86,87,160,32,143,144,145,26,146,147,161,149,148,150,162,163,151,164,91])),h([152,1,2,3,35,6,4,5,7,8,9,29,12,19,20,11,10,17,36,37,38,39,40,41,24,25,42,43,44,45,46,47,21,31,48,49,50,51,52,53,54,55,56,153,154,155,156,129,121,99,123,130,131,16,18,22,23,132,133,134,93,135,110,57,58,59,60,136,137,27,28,30,80,125,126,127,63,68,69,70,71,72,66,67,64,65,88,89,75,90,128,138,139,140,141,98,142,157,158,61,62,159,73,74,13,76,77,78,79,81,82,83,84,85,86,87,160,32,143,144,145,26,146,147,161,149,148,150,162,163,151,164,91])).then(i=>i.default));break;case"OrientedImageryLayer":e.push(C(()=>B(()=>import("./OrientedImageryLayer-CHf2Vuve-CIJ6_VfZ.js"),__vite__mapDeps([165,3,39,35,6,1,2,4,5,7,8,9,29,12,19,20,11,40,41,24,25,42,43,44,45,46,47,21,31,48,49,50,51,52,53,54,55,56,152,10,17,36,37,38,153,154,155,156,129,121,99,123,130,131,16,18,22,23,132,133,134,93,135,110,57,58,59,60,136,137,27,28,30,80,125,126,127,63,68,69,70,71,72,66,67,64,65,88,89,75,90,128,138,139,140,141,98,142,157,158,61,62,159,73,74,13,76,77,78,79,81,82,83,84,85,86,87,160,32,143,144,145,26,146,147,161,149,148,150,162,163,151,164,91])),h([165,3,39,35,6,1,2,4,5,7,8,9,29,12,19,20,11,40,41,24,25,42,43,44,45,46,47,21,31,48,49,50,51,52,53,54,55,56,152,10,17,36,37,38,153,154,155,156,129,121,99,123,130,131,16,18,22,23,132,133,134,93,135,110,57,58,59,60,136,137,27,28,30,80,125,126,127,63,68,69,70,71,72,66,67,64,65,88,89,75,90,128,138,139,140,141,98,142,157,158,61,62,159,73,74,13,76,77,78,79,81,82,83,84,85,86,87,160,32,143,144,145,26,146,147,161,149,148,150,162,163,151,164,91])).then(i=>i.default))}});const t=await Promise.all(e),a=new Map;return s.forEach(({type:o},i)=>{a.set(o,t[i])}),a}function z(s,e,t){s.isTable?E(t.tables,e):E(t.layers,e)}function E(s,e){const t=s.findIndex(({id:a})=>a===e.id);t===-1?s.push(e):s[t]=e}function M(s,e){if(!s.length)throw new c(`${e}:missing-parameters`,"'layers' array should contain at least one feature layer")}function fs(s,e){const t=s.map(a=>a.portalItem.id);if(new Set(t).size>1)throw new c(`${e}:invalid-parameters`,"All layers in the 'layers' array should be loaded from the same portal item")}function V(s,e){const t=s.map(a=>a.layerId);if(new Set(t).size!==t.length)throw new c(`${e}:invalid-parameters`,"'layers' array should contain only one instance each of layer or table in a feature service")}async function ds(s){M(s,j),await Promise.all(s.map(e=>e.load()));for(const e of s)_(e,j,b),K({layer:e,itemType:S,errorNamePrefix:j});fs(s,j),V(s,j)}function hs(s){if(!("layerType"in s))return!!s.charts?.length;switch(s.layerType){case"OrientedImageryLayer":return!!s.charts?.length;case"SubtypeGroupLayer":return!!s.layers.some(e=>!!e.charts?.length);case"SubtypeGroupTable":return!!s.tables.some(e=>!!e.charts?.length);case"CatalogLayer":return!!s.footprintLayer?.charts?.length}}function U(s,e){let t=0,a=0,o=0,i=0;for(const r of[...e.layers,...e.tables])if(hs(r)&&i++,"layerType"in r)switch(r.layerType){case"OrientedImageryLayer":t++;break;case"SubtypeGroupLayer":a++;break;case"SubtypeGroupTable":o++}y(s,u.ORIENTED_IMAGERY_LAYER,t>0),y(s,u.SUBTYPE_GROUP_LAYER,a>0),y(s,u.SUBTYPE_GROUP_TABLE,o>0),y(s,u.CHARTS,i>0)}function k(s,e,t){rs(e,u.METADATA),y(e,u.MULTI_LAYER,s.length>1),y(e,u.SINGLE_LAYER,s.length===1),y(e,u.TABLE,t.tables.length>0&&t.layers.length===0),U(e,t)}async function vs(s,e,t){U(e,t)}async function Ds(s,e,t){const{url:a,layerId:o,title:i,fullExtent:r,isTable:l}=s,n=f(a);e.url=(n?.serverType==="FeatureServer"?a:`${a}/${o}`)??null,e.title||=i,e.extent=null,l||r==null||(e.extent=await F(r)),k([s],e,t)}function Ss(s,e){for(const o of s){const i=o.parsedUrl.path,r=f(i);if(!r?.url.path)throw new c(`${e}:invalid-parameters`,w(o,`has unsupported url pattern: ${i}`),{layer:o});const l=r?.serverType;if(l!=="FeatureServer"&&l!=="MapServer")throw new c(`${e}:invalid-parameters`,w(o,`has unsupported server type: ${l}`),{layer:o});if(l==="MapServer"&&s.length>1)throw new c(`${e}:invalid-parameters`,"Only one layer or table in a map service can be saved")}const t=f(s[0].parsedUrl.path),a=t?.url.path;if(!s.every(o=>f(o.parsedUrl.path)?.url.path===a))throw new c(`${e}:invalid-parameters`,"'layers' array should only contain layers or tables that belong to the same feature service")}async function Ts(s){M(s,m),await Promise.all(s.map(e=>e.load()));for(const e of s)_(e,m,b);Ss(s,m),V(s,m)}function bs(s,e){U(s,e),g(s)}async function Cs(s,e,t){let a=0;for(const{isTable:r}of s)r||a++;const o=s[0].parsedUrl.path,i=f(o);if(e.url=i?.serverType==="FeatureServer"?i.url.path:o,e.title||=i.title,e.extent=null,a>0){const r=s.map(l=>l.fullExtent).filter(q).reduce((l,n)=>l.clone().union(n));r&&(e.extent=await F(r))}k(s,e,t),g(e)}async function $s(s,e){return $({layer:s,itemType:S,validateLayer:b,createJSONContext:t=>D(t,s),createItemData:(t,a)=>A(a,[t]),errorNamePrefix:is,setItemProperties:vs},e)}async function Hs(s,e){await ds(s);const t=s[0].portalItem,a=R(t),o=await Promise.all(s.map(r=>O(r,r.isTable?a.forTables:a.forLayers,e))),i=await A(t,s.map((r,l)=>({layer:r,layerJSON:o[l]})));return bs(t,i),await t.update({data:i}),await Promise.all(s.slice(1).map(r=>r.portalItem.reload())),v(a.forLayers),v(a.forTables),t.clone()}async function Xs(s,e,t){return W({layer:s,itemType:S,validateLayer:b,createJSONContext:a=>D(a,s),createItemData:(a,o)=>Promise.resolve(N(a)),errorNamePrefix:os,newItem:e,setItemProperties:Ds},t)}async function Ws(s,e,t){await Ts(s);const a=H({itemType:S,errorNamePrefix:m,newItem:e}),o=R(a),i=await Promise.all(s.map(l=>O(l,l.isTable?o.forTables:o.forLayers,t))),r=await G(s.map((l,n)=>({layer:l,layerJSON:i[n]})));await Cs(s,a,r),await X(a,r,t);for(const l of s)l.portalItem=a.clone();return v(o.forLayers),v(o.forTables),a}export{$s as save,Hs as saveAll,Ws as saveAllAs,Xs as saveAs};
