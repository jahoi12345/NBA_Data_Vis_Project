import{a as $,D as f,S as c,x as Z,E as w,I as S,f as g}from"./date-IqUzANpt-bLKO9IDT.js";import{x as T,h as D,T as x,a as F}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import"./collectionUtils-jDyktm0P-BDP2Oq99.js";import"./Point-BfTTZoMu-DeJwQYfh.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./mat4-C96X-Nn0-BrMLOLCb.js";import"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./intl-DRFqUect-DPhFaHB2.js";import{g as U}from"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";const A=",",v={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},C=new Set(["integer","small-integer"]);let d=null;function H(t){return T(t)||D(t)||x(t)}async function L(t){const{field:n,field2:e,field3:s,normalizationField:r,valueExpression:u,fields:i}=t;let o=[];if(u){if(!d){const{arcadeUtils:m}=await F();d=m}o=d.extractFieldNames(u)}return n&&o.push(n),e&&o.push(e),s&&o.push(s),r&&o.push(r),i&&o.push(...i),o}function l(t){return String(t).padStart(2,"0")}function h(t,n,e){let s;return n==="date"||n==="number"?(n==="number"&&(t=new Date(t)),s=`TIMESTAMP'${e?t.getFullYear():t.getUTCFullYear()}-${l((e?t.getMonth():t.getUTCMonth())+1)}-${l(e?t.getDate():t.getUTCDate())} ${l(e?t.getHours():t.getUTCHours())}:${l(e?t.getMinutes():t.getUTCMinutes())}:${l(e?t.getSeconds():t.getUTCSeconds())}'`):s=t,s}function P(t,n,e,s){const{hasQueryEngine:r}=t,u=`(${h(e,y(t,e),r)} - ${h(n,y(t,n),r)})`;let i=v[s],o="/";return i<1&&(i=1/i,o="*"),{sqlExpression:i===1?u:`(${u} ${o} ${i})`,sqlWhere:null}}function y(t,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const e=t.getField(n);if(n.toLowerCase()==="<now>")return;if(T(e))return"field"}}function Q(t,n){const e=n&&t.getField(n);return!!e&&C.has(e.type)}function W(t){return`cast(${t} as float)`}function k(t,n){const{format:e,fieldFormat:s,timeZoneOptions:r,fieldType:u}=n??{},i=s?$(s):null;let o,m;if(r&&({timeZone:o,timeZoneName:m}=U(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,i||f(e||"short-date-short-time"),u)),typeof t=="string"&&isNaN(Date.parse(u==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(u){case"date-only":{const a=i||f(e||"short-date");return typeof t=="string"?S(t,{...a}):c(t,{...a,timeZone:g})}case"time-only":{const a=i||f(e||"short-time");return typeof t=="string"?w(t,a):c(t,{...a,timeZone:g})}case"timestamp-offset":{if(!o&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const a=e||i||r?i||f(e||"short-date-short-time"):void 0,p=a?{...a,timeZone:o,timeZoneName:m}:void 0;return typeof t=="string"?Z(t,p):c(t,p)}default:{const a=e||i||r?i||f(e||"short-date-short-time"):void 0;return c(typeof t=="string"?new Date(t):t,a?{...a,timeZone:o,timeZoneName:m}:void 0)}}}export{Q as A,W as L,A as O,H as P,k as Q,L as W,P as Y};
