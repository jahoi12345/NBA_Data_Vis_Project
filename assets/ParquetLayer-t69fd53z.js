import{i as y,d,_ as r,m as o,a as q,G as $,a3 as x,s as _,r as c}from"./jsonMap-Bs3hmeCU.js";import{a as F,q as I}from"./getPopupProvider-3D7bbDmC.js";import{g as S,l as P,O as u}from"./collectionUtils-oMUPqMMC.js";import{l as T}from"./MultiOriginJSONSupport-Bd1TKmh_.js";import{l as h}from"./reactiveUtils-SO2Ko3sy.js";import{o as j}from"./reader-DcGs6kKN.js";import{z as b}from"./Extent-KC9qx-Cg.js";import{m as R,f as J}from"./Point-Byf20bUE.js";import{n as N}from"./Graphic-DDayESOh.js";import{s as E,o as z}from"./GraphicOrigin-uE6TDXc9.js";import{b as D}from"./Layer-C7047eDe.js";import{p as L}from"./workers-1ohSU8uJ.js";import{p as C,i as Q,s as k,a as U,c as m}from"./parquetUtils-DnTvidNv.js";import{g as G}from"./FeatureSet-DvzIE7hz.js";import{p as V}from"./BlendLayer-CjQQIlYb.js";import{s as A}from"./CustomParametersMixin-Dshqz1Zp.js";import{a as W}from"./DisplayFilteredLayer-BN1NjG7c.js";import{c as H}from"./FeatureEffectLayer-BR0DbNor.js";import{f as M}from"./FeatureReductionLayer-CB3IxZox.js";import{b as B,p as K,d as X,l as Y}from"./OperationalLayer-D21xAIax.js";import{p as Z}from"./OrderedLayer-DQAUgUTV.js";import{t as ee}from"./ScaleRangeLayer-DQr2T3Hh.js";import{l as te}from"./TemporalLayer-BY3Kxcqb.js";import{a as re}from"./FeatureTemplate-Ch2q7Sic.js";import{m as ie}from"./Field-Cm_ZejYW.js";import{s as oe}from"./fieldProperties-Bxo5fLcC.js";import{L as f,F as se}from"./lengthUtils-go2kD43r.js";import{l as ae,A as pe}from"./labelingInfo-D_Hp3zg4.js";import{m as ne}from"./typeUtils-DGuMqKvS.js";import{b as g}from"./Query-CEeFv7EX.js";import{d as le}from"./popupUtils-hMJYCmfk.js";import"./Color-CERqXxxY.js";import"./mathUtils-PIGhLnI9.js";import"./date-IqUzANpt.js";import"./index-DqD_sEjA.js";import"./SimpleObservable-CvFyr0NA.js";import"./jsonUtils-yEjkUv4W.js";import"./Polyline-DWJWvQfr.js";import"./Polygon-BuPlovwL.js";import"./aaBoundingRect-C2DMsiYR.js";import"./typeUtils-cp7rBKcN.js";import"./createFeatureId-CVwTD0fV.js";import"./typeUtils-CzDvsuOn.js";import"./lineMarkers-CDwLe3J6.js";import"./PolygonSymbol3D-59towS1W.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x.js";import"./screenUtils-BitdhK1O.js";import"./opacityUtils-DuFH0EC9.js";import"./aaBoundingBox-3Iqogf_p.js";import"./DoubleArray-DExKNiTh.js";import"./mat4f64-q_b6UJoq.js";import"./Font-2nHmDeHF.js";import"./SimpleFillSymbol-CDawtd9z.js";import"./SimpleMarkerSymbol-BGAFRS9_.js";import"./PictureMarkerSymbol-BOUJUEwC.js";import"./TextSymbol-nUyYMD__.js";import"./Queue-CYlrXMwB.js";import"./intl-sjEXBsFq.js";import"./locationUtils-CjGWu4Iq.js";import"./parquet-B-4Yd8QE.js";import"./QueueProcessor-D8z0mMzA.js";import"./ReactiveMap-B0by2bYu.js";import"./signal-BX9ezF8a.js";import"./layerContainerType-CSXZNpHb.js";import"./jsonUtils-CZHLtdFW.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-Dyb44KrD.js";import"./scaleUtils-BWnCGTna.js";import"./uuid-Oe6SV2kF.js";import"./displayFilterUtils-DDhiY40-.js";import"./FeatureEffect-C6zu39AG.js";import"./FeatureFilter-BkpRbqma.js";import"./FeatureReductionSelection-Du7o8OIG.js";import"./featureLayerUtils-Bv2SFOZp.js";import"./asyncUtils-w6KfWU41.js";import"./featureQueryAll-Bs1TsJHw.js";import"./layerUtils-CVHRa_-F.js";import"./SimpleRenderer-CSKJe5WL.js";import"./commonProperties-DG223FIq.js";import"./colorRamps-DswZzxkO.js";import"./ColorStop-De5gQTjr.js";import"./visualVariableUtils-F6Iu93CZ.js";import"./jsonUtils-DrqApMOE.js";import"./defaults3D-wBN5DBv3.js";import"./defaults-ByYwEp-i.js";import"./defaultsJSON-GKolV7NZ.js";import"./UniqueValueRenderer-CqL01Pyt.js";import"./diffUtils-CE43h1Bb.js";import"./RendererLegendOptions-BT9sB-l4.js";import"./styleUtils-D82ESqjo.js";import"./NormalizationBinParametersMixin-BK9wNkI3.js";import"./jsonUtils-cMcWZTHk.js";import"./MD5-MtSiOt06.js";import"./ElevationInfo-CwNOnX1q.js";import"./unitConversionUtils-CewTmddc.js";import"./TimeInfo-Cx_70Sg5.js";import"./timeZoneUtils-BSc7-7qA.js";import"./fieldType-DVUzXtk_.js";import"./FieldsIndex-CKlbiDH8.js";import"./UnknownTimeZone-B697BDFv.js";import"./labelUtils-BtizwBfq.js";import"./ClassBreaksRenderer-DCZt2qUb.js";import"./LRUCache-fy84PBMi.js";import"./DictionaryScriptEvaluator-DJZsvOx4.js";import"./Version-BtYZEj58.js";import"./ArcadeExpression-Cdtbfg1V.js";import"./TimeOnly-DVuxiQet.js";import"./enum-BzLwmiID.js";import"./utils-DX2muIr3.js";import"./heatmapUtils-DPGN6AdF.js";import"./vec42-B7JTmW9u.js";import"./vec4f64-DPb6J-GU.js";const me=Symbol("isParquetGraphicOrigin");var v;class ue extends E{get[(v=me,F)](){return this.layer}get[N](){return this.layer}get[z](){return this.layer}constructor(t){super(),this[v]=!0,this.type="parquet",this.layer=t}get id(){return this.layer.id}}let l=class extends S{constructor(e){super(e),this.type="parquet"}load(e){const t=e!=null?e.signal:null;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){this._connection?.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{y.getLogger(this).warn("Failed to update customParameters")})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t?.signal})}async queryFeatures(e,t={}){const s=await this.queryFeaturesJSON(e,{signal:t?.signal});return G.fromJSON(s)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t?.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t?.signal})}async queryExtent(e,t){if(this.layer.encoding==null)return y.getLogger(this).warn("Tried to queryExtent, but source does not have a geometry. Returning null extent."),{count:0,extent:null};const s=await this._proxy.queryExtent(e.toJSON(),{signal:t?.signal});return{count:s.count,extent:b.fromJSON(s.extent)}}async _initialize(e){this._connection=await L("ParquetSourceWorker",{strategy:"dedicated",signal:e,registryTarget:this}),d(e),this._proxy=this._connection.createInvokeProxy();const{layerDefinition:t,capabilities:s}=await this._proxy.load({urls:this.layer.urls.items,fields:this.layer.fields?.map(a=>a.toJSON()),geometryType:this.layer.geometryType?C(this.layer.geometryType):null,spatialReference:this.layer.spatialReference?.toJSON(),encoding:this.layer.encoding?.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});d(e),this.sourceJSON=t,this.capabilities=s}};r([o()],l.prototype,"type",void 0),r([o({constructOnly:!0})],l.prototype,"layer",void 0),r([o()],l.prototype,"sourceJSON",void 0),r([o()],l.prototype,"capabilities",void 0),l=r([q("esri.layers.graphics.sources.ParquetSource")],l);const w=oe(),O="__OBJECTID",ye={types:{key:"type",base:U,typeMap:{wkb:k,location:Q}},json:{name:"layerDefinition.geometryEncoding",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryEncoding"}}}}};let i=class extends W(M(H(V(Z(te(ee(B(T(A(P(D))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.encoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ue(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=O,this.operationalLayerType="ParquetLayer",this.outFields=null,this.persistenceEnabled=!!$("parquetlayer-persistence-enabled"),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title="Parquet",this.type="parquet",this.urls=new u}destroy(){this.source?.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([h(()=>this.urls,t=>this.source?.updateFiles(t.items)),h(()=>this.customParameters,t=>this.source?.setCustomParameters(t))]),this}get capabilities(){return this.source?.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,s,a){const p=e.filter(n=>!(n.name===O&&n.type==="oid")).map(n=>n.toJSON(a));x(s,p,t)}get isTable(){return this.encoding==null}set renderer(e){f(e,this.fieldsIndex),this._set("renderer",e)}readUrls(e){return new u(e.type==="files"?e.urls:[])}writeUrls(e,t,s,a){const p=[];if(e?.length){a={blockedRelativeUrls:a?.blockedRelativeUrls};for(let n of e)n=R(n,a),n&&p.push(n)}p.length?t.source={type:"files",urls:p}:a.messages?.push(new _("parquet-layer:missing-urls","Missing or empty 'urls'",{layer:this}))}createPopupTemplate(e){return le(this,e)}createQuery(){const e=new g;return e.returnGeometry=!0,e.outFields=["*"],e}async createSource(e){const t=new l({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();const s=await this.source.queryFeatures(this._normalizeQuery(e),t),a=this.graphicOrigin;if(s?.features)for(const p of s.features)p.layer=p.sourceLayer=this,p.origin=a;return s}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return g.from(e)??this.createQuery()}async _load(e){const t=await this.createSource(e);this._set("source",t),this.read(t.sourceJSON,{origin:"service"}),this.revert(["fields","timeInfo"],"service"),f(this.renderer,this.fieldsIndex),se(this.timeInfo,this.fieldsIndex),this.spatialReference==null&&(this.spatialReference=J.WGS84)}};r([o({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([o({type:String})],i.prototype,"copyright",void 0),r([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([o()],i.prototype,"displayOptimization",void 0),r([o({type:[ie],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([c("fields")],i.prototype,"writeFields",null),r([o(w.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([o(ye)],i.prototype,"encoding",void 0),r([o({type:b,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([o({type:m.apiValues,json:{name:"layerDefinition.geometryType",read:{reader:m.read},write:{writer:m.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"geometryType",reader:m.read}}}}})],i.prototype,"geometryType",void 0),r([o({readOnly:!0,clonable:!1})],i.prototype,"graphicOrigin",void 0),r([o(K)],i.prototype,"labelsVisible",void 0),r([o({type:[pe],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ae},write:!0}})],i.prototype,"labelingInfo",void 0),r([o(X)],i.prototype,"legendEnabled",void 0),r([o()],i.prototype,"file",void 0),r([o({type:String,readOnly:!0})],i.prototype,"objectIdField",void 0),r([o({type:["ParquetLayer"]})],i.prototype,"operationalLayerType",void 0),r([o(w.outFields)],i.prototype,"outFields",void 0),r([o(Y)],i.prototype,"popupEnabled",void 0),r([o({type:I,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([o({types:ne,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{read:{source:"drawingInfo.renderer"}}}}})],i.prototype,"renderer",null),r([o({type:l,readOnly:!0,cast:null,json:{read:!1}})],i.prototype,"source",void 0),r([o({json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:"extent.spatialReference"}}}}})],i.prototype,"spatialReference",void 0),r([o({type:[re]})],i.prototype,"templates",void 0),r([o()],i.prototype,"title",void 0),r([o({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([o({type:u.ofType(String),json:{name:"source",write:{isRequired:!0,ignoreOrigin:!0}}})],i.prototype,"urls",void 0),r([j("urls")],i.prototype,"readUrls",null),r([c("urls")],i.prototype,"writeUrls",null),i=r([q("esri.layers.ParquetLayer")],i);const gr=i;export{gr as default};
