import{a as P,Y as x}from"./BufferView-Cj2sQaht-DuP-iLZg.js";import{g as f,p as d,l as y,m as v,n as m,y as w,C as T}from"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import{ct as D,a2 as O,Y as C,w as I,cu as S,ch as F,cv as M,N as $,B as j,F as z,cw as Y,ai as A,aj as B,ak as W,al as L,bJ as N,a0 as H,an as R,bI as V,ao as k,ay as q,aO as E,bp as X,aN as G,aQ as J,aM as K,aR as Q,aS as Z,V as U,ca as o}from"./Texture-CFNZjV2R-lGBztxVp.js";import{bn as ee}from"./ShadowCastClear.glsl-CeOT_rAo-iOFMl8eB.js";import{m as te}from"./TriangleMaterial-BIKWylXl-CcDbhy8X.js";import{H as re}from"./index-CTl7hdrJ.js";import{v as se}from"./DefaultLayouts-B8c6Qefj-D-9ZzY5G.js";import{Y as n}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./collectionUtils-jDyktm0P-ArdXNs6F.js";import"./vec2f64-rIxtbMRN-Kai9mK1i.js";import"./mat4-C96X-Nn0-Do6fKsNS.js";import"./vec32-CewSdTn3-DHOFKD0R.js";class g extends U{}function _(r){const e=new q,{vertex:t,fragment:a,varyings:l}=e,{output:p,perspectiveInterpolation:c}=r;return E(t,r),e.include(X),e.include(G,r),e.fragment.include(J,r),e.include(K,r),e.include(Q,r),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),c&&e.attributes.add("perspectiveDivide","float"),t.main.add(m`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${v(c,"gl_Position *= perspectiveDivide;")}`),l.add("vpos","vec3",{invariant:!0}),l.add("vTexCoord","vec2"),a.include(Z),a.uniforms.add(new w("opacity",s=>s.opacity),new T("tex",s=>s.glTexture)).main.add(m`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${v(p===10,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),e}const ie=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:g,build:_},Symbol.toStringTag,{value:"Module"}));let ae=class extends ${constructor(r,e){super(r,e,new j(ie,()=>re(()=>Promise.resolve().then(()=>pe),void 0)),b(e).locations)}_getPipelineState(r,e){const{oitPass:t,output:a,hasOccludees:l,cullFace:p}=r;return z({blending:y(a)?k(t,!0):null,culling:V(p),depthTest:{func:R(t)},depthWrite:H(r),drawBuffers:N(t,a),colorWrite:L,stencilWrite:l?W:null,stencilTest:l?e?A:B:null,polygonOffset:Y(r)})}initializePipeline(r){return this._occludeePipeline=this._getPipelineState(r,!0),this._getPipelineState(r,!1)}getPipeline(r){return r?this._occludeePipeline:super.getPipeline()}};function b(r){let e=se;return r.perspectiveInterpolation&&(e=e.clone().f32("perspectiveDivide")),e}class i extends C{constructor(e){super(),this.draped=e,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}}n([o({count:3})],i.prototype,"cullFace",void 0),n([o()],i.prototype,"enableOffset",void 0),n([o()],i.prototype,"writeDepth",void 0),n([o()],i.prototype,"hasOccludees",void 0),n([o()],i.prototype,"terrainDepthTest",void 0),n([o()],i.prototype,"cullAboveTerrain",void 0),n([o()],i.prototype,"perspectiveInterpolation",void 0);class Te extends te{constructor(e){super(e,le),this.supportsEdges=!0,this.produces=new Map([[2,t=>f(t)],[4,t=>d(t)&&this.parameters.writeDepth],[8,t=>d(t)&&!this.parameters.writeDepth],[18,t=>d(t)||f(t)]]),this._configuration=new i(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<D,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new oe(e)}createBufferWriter(){return new ne(b(this.parameters))}}class oe extends I{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;ee(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(ae,e)}}class ne extends S{write(e,t,a,l,p,c){for(const s of this.layout.fields.keys()){const u=a.get(s);if(u)if(s==="perspectiveDivide"){P(u.size===1);const h=p.getField(s,x);h&&F(u,h,c)}else M(s,u,e,t,p,c)}return null}}class le extends O{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}const pe=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:g,build:_},Symbol.toStringTag,{value:"Module"}));export{Te as y};
