import{Y as d,G as g}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{a as h,f as w}from"./dataUtils-1NJ_tbX7-BVfW_Ul3.js";import{Q as D,K as _}from"./loadUtils-DQnILyqZ-BymjZ5Cf.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./Point-BfTTZoMu-DeJwQYfh.js";import"./index-B0z_nLWi.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./FeatureTileDescriptor-n_NQwd9p-DjCngMQK.js";import"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import"./reader-DcGs6kKN-DHJfK-tm.js";let m=class{constructor(){this._tileData=new Map}async generateStreamlines(a){const{flowData:o,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:f}=a,n=u(h(l,o),l,t.modelSize,e,f);return{result:{streamlines:n},transferList:n?.map(s=>s.vertices.buffer)}}async generateTiledStreamlines(a){const{flowDataTiles:o,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:f,startPositions:n}=a;this._updateTileData(o,l);const s=u(D(f,this._tileData,t),f,t.modelSize,e,n);return{result:{streamlines:s},transferList:s?.map(r=>r.vertices.buffer)??[]}}_updateTileData(a,o){o&&this._tileData.forEach((t,e)=>{a.get(e)==null&&this._tileData.delete(e)}),a.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};m=d([g("esri.views.3d.support.flow.FlowWorker")],m);const F=m;function u(a,o,t,e,l){if(a==null)return;const f=w(o,a,t[0],t[1],{positions:l}),n=[],s=_(e);for(const{vertices:r,stage:c}of f){const p=new Float32Array(r.length*s);for(let i=0;i<r.length;i++)p[i*s]=r[i].x,p[i*s+1]=r[i].y,p[i*s+2]=r[i].t,e&&(p[i*s+3]=r[i].speed);n.push({vertices:p,stage:c,hasMagnitude:e})}return n}export{F as default};
