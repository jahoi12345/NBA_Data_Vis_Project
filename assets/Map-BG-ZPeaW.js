const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationQuery-pJqr5aW2.js","assets/asyncUtils-w6KfWU41.js","assets/jsonMap-Bs3hmeCU.js","assets/Point-BN8RINcc.js","assets/reader-DcGs6kKN.js","assets/index-C-2WWcaK.js","assets/index-Cv2ko1Ob.css","assets/projectionUtils-zKDw1yLq.js","assets/SimpleObservable-CvFyr0NA.js","assets/collectionUtils-Dk3LoVuX.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-Bbnm65bN.js","assets/Polyline-BtUG5wiC.js","assets/Polygon-BdLNJfwi.js","assets/aaBoundingRect-CrU5VtR_.js","assets/mathUtils-PIGhLnI9.js","assets/TileKey-jKcqhCzg.js","assets/layersCreator-BoQ_EdDb.js","assets/loadUtils-D68eAeiv.js","assets/fetchService-Ee5OwiRg.js","assets/layerUtils-Ca2TiN3a.js","assets/Layer-Ciy6IOGe.js","assets/date-IqUzANpt.js","assets/associatedFeatureServiceUtils-CpoEzD7D.js","assets/PortalItem-JZSYzcdX.js","assets/lazyLayerLoader-Dix7uY-M.js","assets/portalLayers-CWdoKhoP.js","assets/portalItemUtils-C4rc3uwY.js","assets/styleUtils-CZJC3pZm.js"])))=>i.map(i=>d[i]);
import{V,_ as s,m as a,a as y,v as M,N,g as z,i as w,u as T,bw as W,s as K,d as I,y as x,r as Q,E as j,a9 as B}from"./jsonMap-Bs3hmeCU.js";import{a as G,F as g}from"./Basemap-BBszaJs6.js";import{_ as S}from"./index-C-2WWcaK.js";import{r as X,u as D}from"./Color-CERqXxxY.js";import{O as $,c as Y,g as Z,l as ee,f as H}from"./collectionUtils-Dk3LoVuX.js";import{l as C}from"./CollectionFlattener-Cag-8feq.js";import{l as te}from"./loadAll-B7O5Buv4.js";import{r as re,n as se}from"./opacityUtils-DuFH0EC9.js";import{l as oe,w as ae,f as ne,c as ie}from"./reactiveUtils-SO2Ko3sy.js";import{aq as le,H as pe,bk as de,s as F}from"./Point-BN8RINcc.js";import{n as ue}from"./uuid-Oe6SV2kF.js";import{o as ye}from"./reader-DcGs6kKN.js";import{j as ce}from"./persistable-CuCo7Cu3.js";import{l as m}from"./PolygonCollection-90Z4vnqc.js";import{b as he}from"./Layer-Ciy6IOGe.js";import{G as me,$ as fe}from"./layerUtils-Ca2TiN3a.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-n_G6OS58.js";import{n as ge,a as be,t as ve}from"./TablesMixin-BFz-cIJ-.js";const f=new WeakMap;function J(e){return!e.destroyed&&(f.has(e)||e.addHandles([oe(()=>{const{parent:t}=e;return!!(t&&t instanceof he)&&(t.type==="catalog-dynamic-group"||J(t))},t=>f.set(e,t),ae),V(()=>f.delete(e))]),f.get(e))}var O;let b=O=class extends M{constructor(e){super(e),this.type="none"}clone(){return new O({type:this.type})}};s([X({none:"none",stayAbove:"stay-above"}),a({json:{write:{isRequired:!0}}})],b.prototype,"type",void 0),b=O=s([y("esri.ground.NavigationConstraint")],b);const U=Symbol("GroundInstance");function We(e){return e!=null&&typeof e=="object"&&U in e}var R,E;let i=E=class extends N(Z){static{R=U}constructor(e){super(e),this[R]=!0,this.parent=null,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new $;const t=o=>{const{parent:n}=o;n&&n!==this&&"remove"in n&&n.remove?.(o),o.parent=this,o.type!=="elevation"&&o.type!=="base-elevation"&&w.getLogger(this).error(`Layer '${o.title}, id:${o.id}' of type '${o.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=o=>{o.parent=null};this.addHandles([this.layers.on("after-add",o=>t(o.item)),this.layers.on("after-remove",o=>r(o.item))]),this.allLayers=new C({getCollections:()=>[this.layers,this.parent?.basemap?.groundLayers]})}removeChildLayer(e){this.layers.remove(e)}initialize(){this.when().catch(e=>{z(e)||w.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}get integratedMeshGround(){const e=this.parent?.basemap?.groundLayers.at(0);return e?.replacesTerrain?e:null}destroy(){const e=this.layers.removeAll();for(const t of e)T(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get loaded(){return super.loaded}get layers(){return this._get("layers")}set layers(e){this._set("layers",Y(e,this._get("layers")))}writeLayers(e,t,r,o){const n=[];e&&(o={...o,layerContainerType:"ground"},e.forEach(p=>{if("write"in p){const u={};W(p)().write(u,o)&&n.push(u)}else o?.messages&&o.messages.push(new K("layer:unsupported",`Layers (${p.title}, ${p.id}) of type '${p.declaredClass}' cannot be persisted in the ground`,{layer:p}))})),t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return te(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});const{queryAll:r}=await S(()=>import("./ElevationQuery-pJqr5aW2.js").then(o=>o.E),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]));return I(t),r(this.layers.filter(P).toArray(),e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{createSampler:r}=await S(()=>import("./ElevationQuery-pJqr5aW2.js").then(o=>o.E),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]));return I(t),r(this.layers.filter(P).toArray(),e,t)}clone(){const e={opacity:this.opacity,surfaceColor:x(this.surfaceColor),navigationConstraint:x(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new E({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,r){const o=t?.origin||"web-scene",n=t?.portal||null,p=t?.url||null,{populateOperationalLayers:u}=await S(async()=>{const{populateOperationalLayers:L}=await import("./layersCreator-BoQ_EdDb.js");return{populateOperationalLayers:L}},__vite__mapDeps([17,9,2,5,6,3,4,10,11,8,18,19,20,21,22,23,24,25,26,27,7,12,13,14,15,28,1]));I(r);const c=[];if(e.layers&&Array.isArray(e.layers)){const L={context:{origin:o,url:p,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};c.push(u(this.layers,e.layers,L))}await Promise.allSettled(c)}};function P(e){return e&&"createElevationSampler"in e}s([a()],i.prototype,"parent",void 0),s([a()],i.prototype,"integratedMeshGround",null),s([a({json:{read:!1,write:{isRequired:!0}}})],i.prototype,"layers",null),s([a()],i.prototype,"allLayers",void 0),s([Q("layers")],i.prototype,"writeLayers",null),s([a({readOnly:!0})],i.prototype,"resourceInfo",void 0),s([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:j,read:{reader:re,source:"transparency"},write:{writer:(e,t)=>{t.transparency=se(e)},target:"transparency"}}})],i.prototype,"opacity",void 0),s([a({type:D,json:{type:[j],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],i.prototype,"surfaceColor",void 0),s([a({type:b,json:{write:!0}})],i.prototype,"navigationConstraint",void 0),i=E=s([y("esri.Ground")],i);const _=i;let v=class extends ee(M){constructor(e){super(e),this.color=null}};s([a({type:D,json:{type:[j],write:!0}})],v.prototype,"color",void 0),v=s([y("esri.effects.FocusAreaOutline")],v);const we=v;let d=class extends N(H){constructor(e){super(e),this.id=`focusarea-${ue()}`,this.title=null,this.enabled=!0,this.outline=null,this.geometries=new m}readGeometries(e,t,r){Array.isArray(e)?this.geometries=m.fromJSON(e,r):r.origin!=="web-scene"&&r.origin!=="portal-item"||r.hooks?.onAfterLoad?.(()=>this._loadGeometries(le(e,r),r))}async _loadGeometries(e,t){const r=await pe(e,{responseType:"json"});this.geometries=m.fromJSON(r.data,t)}};s([a({type:String,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),a()],d.prototype,"id",void 0),s([a({type:String,json:{write:!0}})],d.prototype,"title",void 0),s([a({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],d.prototype,"enabled",void 0),s([a({type:we,json:{write:!0}})],d.prototype,"outline",void 0),s([a({type:m,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new m(e.items.map(t=>t.clone()))}),ce({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],d.prototype,"geometries",void 0),s([ye(["web-scene","portal-item","service"],"geometries")],d.prototype,"readGeometries",null),d=s([y("esri.effects.FocusArea")],d);const $e=d;let h=class extends N(H){constructor(t){super(t),this.areas=new $,this.style="bright"}};s([a({type:$.ofType($e),nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}},clonable:e=>new $(e.items.map(t=>t.clone()))})],h.prototype,"areas",void 0),s([a({type:["bright","dark"],nonNullable:!0,json:{write:!0}})],h.prototype,"style",void 0),h=s([y("esri.effects.FocusAreas")],h);const k=h;function _e(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function Le(e){return!(!_e(e)||!me(e)?.operations?.supportsEditing||"editingEnabled"in e&&!fe(e)||J(e))}const A=()=>w.getLogger("esri.support.basemapUtils");function Ie(){return{}}function Se(e){for(const t in e){const r=e[t];r&&!r.destroyed&&r.destroy(),delete e[t]}}function Ae(e,t){let r;if(typeof e=="string"){const o=e in G,n=!o&&e.includes("/");if(!o&&!n){if(de())A().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const p=Object.entries(G).filter(([u,c])=>c.classic||c.is3d).map(([u])=>`"${u}"`).sort().join(", ");A().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${p}`)}return null}t&&(r=t[e]),r||(r=o?g.fromId(e):new g({style:{id:e}}),t&&(t[e]=r))}else r=B(g,e);return r?.destroyed&&(A().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}const q={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Te(e){let t=null;if(typeof e=="string")if(e in q){const r=q[e];t=new _({resourceInfo:{data:{layers:[r]}}})}else w.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=B(_,e);return t}let l=class extends ge(be(ie)){constructor(e){super(e),this.allLayers=new C({getCollections:()=>[this.basemap?.baseLayers,this.basemap?.groundLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.focusAreas=new k,this.allTables=ve(this),this.basemap=null,this.editableLayers=new C({getCollections:()=>[this.allLayers],itemFilterFunction:Le}),this.ground=new _,this._basemapCache=Ie(),this.addHandles(ne(()=>this.ground,(t,r)=>{r?.parent===this&&(r.parent=null),t.parent=this},{sync:!0}))}destroy(){Se(this._basemapCache),this._basemapCache=null,this.focusAreas.destroy(),this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=T(this.basemap),T(this.ground),this._set("ground",null)}castBasemap(e){return Ae(e,this._basemapCache)}castGround(e){return Te(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};s([a({readOnly:!0,dependsOn:[]})],l.prototype,"allLayers",void 0),s([a({type:k,nonNullable:!0,json:{write:{overridePolicy:e=>({enabled:e.areas.length>0,ignoreOrigin:!0})}}})],l.prototype,"focusAreas",void 0),s([a({readOnly:!0})],l.prototype,"allTables",void 0),s([a({type:g,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],l.prototype,"basemap",void 0),s([F("basemap")],l.prototype,"castBasemap",null),s([a({readOnly:!0})],l.prototype,"editableLayers",void 0),s([a({type:_,nonNullable:!0})],l.prototype,"ground",void 0),s([F("ground")],l.prototype,"castGround",null),s([a()],l.prototype,"undoRedo",void 0),l=s([y("esri.Map")],l);const je=l,Qe=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));export{je as L,Qe as M,Le as e,We as o};
