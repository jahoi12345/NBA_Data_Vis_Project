import{I as C}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{l as z}from"./screenUtils-BitdhK1O-L0FLPAMi.js";import{v}from"./Layer-DZvC7bne-D3VLDrab.js";import{f as P,a7 as U,a8 as _,b as A}from"./Point-BfTTZoMu-DeJwQYfh.js";import{v as G}from"./quantizationUtils-Ceq-Uxsu-DjgKK_0s.js";import{_ as R,a as Y}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import{I as j,C as D}from"./heatmapUtils-B-AXnq0l-BF3Q_jd2.js";import{P as S}from"./utils-BbtW4lHb-D1wApKS_.js";import{a as E,y as V}from"./utils-BEeBypEk-DQLTC4jR.js";let c=null;const k=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function q(n,e,t){return n.x<0?n.x+=e:n.x>t&&(n.x-=e),n}function re(n,e,t,i){const r=U(t)?_(t):null,s=r?Math.round((r.valid[1]-r.valid[0])/e.scale[0]):null;return n.map(a=>{const l=new A(a.geometry);return G(e,l,l),a.geometry=r?q(l,s??0,i[0]):l,a})}function oe(n,e=18,t,i,r){const s=new Float64Array(i*r);e=Math.round(z(e));let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const x=j(t);for(const{geometry:p,attributes:F}of n){const{x:g,y:f}=p,I=Math.max(0,g-e),N=Math.max(0,f-e),M=Math.min(r,f+e),w=Math.min(i,g+e),h=+x(F);for(let m=N;m<M;m++)for(let d=I;d<w;d++){const $=m*i+d,b=D(d-g,m-f,e)*h,u=s[$]+=b;a=Math.min(a,u),l=Math.max(l,u)}}return{min:a,max:l}}function L(n){const e=k.exec(n);if(!e)return null;const{hh:t,mm:i,ss:r,ms:s}=e.groups;return Number(t)*v.hours+Number(i)*v.minutes+Number(r)*v.seconds+Number(s||0)}async function se(n,e,t=!0){if(!e)return[];const{field:i,field2:r,field3:s,fieldDelimiter:a,fieldInfos:l,timeZone:x}=n,p=i&&l?.find(u=>u.name.toLowerCase()===i.toLowerCase()),F=!!p&&R(p),g=!!p&&S(p),f=n.valueExpression,I=n.normalizationType,N=n.normalizationField,M=n.normalizationTotal,w=[],h=n.viewInfoParams;let m=null,d=null;if(f){if(!c){const{arcadeUtils:u}=await Y();c=u}c.hasGeometryOperations(f)&&await c.enableGeometryOperations(),m=c.createFunction(f),d=h?c.getViewInfo({viewingMode:h.viewingMode,scale:h.scale,spatialReference:new P(h.spatialReference)}):null}const $=n.fieldInfos,b=!(e[0]&&"declaredClass"in e[0]&&e[0].declaredClass==="esri.Graphic")&&$?{fields:$}:null;return e.forEach(u=>{const y=u.attributes;let o;if(f){const T=b?Object.assign({},u,{layer:b}):u,O=c.createExecContext(T,d,x);o=c.executeFunction(m,O)}else y&&(o=y[i],r?(o=`${E(o)}${a}${E(y[r])}`,s&&(o=`${o}${a}${E(y[s])}`)):typeof o=="string"&&t&&(g?o=o?new Date(o).getTime():null:F&&(o=o?L(o):null)));if(I&&typeof o=="number"&&isFinite(o)){const T=y&&parseFloat(y[N]);o=V(o,I,T,M)}w.push(o)}),w}function ae(n){const e=n.field,t=n.normalizationType,i=n.normalizationField;let r;return t==="field"?r="(NOT "+i+" = 0)":t!=="log"&&t!=="natural-log"&&t!=="square-root"||(r=`(${e} > 0)`),r}function le(n,e,t){const i=e!=null?n+" >= "+e:"",r=t!=null?n+" <= "+t:"";let s="";return s=i&&r?Z(i,r):i||r,s?"("+s+")":""}function Z(n,e){let t=n??"";return e!=null&&e&&(t=t?"("+t+") AND ("+e+")":e),t}function ue(n,e){if(n&&n.spatialRelationship!=="intersects")return new C(e,"Only 'intersects' spatialRelationship is supported for featureFilter")}function fe(n,e,t){const i=B({layer:n,fields:e});if(i.length)return new C(t,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");const r=W({layer:n,fields:e});return r.length?new C(t,"Unsupported fields: "+r.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0}function B(n){const e=n.layer;return n.fields.filter(t=>!e.getField(t))}function W(n){const e=n.layer;return n.fields.filter(t=>{const i=e.getFieldUsageInfo(t);return!i||!i.supportsStatistics})}export{Z as B,ae as a,fe as f,re as i,le as l,oe as o,L as q,se as s,ue as u};
