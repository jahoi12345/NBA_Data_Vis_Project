import{B as vn,s as wi,y as xn,A as bn}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{aP as yn,aC as Sn,aQ as wn,aq as _i,F as Re,E as Pi,a as zi,I as _n}from"./Polygon-D6wEPb3W-CpL9Efjx.js";import{C as Pn,z as Rt,s as zn,a as An,t as On,G as Cn,k as Mn,h as Rn}from"./mat4-C96X-Nn0-Do6fKsNS.js";import{n as Ze}from"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import{m as $n,r as J,o as $t}from"./vec2f64-rIxtbMRN-Kai9mK1i.js";import{I as T,L as X,V as Y,l as I,$ as q,k as V,x as ne,v as Tt,O as U,h as Tn,W as Dn,A as Z,z as Gt,c as st,i as Vn,F as ie}from"./vec32-CewSdTn3-DHOFKD0R.js";import{r as Fn,M as Oe,t as D,X as Ce,a as jn}from"./collectionUtils-jDyktm0P-ArdXNs6F.js";import{s as En,I as Un,N as vt,T as Nt,o as Ke,m as Ln,e as Bn}from"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import{y as Dt,L as In}from"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import{a as Ai,_ as Hn}from"./BufferView-Cj2sQaht-DuP-iLZg.js";import{u as kn,a as xt,be as Wn,o as ce,g as K,aK as Gn,cc as Nn,Y as qn,cd as Yn,ce as Xn,av as Zn,aw as Kn,cf as Qn,cg as qt,ch as Jn,ax as Yt,ci as Xt,cj as er,ck as tr,s as ir,N as nr,B as rr,F as sr,al as or,bJ as ar,aU as lr,ao as cr,cl as ur,cm as Zt,ba as te,P as hr,c as Oi,aO as fr,d as dr,aP as Vt,j as Ne,cn as pr,br as mr,i as Ci,bm as Mi,U as Ri,co as gr,cp as vr,cq as xr,cr as br,cs as yr,ay as Sr,bk as wr,M as _r,aM as Pr,aS as zr,bl as Kt,aT as ot,A as Ar,bq as Or,aN as Cr,ca as H}from"./Texture-CFNZjV2R-lGBztxVp.js";import{T as at,l as $i,n as _,y as bt,u as Mr,C as Qt,m as k}from"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import{H as Rr}from"./index-CTl7hdrJ.js";import{p as Ti,n as $r}from"./InterleavedLayout-B7roQAzV-CC2VYRPC.js";import{_ as Tr,N as Dr,E as Jt}from"./enums-B4pqBiXb-BO-3hS_8.js";import{c as Vr}from"./VertexElementDescriptor-BlxU8vCE-BwuKQkTU.js";import{a2 as ei,ao as Ue,bF as Fr,bG as jr,v as Er,Y as W}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{F as Di,f as Vi,a5 as Fi,aC as ti,a6 as Ur}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{S as Lr,z as Br}from"./vec42-B8VM4vXb-BnA9MysM.js";import{$ as Ir,N as Hr}from"./projectionUtils-BGH_5_I3-BySNUA-B.js";import{x as kr,s as Wr,n as Gr}from"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import{$ as Nr}from"./meshVertexSpaceUtils-CtG7DPVT-V_uCtHpB.js";import{h as Qe,x as yt}from"./projectVectorToVector-Csv3NYZI-BsIKHfQD.js";import{s as qr}from"./Graphic-DgGzDmqW-CFzg0c4i.js";import{P as Yr}from"./jsonUtils-CmpazY1u-ateEpj4Q.js";import{r as G,_ as ii,o as ee}from"./vec3f32-WCVSSNPR-9V6Uhrx-.js";import{i as Xr}from"./DoubleArray-DExKNiTh-CvVpHySW.js";import{g as ji,h as Zr}from"./Indices-D0_UQPPr-t1Qev6md.js";import{K as Je,P as Ft,x as qe,A as Kr,b as Ei,H as St,p as Qr,z as Jr,L as es,W as ts,U as is,_ as ns,X as rs}from"./plane-BNdSPG2o-Cq7jmU6w.js";import{g as ss,i as os,e as jt,l as as,b as ls}from"./sphere-DLQ6p7mp-DmnRpHXV.js";import{a as C}from"./orientedBoundingBox-BLEx7wLU-CPBtS4XC.js";import{h as cs,p as us}from"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import{v as hs}from"./HUDIntersectorResult-1xTExS7z-CU1-YQoW.js";import{d as fs}from"./Intersector-DS9YtyQY-CuzM48xl.js";import{z as Ui}from"./spatialReferenceEllipsoidUtils-D2JabnKt-Cip58jmo.js";import{l as ds}from"./projectPointToVector-DL7Z4uvb-BbcUuq8O.js";import{u as ni,k as ps,P as ms}from"./frustum-CMzahy3--CFytpSYl.js";import{z as E,H as gs,F as Le}from"./vector-B8ZDYGQ6-B1uNywRb.js";import"./lengthUtils-Dt1_RvOO-bleznLOi.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import"./normalizeUtils-85zLqeMi-DCF9gKvo.js";import"./Polyline-CoiTLswR-BLagWJLS.js";import"./normalizeUtilsCommon-CnhQye_A-zWtr51r8.js";import"./utils-CylVuxNi-CqOfmBVG.js";import"./utils-Dpg4yj1D-BVnuoMV8.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./videoUtils-Dwx3AEgj-CduhpDRk.js";import"./types-BKo2foNY-DE0QfIFp.js";import"./MeshLocalVertexSpace-BGd1IdEs-DqCdtROz.js";import"./getPopupProvider-CmskPttI-C4PqyuPF.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./Layer-DZvC7bne-m1cEC_yw.js";import"./typeUtils-DqrRcjBx-ZWdHcSIJ.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./typeUtils-CXW_VpOn-BoSnXkME.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-Vi0-2Gvc.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./Font-BwmnW7d2-D-oIm_Md.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./PictureMarkerSymbol-CaSh-vZk-BNpExnAb.js";import"./TextSymbol-hRGhyDHs-C0NgASym.js";import"./quat-B7J5v7rV-i-DOMCm_.js";import"./quatf64-CCm9z-pX-CQ7_sSji.js";import"./computeTranslationToOriginAndRotation-Bjd4esRf-CXUng2L4.js";const lt=()=>Er.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function Te(t=qi){return{plane:Je(t.plane),origin:Ce(t.origin),basis1:Ce(t.basis1),basis2:Ce(t.basis2)}}function vs(t,e,i){const n=Vs.get();return n.origin=t,n.basis1=e,n.basis2=i,n.plane=Qr(0,0,0,0),tt(n),n}function et(t,e=Te()){return Et(t.origin,t.basis1,t.basis2,e)}function xs(t,e){T(e.origin,t.origin),T(e.basis1,t.basis1),T(e.basis2,t.basis2),ts(e.plane,t.plane)}function Et(t,e,i,n=Te()){return T(n.origin,t),T(n.basis1,e),T(n.basis2,i),tt(n),Ts(n,"fromValues()"),n}function tt(t){St(t.basis2,t.basis1,t.origin,t.plane)}function Li(t,e,i){t!==i&&et(t,i);const n=V(E.get(),re(t),e);return U(i.origin,i.origin,n),i.plane[3]-=e,i}function bs(t,e,i){return Bi(e,i),Li(i,Bt(t,t.origin),i),i}function ys(t,e){const i=t.basis1[0],n=t.basis2[1],[r,s]=t.origin;return In(r-i,s-n,r+i,s+n,e)}function Bi(t,e=Te()){const i=(t[2]-t[0])/2,n=(t[3]-t[1])/2;return X(e.origin,t[0]+i,t[1]+n,0),X(e.basis1,i,0,0),X(e.basis2,0,n,0),es(0,0,1,0,e.plane),e}function Ut(t,e,i){return!!Ft(t.plane,e,i)&&Gi(t,i)}function Ss(t,e,i){if(Ut(t,e,i))return i;const n=Ii(t,e,E.get());return U(i,e.origin,V(E.get(),e.direction,Tt(e.origin,n)/ne(e.direction))),i}function Ii(t,e,i){const n=Ye.get();Ni(t,e,n,Ye.get());let r=Number.POSITIVE_INFINITY;for(const s of Ht){const o=It(t,s,it.get()),l=E.get();if(is(n,o,l)){const c=Vn(E.get(),e.origin,l),a=Math.abs(bn(Z(e.direction,c)));a<r&&(r=a,T(i,l))}}return r===Number.POSITIVE_INFINITY?Hi(t,e,i):i}function ws(t,e){return(e-t)/e}function Hi(t,e,i){if(Ut(t,e,i))return i;const n=Ye.get(),r=Ye.get();Ni(t,e,n,r);let s=Number.POSITIVE_INFINITY;for(const o of Ht){const l=It(t,o,it.get()),c=E.get();if(ns(n,l,c)){const a=as(e,c);if(!Ei(r,c))continue;a<s&&(s=a,T(i,c))}}return Lt(t,e.origin)<s&&ki(t,e.origin,i),i}function ki(t,e,i){const n=Jr(t.plane,e,E.get()),r=ni(ri(t,t.basis1),n,-1,1,E.get()),s=ni(ri(t,t.basis2),n,-1,1,E.get());return q(i,U(E.get(),r,s),t.origin),i}function Wi(t,e,i){const{origin:n,basis1:r,basis2:s}=t,o=q(E.get(),e,n),l=Le(r,o),c=Le(s,o),a=Le(re(t),o);return X(i,l,c,a)}function Lt(t,e){const i=Wi(t,e,E.get()),{basis1:n,basis2:r}=t,s=ne(n),o=ne(r),l=Math.max(Math.abs(i[0])-s,0),c=Math.max(Math.abs(i[1])-o,0),a=i[2];return l*l+c*c+a*a}function _s(t,e){return Math.sqrt(Lt(t,e))}function Ps(t,e){let i=Number.NEGATIVE_INFINITY;for(const n of Ht){const r=It(t,n,it.get()),s=ps(r,e);s>i&&(i=s)}return Math.sqrt(i)}function zs(t,e){return Ei(t.plane,e)&&Gi(t,e)}function As(t,e,i,n){return $s(t,i,n)}function Bt(t,e){const i=-t.plane[3];return Le(re(t),e)-i}function Os(t,e,i,n){const r=Bt(t,e),s=V(Ds,re(t),i-r);return U(n,e,s),n}function Cs(t,e){return st(t.basis1,e.basis1)&&st(t.basis2,e.basis2)&&st(t.origin,e.origin)}function Ms(t,e,i){return t!==i&&et(t,i),Rt(me,e),Cn(me,me),Y(i.basis1,t.basis1,me),Y(i.basis2,t.basis2,me),Y(qe(i.plane),qe(t.plane),me),Y(i.origin,t.origin,e),Kr(i.plane,i.plane,i.origin),i}function Rs(t,e,i,n){return t!==n&&et(t,n),Rn(ct,e,i),Y(n.basis1,t.basis1,ct),Y(n.basis2,t.basis2,ct),tt(n),n}function re(t){return qe(t.plane)}function $s(t,e,i){switch(e){case 0:T(i,t.basis1),I(i,i);break;case 1:T(i,t.basis2),I(i,i);break;case 2:T(i,re(t))}return i}function Gi(t,e){const i=q(E.get(),e,t.origin),n=Gt(t.basis1),r=Gt(t.basis2),s=Z(t.basis1,i),o=Z(t.basis2,i);return-s-n<0&&s-n<0&&-o-r<0&&o-r<0}function ri(t,e){const i=it.get();return T(i.origin,t.origin),T(i.vector,e),i}function It(t,e,i){const{basis1:n,basis2:r,origin:s}=t,o=V(E.get(),n,e.origin[0]),l=V(E.get(),r,e.origin[1]);U(i.origin,o,l),U(i.origin,i.origin,s);const c=V(E.get(),n,e.direction[0]),a=V(E.get(),r,e.direction[1]);return V(i.vector,U(c,c,a),2),i}function Ts(t,e){Math.abs(Z(t.basis1,t.basis2)/(ne(t.basis1)*ne(t.basis2)))>1e-6&&lt().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Z(t.basis1,re(t)))>1e-6&&lt().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Z(re(t),t.origin)-t.plane[3])>1e-6&&lt().warn(e,"Plane offset is not consistent with plane origin")}function Ni(t,e,i,n){const r=re(t);St(r,e.direction,e.origin,i),St(qe(i),r,e.origin,n)}const qi={plane:Je(),origin:Oe(0,0,0),basis1:Oe(1,0,0),basis2:Oe(0,1,0)},Ye=new jt(Je),it=new jt(ms),Ds=D(),Vs=new jt(()=>Te()),Ht=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],me=Ze(),ct=Ze(),Fs=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:Bt,axisAt:As,cameraFrustumCoverage:ws,closestPoint:Hi,closestPointOnSilhouette:Ii,copy:et,copyWithoutVerify:xs,create:Te,distance:_s,distance2:Lt,distanceToSilhouette:Ps,elevate:Li,equals:Cs,extrusionContainsPoint:zs,fromAABoundingRect:Bi,fromValues:Et,getExtent:ys,intersectRay:Ut,intersectRayClosestSilhouette:Ss,normal:re,projectPoint:ki,projectPointLocal:Wi,rotate:Rs,setAltitudeAt:Os,setExtent:bs,transform:Ms,up:qi,updateUnboundedPlane:tt,wrap:vs},Symbol.toStringTag,{value:"Module"}));function js(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function Es(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function Us(t,e){return t.operations.getExtent(t.value,e),e}function Ls(t){return{operations:t,value:t.create()}}function Yi(t,e,i=Ls(t)){return i.operations=t,t.copy(e,i.value),i}function Bs(t){return Yi(os,ss(0,0,0,Fi(t).radius))}const si=2**50;function Is(){return Yi(Fs,Et([0,0,0],[si,0,0],[0,si,0]))}function Hs(t,e,i){return t.operations.axisAt(t.value,e,2,i)}function ks(t,e,i,n){return t.operations.axisAt(t.value,e,i,n)}function Ws(t,e,i){return t.operations.intersectRay(t.value,e,i)}function Gs(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function Ns(t,e){return t.operations.altitudeAt(t.value,e)}function Xi(t,e,i,n){return t.operations.setAltitudeAt(t.value,e,i,n)}function qs(t,e,i,n){return e!==n&&Mn(n,e),X(ge,n[12],n[13],n[14]),Xi(t,ge,i,ge),n[12]=ge[0],n[13]=ge[1],n[14]=ge[2],n}function ut(t,e,i){return t.operations.elevate(t.value,e,i.value)}const ge=D();function Tl(t,e,i,n,r){return r[0]=Z(t,e),r[1]=Z(t,i),r[2]=Z(t,n),r}function Dl(t,e,i,n,r){T(i,t),T(Ve,e),I(Ve,Ve),ie(n,Ve,i),ie(r,n,i)}function Vl(t,e){return t?Ui(e):e.isGeographic?Vi.PlateCarree:e}const Ve=D();function Zi(t,e,i){return!!yt(t,e,Fe,i.spatialReference)&&(i.x=Fe[0],i.y=Fe[1],i.z=Fe[2],!0)}async function Fl(t,e,i,n){return await Hr(e,i.spatialReference,null,n),Zi(t,e,i)}const Fe=D();function oi(t){return t.type==="point"}function Ys(t){return t instanceof Float32Array&&t.length>=16}function Xs(t){return Array.isArray(t)&&t.length>=16}function Zs(t){return Ys(t)||Xs(t)}const Ki=.5;function Ks(t,e){t.include(Oi),t.attributes.add("position","vec3"),t.attributes.add("normal","vec3"),t.attributes.add("centerOffsetAndDistance","vec4");const i=t.vertex;fr(i,e),dr(i,e),i.uniforms.add(new Vt("viewport",n=>n.camera.fullViewport),new bt("polygonOffset",n=>n.shaderPolygonOffset),new Ne("cameraGroundRelative",n=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&pr(i),i.code.add(_`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(_`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.terrainDepthTest?_.float(0):_`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||mr(i),e.draped||(i.uniforms.add(new Ne("perDistancePixelRatio",n=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(_`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${_.float(Ki)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&Ci(i),e.hasScreenSizePerspective&&Mi(i),i.code.add(_`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?_`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":_`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function kt(t){t.uniforms.add(new hr("alignPixelEnabled",e=>e.alignPixelEnabled)),t.code.add(_`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(_`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function Qs(t,e){const{vertex:i,fragment:n}=t;t.include(Cr,e),i.include(kt),i.main.add(_`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),n.main.add(_`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)}function Js(t){t.vertex.uniforms.add(new Ne("renderTransparentlyOccludedHUD",e=>e.hudRenderStyle===0?1:e.hudRenderStyle===1?0:.75),new Vt("viewport",e=>e.camera.fullViewport),new Ri("hudVisibilityTexture",e=>e.hudVisibility?.getTexture())),t.vertex.include(kt),t.vertex.code.add(_`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}let eo=class extends Mr{constructor(t,e,i){super(t,"vec4",2,(n,r,s)=>n.setUniform4fv(t,e(r,s),i))}};function Qi(t){const e=new Sr,{signedDistanceFieldEnabled:i,occlusionTestEnabled:n,horizonCullingEnabled:r,pixelSnappingEnabled:s,hasScreenSizePerspective:o,debugDrawLabelBorder:l,hasVVSize:c,hasVVColor:a,hasRotation:u,occludedFragmentFade:h,sampleSignedDistanceFieldTexelCenter:f}=t;e.include(Ks,t),e.vertex.include(wr,t);const{occlusionPass:x,output:S,oitPass:v}=t;if(x)return e.include(Qs,t),e;const{vertex:p,fragment:g}=e;e.include(Oi),e.include(_r,t),e.include(Pr,t),n&&e.include(Js),g.include(zr),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2");const b=S===9,m=b&&n;m&&e.varyings.add("voccluded","float"),p.uniforms.add(new Vt("viewport",w=>w.camera.fullViewport),new Kt("screenOffset",(w,N)=>Re(Be,2*w.screenOffset[0]*N.camera.pixelRatio,2*w.screenOffset[1]*N.camera.pixelRatio)),new Kt("anchorPosition",w=>Pe(w)),new ot("materialColor",w=>w.color),new bt("materialRotation",w=>w.rotation),new Qt("tex",w=>w.texture)),Ci(p),i&&(p.uniforms.add(new ot("outlineColor",w=>w.outlineColor)),g.uniforms.add(new ot("outlineColor",w=>ai(w)?w.outlineColor:Ln),new bt("outlineSize",w=>ai(w)?w.outlineSize:0))),r&&p.uniforms.add(new eo("pointDistanceSphere",(w,N)=>{const y=N.camera.eye,F=w.origin;return Bn(F[0]-y[0],F[1]-y[1],F[2]-y[2],Ur.radius)})),s&&p.include(kt),o&&(Ar(p),Mi(p)),l&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add("uv0","vec2"),e.attributes.add("uvi","vec4"),e.attributes.add("color","vec4"),e.attributes.add("size","vec2"),e.attributes.add("rotation","float"),(c||a)&&e.attributes.add("featureAttribute","vec4"),p.code.add(r?_`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return b > 0.0 && b < a && b * b  > a * c;
}`:_`bool behindHorizon(vec3 posModel) { return false; }`),p.main.add(_`
    ProjectHUDAux projectAux;
    vec4 posProj = projectPositionHUD(projectAux);
    forwardObjectAndLayerIdColor();

    if (rejectBySlice(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    if (behindHorizon(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    vec2 inputSize;
    ${k(o,_`
        inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
        vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,_`
        inputSize = size;
        vec2 screenOffsetScaled = screenOffset;`)}
    ${k(c,_`inputSize *= vvScale(featureAttribute).xx;`)}

    vec2 combinedSize = inputSize * pixelRatio;
    vec4 quadOffset = vec4(0.0);

    ${k(n,_`
    bool visible = testHUDVisibility(posProj);
    if (!visible) {
      vtc = vec2(0.0);
      ${k(l,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
      return;
    }`)}
    ${k(m,_`voccluded = visible ? 0.0 : 1.0;`)}
  `);const O=_`
      vec2 uv = mix(uvi.xy, uvi.zw, bvec2(uv0));
      vec2 texSize = vec2(textureSize(tex, 0));
      uv = mix(vec2(1.0), uv / texSize, lessThan(uv, vec2(${io})));
      quadOffset.xy = (uv0 - anchorPosition) * 2.0 * combinedSize;

      ${k(u,_`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,d=s?i?_`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:_`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:_`posProj += quadOffset;`;p.main.add(_`
    ${O}
    ${a?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${k(S===10,_`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${_.float(ce)};
    ${k(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${_.float(ce)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${d}
      gl_Position = posProj;
    }

    vtc = uv;

    ${k(l,_`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),g.uniforms.add(new Qt("tex",w=>w.texture)),h&&!b&&g.uniforms.add(new Ri("depthMap",w=>w.mainDepth),new Ne("occludedOpacity",w=>w.hudOccludedFragmentOpacity));const z=l?_`(isBorder > 0.0 ? 0.0 : ${_.float(ce)})`:_.float(ce),A=_`
    ${k(l,_`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    vec2 samplePos = vtc;

    ${k(f,_`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      samplePos += (vec2(1.0, -1.0) * texelSize) * scaleFactor;`)}

    ${i?_`
      vec4 fillPixelColor = vcolor;

      // Get distance in output units (i.e. pixels)

      float sdf = texture(tex, samplePos).r;
      float pixelDistance = sdf * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - pixelDistance, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(pixelDistance) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${z} ||
          fillPixelColor.a + outlinePixelColor.a < ${_.float(ce)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${k(!b,_`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${z}) {
          discard;
        }

        ${k(!b,_`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-pixelDistance/vsize.x*2.0, 0.0, 1.0), clamp(pixelDistance/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:_`
          vec4 texColor = texture(tex, samplePos, -0.5);
          if (texColor.a < ${z}) {
            discard;
          }
          ${k(!b,_`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${k(h&&!b,_`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${k(!b&&l,_`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(S){case 0:case 1:e.outputs.add("fragColor","vec4",0),S===1&&e.outputs.add("fragEmission","vec4",1),v===1&&e.outputs.add("fragAlpha","float",S===1?2:1),g.main.add(_`
        ${A}
        ${k(v===2,_`fragColor.rgb /= fragColor.a;`)}
        ${k(S===1,_`fragEmission = vec4(0.0);`)}
        ${k(v===1,_`fragAlpha = fragColor.a;`)}`);break;case 10:g.main.add(_`
        ${A}
        outputObjectAndLayerIdColor();`);break;case 9:e.include(Or,t),g.main.add(_`
        ${A}
        outputHighlight(${k(m,_`voccluded == 1.0`,_`false`)});`)}return e}function ai(t){return t.outlineColor[3]>0&&t.outlineSize>0}function Pe(t){return t.textureIsSignedDistanceField?to(t.anchorPosition,t.distanceFieldBoundingBox,Be):_i(Be,t.anchorPosition),Be}function to(t,e,i){Re(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1])}const Be=$t(),$e=32e3,io=_.float($e),no=Object.freeze(Object.defineProperty({__proto__:null,build:Qi,calculateAnchorPosition:Pe,fullUV:$e},Symbol.toStringTag,{value:"Module"}));let ro=class extends nr{constructor(t,e){super(t,e,new rr(no,()=>Rr(()=>Promise.resolve().then(()=>da),void 0)),Vr([Ji,tn()].map($r))),this.primitiveType=e.occlusionPass?Jt.POINTS:Jt.TRIANGLE_STRIP}initializePipeline(t){const{oitPass:e,hasPolygonOffset:i,draped:n,output:r,depthTestEnabled:s,occlusionPass:o}=t,l=s&&!n&&e!==1&&!o&&r!==9;return sr({blending:$i(r)?cr(e,!0):null,depthTest:s&&!n?{func:515}:null,depthWrite:l?lr:null,drawBuffers:ar(e,r),colorWrite:or,polygonOffset:i?so:null})}};const so={factor:0,units:-4},Ji=Ti().vec2u8("uv0",{glNormalized:!0}),en=Ti().vec3f("position").vec3f("normal").vec4i16("uvi").vec4u8("color").vec2f("size").f32("rotation").vec4f("centerOffsetAndDistance").vec4f("featureAttribute"),oo=en.clone().vec4u8("olidColor");function tn(){return ir()?oo:en}let L=class extends qn{constructor(t){super(),this.spherical=t,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.olidColorInstanced=!1,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.hasVVInstancing=!1,this.snowCover=!1}};W([H()],L.prototype,"screenCenterOffsetUnitsEnabled",void 0),W([H()],L.prototype,"occlusionTestEnabled",void 0),W([H()],L.prototype,"signedDistanceFieldEnabled",void 0),W([H()],L.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),W([H()],L.prototype,"hasVVSize",void 0),W([H()],L.prototype,"hasVVColor",void 0),W([H()],L.prototype,"hasVerticalOffset",void 0),W([H()],L.prototype,"hasScreenSizePerspective",void 0),W([H()],L.prototype,"hasRotation",void 0),W([H()],L.prototype,"debugDrawLabelBorder",void 0),W([H()],L.prototype,"hasPolygonOffset",void 0),W([H()],L.prototype,"depthTestEnabled",void 0),W([H()],L.prototype,"pixelSnappingEnabled",void 0),W([H()],L.prototype,"draped",void 0),W([H()],L.prototype,"terrainDepthTest",void 0),W([H()],L.prototype,"cullAboveTerrain",void 0),W([H()],L.prototype,"occlusionPass",void 0),W([H()],L.prototype,"occludedFragmentFade",void 0),W([H()],L.prototype,"horizonCullingEnabled",void 0),W([H()],L.prototype,"isFocused",void 0);class jl extends kn{constructor(e,i){super(e,po),this.produces=new Map([[13,n=>at(n)&&!this.parameters.drawAsLabel],[14,n=>at(n)&&this.parameters.drawAsLabel],[12,()=>this.parameters.occlusionTest],[18,n=>this.parameters.draped&&at(n)]]),this._visible=!0,this._configuration=new L(i)}getConfiguration(e,i){const n=this.parameters.draped;return super.getConfiguration(e,i,this._configuration),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=n,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.hasVVSize=!!this.parameters.vvSize,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===12,this._configuration.occludedFragmentFade=!n&&this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||i.slot===12,$i(e)&&(this._configuration.debugDrawLabelBorder=!!xt.LABELS_SHOW_BORDER),this._configuration.oitPass=i.oitPass,this._configuration.terrainDepthTest=i.terrainDepthTest,this._configuration.cullAboveTerrain=i.cullAboveTerrain,this._configuration}intersect(e,i,n,r,s,o){const{options:{selectionMode:l,hud:c,excludeLabels:a},point:u,camera:h}=n,{parameters:f}=this;if(!l||!c||a&&f.isLabel||!e.visible||!u||!h)return;const x=e.attributes.get("featureAttribute"),S=x==null?null:Nt(x.data,Pt),{scaleX:v,scaleY:p}=zt(S,f,h.pixelRatio);Pi(Ie,i),e.attributes.has("featureAttribute")&&co(Ie);const g=e.attributes.get("position"),b=e.attributes.get("size"),m=e.attributes.get("normal"),O=e.attributes.get("rotation"),d=e.attributes.get("centerOffsetAndDistance");Ai(g.size>=3);const z=Pe(f),A=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<g.data.length/g.size;w++){const N=w*g.size;X(M,g.data[N],g.data[N+1],g.data[N+2]),Y(M,M,i),Y(M,M,h.viewMatrix);const y=w*d.size;if(X(j,d.data[y],d.data[y+1],d.data[y+2]),!A&&(M[0]+=j[0],M[1]+=j[1],j[2]!==0)){const $=j[2];I(j,M),q(M,M,V(j,j,$))}const F=w*m.size;if(X(fe,m.data[F],m.data[F+1],m.data[F+2]),wt(fe,Ie,h,Me),At(this.parameters,M,Me,h,ye),h.applyProjection(M,R),R[0]>-1){A&&(j[0]||j[1])&&(R[0]+=j[0]*h.pixelRatio,j[1]!==0&&(R[1]+=ye.alignmentEvaluator.apply(j[1])*h.pixelRatio),h.unapplyProjection(R,M)),R[0]+=this.parameters.screenOffset[0]*h.pixelRatio,R[1]+=this.parameters.screenOffset[1]*h.pixelRatio,R[0]=Math.floor(R[0]),R[1]=Math.floor(R[1]);const $=w*b.size;B[0]=b.data[$],B[1]=b.data[$+1],ye.evaluator.applyVec2(B,B);const se=sn*h.pixelRatio;let pe=0;f.textureIsSignedDistanceField&&(pe=Math.min(f.outlineSize,.5*B[0])*h.pixelRatio/2),B[0]*=v,B[1]*=p;const oe=w*O.size,Q=f.rotation+O.data[oe];if(_t(u,R[0],R[1],B,se,pe,Q,f,z)){const ue=n.ray;if(Y(Xe,M,Rt(rn,h.viewMatrix)),R[0]=u[0],R[1]=u[1],h.unprojectFromRenderScreen(R,M)){const P=D();T(P,ue.direction);const ze=1/ne(P);V(P,P,ze),o(Tt(ue.origin,M)*ze,P,-1,Xe)}}}}}intersectDraped(e,i,n,r,s){const o=e.attributes.get("position"),l=e.attributes.get("size"),c=e.attributes.get("rotation"),a=this.parameters,u=Pe(a),h=e.attributes.get("featureAttribute"),f=h==null?null:Nt(h.data,Pt),{scaleX:x,scaleY:S}=zt(f,a,e.screenToWorldRatio),v=ho*e.screenToWorldRatio;for(let p=0;p<o.data.length/o.size;p++){const g=p*o.size,b=o.data[g],m=o.data[g+1],O=p*l.size;B[0]=l.data[O],B[1]=l.data[O+1];let d=0;a.textureIsSignedDistanceField&&(d=Math.min(a.outlineSize,.5*B[0])*e.screenToWorldRatio/2),B[0]*=x,B[1]*=S;const z=p*c.size,A=a.rotation+c.data[z];_t(n,b,m,B,v,d,A,a,u)&&r(s.distance,s.normal,-1)}}createBufferWriter(){return new mo}applyShaderOffsetsView(e,i,n,r,s,o,l){const c=wt(i,n,s,Me);return this._applyVerticalGroundOffsetView(e,c,s,l),At(this.parameters,l,c,s,o),this._applyPolygonOffsetView(l,c,r[3],s,l),this._applyCenterOffsetView(l,r,l),l}applyShaderOffsetsNDC(e,i,n,r,s){return this._applyCenterOffsetNDC(e,i,n,r),s!=null&&T(s,r),this._applyPolygonOffsetNDC(r,i,n,r),r}_applyPolygonOffsetView(e,i,n,r,s){const o=r.aboveGround?1:-1;let l=Math.sign(n);l===0&&(l=o);const c=o*l;if(this.parameters.shaderPolygonOffset<=0)return T(s,e);const a=wi(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-a*a)/a/r.viewport[2];return V(s,e,c>0?u:1/u),s}_applyVerticalGroundOffsetView(e,i,n,r){const s=ne(e),o=n.aboveGround?1:-1,l=n.computeRenderPixelSizeAtDist(s)*Ki,c=V(M,i.normal,o*l);return U(r,e,c),r}_applyCenterOffsetView(e,i,n){const r=this.parameters.centerOffsetUnits!=="screen";return n!==e&&T(n,e),r&&(n[0]+=i[0],n[1]+=i[1],i[2]&&(I(fe,n),Tn(n,n,V(fe,fe,i[2])))),n}_applyCenterOffsetNDC(e,i,n,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&T(r,e),s||(r[0]+=i[0]/n.fullWidth*2,r[1]+=i[1]/n.fullHeight*2),r}_applyPolygonOffsetNDC(e,i,n,r){const s=this.parameters.shaderPolygonOffset;if(e!==r&&T(r,e),s){const o=n.aboveGround?1:-1,l=o*Math.sign(i[3]);r[2]-=(l||o)*s}return r}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:i,outlineColor:n}=this.parameters,r=e[3]>=ce||i>=ce&&n[3]>=ce;return this._visible&&r}createGLMaterial(e){return new ao(e)}calculateRelativeScreenBounds(e,i,n=Dt()){return lo(this.parameters,e,i,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}}class ao extends tr{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(ro,e)}}function lo(t,e,i,n){n[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,n[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function wt(t,e,i,n){return Zs(e)&&(e=Pi(uo,e)),Dn(n.normal,t,e),Y(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=Z(nn,fo),n}function co(t){const e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],l=t[6],c=t[7],a=t[8],u=1/Math.sqrt(e*e+i*i+n*n),h=1/Math.sqrt(r*r+s*s+o*o),f=1/Math.sqrt(l*l+c*c+a*a);return t[0]=e*u,t[1]=i*u,t[2]=n*u,t[3]=r*h,t[4]=s*h,t[5]=o*h,t[6]=l*f,t[7]=c*f,t[8]=a*f,t}function _t(t,e,i,n,r,s,o,l,c){let a=e-r-n[0]*c[0],u=a+n[0]+2*r,h=i-r-n[1]*c[1],f=h+n[1]+2*r;const x=l.distanceFieldBoundingBox;return l.textureIsSignedDistanceField&&x!=null&&(a+=n[0]*x[0],h+=n[1]*x[1],u-=n[0]*(1-x[2]),f-=n[1]*(1-x[3]),a-=s,u+=s,h-=s,f+=s),Re(li,e,i),_n(Ae,t,li,xn(o)),Ae[0]>a&&Ae[0]<u&&Ae[1]>h&&Ae[1]<f}const ye=new Wn,M=D(),fe=D(),R=Ke(),nn=D(),Xe=D(),Ae=$t(),li=$t(),Ie=zi(),uo=zi(),rn=Ze(),je=Ke(),j=D(),ht=D(),Pt=Ke(),Me={normal:nn,cosAngle:0},sn=1,ho=2,B=J(0,0),fo=Oe(0,0,1);class po extends Nn{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1,this.color=vt(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=J(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=vt(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=Ke(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusStyle="bright",this.draped=!1,this.isLabel=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}class mo{constructor(){this.layout=Ji,this.instanceLayout=tn()}elementCount(e){return e.get("position").indices.length}elementCountBaseInstance(e){return e.get("uv0").indices.length}write(e,i,n,r,s,o){const{position:l,normal:c,color:a,size:u,rotation:h,centerOffsetAndDistance:f,featureAttribute:x,uvi:S}=s;Zn(n.get("position"),e,l,o),Kn(n.get("normal"),i,c,o);const v=n.get("position").indices.length;let p=0,g=0,b=$e,m=$e;const O=n.get("uvi")?.data;O&&O.length>=4&&(p=O[0],g=O[1],b=O[2],m=O[3]);for(let d=0;d<v;++d){const z=o+d;S.setValues(z,p,g,b,m)}if(Qn(n.get("color"),4,a,o),qt(n.get("size"),u,o),Jn(n.get("rotation"),h,o),n.get("centerOffsetAndDistance")?Yt(n.get("centerOffsetAndDistance"),f,o):Xt(f,o,v),n.get("featureAttribute")?Yt(n.get("featureAttribute"),x,o):Xt(x,o,v),r!=null){const d=n.get("position")?.indices;if(d){const z=d.length,A=s.getField("olidColor",Hn);er(r,A,z,o)}}return{numVerticesPerItem:1,numItems:v}}writeBaseInstance(e,i){const{uv0:n}=i;qt(e.get("uv0"),n,0)}intersect(e,i,n,r,s,o,l){const{options:{selectionMode:c,hud:a,excludeLabels:u},point:h,camera:f}=r;if(!c||!a||u&&i.isLabel||!h)return;const x=this.instanceLayout.createView(e),{position:S,normal:v,rotation:p,size:g,featureAttribute:b,centerOffsetAndDistance:m}=x,O=i.centerOffsetUnits==="screen",d=Pe(i);if(S==null||v==null||p==null||g==null||m==null||f==null)return;const z=b==null?null:b.getVec(0,Pt),{scaleX:A,scaleY:w}=zt(z,i,f.pixelRatio),N=S.count;for(let y=0;y<N;y++){if(S.getVec(y,M),n!=null&&U(M,M,n),Y(M,M,f.viewMatrix),m.getVec(y,je),X(j,je[0],je[1],je[2]),!O&&(M[0]+=j[0],M[1]+=j[1],j[2]!==0)){const F=j[2];I(j,M),q(M,M,V(j,j,F))}if(v.getVec(y,fe),wt(fe,Ie,f,Me),At(i,M,Me,f,ye),f.applyProjection(M,R),R[0]>-1){O&&(j[0]||j[1])&&(R[0]+=j[0]*f.pixelRatio,j[1]!==0&&(R[1]+=ye.alignmentEvaluator.apply(j[1])*f.pixelRatio),f.unapplyProjection(R,M)),R[0]+=i.screenOffset[0]*f.pixelRatio,R[1]+=i.screenOffset[1]*f.pixelRatio,R[0]=Math.floor(R[0]),R[1]=Math.floor(R[1]),g.getVec(y,B),ye.evaluator.applyVec2(B,B);const F=sn*f.pixelRatio;let $=0;i.textureIsSignedDistanceField&&($=Math.min(i.outlineSize,.5*B[0])*f.pixelRatio/2),B[0]*=A,B[1]*=w;const se=p.get(y),pe=i.rotation+se;if(_t(h,R[0],R[1],B,F,$,pe,i,d)){const oe=r.ray;if(Y(Xe,M,Rt(rn,f.viewMatrix)),R[0]=h[0],R[1]=h[1],f.unprojectFromRenderScreen(R,M)){const Q=D();T(Q,oe.direction);const ue=1/ne(Q);V(Q,Q,ue),l(Tt(oe.origin,M)*ue,Q,y,Xe)}}}}}}function zt(t,e,i){return t==null||e.vvSize==null?{scaleX:i,scaleY:i}:(Yn(ht,e,t),{scaleX:ht[0]*i,scaleY:ht[1]*i})}function At(t,e,i,n,r){if(!t.verticalOffset?.screenLength){const c=ne(e);return r.update(i.cosAngle,c,t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize,t.screenSizePerspectiveAlignment,null),e}const s=ne(e),o=t.screenSizePerspectiveAlignment??t.screenSizePerspective,l=Xn(n,s,t.verticalOffset,i.cosAngle,o,t.screenSizePerspectiveMinPixelReferenceSize);return r.update(i.cosAngle,s,t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize,t.screenSizePerspectiveAlignment,null),V(i.normal,i.normal,l),U(e,e,i.normal)}function on(t){return"declaredClass"in t}function ci(t){return"declaredClass"in t}function go(t){return"declaredClass"in t}function El(t,e,i){return t?go(t)?(t.origin!==i&&(t.origin=i),t):new qr({layer:e,sourceLayer:e,origin:i,visible:t.visible,symbol:ei(t.symbol),attributes:ei(t.attributes),geometry:vo(t.geometry)}):null}function vo(t){return t==null?null:on(t)?t:Yr(xo(t))}function xo(t){const{wkid:e,wkt:i,wkt2:n,latestWkid:r}=t.spatialReference,s={wkid:e,wkt:i,wkt2:n,latestWkid:r};switch(t.type){case"point":{const{x:o,y:l,z:c,m:a}=t;return{x:o,y:l,z:c,m:a,spatialReference:s}}case"polygon":{const{rings:o,hasZ:l,hasM:c}=t;return{rings:ui(o),hasZ:l,hasM:c,spatialReference:s}}case"polyline":{const{paths:o,hasZ:l,hasM:c}=t;return{paths:ui(o),hasZ:l,hasM:c,spatialReference:s}}case"extent":{const{xmin:o,xmax:l,ymin:c,ymax:a,zmin:u,zmax:h,mmin:f,mmax:x,hasZ:S,hasM:v}=t;return{xmin:o,xmax:l,ymin:c,ymax:a,zmin:u,zmax:h,mmin:f,mmax:x,hasZ:S,hasM:v,spatialReference:s}}case"multipoint":{const{points:o,hasZ:l,hasM:c}=t;return{points:ln(o)?an(o):o,hasZ:l,hasM:c,spatialReference:s}}default:return}}function ui(t){return bo(t)?t.map(e=>an(e)):t}function an(t){return t.map(e=>Array.from(e))}function bo(t){for(const e of t)if(e.length!==0)return ln(e);return!1}function ln(t){return t.length>0&&(Fr(t[0])||jr(t[0]))}function yo(t,e){if(!t)return null;let i;if(ci(t)){if(e==null)return t.clone();if(ci(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Qe(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function Ul(t){const{wkid:e,wkt:i,wkt2:n,latestWkid:r}=t,s={wkid:e,wkt:i,wkt2:n,latestWkid:r};return Vi.fromJSON(s)}function Ll(t,e){if(t.type==="point")return le(t,e,!1);if(on(t))switch(t.type){case"extent":return le(t.center,e,!1);case"polygon":return le(fi(t),e,!1);case"polyline":return le(hi(t),e,!0);case"mesh":return le(Nr(t.vertexSpace,t.spatialReference)??t.extent.center,e,!1);case"multipoint":return}else switch(t.type){case"extent":return le(So(t),e,!0);case"polygon":return le(fi(t),e,!0);case"polyline":return le(hi(t),e,!0);case"multipoint":return}}function hi(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=yn(e,Sn(e)/2);return Qe(i[0],i[1],i[2],t.spatialReference)}function So(t){return Qe(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function fi(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=wn(t.rings,!!t.hasZ);return Qe(i[0],i[1],i[2],t.spatialReference)}function le(t,e,i){const n=i?t:yo(t);return e&&t?Ir(t,n,e)?n:null:n}function Bl(t){if(!t)return 0;switch(t.type){case"point":return t.z;case"extent":return t.zmax;case"polygon":return t.hasZ?t.rings.reduce((e,i)=>i.reduce((n,r)=>Math.max(n,r[2]),e),-1/0):void 0;case"polyline":return t.hasZ?t.paths.reduce((e,i)=>i.reduce((n,r)=>Math.max(n,r[2]),e),-1/0):void 0;case"mesh":return t.extent.zmax;case"multipoint":return}}function Il(t,e,i,n=0){if(t){e||(e=Dt());const r=t;let s=.5*r.width*(i-1),o=.5*r.height*(i-1);return r.width<1e-7*r.height?s+=o/20:r.height<1e-7*r.width&&(o+=s/20),Br(e,r.xmin-s-n,r.ymin-o-n,r.xmax+s+n,r.ymax+o+n),e}return null}function Hl(t,e,i=null){const n=En(Un);return t!=null&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],t.length>3&&(n[3]=t[3])),e!=null&&(n[3]=e),i&&Lr(n,n,i),n}function kl(t,e,i,n,r,s){for(let o=0;o<3;++o)s[o]=t?.[o]!=null?t[o]:i?.[o]!=null?i[o]:r[o];return s[3]=e??n??r[3],s}function Wl(t=Fn,e,i,n=1){const r=new Array(3);if(e==null||i==null)r[0]=1,r[1]=1,r[2]=1;else{let s,o=0;for(let l=2;l>=0;l--){const c=t[l],a=c!=null,u=l===0&&!s&&!a,h=i[l];let f;c==="symbol-value"||u?f=h!==0?e[l]/h:1:a&&c!=="proportional"&&isFinite(c)&&(f=h!==0?c/h:1),f!=null&&(r[l]=f,s=f,o=Math.max(o,Math.abs(f)))}for(let l=2;l>=0;l--)r[l]==null?r[l]=s:r[l]===0&&(r[l]=.001*o)}for(let s=2;s>=0;s--)r[s]/=n;return jn(r)}function wo(t){return t.isPrimitive!=null}function Gl(t){return _o(wo(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function _o(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function Nl(t,e,i,n=Ze()){return t&&zn(n,n,-t/180*Math.PI),e&&An(n,n,e/180*Math.PI),i&&On(n,n,i/180*Math.PI),n}function ql(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const n=Di(e),r=kr(t)*n,s=Wr(t)*n,o=Gr(t)*(e.isGeographic?1:n);return r===0&&s===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(r,s,o)}function di(t,e){const i=t[e],n=t[e+1],r=t[e+2];return Math.sqrt(i*i+n*n+r*r)}function Po(t,e){const i=t[e],n=t[e+1],r=t[e+2],s=1/Math.sqrt(i*i+n*n+r*r);t[e]*=s,t[e+1]*=s,t[e+2]*=s}function pi(t,e,i){t[e]*=i,t[e+1]*=i,t[e+2]*=i}function zo(t,e,i,n,r,s=e){(r=r||t)[s]=t[e]+i[n],r[s+1]=t[e+1]+i[n+1],r[s+2]=t[e+2]+i[n+2]}function Ao(){return mi??=Oo(),mi}function Oo(){const t=new C([0,0,0,255,255,0,255,255],[0,1,2,3],2,!0);return new ur([["uv0",t]])}let mi=null;const ft=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Co=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Mo=[0,0,1,0,1,1,0,1],Ro=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],cn=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)cn[6*t+e]=t;const he=new Array(36);for(let t=0;t<6;t++)he[6*t]=0,he[6*t+1]=1,he[6*t+2]=2,he[6*t+3]=2,he[6*t+4]=3,he[6*t+5]=0;function $o(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let n=0;n<8;n++)i[3*n]=ft[n][0]*e[0],i[3*n+1]=ft[n][1]*e[1],i[3*n+2]=ft[n][2]*e[2];return new K(t,[["position",new C(i,Ro,3,!0)],["normal",new C(Co,cn,3)],["uv0",new C(Mo,he,2)]])}const dt=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],To=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Do=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Vo=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Fo(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let n=0;n<6;n++)i[3*n]=dt[n][0]*e[0],i[3*n+1]=dt[n][1]*e[1],i[3*n+2]=dt[n][2]*e[2];return new K(t,[["position",new C(i,Do,3,!0)],["normal",new C(To,Vo,3)]])}const He=G(-.5,0,-.5),ke=G(.5,0,-.5),We=G(0,0,.5),Ge=G(0,.5,0),ve=ee(),xe=ee(),Se=ee(),we=ee(),_e=ee();q(ve,He,Ge),q(xe,He,ke),ie(Se,ve,xe),I(Se,Se),q(ve,ke,Ge),q(xe,ke,We),ie(we,ve,xe),I(we,we),q(ve,We,Ge),q(xe,We,He),ie(_e,ve,xe),I(_e,_e);const pt=[He,ke,We,Ge],jo=[0,-1,0,Se[0],Se[1],Se[2],we[0],we[1],we[2],_e[0],_e[1],_e[2]],Eo=[0,1,2,3,1,0,3,2,1,3,0,2],Uo=[0,0,0,1,1,1,2,2,2,3,3,3];function Lo(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let n=0;n<4;n++)i[3*n]=pt[n][0]*e[0],i[3*n+1]=pt[n][1]*e[1],i[3*n+2]=pt[n][2]*e[2];return new K(t,[["position",new C(i,Eo,3,!0)],["normal",new C(jo,Uo,3)]])}function Yl(t,e,i,n,r={uv:!0}){const s=-Math.PI,o=2*Math.PI,l=-Math.PI/2,c=Math.PI,a=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(n)),h=(a+1)*(u+1),f=te(3*h),x=te(3*h),S=te(2*h),v=[];let p=0;for(let m=0;m<=u;m++){const O=[],d=m/u,z=l+d*c,A=Math.cos(z);for(let w=0;w<=a;w++){const N=w/a,y=s+N*o,F=Math.cos(y)*A,$=Math.sin(z),se=-Math.sin(y)*A;f[3*p]=F*e,f[3*p+1]=$*e,f[3*p+2]=se*e,x[3*p]=F,x[3*p+1]=$,x[3*p+2]=se,S[2*p]=N,S[2*p+1]=d,O.push(p),++p}v.push(O)}const g=new Array;for(let m=0;m<u;m++)for(let O=0;O<a;O++){const d=v[m][O],z=v[m][O+1],A=v[m+1][O+1],w=v[m+1][O];m===0?(g.push(d),g.push(A),g.push(w)):m===u-1?(g.push(d),g.push(z),g.push(A)):(g.push(d),g.push(z),g.push(A),g.push(A),g.push(w),g.push(d))}const b=[["position",new C(f,g,3,!0)],["normal",new C(x,g,3,!0)]];return r.uv&&b.push(["uv0",new C(S,g,2,!0)]),r.offset&&(b[0][0]="offset",b.push(["position",new C(Float64Array.from(r.offset),ji(g.length),3,!0)])),new K(t,b)}function Bo(t,e,i,n){const r=Io(e,i,n);return new K(t,r)}function Io(t,e,i){const n=t;let r,s;if(i)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const a=n*(1+Math.sqrt(5))/2;r=[-n,a,0,n,a,0,-n,-a,0,n,-a,0,0,-n,a,0,n,a,0,-n,-a,0,n,-a,a,0,-n,a,0,n,-a,0,-n,-a,0,n],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let a=0;a<r.length;a+=3)pi(r,a,t/di(r,a));let o={};function l(a,u){a>u&&([a,u]=[u,a]);const h=a.toString()+"."+u.toString();if(o[h])return o[h];let f=r.length;return r.length+=3,zo(r,3*a,r,3*u,r,f),pi(r,f,t/di(r,f)),f/=3,o[h]=f,f}for(let a=0;a<e;a++){const u=s.length,h=new Array(4*u);for(let f=0;f<u;f+=3){const x=s[f],S=s[f+1],v=s[f+2],p=l(x,S),g=l(S,v),b=l(v,x),m=4*f;h[m]=x,h[m+1]=p,h[m+2]=b,h[m+3]=S,h[m+4]=g,h[m+5]=p,h[m+6]=v,h[m+7]=b,h[m+8]=g,h[m+9]=p,h[m+10]=g,h[m+11]=b}s=h,o={}}const c=Zt(r);for(let a=0;a<c.length;a+=3)Po(c,a);return[["position",new C(Zt(r),s,3,!0)],["normal",new C(c,s,3,!0)]]}function Xl(t,{normal:e,position:i,color:n,rotation:r,size:s,centerOffsetAndDistance:o,uvi:l,featureAttribute:c,olidColor:a=null}={}){const u=i?Ce(i):D(),h=e?Ce(e):Oe(0,0,1),f=n?[n[0],n[1],n[2],n.length>3?n[3]:255]:[255,255,255,255],x=s!=null&&s.length===2?s:[1,1],S=r!=null?[r]:[0],v=ji(1),p=[["position",new C(u,v,3,!0)],["normal",new C(h,v,3,!0)],["color",new C(f,v,4,!0)],["size",new C(x,v,2)],["rotation",new C(S,v,1,!0)]];if(l&&p.push(["uvi",new C(l,v,l.length)]),o!=null){const g=[o[0],o[1],o[2],o[3]];p.push(["centerOffsetAndDistance",new C(g,v,4)])}if(c){const g=[c[0],c[1],c[2],c[3]];p.push(["featureAttribute",new C(g,v,4)])}return new K(t,p,null,1,a,void 0,Ao())}const Ho=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Zl(t,e=Ho){const i=new Array(12);for(let a=0;a<4;a++)for(let u=0;u<3;u++)i[3*a+u]=e[a][u];const n=[0,1,2,2,3,0],r=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],l=[255,255,255,255],c=[["position",new C(i,n,3,!0)],["normal",new C(r,s,3,!0)],["uv0",new C(o,n,2,!0)],["color",new C(l,s,4,!0)]];return new K(t,c)}function ko(t,e,i,n,r=!0,s=!0){let o=0;const l=e,c=t;let a=G(0,o,0),u=G(0,o+c,0),h=G(0,-1,0),f=G(0,1,0);n&&(o=c,u=G(0,0,0),a=G(0,o,0),h=G(0,1,0),f=G(0,-1,0));const x=[u,a],S=[h,f],v=i+2,p=Math.sqrt(c*c+l*l);if(n)for(let d=i-1;d>=0;d--){const z=d*(2*Math.PI/i),A=G(Math.cos(z)*l,o,Math.sin(z)*l);x.push(A);const w=G(c*Math.cos(z)/p,-l/p,c*Math.sin(z)/p);S.push(w)}else for(let d=0;d<i;d++){const z=d*(2*Math.PI/i),A=G(Math.cos(z)*l,o,Math.sin(z)*l);x.push(A);const w=G(c*Math.cos(z)/p,l/p,c*Math.sin(z)/p);S.push(w)}const g=new Array,b=new Array;if(r){for(let d=3;d<x.length;d++)g.push(1),g.push(d-1),g.push(d),b.push(0),b.push(0),b.push(0);g.push(x.length-1),g.push(2),g.push(1),b.push(0),b.push(0),b.push(0)}if(s){for(let d=3;d<x.length;d++)g.push(d),g.push(d-1),g.push(0),b.push(d),b.push(d-1),b.push(1);g.push(0),g.push(2),g.push(x.length-1),b.push(1),b.push(2),b.push(S.length-1)}const m=te(3*v);for(let d=0;d<v;d++)m[3*d]=x[d][0],m[3*d+1]=x[d][1],m[3*d+2]=x[d][2];const O=te(3*v);for(let d=0;d<v;d++)O[3*d]=S[d][0],O[3*d+1]=S[d][1],O[3*d+2]=S[d][2];return[["position",new C(m,g,3,!0)],["normal",new C(O,b,3,!0)]]}function gi(t,e,i,n,r,s=!0,o=!0){return new K(t,ko(e,i,n,r,s,o))}function Wo(t,e,i,n,r,s,o){const l=r?ii(r):G(1,0,0),c=s?ii(s):G(0,0,0);o??=!0;const a=ee();I(a,l);const u=ee();V(u,a,Math.abs(e));const h=ee();V(h,u,-.5),U(h,h,c);const f=G(0,1,0);Math.abs(1-Z(a,f))<.2&&X(f,0,0,1);const x=ee();ie(x,a,f),I(x,x),ie(f,x,a);const S=2*n+(o?2:0),v=n+(o?2:0),p=te(3*S),g=te(3*v),b=te(2*S),m=new Array(3*n*(o?4:2)),O=new Array(3*n*(o?4:2));o&&(p[3*(S-2)]=h[0],p[3*(S-2)+1]=h[1],p[3*(S-2)+2]=h[2],b[2*(S-2)]=0,b[2*(S-2)+1]=0,p[3*(S-1)]=p[3*(S-2)]+u[0],p[3*(S-1)+1]=p[3*(S-2)+1]+u[1],p[3*(S-1)+2]=p[3*(S-2)+2]+u[2],b[2*(S-1)]=1,b[2*(S-1)+1]=1,g[3*(v-2)]=-a[0],g[3*(v-2)+1]=-a[1],g[3*(v-2)+2]=-a[2],g[3*(v-1)]=a[0],g[3*(v-1)+1]=a[1],g[3*(v-1)+2]=a[2]);const d=(y,F,$)=>{m[y]=F,O[y]=$};let z=0;const A=ee(),w=ee();for(let y=0;y<n;y++){const F=y*(2*Math.PI/n);V(A,f,Math.sin(F)),V(w,x,Math.cos(F)),U(A,A,w),g[3*y]=A[0],g[3*y+1]=A[1],g[3*y+2]=A[2],V(A,A,i),U(A,A,h),p[3*y]=A[0],p[3*y+1]=A[1],p[3*y+2]=A[2],b[2*y]=y/n,b[2*y+1]=0,p[3*(y+n)]=p[3*y]+u[0],p[3*(y+n)+1]=p[3*y+1]+u[1],p[3*(y+n)+2]=p[3*y+2]+u[2],b[2*(y+n)]=y/n,b[2*y+1]=1;const $=(y+1)%n;d(z++,y,y),d(z++,y+n,y),d(z++,$,$),d(z++,$,$),d(z++,y+n,y),d(z++,$+n,$)}if(o){for(let y=0;y<n;y++){const F=(y+1)%n;d(z++,S-2,v-2),d(z++,y,v-2),d(z++,F,v-2)}for(let y=0;y<n;y++){const F=(y+1)%n;d(z++,y+n,v-1),d(z++,S-1,v-1),d(z++,F+n,v-1)}}const N=[["position",new C(p,m,3,!0)],["normal",new C(g,O,3,!0)],["uv0",new C(b,m,2,!0)]];return new K(t,N)}function Kl(t,e,i,n,r,s){n=n||10,r=r==null||r,Ai(e.length>1);const o=[[0,0,0]],l=[],c=[];for(let a=0;a<n;a++){l.push([0,-a-1,-(a+1)%n-1]);const u=a/n*2*Math.PI;c.push([Math.cos(u)*i,Math.sin(u)*i])}return Go(t,c,e,o,l,r,s)}function Go(t,e,i,n,r,s,o=G(0,0,0)){const l=e.length,c=te(i.length*l*3+(6*n.length||0)),a=te(i.length*l*3+(n?6:0)),u=new Array,h=new Array;let f=0,x=0;const S=D(),v=D(),p=D(),g=D(),b=D(),m=D(),O=D(),d=D(),z=D(),A=D(),w=D(),N=D(),y=D(),F=Je();X(z,0,1,0),q(v,i[1],i[0]),I(v,v),s?(U(d,i[0],o),I(p,d)):X(p,0,0,1),vi(v,p,z,z,b,p,xi),T(g,p),T(N,b);for(let P=0;P<n.length;P++)V(m,b,n[P][0]),V(d,p,n[P][2]),U(m,m,d),U(m,m,i[0]),c[f++]=m[0],c[f++]=m[1],c[f++]=m[2];a[x++]=-v[0],a[x++]=-v[1],a[x++]=-v[2];for(let P=0;P<r.length;P++)u.push(r[P][0]>0?r[P][0]:-r[P][0]-1+n.length),u.push(r[P][1]>0?r[P][1]:-r[P][1]-1+n.length),u.push(r[P][2]>0?r[P][2]:-r[P][2]-1+n.length),h.push(0),h.push(0),h.push(0);let $=n.length;const se=n.length-1;for(let P=0;P<i.length;P++){let ze=!1;P>0&&(T(S,v),P<i.length-1?(q(v,i[P+1],i[P]),I(v,v)):ze=!0,U(A,S,v),I(A,A),U(w,i[P-1],g),rs(i[P],A,F),Ft(F,ls(w,S),d)?(q(d,d,i[P]),I(p,d),ie(b,A,p),I(b,b)):vi(A,g,N,z,b,p,xi),T(g,p),T(N,b)),s&&(U(d,i[P],o),I(y,d));for(let ae=0;ae<l;ae++)if(V(m,b,e[ae][0]),V(d,p,e[ae][1]),U(m,m,d),I(O,m),a[x++]=O[0],a[x++]=O[1],a[x++]=O[2],U(m,m,i[P]),c[f++]=m[0],c[f++]=m[1],c[f++]=m[2],!ze){const nt=(ae+1)%l;u.push($+ae),u.push($+l+ae),u.push($+nt),u.push($+nt),u.push($+l+ae),u.push($+l+nt);for(let rt=0;rt<6;rt++){const gn=u.length-6;h.push(u[gn+rt]-se)}}$+=l}const pe=i[i.length-1];for(let P=0;P<n.length;P++)V(m,b,n[P][0]),V(d,p,n[P][1]),U(m,m,d),U(m,m,pe),c[f++]=m[0],c[f++]=m[1],c[f++]=m[2];const oe=x/3;a[x++]=v[0],a[x++]=v[1],a[x++]=v[2];const Q=$-l;for(let P=0;P<r.length;P++)u.push(r[P][0]>=0?$+r[P][0]:-r[P][0]-1+Q),u.push(r[P][2]>=0?$+r[P][2]:-r[P][2]-1+Q),u.push(r[P][1]>=0?$+r[P][1]:-r[P][1]-1+Q),h.push(oe),h.push(oe),h.push(oe);const ue=[["position",new C(c,u,3,!0)],["normal",new C(a,h,3,!0)]];return new K(t,ue)}function Ql(t,e,i,n,r){const s=Xr(3*e.length),o=new Array(2*(e.length-1));let l=0,c=0;for(let u=0;u<e.length;u++){for(let h=0;h<3;h++)s[l++]=e[u][h];u>0&&(o[c++]=u-1,o[c++]=u)}const a=[["position",new C(s,o,3,!0)]];if(i&&i.length===e.length&&i[0].length===3){const u=te(3*i.length);let h=0;for(let f=0;f<e.length;f++)for(let x=0;x<3;x++)u[h++]=i[f][x];a.push(["normal",new C(u,o,3,!0)])}return n&&a.push(["color",new C(n,Zr(n.length/4),4)]),new K(t,a,null,2)}function Jl(t,e,i,n,r,s=0){const o=new Array(18),l=[[-i,s,r/2],[n,s,r/2],[0,e+s,r/2],[-i,s,-r/2],[n,s,-r/2],[0,e+s,-r/2]],c=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let a=0;a<6;a++)o[3*a]=l[a][0],o[3*a+1]=l[a][1],o[3*a+2]=l[a][2];return new K(t,[["position",new C(o,c,3,!0)]])}function ec(t,e){const i=t.getMutableAttribute("position").data;for(let n=0;n<i.length;n+=3){const r=i[n],s=i[n+1],o=i[n+2];X(be,r,s,o),Y(be,be,e),i[n]=be[0],i[n+1]=be[1],i[n+2]=be[2]}}function No(t,e=t){const i=t.attributes,n=i.get("position").data,r=i.get("normal").data;if(r){const s=e.getMutableAttribute("normal").data;for(let o=0;o<r.length;o+=3){const l=r[o+1];s[o+1]=-r[o+2],s[o+2]=l}}if(n){const s=e.getMutableAttribute("position").data;for(let o=0;o<n.length;o+=3){const l=n[o+1];s[o+1]=-n[o+2],s[o+2]=l}}}function mt(t,e,i,n,r){return!(Math.abs(Z(e,t))>r)&&(ie(i,t,e),I(i,i),ie(n,i,t),I(n,n),!0)}function vi(t,e,i,n,r,s,o){return mt(t,e,r,s,o)||mt(t,i,r,s,o)||mt(t,n,r,s,o)}const xi=.99619469809,be=D();let qo=class{constructor(t,e,i,n){this.material=t,this.buffer=e,this.numVertices=i,this.boundingInfo=n,this.bufferWriter=t.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+us}get renderGeometry(){return this}intersect(t,e,i,n,r,s,o,l){const c=this.bufferWriter,a=this.buffer;c.intersect(a,this.material.parameters,null,t,i,n,(u,h,f)=>un(u,h,f,t,e,s,o,r,l))}},Yo=class{constructor(t){this.engineGeometry=t;const e=this.material,i=this.engineGeometry,n=i.attributes,r=i.boundingInfo,s=e.createBufferWriter(),o=s.layout,l=s.elementCount(n),c=o.createBuffer(l);s.write(null,null,n,null,c,0),this.renderGeometry=new qo(e,c.buffer,l,r)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((t,e)=>t+cs(e.data,e.indices),0)}intersect(t,e,i,n,r,s,o,l){const c=this.engineGeometry;this.material.intersect(c,t.transform.transform,t,i,n,(a,u,h)=>un(a,u,h,t,e,s,o,r,l))}};function un(t,e,i,n,r,s,o,l,c){if(t<0||r&&!r(n.rayBegin,n.rayEnd,t))return;const a=new fs(s.layerViewUid,s.graphicUid(l),i,o,c);if((n.results.min.distance==null||t<n.results.min.distance)&&n.results.min.set(3,a,t,e,n.transform.transform),(n.results.max.distance==null||t>n.results.max.distance)&&n.results.max.set(3,a,t,e,n.transform.transform),n.options.store===2){const u=new hs(n.results.min.ray);u.set(3,a,t,e,n.transform.transform),n.results.all.push(u)}}let Xo=class{constructor(t,e=null){this.geometry=t,this.textures=e}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},Zo=class{constructor(t,e,i){this.components=t,this.minScreenSpaceRadius=e,this.pivotOffset=i;const n=Ue(this.components.map(r=>r.geometry));this.numVertices=n.reduce((r,s)=>r+s.numVertices,0)}},Ko=class{constructor(t){this.levels=t,this.levels.sort((e,i)=>e.minScreenSpaceRadius===i.minScreenSpaceRadius?e.numVertices-i.numVertices:e.minScreenSpaceRadius-i.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const t=[];return this.levels.forEach(e=>e.components.forEach(i=>t.push(i.geometry.material))),Ue(t)}getTextures(){const t=new Array;return this.levels.forEach(e=>e.components.forEach(i=>{i.textures!=null&&t.push(...i.textures)})),Ue(t)}getGeometries(){const t=new Array;return this.levels.forEach(e=>e.components.forEach(i=>{t.push(i.geometry)})),Ue(t)}getEngineGeometries(){return this.getGeometries().map(t=>t.engineGeometry).filter(t=>t!=null)}computeUsedMemory(){const t=this.getGeometries(),e=this.getTextures(),i=t.reduce((n,r)=>n+r.computeUsedMemory(),0);return e.reduce((n,r)=>n+r.usedMemory,0)+i}};function tc(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function ic(t,e){const i=(n,r,s=!1)=>new Ko(n.map(o=>{const l=r(o.tesselation);return s&&No(l),new Zo([new Xo(new Yo(l))],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],n=>Bo(e,.5,n,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>$o(e,1));case"cone":return i(gt,n=>gi(e,1,.5,n,!1),!0);case"inverted-cone":return i(gt,n=>gi(e,1,.5,n,!0),!0);case"cylinder":return i(gt,n=>Wo(e,1,.5,n,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Lo(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Fo(e,1),!0);default:return}}const gt=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Ot(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function Qo(t){const{size:e}=t.definition,i=t.fontString(e);let n=bi.get(i);if(!n){const r=Ot(ea,0,0).getContext("2d");t.setFontProperties(r,e);const s=r.measureText(ta);n=new Jo(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),bi.set(i,n)}return n}const bi=new Map;let Jo=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(t,e){this.maxAscent=t,this.maxDescent=e}};const ea={canvas:null},ta=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),Ct=1;class nc{constructor(e,i,n,r){this.text=e,this._alignment=i,this._parameters=n,this._maxSize=r,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=Ot(yi,Ee,Ee).getContext("2d"),i=this._parameters.definition.pixelRatio,n=this._fontSize*i;this._parameters.setFontProperties(e,n);let r=2*this._haloSize;const s=this._parameters.definition.font;s.style!=="italic"&&s.style!=="oblique"&&s.weight!=="bold"&&s.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,l=0,c=0,a=0,u=0;this._lines.forEach((g,b)=>{const m=e.measureText(g),O=m.width/i,d=O+r;this._textWidths.push(O),this._lineWidths.push(d),o=Math.max(o,d),a=Math.max(a,m.actualBoundingBoxAscent/i),u=Math.max(u,m.actualBoundingBoxDescent/i),b===0&&(l=m.actualBoundingBoxAscent/i),b===this._lines.length-1&&(c=m.actualBoundingBoxDescent/i)});const h=Qo(this._parameters),f=Math.max(a,h.maxAscent),x=Math.max(u,h.maxDescent),S=l,v=this._parameters.definition.font.decoration==="underline"?x:c,p=o;this._metricsCached=new na(S,v,f,x,p)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*ia}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,Ct)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case 0:return this._horizontalPadding;case 1:return(this.displayWidth-this._lineWidths[e])/2;case 2:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,n){e.save();const r=i/=this.renderPixelRatio,s=n/=this.renderPixelRatio,o=this._haloSize,l=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,n+=l;const c=this._haloSize>0;c&&this._renderHalo(e,r,s,o,l),this._parameters.setFontProperties(e,this._renderedFontSize);for(let a=0;a<this._lines.length;++a){const u=this._lines[a],h=this._getLineXOffset(a);c&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+h,n),this._renderLineDecoration(e,i+h,n,this._textWidths[a])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(a),n),this._renderLineDecoration(e,i+h,n,this._textWidths[a]),n+=this._lineSpacing}if(xt.TEXT_SHOW_BASELINE){e.strokeStyle=Si,e.setLineDash([2,2]),e.lineWidth=1;let a=s+l;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[r,a],[r+this.displayWidth,a]),a+=this._lineSpacing}if(xt.TEXT_SHOW_BORDER&&(e.strokeStyle=Si,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[r,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const a=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,r,s,a),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,n,r,s=!1){if(this._parameters.definition.font.decoration==="none"||r===0)return;const o=1,l=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":n+=2*l;break;case"line-through":n-=.33*this._midLineAscent}const c=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(l+2*c),e.beginPath(),e.moveTo(this._toRenderUnit(i-c),this._toRenderUnit(n)),e.lineTo(this._toRenderUnit(i+r+c),this._toRenderUnit(n)),e.stroke()}_roundedRect(e,i,n,r){i=this._toRenderUnit(i),n=this._toRenderUnit(n);const s=this.renderedWidth,o=this.renderedHeight;r!==0?(r=wi(r,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,n+r),e.arcTo(i,n,i+r,n,r),e.lineTo(i+s-r,n),e.arcTo(i+s,n,i+s,n+r,r),e.lineTo(i+s,n+o-r),e.arcTo(i+s,n+o,i+s-r,n+o,r),e.lineTo(i+r,n+o),e.arcTo(i,n+o,i,n+o-r,r),e.closePath()):e.rect(i,n,s,o)}_renderHalo(e,i,n,r,s){const o=this.renderedWidth,l=this.renderedHeight,c=Ot(yi,Math.max(o,Ee),Math.max(l,Ee)),a=c.getContext("2d");a.clearRect(0,0,o,l),this._parameters.setFontProperties(a,this._renderedFontSize),a.fillStyle=this._parameters.haloStyle,a.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;a.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(a,r,s):this._renderHaloNative(a,r,s);let h=s;for(let f=0;f<this._lines.length;++f){const x=this._getLineXOffset(f);this._renderLineDecoration(a,r+x,h,this._textWidths[f],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(c,0,0,o,l,this._toRenderUnit(i),this._toRenderUnit(n),o,l),e.globalAlpha=1}_renderHaloEmulated(e,i,n){for(let r=0;r<this._lines.length;++r){const s=this._lines[r],o=this._getLineXOffset(r);for(const[l,c]of hn)this._fillText(e,s,i+o+this._haloSize*l,n+this._haloSize*c);n+=this._lineSpacing}}_renderHaloNative(e,i,n){const r=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],l=this._getLineXOffset(s),c=5,a=.1;for(let u=0;u<c;u++){const h=1-(c-1)*a+u*a;e.lineWidth=this._toRenderUnit(h*r),this._strokeText(e,o,i+l,n)}n+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,n,r){e.fillText(i,this._toRenderUnit(n),this._toRenderUnit(r))}_strokeText(e,i,n,r){e.strokeText(i,this._toRenderUnit(n),this._toRenderUnit(r))}_drawLine(e,i,n){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(n[0])+.5,this._toRoundedRenderUnit(n[1])+.5),e.stroke()}_drawBox(e,i,n){const r=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=this._toRenderUnit(n[0]),l=this._toRenderUnit(n[1]),c=Math.floor(r)+.5,a=Math.ceil(r+o)-.5,u=Math.floor(s)+.5,h=Math.ceil(s+l)-.5;e.beginPath(),e.moveTo(c,u),e.lineTo(a,u),e.lineTo(a,h),e.lineTo(c,h),e.lineTo(c,u),e.stroke()}}const hn=[];for(let t=0;t<360;t+=360/16)hn.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);const yi={canvas:null},ia=.2,Ee=512,Si="rgb(255, 0, 255, 0.5)";class na{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,n,r,s){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=n,this.maxLineDescent=r,this.displayWidth=s}}const rc=Object.freeze({left:0,center:.5,right:1}),sc=Object.freeze({"bottom-left":J(0,0),bottom:J(.5,0),"bottom-right":J(1,0),left:J(0,.5),center:J(.5,.5),right:J(1,.5),"top-left":J(0,1),top:J(.5,1),"top-right":J(1,1)});function oc(t){switch(t){case"left":return 0;case"right":return 2;default:return 1}}function ac(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function lc(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function cc(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function uc(t){return t==="middle"?"center":t}function hc(t,e){switch(t){case"top":return Re(e,0,Ct);case"bottom":return Re(e,0,-Ct);default:return _i(e,$n)}}class Mt{constructor(e,i,n,r){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=n,this._coordinateSystem=r,this._tmpCoordinateSystem=js(r),this.referenceEllipsoid=Fi(i),this.sphericalPCPF=Ui(i)}set extent(e){e&&Es(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return Us(this._coordinateSystem,Dt())}getAltitude(e){return Ns(this._coordinateSystem,e)}setAltitude(e,i,n=e){return Xi(this._coordinateSystem,n,i,e)}setAltitudeOfTransformation(e,i){qs(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Hs(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,n){return ks(this._coordinateSystem,e,i,n)}basisMatrixAtPosition(e,i){const n=this.worldBasisAtPosition(e,0,E.get()),r=this.worldBasisAtPosition(e,1,E.get()),s=this.worldBasisAtPosition(e,2,E.get());return Pn(i,n[0],n[1],n[2],0,r[0],r[1],r[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const n=this.worldUpAtPosition(e,E.get()),r=this.worldBasisAtPosition(e,1,E.get()),s=gs(i,r,n);return vn(s)}intersectManifoldClosestSilhouette(e,i,n){return ut(this._coordinateSystem,i,this._tmpCoordinateSystem),Gs(this._tmpCoordinateSystem,e,n),n}intersectManifold(e,i,n){ut(this._coordinateSystem,i,this._tmpCoordinateSystem);const r=E.get();return Ws(this._tmpCoordinateSystem,e,r)?T(n,r):null}intersectInfiniteManifold(e,i,n){if(this.viewingMode===1)return this.intersectManifold(e,i,n);ut(this._coordinateSystem,i,this._tmpCoordinateSystem);const r=this._tmpCoordinateSystem.value,s=E.get();return Ft(r.plane,e,s)?T(n,s):null}toRenderCoords(e,i,n){return oi(e)?ds(e,i,this.spatialReference):yt(e,i,n,this.spatialReference)}fromRenderCoords(e,i,n=null){return oi(i)?(n!=null&&(i.spatialReference=n),Zi(e,this.spatialReference,i)?i:null):yt(e,this.spatialReference,i,n)?i:null}static create(e,i){switch(e){case 2:return new Mt(2,i,Di(i),Is());case 1:return new Mt(1,i,1,Bs(i))}}static renderUnitScaleFactor(e,i){return ti(e)/ti(i)}}const Wt=128,de=.5,fc=vt(de/2,de/2,1-de/2,1-de/2);function dc(t){return t==="cross"||t==="x"}function pc(t,e=Wt,i=e*de,n=0){const{data:r,parameters:s}=ra(t,e,i,n);return new Gn(r,s)}function ra(t,e=Wt,i=e*de,n=0){return{data:sa(t,e,i,n),parameters:{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,noUnpackFlip:!0,dataType:Dr.FLOAT,pixelFormat:6403,internalFormat:Tr.R16F,reloadable:!0}}}function sa(t,e=Wt,i=e*de,n=0){switch(t){case"circle":default:return oa(e,i);case"square":return aa(e,i);case"cross":return ca(e,i,n);case"x":return ua(e,i,n);case"kite":return la(e,i);case"triangle":return ha(e,i);case"arrow":return fa(e,i)}}function oa(t,e){const i=t/2-.5;return De(t,pn(i,i,e/2))}function aa(t,e){return fn(t,e,!1)}function la(t,e){return fn(t,e,!0)}function ca(t,e,i=0){return dn(t,e,!1,i)}function ua(t,e,i=0){return dn(t,e,!0,i)}function ha(t,e){return De(t,mn(t/2,e,e/2))}function fa(t,e){const i=e,n=e/2,r=t/2,s=.8*i,o=pn(r,(t-e)/2-s,Math.sqrt(s*s+n*n)),l=mn(r,i,n);return De(t,(c,a)=>Math.max(l(c,a),-o(c,a)))}function fn(t,e,i){return i&&(e/=Math.SQRT2),De(t,(n,r)=>{let s=n-.5*t+.25,o=.5*t-r-.75;if(i){const l=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=l}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function dn(t,e,i,n=0){e-=n,i&&(e*=Math.SQRT2);const r=.5*e;return De(t,(s,o)=>{let l,c=s-.5*t,a=.5*t-o-1;if(i){const u=(c+a)/Math.SQRT2;a=(a-c)/Math.SQRT2,c=u}return c=Math.abs(c),a=Math.abs(a),l=c>a?c>r?Math.sqrt((c-r)*(c-r)+a*a):a:a>r?Math.sqrt(c*c+(a-r)*(a-r)):c,l-=n/2,l})}function pn(t,e,i){return(n,r)=>{const s=n-t,o=r-e;return Math.sqrt(s*s+o*o)-i}}function mn(t,e,i){const n=Math.sqrt(e*e+i*i);return(r,s)=>{const o=Math.abs(r-t)-i,l=s-t+e/2+.75,c=(e*o+i*l)/n,a=-l;return Math.max(c,a)}}function De(t,e){const i=new Float32Array(t*t);for(let n=0;n<t;n++)for(let r=0;r<t;r++)i[r+t*n]=e(r,n)/t;return i}const da=Object.freeze(Object.defineProperty({__proto__:null,build:Qi,calculateAnchorPosition:Pe,fullUV:$e},Symbol.toStringTag,{value:"Module"})),mc=Object.freeze(Object.defineProperty({__proto__:null,build:gr},Symbol.toStringTag,{value:"Module"})),gc=Object.freeze(Object.defineProperty({__proto__:null,build:xr,getRadius:vr},Symbol.toStringTag,{value:"Module"})),vc=Object.freeze(Object.defineProperty({__proto__:null,build:br},Symbol.toStringTag,{value:"Module"})),xc=Object.freeze(Object.defineProperty({__proto__:null,build:yr},Symbol.toStringTag,{value:"Module"}));export{Ut as $,Jl as A,Vl as B,ra as C,sc as D,Hl as E,Io as F,et as G,Et as H,ko as I,tt as J,Wl as K,Go as L,Ql as M,Rs as N,Bl as O,Tl as P,ql as Q,Gl as R,tc as S,Wt as T,Il as U,Yo as V,ic as W,Nl as X,vi as Y,Bi as Z,_o as _,pc as a,nc as a0,Ot as a1,hc as a2,uc as a3,oc as a4,Qo as a5,rc as a6,cc as a7,oi as a8,Zi as a9,Fl as aa,Dl as ab,zs as ac,Ms as ad,kt as ae,Ks as af,Js as ag,Ct as ah,ac as ai,lc as aj,ws as ak,sa as al,eo as am,Cs as an,mc as ao,gc as ap,vc as aq,xc as ar,Xl as b,El as c,Zl as d,re as e,qo as f,Zo as g,Ko as h,jl as i,_s as j,Ul as k,Yl as l,Xo as m,vo as n,de as o,Wo as p,Kl as q,gi as r,dc as s,kl as t,fc as u,Mt as v,Ll as w,yo as x,ec as y,Te as z};
