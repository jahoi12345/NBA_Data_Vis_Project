import{s as P,f as x}from"./BufferView-5vCN6AU9.js";import{n as f,t as m,f as b,j as T,o as w,p as g,q as d}from"./Emissions.glsl-B8XKMjLy.js";import{T as y,V as D,W as O,X as I,Y as C,Z as S,_ as j,$ as F,a0 as M,a1 as z,a2 as A,a3 as W,a4 as B,a5 as E,a6 as q,a7 as V,a8 as k,a9 as L,aa as G,ab as H,ac as R,ad as X,ae as Y,af as l,ag as Z,ah as J,ai as K,aj as N,ak as Q,q as U}from"./Texture-BcM9ZALi.js";import{bn as ee}from"./ShadowCastClear.glsl-9G1ObMeX.js";import{i as te}from"./TriangleMaterial-CNoFGBqj.js";import{_ as ie}from"./index-CAyy5ces.js";import{f as se}from"./DefaultLayouts-k-HobCHF.js";import{_ as p}from"./jsonMap-Bs3hmeCU.js";import"./Polygon-BUi4eoGW.js";import"./mat4f64-q_b6UJoq.js";import"./collectionUtils-yEu3-UXw.js";import"./vec2f64-rIxtbMRN.js";import"./mat4-DMghHRAg.js";import"./vec32-BF0cLBAR.js";class v extends y{}function _(i){const e=new D,{vertex:t,fragment:s,varyings:c}=e,{output:o,perspectiveInterpolation:n}=i;return O(t,i),e.include(I),e.include(C,i),e.fragment.include(S,i),e.include(j,i),e.include(F,i),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),n&&e.attributes.add("perspectiveDivide","float"),t.main.add(m`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${f(n,"gl_Position *= perspectiveDivide;")}`),c.add("vpos","vec3",{invariant:!0}),c.add("vTexCoord","vec2"),s.include(M),s.uniforms.add(new b("opacity",r=>r.opacity),new T("tex",r=>r.glTexture)).main.add(m`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${f(o===10,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),e}const re=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:v,build:_},Symbol.toStringTag,{value:"Module"}));let ae=class extends z{constructor(e,t){super(e,t,new A(re,()=>ie(()=>Promise.resolve().then(()=>pe),void 0)),$(t).locations)}_getPipelineState(e,t){const{oitPass:s,output:c,hasOccludees:o,cullFace:n}=e;return W({blending:w(c)?X(s,!0):null,culling:R(n),depthTest:{func:H(s)},depthWrite:G(e),drawBuffers:L(s,c),colorWrite:k,stencilWrite:o?V:null,stencilTest:o?t?E:q:null,polygonOffset:B(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}};function $(i){let e=se;return i.perspectiveInterpolation&&(e=e.clone().f32("perspectiveDivide")),e}class a extends Y{constructor(e){super(),this.draped=e,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}}p([l({count:3})],a.prototype,"cullFace",void 0),p([l()],a.prototype,"enableOffset",void 0),p([l()],a.prototype,"writeDepth",void 0),p([l()],a.prototype,"hasOccludees",void 0),p([l()],a.prototype,"terrainDepthTest",void 0),p([l()],a.prototype,"cullAboveTerrain",void 0),p([l()],a.prototype,"perspectiveInterpolation",void 0);class ye extends te{constructor(e){super(e,le),this.supportsEdges=!0,this.produces=new Map([[2,t=>g(t)],[4,t=>d(t)&&this.parameters.writeDepth],[8,t=>d(t)&&!this.parameters.writeDepth],[18,t=>d(t)||g(t)]]),this._configuration=new a(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<Z,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new oe(e)}createBufferWriter(){return new ne($(this.parameters))}}class oe extends K{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;ee(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(ae,e)}}class ne extends N{write(e,t,s,c,o,n){for(const r of this.layout.fields.keys()){const u=s.get(r);if(u)if(r==="perspectiveDivide"){P(u.size===1);const h=o.getField(r,x);h&&Q(u,h,n)}else U(r,u,e,t,o,n)}return null}}class le extends J{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}const pe=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:v,build:_},Symbol.toStringTag,{value:"Module"}));export{ye as g};
