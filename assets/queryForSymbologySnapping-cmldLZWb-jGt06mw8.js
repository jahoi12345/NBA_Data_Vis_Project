import{o as F}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{t as $}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{f as D}from"./Point-BfTTZoMu-DeJwQYfh.js";import{y as G}from"./projectPointToVector-DL7Z4uvb-CPbOlZdQ.js";import{h as P}from"./projectVectorToVector-Csv3NYZI-DpBtmQMN.js";import{N as q}from"./elevationInfoUtils-B8MpdRMP-CDlK86wO.js";import{N,O as E,o as A,P as B,Q as H}from"./ShadowCastClear.glsl-CeOT_rAo-BEYyVrmo.js";import{a as J}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";async function L(a,p,d,I,o){const{elevationProvider:l,renderCoordsHelper:i}=a,{elevationInfo:u}=p,{pointsInFeatures:S,spatialReference:m}=I,h=D.fromJSON(m),g=N(u,!0),f=await E(g,h,o);F(o);const c=[],e=new Set,r=new Set,t=new A,n=P(0,0,0,D.WGS84),s=new H,v=$();n.spatialReference=h;const x=a.elevationProvider.spatialReference??a.spatialReference;for(const{objectId:b,points:R}of S){const y=d(b);if(y==null){for(const w of R)c.push(w.z??0);e.add(b);continue}y.isDraped&&r.add(b);const z=y.graphic.geometry;t.setFromElevationInfo(q(z,u)),f&&t.updateFeatureExpressionInfoContextForGraphic(f,y.graphic,p);for(const{x:w,y:C,z:O}of R)n.x=w,n.y=C,n.z=O??0,await G(n,v,x,0,{signal:o}),B(v,l,t,i,s),c.push(s.z)}return{elevations:c,drapedObjectIds:r,failedObjectIds:e}}async function T(a,p,d){if(a==null||p.candidates.length===0)return j;const I=a.graphics3DGraphicsByObjectID??a.graphics3DGraphics,o=[],l=[],{renderer:i}=a,u=i!=null&&"arcadeRequired"in i&&i.arcadeRequired?J():null,S=async(e,{graphic:r,graphics3DSymbol:t})=>{const n=await u,s=await a.getRenderingInfoAsync(r,i,n,{signal:d});return s==null?[]:t.queryForSnapping(e,h,s,d)},{candidates:m,spatialReference:h}=p;for(let e=0;e<m.length;++e){const r=m[e],{objectId:t}=r,n=typeof t=="number"?I?.get(t):void 0;if(n==null)continue;const{graphics3DSymbol:s}=n;s.symbologySnappingSupported&&(o.push(S(r,n)),l.push(e))}if(o.length===0)return j;const g=await Promise.all(o);F(d);const f=[],c=[];for(let e=0;e<g.length;++e){const r=g[e],t=l[e];for(const n of r)f.push(n),c.push(t)}return{candidates:f,sourceCandidateIndices:c}}const j={candidates:[],sourceCandidateIndices:[]};export{L as V,T as X};
