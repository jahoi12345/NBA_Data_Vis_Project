import{c as F,q as Z,v as zt,a as De,i as ke,a4 as Ht,ar as Ut,l as qt,z as I,I as It,Y as a,H as l,G as O}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{ax as ye,af as fe,b as Ee,bA as mt}from"./Point-BfTTZoMu-DeJwQYfh.js";import{t as y,M as gt,a as je,X as Ae,e as _t}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{s as Nt}from"./getDefaultUnitForView-BIGim07z-DyM4eekL.js";import{s as Bt}from"./AnalysisView3D-zhHEgrUR-DZ8OICjY.js";import{F as w}from"./Color-CERqXxxY-BuYn26eI.js";import{o as k,j as v,s as Wt,l as B,i as yt,W as Jt}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{a as Xt}from"./screenUtils-BitdhK1O-L0FLPAMi.js";import{A as ft}from"./earcut-D9gy186--DqxOpTir.js";import{n as $}from"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import{L as me,m as $e,$ as Y,J as Yt,I as Qt,l as W,F as ze,A as He}from"./vec32-CewSdTn3-VRto2OOh.js";import{r as vt}from"./UpdatingHandles-D2RI_3Hb-dwLPjVun.js";import{X as Zt}from"./projectionUtils-BGH_5_I3-DGwchVO8.js";import{y as wt}from"./computeTranslationToOriginAndRotation-Bjd4esRf-vJ4LbdOU.js";import{o as ve,az as Kt,bq as ei,bN as ae,aF as ti,ar as bt,s as ii}from"./ShadowCastClear.glsl-CeOT_rAo-BEYyVrmo.js";import{a as Pe,S as Ct,y as xt,h as we,s as be,N as Vt,d as ri}from"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import{i as Ce}from"./DoubleArray-DExKNiTh-CvVpHySW.js";import{b as Pt}from"./vec3-B_phcnZY-DHC7I6xa.js";import{s as xe}from"./ElevationInfo-Cw2HaA6E-CuK5hJ96.js";import{I as oi,N as le,o as si}from"./ShadedColorMaterial.glsl-Cdsx30m0-BzzDoTK3.js";import{P as ni}from"./RealisticTree.glsl-WN9nrQUl-QZiY3aPA.js";import{u as Ve,f as ai}from"./Graphics3DExtrudeSymbolLayer-zvNu2dVq-B0ah8s4E.js";import{x as Ue,y as li}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{g as ui,s as ci,L as Ft}from"./mat4-C96X-Nn0-BrMLOLCb.js";import{aW as Tt,aX as Rt,aY as ge,a8 as hi,cP as qe,cQ as pi,cR as Ie,cS as ue,cT as di,O as Gt,y as mi,V as K,N as ee,B as te,cU as gi,F as ie,aU as _i,al as re,E as Fe,cV as yi,ay as oe,bp as fi,bs as vi,bN as Ne,bl as wi,az as Te,S as bi,n as Ci,f as xi,aT as Vi,ca as Pi}from"./Texture-CFNZjV2R-CxGjQ8pI.js";import{p as Mt,n as Ot}from"./InterleavedLayout-B7roQAzV-CdGz7mlm.js";import{H as se}from"./index-B0z_nLWi.js";import{E as q,R as Fi,P as _e}from"./enums-B4pqBiXb-BO-3hS_8.js";import{$ as Be,m as We}from"./euclideanLengthMeasurementUtils-CpHh36Dt-Ct4GxOU1.js";import{V as Je}from"./intl-DRFqUect-DPhFaHB2.js";import{u as Ti}from"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import{i as Ri}from"./quantityFormatUtils-WvkXaau6-BdljHfvV.js";import{m as Xe}from"./Indices-D0_UQPPr-t1Qev6md.js";import{z as ce,C as Gi,H as Mi}from"./vector-B8ZDYGQ6-DRILJdcx.js";import{$ as Ye,E as Oi}from"./Segment-DyJXA5Sk-ByhPeua0.js";import{X as Qe}from"./OutlineVisualElement-D-YFBknk-Cv23VSLn.js";import{u as Li}from"./VertexElementDescriptor-BlxU8vCE-BwuKQkTU.js";import{r as Si}from"./lineStippleUtils-CCavR4OV-DESXkwZW.js";import{k as Ze}from"./substitute-CT75-Q6W-DC-JcRyg.js";import{s as Di}from"./Graphic-DgGzDmqW-d1CNicxz.js";import ki from"./GraphicsLayer-CZ0Xqeb2-BtZ4GO5Z.js";import{o as Ei}from"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import{J as ji,f as Ai}from"./SlicePlaneMaterial.glsl-Bk_6X0A4-BDF0yWid.js";import{f as $i}from"./dragEventPipeline3D-DqqdeG4y-VV3Rp8Vu.js";import{l as zi,J as Hi,S as Ui}from"./InteractiveToolBase-DXh7kfgV-B5EAl8tr.js";import{m as Lt,h as Ke}from"./SketchOptions-Dguq2sp8-DmrYxGLA.js";import{y as qi,k as Ii,x as Ni}from"./SketchTooltipInfo-BNoFeSMr-BnE45nQX.js";import{l as Bi}from"./TooltipInfoWithCoordinates-CbHxsk06-B38ZJ-lU.js";import{T as Wi,f as Ji}from"./SketchViewModel-DKGDyAz7-Dg-c-laB.js";import{b as Xi}from"./allLayerSnapping-DASGx2Wx-CwdhFVIb.js";import{n as z,C as N,y as Yi}from"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import{o as Qi}from"./vec2f64-rIxtbMRN-Kai9mK1i.js";import{o as Zi}from"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./typeUtils-DqrRcjBx-DZ6_Gsbu.js";import"./modeUtils-BA-mAwuS-DSb1K26b.js";import"./sanitizerUtils-BT_8V5US-CWQWUwZQ.js";import"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./workers-BEkgoq8Q-BM_Hz460.js";import"./PooledRBush-Dco5QkUp-DX3CMhf3.js";import"./GraphicsCollection-Bk6M0b7D-Dk6KdmO7.js";import"./HeightModelInfo-D5IdRvJ2-23y6MRiu.js";import"./spatialReferenceEllipsoidUtils-D2JabnKt-Ce3ED0lc.js";import"./Layer-DZvC7bne-D3VLDrab.js";import"./TilemapCache-CjhKW_vj-8gKqgQfa.js";import"./LRUCache-fy84PBMi-Y56WPIvD.js";import"./asyncUtils-w6KfWU41-HenJ0UOu.js";import"./Map-AEYszeHg-ZEOzAMWa.js";import"./Basemap-CL_uaRmk-O3l-dbYk.js";import"./PortalItem-DnxMlRVo-CI4Ns2_M.js";import"./writeUtils-DEFpwIW1-AHZYPaSV.js";import"./CollectionFlattener-D6h2Fkvj-WVl2BXw-.js";import"./resourceExtension-DOTCeiZj-C2WIbjQM.js";import"./PolygonCollection-HNNpnBH7-5UHgGprq.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./Query-BlS0WPDF-jdXS_Qhy.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./normalizeUtils-85zLqeMi-C1bdAKNn.js";import"./normalizeUtilsCommon-CnhQye_A-UWhaH-kt.js";import"./ElevationQuery-DzlYa4L4-DkUTW9Ak.js";import"./TileInfo-Bz7QlefV-CdK7c8ef.js";import"./vec42-B8VM4vXb-B6OGOEI9.js";import"./vec3f32-WCVSSNPR-9V6Uhrx-.js";import"./Scheduler-CNrsbccs-Bcg8fWoS.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./sphere-DLQ6p7mp-DyEe1Vll.js";import"./constants-D67WmGms-H7IOwEdB.js";import"./quat-B7J5v7rV-CZ9akUv-.js";import"./quatf64-CCm9z-pX-CQ7_sSji.js";import"./projectVectorToVector-Csv3NYZI-DpBtmQMN.js";import"./aaBoundingBox-Cn49X7ge-BcYPaJ58.js";import"./frustum-CMzahy3--B-DC1Co-.js";import"./floatRGBA-D-Q4FzNN-DQhowfyr.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./TileKey-C44YQC4_-BW7BBbYp.js";import"./typeUtils-CXW_VpOn-BGgLp_TK.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-BjPAY2LA.js";import"./Font-BwmnW7d2-Dwh3xjKw.js";import"./PictureMarkerSymbol-CaSh-vZk-xhjZ61bb.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./TextSymbol-hRGhyDHs-CoS7dSjf.js";import"./unitConversionUtils-4vB4Ezlp-DnY5MDxd.js";import"./BufferView-Cj2sQaht-avJ4OGB_.js";import"./orientedBoundingBox-BLEx7wLU-ByGP9QG1.js";import"./vec2f32-CaVKkSa6-BjkBmyoj.js";import"./Octree-DckBBpQ7-CkRPu4UJ.js";import"./axisAngleDegrees-CjbXmycq-DcVVDR1-.js";import"./edgePreprocessing-D_eX-fWy-DqE-06Ss.js";import"./vec33-CWJeyzxV-Me4sF5XB.js";import"./ColorMaterial.glsl-rhi0cQVb-DVm6kWLC.js";import"./MeshLocalVertexSpace-BGd1IdEs-C0HJG4wR.js";import"./visualVariableUtils-ma4r7Z2K-Df6C3Hkh.js";import"./triangulationUtils-D34y65Gu-Cdt3j08j.js";import"./utils-DTE-xBiC-uxMmcNif.js";import"./geodeticLengthOperator-ysQZ6ofQ-ChYlynyx.js";import"./TextOverlayItem-OzxvglQU-B38vHCEh.js";import"./EngineVisualElement-DP9Jiq6V-Dztd1hg5.js";import"./LaserlinePath.glsl-DfE4imRj-NE31_VCm.js";import"./getPopupProvider-CmskPttI-CzUWpGwk.js";import"./sliceToolConfig-BnawSSVt-BPWko_GQ.js";import"./DefaultLayouts-B8c6Qefj-C3DDatg5.js";import"./EditGeometryOperations-DZvKpTU8-DnyvzBdp.js";import"./MeshTransform-Bl0zl104-SaBiGlTx.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./jsonUtils-CmpazY1u-6pDLj5sx.js";import"./projectPointToVector-DL7Z4uvb-CPbOlZdQ.js";import"./scaleUtils-yfx9kKWT-D9SVsyM-.js";import"./layerUtils-DZGhvm-W-CfyHx1TZ.js";import"./tagSymbols-BPcGfZon-BPcGfZon.js";import"./Queue-CYlrXMwB-CYJTUII-.js";import"./signal-BX9ezF8a-cf1Pn6io.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./ReactiveMap-B0by2bYu-DCsCfMj5.js";import"./TablesMixin-Q80MT3nU-CBB9B-b6.js";import"./plane-BNdSPG2o-DTV5z6SO.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./layerViewUtils-BTa15X3o-BjQlX2q8.js";import"./dehydratedFeatures-Ql-uVzLq-aoK2987s.js";import"./quantizationUtils-Ceq-Uxsu-DjgKK_0s.js";import"./featureConversionUtils-BDA_FXJx-CDxX1Wik.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./elevationInfoUtils-B8MpdRMP-CDlK86wO.js";import"./HUDIntersectorResult-1xTExS7z-dL9SFL6u.js";import"./intersectorUtilsConversions-pLQPEbcN-Ck-nyNYa.js";import"./Intersector-DS9YtyQY-DMoYp6i0.js";import"./DefaultLoadingContext-DXgBe4GE-Unnb_XgV.js";import"./wosrLoader-CIPfz1Cl-DlmQQkMX.js";import"./Version-BtYZEj58-LyRHDnSJ.js";import"./config-Dg972SSE-D9DBKeq5.js";import"./GeometryUtils-C354xUs0-BLAznQrw.js";import"./definitions-Dvg4hMIw-CdK2DzFN.js";import"./WorkerHandle-B930SiRy-DglEKt53.js";import"./colorUtils-CeIi7j7j-C2WVx6th.js";import"./capabilities-Bi6C4OG6-CpURufko.js";import"./imageUtils-142g71N8-Wj0XNClb.js";import"./videoUtils-Dwx3AEgj-CduhpDRk.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./quickselect-QQC62dOK-Br2Ahhru.js";import"./meshVertexSpaceUtils-CtG7DPVT-kybwngCt.js";import"./TileKey-CXWFOqOI-Lra6v-mg.js";import"./loadAll-BCyxerwc-B4Lp8wGC.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./persistable-CdoDQOTR-BklJqWTn.js";import"./MD5-MtSiOt06-jWr180Yc.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw-DH8sdIsE.js";import"./utils-CylVuxNi--x86XOjU.js";import"./utils-Dpg4yj1D-CeFz2JVC.js";import"./types-BKo2foNY-DE0QfIFp.js";import"./labelUtils-BtizwBfq-Zegx4520.js";import"./ArcadeExpression-BlIRq-oN-VZkrwLVE.js";import"./TimeOnly-BERR31kg-CQiLyUZi.js";import"./enum-BzLwmiID-CcyIdWlQ.js";import"./FieldsIndex-CimK-TqD--24JoCkp.js";import"./VisualElement-By4iq8p4-ZBataKFH.js";import"./line-DShd3yGd-HKPw0I1T.js";import"./SnappingCandidate-DGkpYqI6-CfPvDre4.js";import"./renderingInfoUtils-BivCmbrV-CIlcu1O_.js";import"./geometry2dUtils-B4vDf2wH-DzgYge1I.js";import"./line-CgFvXjo5-Ccb7VN1k.js";import"./BlendLayer-HE_aYHHW-D0es7Iiq.js";import"./layerContainerType-CSXZNpHb-BIF7XAYP.js";import"./jsonUtils-CY6YsQMo-LM0PY-PG.js";import"./ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js";import"./TriangleMaterial-BIKWylXl-CXByzRQi.js";import"./a11yUtils-B9mR-UhZ-BVFKYm-0.js";import"./angularMeasurementUtils-CP9gTlx0-ps9xKKJ5.js";import"./automaticAreaMeasurementUtils-L66brXzH-D53WJA2q.js";import"./geodesicAreaMeasurementUtils-DMf2sF8v-ppx2yPNh.js";import"./automaticLengthMeasurementUtils-O6uwtXFm-DGWcG540.js";import"./deduplicate-Lzwo1kX7-CSf-1ZcR.js";import"./geodeticCurveType-CirnHLSB-CirnHLSB.js";import"./rotate-CKztRS_J-BAJoscjo.js";import"./curveOperationUtils-BGqPT1bh-DTx58Z-T.js";const et=new w("black");let Ki=class{constructor(){this.geometryOutlineWidth=1.5,this.geometryOutlineColor=new w("rgb(128,128,128)"),this.cutColor=new w("rgba(153, 198, 111, 0.75)"),this.fillColor=new w("rgba(200, 200, 230, 0.75)"),this.cutColorMuted=new w("rgba(176, 176, 176, 0.75)"),this.fillColorMuted=new w("rgba(194, 194, 194, 0.75)"),this.cutProjectionLineColor=w.blendColors(this.cutColor,et,.4),this.fillProjectionLineColor=w.blendColors(this.fillColor,et,.4),this.projectionLineWidth=2,this.projectionLineStippleSize=4,this.labelDistance=40,this.labelPrecisions={"cubic-millimeters":0,"cubic-centimeters":0,"cubic-decimeters":1,"cubic-meters":2,"cubic-kilometers":6,"cubic-inches":0,"cubic-feet":2,"cubic-yards":2,"cubic-miles":6,liters:2},this.maxVolumeExtentSizeVw=.7,this.minVolumeExtentSizePixels=250,this.minTargetElevation=-11e3,this.maxTargetElevation=9e3,this.targetElevationRange=this.maxTargetElevation-this.minTargetElevation,this.maxPerimeterLocalWebMercator=1e4,this.maxPerimeterGlobal=5e4}};const M=new Ki;let b=class extends Z{constructor(e){super(e),this.rawResult=null}get localOriginRenderSpace(){const{extent:e,localOrigin:t,renderCoordsHelper:i}=this,r=y();return i.toRenderCoords(t,e.spatialReference,r),r}get cameraPositionRenderSpace(){const{localOriginRenderSpace:e,renderCoordsHelper:t}=this,i=y(),r=1/t.unitInMeters;return t.setAltitude(i,tr*r,e),i}get boundingRect(){const{extent:e,renderCoordsHelper:t}=this,i=xt();return t.viewingMode===2?Vt(e,i):(this._expandBoundingRect(e.xmin,e.ymin,i),this._expandBoundingRect(e.xmax,e.ymin,i),this._expandBoundingRect(e.xmin,e.ymax,i),this._expandBoundingRect(e.xmax,e.ymax,i)),i}get cameraDimensions(){const{boundingRect:e}=this;return{width:we(e),height:be(e)}}get cameraNearFar(){const{renderCoordsHelper:{unitInMeters:e}}=this,t=1/e;return{near:ir*t,far:rr*t}}get upVector(){return this.renderCoordsHelper.worldBasisAtPosition(this.cameraPositionRenderSpace,2,y())}get northVector(){return this.renderCoordsHelper.worldBasisAtPosition(this.cameraPositionRenderSpace,1,y())}get eastVector(){return this.renderCoordsHelper.worldBasisAtPosition(this.cameraPositionRenderSpace,0,y())}_expandBoundingRect(e,t,i){const{extent:r,eastVector:s,northVector:n,upVector:u,renderCoordsHelper:c}=this,h=r.center.z??0;me(he,e,t,h),c.toRenderCoords(he,r.spatialReference,he),ni(he,s,n,u,tt),Ct(i,tt,i)}};a([l()],b.prototype,"renderCoordsHelper",void 0),a([l()],b.prototype,"extent",void 0),a([l()],b.prototype,"localOrigin",void 0),a([l()],b.prototype,"localOriginRenderSpace",null),a([l()],b.prototype,"cameraPositionRenderSpace",null),a([l()],b.prototype,"boundingRect",null),a([l()],b.prototype,"cameraDimensions",null),a([l()],b.prototype,"upVector",null),a([l()],b.prototype,"northVector",null),a([l()],b.prototype,"eastVector",null),a([l()],b.prototype,"rawResult",void 0),b=a([O("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementCutFillComputation")],b);const he=y(),tt=y(),er=100,tr=M.maxTargetElevation,ir=0,rr=M.targetElevationRange+er;let ne=class extends It{constructor(e,t,i){super(e,t,i),this.name="unknown",this.name=e}};class it extends ne{constructor(){super("perimeter-too-large","The input geometry's perimeter is too large for the current viewing mode and spatial reference.")}}let or=class extends ne{constructor(){super("distance-too-far","The measurement geometry is too far from the camera.")}},sr=class extends ne{constructor(){super("distance-too-close","The measurement geometry is too close to the camera.")}};class nr extends ne{constructor(){super("unsupported-coordinate-system","The coordinate system of the view (viewing mode and spatial reference) is not supported.")}}let ar=class extends ne{constructor(){super("unsupported-layer-transparency","The volume measurement analysis does not support transparent layers.")}};function lr(e,t,i="cubic-meters"){const r=e-t,s=e+t;return{cutVolume:ae(e,i),fillVolume:ae(t,i),netVolume:ae(r,i),totalVolume:ae(s,i)}}function pe(e,t){return e?ii(e,mt(e.value,e.unit,t)):null}let R=class extends Z{constructor(e){super(e)}get cutVolume(){return pe(this.rawResult.cutVolume,this.unit)}get fillVolume(){return pe(this.rawResult.fillVolume,this.unit)}get netVolume(){return pe(this.rawResult.netVolume,this.unit)}get totalVolume(){return pe(this.rawResult.totalVolume,this.unit)}};a([l({constructOnly:!0})],R.prototype,"measureType",void 0),a([l()],R.prototype,"cutVolume",null),a([l()],R.prototype,"fillVolume",null),a([l()],R.prototype,"netVolume",null),a([l()],R.prototype,"totalVolume",null),a([l({constructOnly:!0})],R.prototype,"rawResult",void 0),a([l({constructOnly:!0})],R.prototype,"unit",void 0),R=a([O("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementResult")],R);class St extends mi{constructor(){super(...arguments),this.output=0}}a([Pi({count:11})],St.prototype,"output",void 0);let Re=class extends K{};function Dt(){const e=new oe;return e.include(Te),e.fragment.include(bi),e.fragment.uniforms.add(new N("cutFillReferenceDepthTexture",t=>t.referenceDepthTexture),new N("cutFillTargetDepthTexture",t=>t.targetDepthTexture)),e.fragment.code.add(z`bool outsideFar(float depth) {
return depth >= 1.0;
}`),e.fragment.main.add(z`float referenceDepth = depthFromTexture(cutFillReferenceDepthTexture, uv);
float targetDepth = depthFromTexture(cutFillTargetDepthTexture, uv);
if (outsideFar(targetDepth)) {
discard;
}
float depth = referenceDepth - targetDepth;
float cut = min(0.0, depth);
float fill = max(0.0, depth);
fragColor = vec4(cut, fill, 0.0, 0.0);`),e}const ur=Object.freeze(Object.defineProperty({__proto__:null,CutFillDepthParameters:Re,build:Dt},Symbol.toStringTag,{value:"Module"}));let rt=class extends ee{constructor(e,t){super(e,t,new te(ur,()=>se(()=>Promise.resolve().then(()=>Tr),void 0)),Fe)}initializePipeline(){return ie({colorWrite:re})}},Ge=class extends K{};function kt(){const e=new oe;return e.include(Te),e.fragment.uniforms.add(new N("cutFillDepthTexture",t=>t.depthTexture)),e.fragment.main.add(z`ivec2 iuv = ivec2(gl_FragCoord.xy) * 2;
vec2 sum = vec2(0.0);
for (int dx = 0; dx < 2; dx++) {
for (int dy = 0; dy < 2; dy++) {
sum += texelFetch(cutFillDepthTexture, iuv + ivec2(dx, dy), 0).rg;
}
}
fragColor = vec4(sum.r, sum.g, 0.0, 0.0);`),e}const cr=Object.freeze(Object.defineProperty({__proto__:null,CutFillReductionParameters:Ge,build:kt},Symbol.toStringTag,{value:"Module"}));class ot extends ee{constructor(t,i){super(t,i,new te(cr,()=>se(()=>Promise.resolve().then(()=>Rr),void 0)),Fe)}initializePipeline(){return ie({colorWrite:re})}}let Me=class extends K{constructor(){super(...arguments),this.origin=_t,this.cutFillCamera={projectionMatrix:$(),viewMatrix:$(),nearFar:Qi()}}};function Et(e){const t=new oe,{vertex:i,fragment:r,varyings:s,attributes:n}=t;return t.include(fi),t.include(vi,e),n.add("position","vec3"),s.add("depth","float",{invariant:!0}),i.uniforms.add(new Ne("proj",u=>u.cutFillCamera.projectionMatrix),new Ne("view",u=>Ft(hr,u.cutFillCamera.viewMatrix,u.origin)),new wi("nearFar",u=>u.cutFillCamera.nearFar)),i.main.add(z`gl_Position = transformPositionWithDepth(proj, view, position, nearFar, depth);`),r.main.add(z`fragColor = vec4(1.0);
outputDepth(depth);`),t}const hr=$(),pr=Object.freeze(Object.defineProperty({__proto__:null,CutFillTargetDepthParameters:Me,build:Et},Symbol.toStringTag,{value:"Module"}));let st=class extends ee{constructor(e,t){super(e,t,new te(pr,()=>se(()=>Promise.resolve().then(()=>Gr),void 0)),gi)}initializePipeline(){return ie({colorWrite:re,depthWrite:_i,depthTest:{func:519}})}},E=class extends Tt{constructor(e){super(e),this.consumes={required:[Rt.TRANSPARENT]},this.produces=ge.CUTFILL_DEPTH,this._cutFillTargetDepthConfiguration=new St,this._cutFillTargetDepthParameters=new Me,this._cutFillDepthParameters=new Re,this._cutFillReductionParameters=new Ge,this.needsRender=!1,this.done=!0,this._localOrigin=y(),this._maxTextureSize=4096,this._width=0,this._height=0,this._reducedWidth=0,this._reducedHeight=0,this._depthFormat=13,this._colorFormat=10,this._targetVao=null}initialize(){this._maxTextureSize=Math.min(qt("esri-mobile")?1024:this._maxTextureSize,this.fboCache.rctx.parameters.maxTextureSize),this._cutFillTargetDepthConfiguration.output=8}destroy(){this._targetVao=I(this._targetVao)}precompile(){this.techniques.precompile(st,this._cutFillTargetDepthConfiguration),this.techniques.precompile(rt),this.techniques.precompile(ot),this.view.stage.renderer.precompileCutFill()}render(e){const t=e.find(({name:g})=>g===ge.CUTFILL_DEPTH);if(!this._orthographicCamera||!this._targetVao||!this.needsRender)return t;const i=this.techniques.get(st,this._cutFillTargetDepthConfiguration),r=this.techniques.get(rt),s=this.techniques.get(ot);if(!i.compiled||!r.compiled||!s.compiled)return this.requestRender(1),t;this.needsRender=!1;const n=this.renderingContext,u=this.fboCache,c=n.getViewport(),h=u.acquire(this._width,this._height,"cutfill reference depth",this._depthFormat);n.bindFramebuffer(h.fbo),n.setViewport(0,0,this._width,this._height),n.clear(1280),this.view.stage.renderer.renderCutFillReferenceDepth(this._orthographicCamera);const p=u.acquire(this._width,this._height,"cutfill target depth",this._depthFormat);n.bindFramebuffer(p.fbo),n.setViewport(0,0,this._width,this._height),n.setClearDepth(1),n.clear(256),this._cutFillTargetDepthParameters.origin=this._localOrigin,this._cutFillTargetDepthParameters.cutFillCamera=this._orthographicCamera,n.bindTechnique(i,this.bindParameters,this._cutFillTargetDepthParameters),n.bindVAO(this._targetVao),n.drawArrays(q.TRIANGLES,0,this._targetVao.vertexCount("geometry"));let o=u.acquire(this._width,this._height,"cutfill reduction even",this._colorFormat),d=u.acquire(this._width,this._height,"cutfill reduction odd",this._colorFormat);this._cutFillDepthParameters.referenceDepthTexture=h.depthTexture,this._cutFillDepthParameters.targetDepthTexture=p.depthTexture,n.bindFramebuffer(o.fbo),n.bindTechnique(r,this.bindParameters,this._cutFillDepthParameters),n.setClearColor(0,0,0,0),n.clear(16384),n.screen.draw(),h.release(),p.release();let m=this._width,f=this._height;const x=Math.ceil(Math.log2(Math.min(m,f)));for(let g=0;g<x;g++)m=Math.ceil(m/2),f=Math.ceil(f/2),this._cutFillReductionParameters.depthTexture=o.getTexture(),this._prepareFBO(d,m,f),n.bindTechnique(s,this.bindParameters,this._cutFillReductionParameters),n.screen.draw(),[o,d]=[d,o];return this._buffer=new Float32Array(m*f*2),o.fbo?.readPixels(0,0,m,f,33319,Fi.FLOAT,this._buffer),this._reducedWidth=m,this._reducedHeight=f,o.release(),d.release(),n.setViewport(c.x,c.y,c.width,c.height),this.done=!0,t}setup(e,t){const i=this.renderingContext,{cameraDimensions:{width:r,height:s},localOriginRenderSpace:n}=e,u=this._maxTextureSize,c=s/r,h=r>s?u:u/c,p=r>s?u*c:u;this._width=Ue(h),this._height=Ue(p);const o=[this._width,this._height];this._orthographicCamera=this._createCamera(e,o),this._targetVao=I(this._targetVao),this._targetVao=dr(i,t),this._localOrigin=n,this.done=!1}start(){this._width!==0&&this._height!==0&&(this.needsRender=!0)}getDepth(){let e=0,t=0;for(let i=0;i<this._reducedWidth;i++)for(let r=0;r<this._reducedHeight;r++){const s=i+r*this._reducedHeight;e+=this._buffer?.[2*s]??0,t+=this._buffer?.[2*s+1]??0}return{cut:e,fill:t}}get width(){return this._width}get height(){return this._height}get updating(){return this.needsRender||!this.done}_prepareFBO(e,t,i){const r=this.renderingContext;r.bindFramebuffer(e.fbo),r.setViewport(0,0,t,i),r.setClearColor(0,0,0,0),r.clear(16384)}_createCamera(e,t){const{cameraPositionRenderSpace:i,localOriginRenderSpace:r,northVector:s,cameraDimensions:{width:n,height:u},cameraNearFar:{near:c,far:h}}=e,p=new hi({eye:i,center:r,up:s,near:c,far:h});return p.viewport=[0,0,t[0],t[1]],ui(p.projectionMatrix,-n/2,n/2,-u/2,u/2,c,h),p}};a([l()],E.prototype,"consumes",void 0),a([l()],E.prototype,"produces",void 0),a([l()],E.prototype,"needsRender",void 0),a([l()],E.prototype,"done",void 0),a([l()],E.prototype,"updating",null),E=a([O("esri.views.3d.webgl-engine.lib.CutFillDepth")],E);const nt=Mt().vec3f("position").freeze();function dr(e,t){const{positions:i,indices:r}=t,s=nt.createBuffer(r.length),n=s.position;for(let c=0;c<r.length;++c){const h=3*r[c];n.set(c,0,i[h]),n.set(c,1,i[h+1]),n.set(c,2,i[h+2])}const u=new Gt(e,Ot(nt),s.buffer);return new bt(e,u)}let mr=class{constructor(e,t){this.positions=e,this.indices=t}},_=class extends Z{constructor(e){super(e),this._getElevationProvider=()=>this.view.elevationProvider,this._updatingHandles=new vt,this._computationValue=null}initialize(){const e=this.view;this._renderer=new E({view:e}),this._updatingHandles.add(()=>({computation:this._computation,renderGeometry:this._targetGeometryRenderInfo}),({computation:t,renderGeometry:i})=>{t&&i&&(this._renderer.setup(t,i),this._renderer.start())},k),this.addHandles([this._createElevationUpdateHandle(),v(()=>this._targetGeometry,t=>this.analysisViewData.targetGeometry=t,B),v(()=>this._elevationAlignedGeometry,t=>this.analysisViewData.elevationAlignedGeometry=t,B),v(()=>({computation:this._computation,extent:this._projectedGeometry?.extent,localOrigin:this._localOrigin}),({computation:t,extent:i,localOrigin:r})=>{t&&i&&r&&(t.extent=i,t.localOrigin=r)},yt),Wt(()=>this._renderer.done,()=>this._updateResult())])}destroy(){this._updatingHandles.destroy(),this._renderer.destroy()}get _projectedGeometry(){if(!this.analysis.valid)return null;const e=this.analysis.geometry,t=Zt(e,this.view.spatialReference);return t.pending?(this._updatingHandles.addPromise(t.pending),null):(e&&!t.geometry&&oi(this.analysis,e.spatialReference,zt.getLogger(this)),t.geometry)}get _localOrigin(){const e=this._projectedGeometry?.extent;return e?gt(e.center.x,e.center.y,0):null}get _elevationAlignedGeometry(){const e=this._projectedGeometry;if(!e)return null;const t=e.clone();return gr(this._getElevationProvider(),t),t}get _targetGeometry(){const e=this._elevationAlignedGeometry;if(!e)return null;const t=this.analysis.measureType,{effectiveTargetElevation:i}=this.analysisViewData;if(t==="stockpile"||i==null)return e;const r=e.clone();return r.rings[0].forEach(s=>s[2]=i),r}get _targetGeometryRenderInfo(){const e=this._targetGeometry,t=this._projectedGeometry?.extent,i=this._localOrigin;if(!e||!t||!i)return null;const{elevationProvider:r,renderCoordsHelper:s}=this.view,n=Ve(e,r,s,ve.fromElevationInfo(new xe({mode:"absolute-height"}))),{polygons:u}=n,c=u[0],h=ft(c.position,c.holeIndices,3),p=Ce(3*c.count),o=$(),d=$();return wt(t.spatialReference,i,o,s.spatialReference),d[12]=-o[12],d[13]=-o[13],d[14]=-o[14],Pt(p,c.position,d),new mr(p,h)}get updating(){return this._renderer.updating||this._updatingHandles.updating}get result(){const e=this._computation?.rawResult;return e?new R({measureType:this.analysis.measureType,rawResult:e,unit:this.analysisViewData.effectiveDisplayUnits.volume}):null}get error(){return this._unsupportedCoordinateSystemError??this._unsupportedLayerTransparencyError??this._perimeterTooLargeError??this._tooNearFarError}get _tooNearFarError(){const e=this._elevationAlignedGeometry;if(!e)return null;const{view:t}=this,{elevationProvider:i,renderCoordsHelper:r}=t,{camera:s}=t.state,n=Ve(e,i,r,ve.fromElevationInfo(new xe({mode:"absolute-height"}))),{polygons:u}=n,c=u[0].position;Pe(J);for(let m=0;m<c.length;m+=3)s.projectToScreen(me(vr,c[m],c[m+1],c[m+2]),ut),Ct(J,ut,J);const h=we(J),p=be(J),{maxVolumeExtentSizeVw:o,minVolumeExtentSizePixels:d}=M;return h>s.width/s.pixelRatio*o||p>s.height/s.pixelRatio*o?new sr:Math.max(h,p)<d?new or:null}get _perimeterTooLargeError(){return this._perimeterTooLargeLocalError??this._perimeterTooLargeGlobalError}get _perimeterTooLargeLocalError(){const{spatialReference:e,state:{isLocal:t}}=this.view;if(!t||!e.isWebMercator)return null;const i=this._perimeter,{maxPerimeterLocalWebMercator:r}=M;return i!=null&&i>r?new it:null}get _perimeterTooLargeGlobalError(){if(!this.view.state.isGlobal)return null;const e=this._perimeter,{maxPerimeterGlobal:t}=M;return e!=null&&e>t?new it:null}get _unsupportedCoordinateSystemError(){return this.view.state.isLocal&&this.view.spatialReference.isGeographic?new nr:null}get _unsupportedLayerTransparencyError(){return(this.view.map?.ground.opacity??1)<1?new ar:null}get _perimeter(){const e=this._targetGeometryRenderInfo?.positions,t=e?yr(fr(e)):null;return t!=null?t/this.view.renderCoordsHelper.unitInMeters:null}get _enabled(){return!this.error}get _computation(){const e=this._projectedGeometry?.extent;if(!e||!this._enabled)return this._computationValue=F(this._computationValue),null;if(this._computationValue)return this._computationValue;const t=this._localOrigin;if(!t)return null;const{renderCoordsHelper:i}=this.view;return this._computationValue=new b({extent:e,localOrigin:t,renderCoordsHelper:i}),this._computationValue}_createElevationUpdateHandle(){const e=t=>{const i=this._projectedGeometry?.extent;t.context==="ground"&&i&&(Kt(t.extent,t.spatialReference,at,this.view.spatialReference),Vt(i,lt),ri(at,lt)&&(this._getElevationProvider=()=>this.view.elevationProvider))};return this.view.elevationProvider.on("elevation-change",t=>e(t))}_updateResult(){if(!this._computation)return;const{spatialReference:e,viewingMode:t}=this.view,{extent:i,boundingRect:r,cameraNearFar:{near:s,far:n}}=this._computation,{width:u,height:c}=this._renderer;let h,p;t==="local"&&e.isWebMercator?{width:h,height:p}=_r(i):(h=we(r),p=be(r));const o=h/u*(p/c),d=this._renderer.getDepth(),m=g=>g*(n-s)+s,f=m(d.cut)*o,x=m(d.fill)*o;this._computation.rawResult=lr(Math.abs(f),x)}};function gr(e,t){t.rings[0].forEach(i=>{i[2]=ei(e,i,"ground")??0})}function _r(e){const t=Be([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],e.spatialReference),i=Be([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],e.spatialReference);return{width:t?.value??0,height:i?.value??0}}function yr(e){if(!e)return null;let t=null,i=null,r=0;for(const s of e)t||(t=[s[0],s[1],s[2]??0]),i?r+=$e(i,s):i=[0,0,0],i[0]=s[0],i[1]=s[1],i[2]=s[2];return t&&i&&(r+=$e(i,t)),Math.sqrt(r)}function*fr(e){const t=y();for(let i=0;i<e.length;i+=3)t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],yield t}a([l()],_.prototype,"_projectedGeometry",null),a([l()],_.prototype,"_localOrigin",null),a([l()],_.prototype,"_getElevationProvider",void 0),a([l()],_.prototype,"_elevationAlignedGeometry",null),a([l()],_.prototype,"_targetGeometry",null),a([l()],_.prototype,"_targetGeometryRenderInfo",null),a([l({constructOnly:!0})],_.prototype,"analysis",void 0),a([l({constructOnly:!0})],_.prototype,"analysisViewData",void 0),a([l({constructOnly:!0})],_.prototype,"view",void 0),a([l()],_.prototype,"updating",null),a([l()],_.prototype,"result",null),a([l()],_.prototype,"error",null),a([l()],_.prototype,"_tooNearFarError",null),a([l()],_.prototype,"_perimeterTooLargeError",null),a([l()],_.prototype,"_perimeterTooLargeLocalError",null),a([l()],_.prototype,"_perimeterTooLargeGlobalError",null),a([l()],_.prototype,"_unsupportedCoordinateSystemError",null),a([l()],_.prototype,"_unsupportedLayerTransparencyError",null),a([l()],_.prototype,"_perimeter",null),a([l()],_.prototype,"_enabled",null),a([l()],_.prototype,"_renderer",void 0),a([l({readOnly:!0})],_.prototype,"_updatingHandles",void 0),a([l()],_.prototype,"_computation",null),_=a([O("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementCutFillController")],_);const at=Pe(),lt=Pe(),vr=y(),J=xt(),ut=Xt();let Oe=class extends K{constructor(){super(...arguments),this.borderColor=Zi()}};function jt(){const e=new oe;return e.include(Te),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new N("colorTexture",t=>t.color),new N("cutFillVolumes",t=>t.cutFillVolumes),new N("cutFillMask",t=>t.cutFillMask),new Yi("pixelRatio",(t,i)=>i.camera.pixelRatio),new Vi("borderColor",t=>t.borderColor)).main.add(z`vec4 color = texture(colorTexture, uv, 0.0);
vec4 volumesColor = texture(cutFillVolumes, uv, 0.0);
ivec2 iuv = ivec2(uv * vec2(textureSize(cutFillMask, 0)));
vec2 m0 = texelFetch(cutFillMask, iuv, 0).rg;
vec2 m1 = texelFetch(cutFillMask, iuv + ivec2(-1, 0), 0).rg;
vec2 m2 = texelFetch(cutFillMask, iuv + ivec2(1, 0), 0).rg;
vec2 m3 = texelFetch(cutFillMask, iuv + ivec2(0, -1), 0).rg;
vec2 m4 = texelFetch(cutFillMask, iuv + ivec2(0, 1), 0).rg;
float d = (
step(1.5, abs(m0.r - m1.r) + abs(m0.g - m1.g))
+ step(1.5, abs(m0.r - m2.r) + abs(m0.g - m2.g))
+ step(1.5, abs(m0.r - m3.r) + abs(m0.g - m3.g))
+ step(1.5, abs(m0.r - m4.r) + abs(m0.g - m4.g))
) * 0.25 * pixelRatio;
vec4 base = mix(color, volumesColor, max(m0.r, m0.g) * volumesColor.a);
fragColor = mix(base, borderColor, d);`),e}const wr=Object.freeze(Object.defineProperty({__proto__:null,CutFillCompositionPassParameters:Oe,build:jt},Symbol.toStringTag,{value:"Module"}));let ct=class extends ee{constructor(e,t){super(e,t,new te(wr,()=>se(()=>Promise.resolve().then(()=>Mr),void 0)),Fe)}initializePipeline(){return ie({colorWrite:re})}};class Le extends K{constructor(){super(...arguments),this.origin=_t}}function At(){const e=new oe;return e.attributes.add("position","vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new Ci("proj",t=>t.camera.projectionMatrix),new xi("view",(t,i)=>Ft(br,i.camera.viewMatrix,t.origin))).main.add(z`gl_Position = proj * view * vec4(position, 1.0);
gl_Position.z = min(gl_Position.z, gl_Position.w);`),e.fragment.main.add(z`fragColor = vec4(1, 1, 0, 0);`),e}const br=$(),Cr=Object.freeze(Object.defineProperty({__proto__:null,CutFillMaskDrawParameters:Le,build:At},Symbol.toStringTag,{value:"Module"}));class ht extends ee{constructor(t,i){super(t,i,new te(Cr,()=>se(()=>Promise.resolve().then(()=>Or),void 0)),Li(yi))}initializePipeline(){return ie({colorWrite:re,depthTest:{func:515}})}}let j=class extends Tt{constructor(e){super(e),this.consumes={required:[Rt.OPAQUE]},this.produces=ge.CUTFILL_COLOR,this._vaoCut=null,this._vaoFill=null,this._countCut=0,this._countFill=0,this._maskParameters=new Le,this._cutVolumeParameters=new qe,this._fillVolumeParameters=new qe,this._compositeParameters=new Oe,this._drawParameters=new pi;const t=e.view.state.viewingMode===1;this._cutVolumeTechniqueConfiguration=new Ie(t),this._cutVolumeTechniqueConfiguration.customDepthTest=2,this._cutVolumeTechniqueConfiguration.writeDepth=!1,this._cutVolumeTechniqueConfiguration.cullFace=1,this._cutVolumeTechniqueConfiguration.doubleSidedMode=1,this._fillVolumeTechniqueConfiguration=new Ie(t),this._fillVolumeTechniqueConfiguration.cullFace=2}initialize(){this.addHandles([v(()=>[this.cutColor,this.fillColor],()=>this._updateColors(),B)])}destroy(){this._vaoCut=I(this._vaoCut),this._vaoFill=I(this._vaoFill)}precompile(){this.techniques.precompile(ue,this._cutVolumeTechniqueConfiguration),this.techniques.precompile(ue,this._fillVolumeTechniqueConfiguration),this.techniques.precompile(ht),this.techniques.precompile(ct)}render(e){const t=this.techniques.get(ue,this._cutVolumeTechniqueConfiguration),i=this.techniques.get(ue,this._fillVolumeTechniqueConfiguration),r=this.techniques.get(ht),s=this.techniques.get(ct),n=e.find(({name:g})=>g===this.produces);if(!this._vaoCut||!this._vaoFill)return n;if(!(t&&i&&r.compiled&&s.compiled))return this.requestRender(1),n;const u=this.bindParameters,c=u.camera,h=c.fullViewport[2],p=c.fullViewport[3],o=this.renderingContext,d=this.fboCache,m=d.acquire(h,p,"cutfill color mask",2);m.attachDepth(n.getAttachment(_e)),o.bindFramebuffer(m.fbo),o.setClearColor(0,0,0,1),o.clear(17408),o.setViewport(0,0,h,p),o.bindTechnique(r,u,di,this._maskParameters),o.setFaceCullingEnabled(!1),o.setStencilTestEnabled(!0),o.setStencilOpSeparate(1028,7680,34055,7680),o.setStencilOpSeparate(1029,7680,34056,7680),o.setDepthWriteEnabled(!1),o.bindVAO(this._vaoCut),o.setDepthTestEnabled(!0),o.setStencilWriteMask(255),o.setStencilFunction(519,0,255),o.setColorMask(!1,!1,!1,!1),o.drawArrays(q.TRIANGLES,0,this._countCut),o.setDepthTestEnabled(!1),o.setStencilWriteMask(0),o.setStencilFunction(517,0,255),o.setColorMask(!0,!1,!1,!1),o.drawArrays(q.TRIANGLES,0,this._countCut),o.bindVAO(this._vaoFill),o.setDepthTestEnabled(!0),o.setStencilWriteMask(255),o.setStencilFunction(519,0,255),o.setColorMask(!1,!0,!1,!1),o.drawArrays(q.TRIANGLES,0,this._countFill);const f=d.acquire(h,p,"cutfill color volumes",5);f.attachDepth(n.getAttachment(_e)),o.bindFramebuffer(f.fbo),o.setClearColor(0,0,0,0),o.clear(16384),o.setColorMask(!0,!0,!0,!0),o.bindTechnique(t,this.bindParameters,this._cutVolumeParameters,this._drawParameters),o.setPolygonOffset(1,1),o.setPolygonOffsetFillEnabled(!0),o.bindVAO(this._vaoCut),o.drawArrays(q.TRIANGLES,0,this._countCut),o.bindTechnique(i,this.bindParameters,this._fillVolumeParameters,this._drawParameters),o.setPolygonOffset(0,0),o.setPolygonOffsetFillEnabled(!1),o.bindVAO(this._vaoFill),o.drawArrays(q.TRIANGLES,0,this._countFill);const x=this.fboCache.acquire(h,p,this.produces);return o.bindFramebuffer(x.fbo),this._compositeParameters.color=n.getTexture(),this._compositeParameters.cutFillVolumes=f.getTexture(),this._compositeParameters.cutFillMask=m.getTexture(),w.toUnitRGBA(this.borderColor,this._compositeParameters.borderColor),o.bindTechnique(s,u,this._compositeParameters),o.screen.draw(),m.release(),f.release(),x.attachDepth(n.getAttachment(_e)),x}enable(){this.produces=ge.CUTFILL_COLOR,this.requestRender(1)}disable(){this.produces="disabled",this.requestRender(1)}updateGeometries(e,t,i){this._vaoCut=I(this._vaoCut),this._vaoCut=this._createVao(e),this._countCut=e.indicesBottom.length+e.indicesExtruded.length,this._vaoFill=I(this._vaoFill),this._vaoFill=this._createVao(t),this._countFill=t.indicesBottom.length+t.indicesExtruded.length,this._maskParameters.origin=i,Qt(this._drawParameters.origin,i),this.requestRender(1)}_updateColors(){this._cutVolumeParameters.diffuse=w.toUnitRGB(this.cutColor),this._cutVolumeParameters.opacity=this.cutColor.a,this._fillVolumeParameters.diffuse=w.toUnitRGB(this.fillColor),this._fillVolumeParameters.opacity=this.fillColor.a,this.requestRender(1)}_createVao(e){const t=this.renderingContext,{vertices:i,normals:r,indicesBottom:s,indicesExtruded:n}=e,u=pt.createBuffer(s.length+n.length),{position:c,normal:h}=u;for(let o=0;o<s.length;o++){const d=3*s[o];c.set(o,0,i[d]),c.set(o,1,i[d+1]),c.set(o,2,i[d+2]),h.set(o,0,r[d]),h.set(o,1,r[d+1]),h.set(o,2,r[d+2])}for(let o=0;o<n.length;o++){const d=o+s.length,m=3*n[o];c.set(d,0,i[m]),c.set(d,1,i[m+1]),c.set(d,2,i[m+2]),h.set(d,0,r[m]),h.set(d,1,r[m+1]),h.set(d,2,r[m+2])}const p=new Gt(t,Ot(pt),u.buffer);return new bt(t,p)}};a([l()],j.prototype,"consumes",void 0),a([l()],j.prototype,"produces",void 0),a([l()],j.prototype,"cutColor",void 0),a([l()],j.prototype,"fillColor",void 0),a([l()],j.prototype,"borderColor",void 0),j=a([O("esri.views.3d.webgl-engine.lib.CutFillColor")],j);const pt=Mt().vec3f("position").vec3f("normal").freeze();class xr{constructor(t,i,r,s){this.vertices=t,this.indicesBottom=i,this.indicesExtruded=r,this.normals=s}}let V=class extends Z{get visible(){return this.analysisViewData.visible&&this.analysisViewData.elevationAlignedGeometry!=null&&this.analysisViewData.targetGeometry!=null}get updating(){return this.loadingMessages}get hasUnsupportedError(){const{error:e}=this.analysisViewData;return!!e&&["unsupported-coordinate-system","unsupported-layer-transparency"].includes(e.name)}constructor(e){super(e),this.unitsMessages=null,this.messages=null,this.loadingMessages=!0,this._elevationContext=ve.fromElevationInfo(new xe({mode:"absolute-height"})),this._extrusionHeight=M.targetElevationRange,this._projectionLines=[]}initialize(){const{view:e}=this,t={view:e,isDecoration:!0},i=M,r={...t,width:i.geometryOutlineWidth};this._elevationAlignedGeometry=new Qe({...r,isDraped:!0,color:w.toUnitRGBA(i.geometryOutlineColor)}),this._targetGeometry=new Qe(r);const s={...t,attached:!0,width:i.projectionLineWidth,renderOccluded:4,polygonOffset:!0},n={...s,stipplePattern:Si(i.projectionLineStippleSize)},u=w.toUnitRGBA(i.cutProjectionLineColor),c=w.toUnitRGBA(i.fillProjectionLineColor);this._cutProjectionLines=new le({...s,color:u}),this._occludedCutProjectionLines=new le({...n,color:u}),this._fillProjectionLines=new le({...s,color:c}),this._occludedFillProjectionLines=new le({...n,color:c});const h={...t,attached:!0};this._cutVolumeLabel=new Ye(h),this._fillVolumeLabel=new Ye(h),this._cutFillRenderNode=new j({view:e,cutColor:i.cutColor,fillColor:i.fillColor,borderColor:i.geometryOutlineColor}),this.addHandles([v(()=>({elevationAlignedGeometry:this.analysisViewData.elevationAlignedGeometry,targetGeometry:this.analysisViewData.targetGeometry}),({elevationAlignedGeometry:p,targetGeometry:o})=>{this._elevationAlignedGeometry.geometry=p,this._targetGeometry.geometry=o},k),v(()=>({interactive:this.analysisViewData.interactive,measureType:this.analysis.measureType,visible:this.visible}),({visible:p,interactive:o,measureType:d})=>{this._elevationAlignedGeometry.visible=p&&!o,this._targetGeometry.visible=p&&d==="cut-fill"},k),v(()=>({elevationAlignedGeometry:this.analysisViewData.elevationAlignedGeometry,targetGeometry:this.analysisViewData.targetGeometry,visible:this.visible}),({elevationAlignedGeometry:p,targetGeometry:o,visible:d})=>this._updateProjectionLines(p,o,d),k),v(()=>({interactive:this.analysisViewData.interactive,accentColor:this.view.effectiveTheme.accentColor,hasResult:!!this.analysisViewData.result}),({interactive:p,accentColor:o,hasResult:d})=>{this._updateColors(p,o,d)},k),v(()=>this.analysisViewData.targetGeometry,()=>this._updateCutFillGeometry(),k),v(()=>this.visible&&!this.hasUnsupportedError,p=>this._updateCutFillVisibility(p),k),v(()=>{const{messages:p,unitsMessages:o,visible:d,analysisViewData:m}=this;return{labelAnchors:m.labelAnchors,effectiveDisplayUnits:m.effectiveDisplayUnits,messages:p,unitsMessages:o,result:m.result,visible:d&&!!m.result}},p=>this._updateLabels(p)),v(()=>this.view.state.camera,p=>this._updateProjectionLineOcclusion(p),k),Jt(()=>this._updateMessageBundle())]),this._updateMessageBundle()}destroy(){this._elevationAlignedGeometry=F(this._elevationAlignedGeometry),this._targetGeometry=F(this._targetGeometry),this._cutProjectionLines=F(this._cutProjectionLines),this._occludedCutProjectionLines=F(this._occludedCutProjectionLines),this._fillProjectionLines=F(this._fillProjectionLines),this._occludedFillProjectionLines=F(this._occludedFillProjectionLines),this._cutVolumeLabel=F(this._cutVolumeLabel),this._fillVolumeLabel=F(this._fillVolumeLabel),this._cutFillRenderNode.destroy()}_updateProjectionLines(e,t,i){if(this._cutProjectionLines.visible=i,this._occludedCutProjectionLines.visible=i,this._fillProjectionLines.visible=i,this._occludedFillProjectionLines.visible=i,!e||!t)return;const{renderCoordsHelper:r}=this.view,s=[],n=e.spatialReference,u=e.rings[0],c=u.length>1&&Ut(u[0],u[u.length-1]),h=u.length-(c?1:0);for(let g=0;g<h;++g){const P=u[g],L=me(y(),P[0],P[1],P[2]);r.toRenderCoords(L,n,L);const S=t.rings[0][g],T=me(y(),S[0],S[1],S[2]);r.toRenderCoords(T,n,T);const U=new Oi(L,T);s.push(U)}e.isClockwise(u)||s.reverse();const p=[],o=[],d=[],m=[],f=[],x=this.view.state.camera;for(let g=0;g<s.length;++g){const P=s[g],L=s[g===0?s.length-1:g-1],S=s[g===s.length-1?0:g+1],T=e.rings[0][g],U=t.rings[0][g],H=T[2]>U[2],D=new Vr(P,L,S,H);p.push(D),D.updateOccluded(x);const Se=D.isOccluded;H?(Se?d:o).push(P):(Se?f:m).push(P)}this._projectionLines=p,this._cutProjectionLines.setGeometryFromSegments(o),this._occludedCutProjectionLines.setGeometryFromSegments(d),this._fillProjectionLines.setGeometryFromSegments(m),this._occludedFillProjectionLines.setGeometryFromSegments(f)}_updateProjectionLineOcclusion(e){const t=[],i=[],r=[],s=[];let n=!1,u=!1;for(const c of this._projectionLines){c.updateOccluded(e)&&(n||=c.isCut,u||=!c.isCut);const h=c.isOccluded;(c.isCut?h?i:t:h?s:r).push(c.segment)}u&&(this._fillProjectionLines.setGeometryFromSegments(r),this._occludedFillProjectionLines.setGeometryFromSegments(s)),n&&(this._cutProjectionLines.setGeometryFromSegments(t),this._occludedCutProjectionLines.setGeometryFromSegments(i))}_updateColors(e,t,i){const{geometryOutlineColor:r,cutColor:s,fillColor:n,cutColorMuted:u,fillColorMuted:c,cutProjectionLineColor:h,fillProjectionLineColor:p}=M;if(this._cutFillRenderNode.cutColor=i?s:u,this._cutFillRenderNode.fillColor=i?n:c,e){const o=w.toUnitRGBA(t);this._targetGeometry.color=o,this._cutProjectionLines.color=o,this._occludedCutProjectionLines.color=o,this._fillProjectionLines.color=o,this._occludedFillProjectionLines.color=o,this._cutFillRenderNode.borderColor=t}else{this._targetGeometry.color=w.toUnitRGBA(r);const o=w.toUnitRGBA(i?h:u);this._cutProjectionLines.color=o,this._occludedCutProjectionLines.color=o;const d=w.toUnitRGBA(i?p:c);this._fillProjectionLines.color=d,this._occludedFillProjectionLines.color=d,this._cutFillRenderNode.borderColor=r}}_updateLabels(e){const{labelDistance:t}=M,{effectiveDisplayUnits:i,labelAnchors:r,messages:s,unitsMessages:n,result:u,visible:c}=e;if(this._cutVolumeLabel.visible=c,this._fillVolumeLabel.visible=c,this._cutVolumeLabel.geometry=r.cut?{type:"point",point:r.cut,callout:{distance:t,offset:0}}:null,this._fillVolumeLabel.geometry=r.fill?{type:"point",point:r.fill,callout:{distance:-t,offset:0}}:null,u==null||s==null||n==null)return this._cutVolumeLabel.text="-",void(this._fillVolumeLabel.text="-");const h=i.volume,p=Ze(s.labels.cut,{volume:dt(n,u.cutVolume,h)}),o=Ze(s.labels.fill,{volume:dt(n,u.fillVolume,h)});this._cutVolumeLabel.text=p,this._fillVolumeLabel.text=o}_updateCutFillVisibility(e){e?this._cutFillRenderNode.enable():this._cutFillRenderNode.disable()}_updateCutFillGeometry(){const{renderCoordsHelper:e}=this.view,{targetGeometry:t}=this.analysisViewData;if(!t?.extent)return;const{center:i}=t.extent,r=gt(i.x,i.y,0),s=y();e.toRenderCoords(r,t.spatialReference,s);const n=this._getExtrudedVolumes(t,this._extrusionHeight,r),u=this._getExtrudedVolumes(t,-this._extrusionHeight,r);this._cutFillRenderNode.updateGeometries(n,u,s)}_getExtrudedVolumes(e,t,i){const{renderCoordsHelper:r,spatialReference:s,elevationProvider:n}=this.view,u=y(),c=r.viewingMode===1;c||r.worldUpAtPosition([0,0,0],u);const h=Ve(e,n,r,this._elevationContext),{polygons:p,mapPositions:o,position:d}=h,m=p[0],f=m.count,x=ft(m.mapPositions,m.holeIndices,3),g=x.length,P=6*f,L=Xe(P+g),S=Xe(g),T=Ce(3*P),U=Ce(3*P);ai(d,o,x,m,T,null,U,null,L,S,t,u,c);const H=$(),D=$();return wt(s,i,H,r.spatialReference),D[12]=-H[12],D[13]=-H[13],D[14]=-H[14],Pt(T,T,D),new xr(T,S,L,U)}async _updateMessageBundle(){this.loadingMessages=!0;try{this.unitsMessages=await Je("esri/core/t9n/Units"),this.messages=await Je("esri/views/3d/analysis/VolumeMeasurement/t9n/VolumeMeasurementAnalysis")}finally{this.loadingMessages=!1}}};function dt(e,t,i){if(!t||!e)return null;const r=mt(t.value,t.unit,i),s=M.labelPrecisions[r];return Ri(e,t,r,s)}a([l({constructOnly:!0})],V.prototype,"view",void 0),a([l({constructOnly:!0})],V.prototype,"analysis",void 0),a([l({constructOnly:!0})],V.prototype,"analysisViewData",void 0),a([l()],V.prototype,"unitsMessages",void 0),a([l()],V.prototype,"messages",void 0),a([l()],V.prototype,"loadingMessages",void 0),a([l({readOnly:!0})],V.prototype,"visible",null),a([l()],V.prototype,"updating",null),a([l()],V.prototype,"hasUnsupportedError",null),V=a([O("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementCutFillVisualization")],V);class Vr{constructor(t,i,r,s){this.segment=t,this.previous=i,this.next=r,this.isCut=s,this._isOccluded=!1,this._n1=y(),this._n2=y();const n=W(X,Y(X,t.endRenderSpace,t.startRenderSpace));W(this._n1,ze(this._n1,n,W(de,Y(de,i.startRenderSpace,t.startRenderSpace)))),W(this._n2,ze(this._n2,n,W(de,Y(de,t.startRenderSpace,r.startRenderSpace)))),this._isConvex=Ti.normalize(Mi(this._n1,this._n2,n))<0}get isOccluded(){return this._isOccluded}updateOccluded(t){Y(X,this.segment.startRenderSpace,t.eye);const i=He(this._n1,X)<0,r=He(this._n2,X)<0,s=this._isOccluded;return this._isOccluded=this._isConvex?i&&r:i||r,this._isOccluded!==s}}const X=y(),de=y();function Pr(e){return $t(e?.geometry)}function $t(e){return e!=null&&e.type==="polygon"}let Q=class extends Bi(Ni){constructor(e){super(e),this.type="elevation",this.allFields.forEach(t=>{t.lockable=!1,t.setActual(null)})}get allFields(){return[this.elevation]}};a([l()],Q.prototype,"type",void 0),a([l()],Q.prototype,"allFields",null),Q=a([O("esri.views.interactive.tooltip.infos.ElevationTooltipInfo")],Q);let A=class extends zi{constructor(e){super(e),this.sketchOptions=new Lt}initialize(){const{view:e}=this;this._shiftManipulator=new ji(e,0),this._shiftManipulator.state|=Ai,this.manipulators.add(this._shiftManipulator),this.addHandles([this._createDragPipeline(),v(()=>this.analysisViewData.targetGeometry,()=>this._updateManipulatorPosition(),yt),v(()=>[this.analysisViewData.interactive,this.analysisViewData.targetGeometry,this.analysis.measureType],()=>this._updateManipulatorVisibility(),B)]),this._initializeTooltip(),this.finishToolCreation()}_initializeTooltip(){const{view:e}=this;this.tooltip=qi(()=>({view:e,options:this.sketchOptions.tooltips})),this._tooltipInfo=new Q({sketchOptions:this.sketchOptions}),this.sketchOptions.tooltips.placement="trailing",this._updateSketchOptions(),this.addHandles([v(()=>this.analysisViewData.effectiveTargetElevation,()=>this._updateTooltip()),v(()=>this._shouldShowTooltip,t=>{t?this._showTooltip():this._hideTooltip()}),this.tooltip.on("commit",()=>{const t=this._tooltipInfo.elevation.actual,i=ye(this.view.spatialReference);if(t==null||i==null)return;const r=ti(t,i);this._updateValue(r,{recordUndo:this.analysis.cutFillOptions.targetElevation})}),v(()=>[this.analysis.displayUnits.elevation,this.analysis.inputUnits.elevation],()=>this._updateSketchOptions(),B)])}destroy(){this._shiftManipulator.destroy(),this.tooltip.destroy()}onInputEvent(e){if(!this.destroyed&&!Ii(e,this.tooltip))return super.onInputEvent(e)}get _shouldShowTooltip(){return this.hasFocusedManipulators||this.tooltip.mode==="input"}_createDragPipeline(){return Hi(this._shiftManipulator,(e,t,i)=>{const r=Ae(e.renderLocation),s=this.analysis.inputUnits.elevation??"meters",n=ye(this.view.spatialReference);let u;t.next($i(this.view,r,this.view.spatialReference)).next(Ui()).next(c=>{if(c.action==="start"){const{targetElevation:h}=this.analysis.cutFillOptions;u=h&&n?fe(h,s,n):void 0}return this._updateValue(u!=null?u+c.translationZ:c.mapEnd.z,c.action==="end"?{recordUndo:u}:void 0),c}),i.next(()=>{this._updateValue(u)})})}_updateManipulatorPosition(){const{targetGeometry:e}=this.analysisViewData,{renderCoordsHelper:t}=this.view;if(!e)return;const i=.5,r=e.rings[0],s=je(r[0]),n=je(r[1]);t.toRenderCoords(s,e.spatialReference,s),t.toRenderCoords(n,e.spatialReference,n);const u=ce.get();Y(u,n,s);const c=ce.get();Yt(c,s,n,i);const h=t.worldBasisAtPosition(c,1,ce.get()),p=t.worldBasisAtPosition(c,0,ce.get()),o=si(h,p,c,Gi.get()),d=t.headingAtPosition(c,u),m=e.isClockwise(e.rings[0])?-Math.PI/2:Math.PI/2;ci(o,o,li(d)+m),o[12]=0,o[13]=0,o[14]=0,this._shiftManipulator.renderLocation=Ae(c),this._shiftManipulator.modelTransform=o}_updateManipulatorVisibility(){const{interactive:e,targetGeometry:t}=this.analysisViewData,{measureType:i}=this.analysis,r=e&&t!=null&&i==="cut-fill";this._shiftManipulator.available=r}_updateValue(e,t){const i=We(e,this.view.spatialReference);if(i==null)return;const r=this.analysis.inputUnits.elevation??"meters",s=fe(i.value,i.unit,r),n=u=>{this.analysis.cutFillOptions.targetElevation=u};if(n(s),t&&"recordUndo"in t){const u=t.recordUndo;this.emit("record-undo",{apply:()=>n(s),undo:()=>n(u)})}}_getUpdatedTooltipInfo(){const{effectiveTargetElevation:e}=this.analysisViewData;return e?(this._tooltipInfo.elevation.actual=We(e,this.view.spatialReference),this._tooltipInfo):this._tooltipInfo}_updateTooltip(){this._shouldShowTooltip&&(this.tooltip.info=this._getUpdatedTooltipInfo())}_showTooltip(){this._updateTooltip()}_hideTooltip(){this.tooltip?.clear()}_updateSketchOptions(){const{analysis:e}=this,{displayUnits:t,inputUnits:i}=e;this.sketchOptions.values.inputUnits=new Ke({verticalLength:i.elevation}),this.sketchOptions.values.displayUnits=new Ke({verticalLength:t.elevation})}};a([l({constructOnly:!0})],A.prototype,"analysis",void 0),a([l({constructOnly:!0})],A.prototype,"view",void 0),a([l({constructOnly:!0})],A.prototype,"analysisViewData",void 0),a([l({constructOnly:!0,type:Lt})],A.prototype,"sketchOptions",void 0),a([l()],A.prototype,"_shouldShowTooltip",null),A=a([O("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementShiftTool")],A);let G=class extends Z{constructor(e){super(e),this._updatingHandles=new vt,this._operationManager=new Wi,this._onUndoRedo=()=>{this._updateGeometryFromSketchGraphic()}}initialize(){const{analysis:e,analysisViewData:t,view:i}=this;this._graphicsLayer=new ki({listMode:"hide",internal:!0,elevationInfo:{mode:"on-the-ground"}});const r=Xi(i,{selfEnabled:!0,excludeInternal:!0});this._sketchViewModel=new Ji({layer:this._graphicsLayer,view:i,updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polygonSymbol:this._polygonSymbol,snappingOptions:r.options}),this.addHandles([this._sketchViewModel.on(["undo","redo"],this._onUndoRedo),v(()=>({map:i.map,internalGraphicsLayer:this._graphicsLayer,state:this.state}),({map:s,internalGraphicsLayer:n,state:u})=>{switch(Fr(s,n),u){case"idle":case"reshaping-disabled":this._operationManager.stop(),this._graphicsLayer.removeAll(),this._ensureUpdatedSketchGraphic();break;case"reshaping":De(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},B),r]),this._shiftTool=new A({analysis:e,view:i,analysisViewData:t}),this.addHandles(this._shiftTool.on("record-undo",s=>{const n=this._sketchViewModel.activeComponent;n?.type==="reshape-3d"&&n.recordUndo(s.apply,s.undo)})),i.tools.add(this._shiftTool),this.addHandles({remove:()=>i.tools.remove(this._shiftTool)})}destroy(){this._operationManager.destroy(),this._sketchViewModel.destroy();const e=this._graphicsLayer;this.view.map.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateGeometryFromSketchGraphic())}get state(){const{geometry:e}=this.analysis,{interactive:t,visible:i}=this.analysisViewData;return i?this._sketchViewModel.createGraphic?this._sketchViewModel.createGraphic===this.sketchGraphic?"sketching":"awaiting-sketch":e?t?"reshaping":"reshaping-disabled":"idle":"idle"}get updating(){return this._sketchViewModel.updating||this._updatingHandles.updating}get _polygonSymbol(){return new Ei({color:[0,0,0,0],outline:{color:[0,0,0,0]}})}place(e){return this._operationManager.start("place",async t=>{const i=this.analysis.clone();this._ensureUpdatedSketchGraphic();const r=this._sketchViewModel.on("create",s=>{switch(s.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=s.graphic;break;case"active":this._updateGeometryFromSketchGraphic();break;case"complete":this._updateGeometryFromSketchGraphic(),t.stop();break;case"cancel":t.stop()}});t.handles.push(r,ke(()=>(r.remove(),this._sketchViewModel.cancel(),this._updateGeometryFromSketchGraphic(),this.analysis.valid?Ht(e)||i.equals(this.analysis)?t.reject():void t.resolve({}):(this._clearGeometry(),t.reject())))),await this._updatingHandles.addPromise(this._sketchViewModel.create("polygon"))},e)}_startReshape(){return this._operationManager.start("reshape",async e=>{const t=()=>{const r=this._ensureUpdatedSketchGraphic();return r?(this._graphicsLayer.removeAll(),this._graphicsLayer.add(r),this._updatingHandles.addPromise(this._sketchViewModel.update(r,{tool:"reshape"}))):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const i=this._sketchViewModel.on("update",r=>{this._updateGeometryFromSketchGraphic(),r.state==="complete"&&(this.state==="reshaping"?De(t()):e.resolve())});e.handles.push(i,ke(()=>{i.remove(),this._sketchViewModel.cancel(),e.resolve()})),await t()})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this.analysis;return $t(e)?(this.sketchGraphic??=new Di({geometry:e,symbol:this._polygonSymbol}),this.sketchGraphic.geometry=e,this.sketchGraphic):(this.sketchGraphic=null,null)}_clearGeometry(){this.sketchGraphic=null,this.analysis.geometry=null}_updateGeometryFromSketchGraphic(){const e=this.sketchGraphic;this.analysis.geometry=Pr(e)?e.geometry:null}get test(){}};function Fr(e,t){t&&(t.removeFromParent(),e?.add(t))}a([l({constructOnly:!0})],G.prototype,"analysisViewData",void 0),a([l({constructOnly:!0})],G.prototype,"view",void 0),a([l({constructOnly:!0})],G.prototype,"analysis",void 0),a([l()],G.prototype,"sketchGraphic",null),a([l({nonNullable:!0})],G.prototype,"state",null),a([l()],G.prototype,"updating",null),a([l()],G.prototype,"_polygonSymbol",null),G=a([O("esri.views.3d.analysis.VolumeMeasurement.VolumeMeasurementTool")],G);let C=class extends Bt{constructor(e){super(e),this.type="volume-measurement-view-3d",this.analysis=null,this.elevationAlignedGeometry=null,this.targetGeometry=null}initialize(){const{analysis:e,view:t}=this;this._analysisController=new _({view:t,analysis:e,analysisViewData:this}),this._analysisTool=new G({analysis:e,view:t,analysisViewData:this}),this._analysisVisualization=new V({view:t,analysis:e,analysisViewData:this})}destroy(){this._analysisController=F(this._analysisController),this._analysisVisualization=F(this._analysisVisualization),this._analysisTool.destroy()}get error(){return this._analysisController?.error??null}get result(){return this._analysisController?.result}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get visible(){return super.visible}set visible(e){super.visible=e}get effectiveTargetElevation(){const{cutFillOptions:e,inputUnits:t}=this.analysis,{targetElevation:i}=e,r=t?.elevation??"meters",s=ye(this.view.spatialReference);if(i!=null&&s!=null)return fe(i,r,s);const n=this.elevationAlignedGeometry?.extent;return n?.zmin==null||n?.zmax==null?null:(n.zmax+n.zmin)/2}get effectiveDisplayUnits(){const{displayUnits:e}=this.analysis,t=Nt(this.view);return{elevation:e.elevation??t,volume:e.volume??t}}get labelAnchors(){const{elevationAlignedGeometry:e,view:t}=this,{renderCoordsHelper:i}=t;if(!e)return{cut:null,fill:null};let r=e.rings[0][0],s=e.rings[0][0];e.rings[0].forEach(o=>{o[2]>r[2]&&(r=o),o[2]<s[2]&&(s=o)});const{spatialReference:n}=e,u=new Ee({x:r[0],y:r[1],z:r[2],spatialReference:n}),c=new Ee({x:s[0],y:s[1],z:s[2],spatialReference:n}),h=y(),p=y();return i.toRenderCoords(u,h),i.toRenderCoords(c,p),{cut:h,fill:p}}get updating(){return this._analysisController!=null&&this._analysisController.updating||this._analysisTool.updating||this._analysisVisualization.updating}place(e){return this._analysisTool.place(e)}get test(){}};a([l()],C.prototype,"error",null),a([l({readOnly:!0})],C.prototype,"type",void 0),a([l({constructOnly:!0,nonNullable:!0})],C.prototype,"analysis",void 0),a([l({readOnly:!0})],C.prototype,"result",null),a([l()],C.prototype,"elevationAlignedGeometry",void 0),a([l({type:Number})],C.prototype,"effectiveTargetElevation",null),a([l()],C.prototype,"targetGeometry",void 0),a([l()],C.prototype,"effectiveDisplayUnits",null),a([l()],C.prototype,"labelAnchors",null),a([l()],C.prototype,"updating",null),C=a([O("esri.views.3d.analysis.VolumeMeasurementAnalysisView3D")],C);const va=C,Tr=Object.freeze(Object.defineProperty({__proto__:null,CutFillDepthParameters:Re,build:Dt},Symbol.toStringTag,{value:"Module"})),Rr=Object.freeze(Object.defineProperty({__proto__:null,CutFillReductionParameters:Ge,build:kt},Symbol.toStringTag,{value:"Module"})),Gr=Object.freeze(Object.defineProperty({__proto__:null,CutFillTargetDepthParameters:Me,build:Et},Symbol.toStringTag,{value:"Module"})),Mr=Object.freeze(Object.defineProperty({__proto__:null,CutFillCompositionPassParameters:Oe,build:jt},Symbol.toStringTag,{value:"Module"})),Or=Object.freeze(Object.defineProperty({__proto__:null,CutFillMaskDrawParameters:Le,build:At},Symbol.toStringTag,{value:"Module"}));export{va as default};
