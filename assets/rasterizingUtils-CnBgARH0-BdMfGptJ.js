import{l as N}from"./floatRGBA-D-Q4FzNN-BzjdY1tU.js";import{v as b}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";const k={CIMVectorMarker:{size:10},CIMPictureMarker:{size:10},CIMTextSymbol:{height:10},CIMSolidStroke:{width:4},CIMGradientStroke:{gradientSize:75,gradientType:"Discrete"},CIMHatchFill:{separation:4},CIMGradientFill:{gradientSize:75,gradientType:"Discrete",interval:5},CIMGeometricEffectRadial:{angle:0,length:5}},v=15.5,D=1024,I=()=>b.getLogger("esri.symbols.cim.rasterizingUtils");function E(r,l){r==null&&(r=[]);const t=l==="Butt",n=l==="Square",e=!t&&!n;r.length%2==1&&(r=[...r,...r]);const o=v,a=2*o;let s=0;for(const m of r)s+=m;const i=Math.round(s*o),c=new Float32Array(i*a),h=.5*o;let f=0,C=0,u=.5,d=!0;for(const m of r){for(f=C,C+=m*o;u<=C;){let M=.5;for(;M<a;){const S=(M-.5)*i+u-.5,p=e?(M-o)*(M-o):Math.abs(M-o);c[S]=d?t?Math.max(Math.max(f+h-u,p),Math.max(u-C+h,p)):p:e?Math.min((u-f)*(u-f)+p,(u-C)*(u-C)+p):n?Math.min(Math.max(u-f,p),Math.max(C-u,p)):Math.min(Math.max(u-f+h,p),Math.max(C+h-u,p)),M++}u++}d=!d}const y=c.length,w=new Uint8Array(4*y);for(let m=0;m<y;++m){const M=(e?Math.sqrt(c[m]):c[m])/o;N(M,w,4*m)}return[w,i,a]}let x;function L(r,l){const{colorRamp:t,gradientType:n}=l,e=R(t),o=t.type==="CIMFixedColorRamp";if(n==="Continuous"&&!o)return g(r,e);const a=l.interval??k.CIMGradientFill.interval;if(o)return g(r,F(e,a));const s=[];x??=document.createElement("canvas"),$(x,e,a,1,0);const i=x.getContext("2d").getImageData(0,0,a,1).data;for(let c=0,h=0;c<a;c++,h=4*c){const f=[i[h+0],i[h+1],i[h+2],i[h+3]];s.push({offset:c/a,color:f}),s.push({offset:(c+1)/a,color:f})}return g(r,s)}function R(r){const l=[];switch(r.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{r.type==="CIMPolarContinuousColorRamp"&&I().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const t=r;l.push({offset:0,color:[t.fromColor[0],t.fromColor[1],t.fromColor[2],t.fromColor[3]/255]}),l.push({offset:1,color:[t.toColor[0],t.toColor[1],t.toColor[2],t.toColor[3]/255]});break}case"CIMFixedColorRamp":{const t=r,n=1/(t.colors.length-1);let e=0;for(const o of t.colors)l.push({offset:e,color:[o[0],o[1],o[2],o[3]/255]}),e+=n;break}case"CIMMultipartColorRamp":{const t=r,n=t.weights.reduce((o,a)=>o+a,0);let e=0;for(let o=0;o<t.colorRamps.length;o++){const a=t.colorRamps[o],s=t.weights[o],i=R(a);for(const c of i)l.push({offset:(e+c.offset*s)/n,color:c.color});e+=s}break}default:I().error(`Color ramp "${r.type}" currently unsupported.`)}return l}function F(r,l){const t=[],n=(r.length-1)/(l-1);for(let e=0;e<l;e++){const o=r[Math.round(e*n)].color;t.push({offset:e/l,color:o}),t.push({offset:(e+1)/l,color:o})}return t}function g(r,l,t=0){for(const{offset:n,color:e}of l)r.addColorStop(Math.min(Math.max(n,t),1-t),`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`)}function $(r,l,t,n,e){const o=t+2*e;r.width=o,r.height=n;const a=(e+1)/o,s=r.getContext("2d",{willReadFrequently:!0});if(l.length>0){const i=s.createLinearGradient(0,0,o,n);g(i,l,a),s.fillStyle=i}else s.fillStyle="rgba(128, 128, 128, 1)";s.fillRect(0,0,o,n)}function z(r){const l=r[0]?.[0]?.[0]??0,t=r[0]?.[0]?.[1]??0,n={ymin:t,xmin:l,ymax:t,xmax:l,width:0,height:0};for(let e=0;e<r.length;e++){const o=r[e];for(let a=0;a<o.length;a++){const s=o[a][0],i=o[a][1];s<n.xmin&&(n.xmin=s),s>n.xmax&&(n.xmax=s),i<n.ymin&&(n.ymin=i),i>n.ymax&&(n.ymax=i)}}return n.width=Math.abs(n.xmax-n.xmin),n.height=Math.abs(n.ymax-n.ymin),n}function T(r,l){const t=z(r),n=t.width===0?1:t.width,e=t.height===0?1:t.height,o=[];for(let a=0;a<r.length;a++){const s=r[a],i=[];for(let c=0;c<s.length;c++){let h=Math.round(s[c][0]-t.xmin),f=Math.round(s[c][1]-t.ymin);if(h=l.xmin+h*l.width/n,f=l.ymin+f*l.height/e,isNaN(h)||isNaN(f))throw new Error("Scaled shape has NaN values");i.push([h,f])}o.push(i)}return o}function A(r,l,t){const n=[];for(let e=0;e<r.length;e++){const o=r[e],a=[];for(let s=0;s<o.length;s++){const i=o[s][0]+l,c=o[s][1]+t;if(isNaN(i)||isNaN(c))throw new Error("Scaled shape has NaN values");a.push([i,c])}n.push(a)}return n}export{E as $,A,T as D,D as P,k,L as q};
