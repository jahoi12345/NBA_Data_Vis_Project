import{F as S}from"./Color-CERqXxxY-BuYn26eI.js";import{a as Pe,n as Ie}from"./colorUtils-CeIi7j7j-nwrKvQYb.js";import{j as Ne,o as Fe}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{M as ie,U as xe,E as I,Y as ne,L as ae,x as ce,s as Ge,a as Oe}from"./mat4-C96X-Nn0-Do6fKsNS.js";import{n as K}from"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import{p as le}from"./quat-B7J5v7rV-i-DOMCm_.js";import{x as y,k as p,L as V,O as h,I as C,$ as v,l as $,A as H,F as M,z as ze}from"./vec32-CewSdTn3-DHOFKD0R.js";import{Y as Le,t as q,M as Q,X as Be}from"./collectionUtils-jDyktm0P-ArdXNs6F.js";import{z as c,H as Ee,C as F,D as de}from"./vector-B8ZDYGQ6-B1uNywRb.js";import{x as Ve,d as E,S as Ue,$ as Z,j as qe,u as Je,g as ue,C as Ye,h as Xe,f as Ke,U as ge,w as Qe,M as Ze,e as pe}from"./sliceToolConfig-BnawSSVt-BPWko_GQ.js";import{a7 as et,bc as tt,v as rt,Y as O,H as j,aO as he,G as it}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{M as fe}from"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import{b as Re,s as me}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{B as st,y as be}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{h as ee}from"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import{F as ot}from"./projectionUtils-BGH_5_I3-BySNUA-B.js";import{z as We,v as Se,d as nt,N as te,e as at,J as ct,M as we,r as ve,L as lt,H as dt,$ as ut}from"./RealisticTree.glsl-WN9nrQUl-CRRcYwOn.js";import{H as je,X as ke}from"./plane-BNdSPG2o-Cq7jmU6w.js";import{x as gt}from"./sphere-DLQ6p7mp-DmnRpHXV.js";import{e as N}from"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import{N as pt,o as ht,G as ft,B as mt,a as bt,e as k}from"./ShadedColorMaterial.glsl-Cdsx30m0-VRbWQZDd.js";import{_ as _e}from"./vec42-B8VM4vXb-BnA9MysM.js";import{l as wt,n as Me,y as vt}from"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import{cM as _t,cu as Mt,w as Ct,V as yt,N as $t,B as Pt,F as xt,al as Ot,b4 as Ut,ay as Rt,aO as Wt,aT as Ce}from"./Texture-CFNZjV2R-lGBztxVp.js";import{v as He}from"./DefaultLayouts-B8c6Qefj-D-9ZzY5G.js";import{m as St}from"./TriangleMaterial-BIKWylXl-CcDbhy8X.js";import{H as jt}from"./index-CTl7hdrJ.js";import{J as kt,bz as Ht}from"./ShadowCastClear.glsl-CeOT_rAo-iOFMl8eB.js";import{V as L}from"./ColorMaterial.glsl-rhi0cQVb-BUmbct5I.js";let _=class extends Le(et){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&this.width===e.width&&this.height===e.height&&tt(this.position,e.position)}};O([j({type:["plane"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],_.prototype,"type",void 0),O([j({type:Re,json:{write:{isRequired:!0}}})],_.prototype,"position",void 0),O([j({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),me(e=>fe.normalize(he(e),0,!0))],_.prototype,"heading",void 0),O([j({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),me(e=>fe.normalize(he(e),0,!0))],_.prototype,"tilt",void 0),O([j({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],_.prototype,"width",void 0),O([j({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],_.prototype,"height",void 0),_=O([it("esri.analysis.SlicePlane")],_);const Tt=_,At=N(0,0,0,.04);function Dt({accentColor:e}){return Pe(e,.5)}function It({accentColor:e}){return Pe(e,.7)}function Te(e){const t=new Rt,{vertex:n,fragment:s,attributes:i,varyings:o}=t;return Wt(n,e),i.add("position","vec3"),i.add("uv0","vec2"),o.add("vUV","vec2"),n.main.add(Me`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),s.uniforms.add(new Ce("backgroundColor",r=>r.backgroundColor),new Ce("gridColor",r=>r.gridColor),new vt("gridWidth",r=>r.gridWidth)).main.add(Me`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const Nt=Object.freeze(Object.defineProperty({__proto__:null,build:Te},Symbol.toStringTag,{value:"Module"}));class Ft extends yt{constructor(){super(...arguments),this.backgroundColor=N(1,0,0,.5),this.gridColor=N(0,1,0,.5),this.gridWidth=4}}class Gt extends $t{constructor(t,n){super(t,n,new Pt(Nt,()=>jt(()=>Promise.resolve().then(()=>Zt),void 0)),He.locations)}initializePipeline(){return xt({blending:Ut,depthTest:{func:513},colorWrite:Ot})}}class zt extends St{constructor(t){super(t,Bt),this.produces=new Map([[8,n=>wt(n)]]),this._configuration=new _t}get visible(){return!0}createGLMaterial(t){return new Lt(t)}createBufferWriter(){return new Mt(He)}getConfiguration(){return this._configuration}}class Lt extends Ct{constructor(t){super(t)}beginSlot(t){return this.getTechnique(Gt,t)}}class Bt extends Ft{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}class Et extends bt{constructor(t){super(t),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=N(1,0,0,1),this._backgroundColor=N(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){_e(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){_e(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new zt(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(t){t(this._material)}createGeometries(t){if(this._material!=null){const n=nt(this._material);t.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material?.setParameters(this._materialParameters)}}function Wr(e,t,n,s,i,o,r,a){return Vt(t,r.worldUpAtPosition(e,c.get()),i,o,a.basis1,a.basis2),p(a.basis1,a.basis1,n),p(a.basis2,a.basis2,s),C(a.origin,e),je(a.basis2,a.basis1,a.origin,a.plane),a}function Vt(e,t,n,s,i,o){const r=H(e,t),a=c.get(),l=c.get();switch(s===0?Math.abs(r)>Ze?1:2:s){case 2:{const u=Math.abs(r)<=pe?e:n.viewUp;M(a,u,t),C(l,t);break}case 1:M(a,n.viewUp,t),M(l,t,a);break;case 3:{const u=Math.abs(r)<=pe?t:n.viewUp;M(a,u,e),M(l,e,a);break}}const d=M(c.get(),a,l);H(d,n.viewForward)>0&&p(l,l,-1),$(i,a),$(o,l)}function qt(e,t,n){const s=t.worldUpAtPosition(e.origin,c.get()),i=e.basis1,o=oe(e,s),r=Math.round(o/T)*T;return te(e,r-o,i,n)}function Sr(e,t,n,s,i,o){const r=C(c.get(),i.origin);h(r,r,p(c.get(),i.basis1,e.direction[0]<0?1:-1)),h(r,r,p(c.get(),i.basis2,e.direction[1]<0?1:-1));const a=y(i.basis1),l=y(i.basis2),d=v(c.get(),n,r),u=v(c.get(),t,r);let g=0,m=0;if(De(e)){const Y=re(i),A=re(o);g=a-.5*e.direction[0]*H(i.basis1,u)/a,m=l-.5*e.direction[1]*H(i.basis2,u)/l;const G=A/Y;g*=G,m*=G}const f=g+.5*e.direction[0]*H(i.basis1,d)/a,w=m+.5*e.direction[1]*H(i.basis2,d)/l,R=p(c.get(),i.basis1,f/a),P=p(c.get(),i.basis2,w/l);(f<=0||ye(o.origin,R,s)<=ge)&&C(R,o.basis1),(w<=0||ye(o.origin,P,s)<=ge)&&C(P,o.basis2);const b=C(c.get(),r);return h(b,b,p(c.get(),R,e.direction[0]<0?-1:1)),h(b,b,p(c.get(),P,e.direction[1]<0?-1:1)),dt(b,R,P,o)}function jr(e,t){return Qe*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function kr(e,t,n,s){const i=M(c.get(),t,n);return M(i,i,t),ke(e,i,s)}function Hr(e,t){return ht(e.basis1,e.basis2,e.origin,t)}function Tr(e,t,n,s){const i=t.worldUpAtPosition(e.origin,c.get()),o=c.get();switch(n){case 1:C(o,i);break;case 2:C(o,e.basis1)}return ke(e.origin,o,s)}function Ar(e,t,n,s){const i=se(n,2),o=F.get();Ge(o,t,i.edge*Math.PI/2);const r=$(c.get(),i.basis);let a=p(c.get(),r,i.direction*s.computeScreenPixelSizeAt(i.position)*E);h(a,a,i.position);const l=s.projectToRenderScreen(a,ee(c.get())),d=Jt(s,l);Ht(s,l,B),$(B.direction,B.direction);const u=c.get();!d&&ut(n,B,u)&&(a=u),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=Be(a),d?e.state|=J:e.state&=~J}function Jt(e,t){if(t==null)return!1;const[n,s,i,o]=e.viewport,r=Math.min(i,o)/16;let a=!0;return t[0]<n+r?(t[0]=n+r,a=!1):t[0]>n+i-r&&(t[0]=n+i-r,a=!1),t[1]<s+r?(t[1]=s+r,a=!1):t[1]>s+o-r&&(t[1]=s+o-r,a=!1),a}function Dr(e,t,n,s){const i=y(s.basis1),o=y(s.basis2),r=Ae(s),a=re(s),l=V(c.get(),0,0,0);h(l,p(c.get(),s.basis1,t.direction[0]),p(c.get(),s.basis2,t.direction[1])),h(l,s.origin,l);let d=0,u=1;if(De(t))t.direction[0]===1&&t.direction[1]===-1?d=T:t.direction[0]===1&&t.direction[1]===1?d=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(d=3*Math.PI/2),u=a;else{const m=t.direction[0]!==0?1:2;d=m===1?T:0,u=(m===1?o:i)-r}const g=ie(F.get(),d);xe(g,g,V(c.get(),u,u,u)),I(g,n,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=l}function Ir(e,t,n,s){const i=s.worldUpAtPosition(n.origin,c.get()),o=se(n,0),r=ie(F.get(),o.edge*Math.PI/2);Oe(r,r,-oe(n,i)),I(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=o.position}function Nr(e,t,n){const s=se(n,1),i=ie(F.get(),s.edge*Math.PI/2);Oe(i,i,T),I(i,t,i),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=s.position}function se(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:h(c.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:h(c.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:v(c.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:v(c.get(),e.origin,e.basis2),edge:t}}}function ye(e,t,n){const s=n.projectToRenderScreen(h(c.get(),e,t),ee(c.get())),i=n.projectToRenderScreen(v(c.get(),e,t),ee(c.get()));return s&&i?ze(v(s,s,i)):0}function Ae(e){const t=y(e.basis1),n=y(e.basis2);return Je*Math.min(t,n)}function re(e){return Ae(e)}function De(e){return e.direction[0]!==0&&e.direction[1]!==0}function Fr(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new pt({view:e,attached:!1,color:It(e.effectiveTheme),width:Ve,renderOccluded:4,geometry:[t],isDecoration:!0})}function Gr(e){return new Et({view:e,attached:!1,backgroundColor:At,gridColor:Dt(e.effectiveTheme),gridWidth:4,renderOccluded:4,isDecoration:!0})}function zr(e,t,n,s=new Tt){if(e==null)return null;const{renderCoordsHelper:i}=t,o=i.fromRenderCoords(e.origin,new Re({spatialReference:t.spatialReference}));if(o==null)return null;const r=ot(o,n);if(r==null)return null;s.position=r;const a=2*y(e.basis1),l=2*y(e.basis2),d=Se.renderUnitScaleFactor(t.spatialReference,n);s.width=a*d,s.height=l*d;const u=i.worldUpAtPosition(e.origin,c.get());return s.tilt=st(oe(e,u)),s.heading=i.headingAtPosition(e.origin,e.basis1)-90,s}function oe(e,t){return Ee(t,e.basis2,e.basis1)+T}function Yt(e,t,n,s,i,o,r=We()){return o.toRenderCoords(e,r.origin)?(o.worldBasisAtPosition(r.origin,0,r.basis1),o.worldBasisAtPosition(r.origin,1,r.basis2),je(r.basis2,r.basis1,r.origin,r.plane),te(r,-be(t),at(r),r),te(r,be(n),r.basis1,r),p(r.basis1,r.basis1,s/2),p(r.basis2,r.basis2,i/2),ct(r),r):(rt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Lr(e,t){if(e?.position==null)return null;const n=ft(e.position,t.spatialReference,t.elevationProvider);if(n==null)return null;const s=Se.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),i=e.width*s,o=e.height*s;return{position:n,heading:e.heading,tilt:e.tilt,renderWidth:i,renderHeight:o}}function Br(e,t,n,s=We()){if(e==null)return null;const i=Yt(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,s);return n.tiltEnabled||i==null||qt(i,t.renderCoordsHelper,i),i}const U=16,J=32,B=gt(),T=Math.PI/2,Er=16,Vr=32;function qr(e){return(e.type==="building-scene-3d"?e:null)!=null}let Jr=class extends mt{constructor(e,t){const n=new kt({width:1,renderOccluded:4,isDecoration:!0},e.state.isGlobal),s=new L({cullFace:2,renderOccluded:16,isDecoration:!0}),i=new L({cullFace:2,renderOccluded:16,isDecoration:!0}),o=new L({cullFace:2,renderOccluded:16,isDecoration:!0}),r=new L({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:e,...Xt({offsetMode:t,tubeMaterial:s,tipMaterial:i,capMaterial:o,outlineMaterial:r,calloutMaterial:n})}),this._themeHandle=Ne(()=>e.effectiveTheme.accentColor,a=>{const l=Ie(a),d=S.toUnitRGBA(a),u=S.toUnitRGBA(l),g=S.toUnitRGBA(S.blendColors(l,a,.4)),m=S.toUnitRGBA(S.blendColors(l,a,.14));n.setParameters({color:d}),s.setParameters({color:m}),i.setParameters({color:u}),o.setParameters({color:g}),r.setParameters({color:d})},Fe)}destroy(){this._themeHandle.remove(),super.destroy()}};function Xt({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:s,outlineMaterial:i,calloutMaterial:o}){const r=e===0?E:0,a=[Q(r,0,-ue/2),Q(r,0,ue/2)],l=Qt(a),d=$e({vertices:a,padding:0,materials:{tube:t,tip:n,cap:s}}),u=$e({vertices:a,padding:qe,materials:{tube:i,tip:i,cap:i}}),g=we(o,[[r,0,0],[r-E,0,0]]),m=we(o,[[r,0,0],[r-E,0,0]]);return{renderObjects:[...d.normal.map(f=>new k(f,1|U)),...u.normal.map(f=>new k(f,1|U)),new k(g,1|U|J),...d.focused.map(f=>new k(f,2|U)),...u.focused.map(f=>new k(f,2|U)),new k(m,2|U|J)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:Ue,state:U}}function $e({vertices:e,padding:t,materials:n}){const s=i=>{const o=e.slice(),r=v(c.get(),o[0],o[1]);$(r,r);const a=v(c.get(),o[o.length-1],o[o.length-2]);if($(a,a),t>0){const D=p(q(),a,-t);o[o.length-1]=h(D,D,o[o.length-1]);const W=p(q(),r,-t);o[0]=h(W,W,o[0])}const l=i?Ke:1,d=Z*l,u=Ue*l,g=ne(F.get());if(t>0){const D=d/4,W=V(c.get(),0,D,0),z=1+t/D;ae(g,g,W),xe(g,g,V(c.get(),z,z,z)),ae(g,g,p(W,W,-1/z))}const m=ne(K()),f=Q(0,1,0),w=ce(K(),le(de.get(),f,a));w[12]=o[o.length-1][0],w[13]=o[o.length-1][1],w[14]=o[o.length-1][2],I(w,w,g);const R=n.tube,P=Kt(Ye*(i?Xe:1)+t,o,R);P.transformation=m;const b=[P],Y=n.tip,A=ve(Y,d,u,24,!1,!1,!0);A.transformation=w,b.push(A);const G=n.cap,X=ve(G,d,u,24,!1,!0,!1);X.transformation=w,b.push(X);const x=ce(K(),le(de.get(),f,r));return x[12]=o[0][0],x[13]=o[0][1],x[14]=o[0][2],I(x,x,g),b.push(A.instantiate({transformation:x})),b.push(X.instantiate({transformation:x})),b};return{normal:s(!1),focused:s(!0)}}function Kt(e,t,n){const s=[];for(let i=0;i<12;i++){const o=i/12*2*Math.PI;s.push([Math.cos(o)*e,Math.sin(o)*e])}return lt(n,s,t,[],[],!1)}function Qt(e,t){const n=v(q(),e[e.length-1],e[e.length-2]);$(n,n),p(n,n,Z),h(n,n,e[e.length-1]);{const s=v(q(),e[0],e[1]);return $(s,s),p(s,s,Z),h(s,s,e[0]),[s,...e,n]}}const Zt=Object.freeze(Object.defineProperty({__proto__:null,build:Te},Symbol.toStringTag,{value:"Module"}));export{kr as A,Vr as B,Dt as D,Br as E,Fr as F,Er as G,Gr as H,At as I,Jr as J,It as L,zr as N,Sr as O,Hr as T,U,qr as V,Tt as W,Tr as a,Ar as b,Ir as c,Dr as d,De as e,J as f,jr as k,Lr as q,re as r,Wr as x,Nr as z};
