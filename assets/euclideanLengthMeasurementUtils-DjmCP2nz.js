const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-BInGx8el.js","assets/jsonMap-Bs3hmeCU.js","assets/collectionUtils-yEu3-UXw.js","assets/index-CAyy5ces.js","assets/index-DmB13pS_.css","assets/Point-B6yFWNoR.js","assets/reader-DcGs6kKN.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-D4kxmHSf.js","assets/SimpleObservable-CvFyr0NA.js","assets/Cyclical-BLSxUpe7.js","assets/mathUtils-PIGhLnI9.js","assets/ShadowCastClear.glsl-9G1ObMeX.js","assets/Texture-BcM9ZALi.js","assets/mat4f64-q_b6UJoq.js","assets/vec32-BF0cLBAR.js","assets/Polygon-BUi4eoGW.js","assets/aaBoundingRect-F1Nk1aID.js","assets/Indices-D0_UQPPr.js","assets/BufferView-5vCN6AU9.js","assets/vec42-Cr02Pi7P.js","assets/vec2f64-rIxtbMRN.js","assets/vec4f64-DPb6J-GU.js","assets/sphere-BiyfUvnN.js","assets/mat4-DMghHRAg.js","assets/vector-B05yfH0j.js","assets/quatf64-CCm9z-pX.js","assets/frustum-BV26jp-1.js","assets/plane-B7VfuINA.js","assets/Emissions.glsl-B8XKMjLy.js","assets/Color-CERqXxxY.js","assets/enums-B4pqBiXb.js","assets/aaBoundingBox-CVMQtR0c.js","assets/DoubleArray-DExKNiTh.js","assets/orientedBoundingBox-ezehkKFt.js","assets/quat-Ao2mrU5h.js","assets/spatialReferenceEllipsoidUtils-CJDHI1w1.js","assets/computeTranslationToOriginAndRotation-BK14f5O2.js","assets/projectionUtils-DIbtnzb-.js","assets/Polyline-CiznIgZG.js","assets/InterleavedLayout-NeYQVO9u.js","assets/types-BKo2foNY.js","assets/VertexElementDescriptor-BlxU8vCE.js","assets/screenUtils-BitdhK1O.js","assets/lengthUtils-BsZbNiqt.js","assets/date-IqUzANpt.js","assets/projectPointToVector-DJN8xj-B.js","assets/projectVectorToVector-P-2wsy-w.js","assets/HUDIntersectorResult-B_jyrAGm.js","assets/normalizeUtils-9qNRso4M.js","assets/normalizeUtilsCommon-C6mtpeei.js","assets/jsonUtils-BGiBUdmT.js","assets/utils-CIVJ4xuJ.js","assets/utils-CMK6z7yl.js","assets/videoUtils-Dwx3AEgj.js","assets/typeUtils-BzzgRKyX.js","assets/modeUtils-BQO-Lkkv.js","assets/intl-BY86zs1L.js","assets/uuid-Oe6SV2kF.js","assets/sanitizerUtils-BT_8V5US.js","assets/modeUtils-OCMtRbrJ.css","assets/workers-CpwSXy88.js","assets/Queue-CYlrXMwB.js","assets/PooledRBush-Dco5QkUp.js","assets/quickselect-QQC62dOK.js","assets/GraphicsCollection-DOghpxSR.js","assets/Graphic-B5lJuCvi.js","assets/getPopupProvider-mvkAgiBn.js","assets/Layer-B6AWeI6O.js","assets/createFeatureId-CVwTD0fV.js","assets/typeUtils-cI568bV6.js","assets/lineMarkers-CDwLe3J6.js","assets/PolygonSymbol3D-DuQ13Get.js","assets/ExtrudeSymbol3DLayer-DSc1ou2x.js","assets/opacityUtils-DuFH0EC9.js","assets/Font-DF-HycCW.js","assets/SimpleFillSymbol-CDawtd9z.js","assets/SimpleMarkerSymbol-BGAFRS9_.js","assets/PictureMarkerSymbol-_eQf1cyL.js","assets/TextSymbol-BjfCHbpC.js","assets/HeightModelInfo-DHIKf3I1.js","assets/RealisticTree.glsl-XUrhiZwO.js","assets/meshVertexSpaceUtils-DUZqeOYR.js","assets/MeshLocalVertexSpace-C1Y-OkHk.js","assets/vec3f32-WCVSSNPR.js","assets/memoryEstimations-Bd726a_p.js","assets/Intersector-CoyLvWqI.js","assets/scaleUtils-CA2vbbgo.js","assets/layerUtils-CIRkC1pU.js","assets/TilemapCache-PuRJnLNa.js","assets/LRUCache-fy84PBMi.js","assets/TileKey-BVNpatnV.js","assets/tagSymbols-BPcGfZon.js","assets/UpdatingHandles-D2RI_3Hb.js","assets/asyncUtils-w6KfWU41.js","assets/signal-BX9ezF8a.js","assets/Map-vzu4-Gpj.js","assets/Basemap-CnwcXr2z.js","assets/loadAll-B9GTyWP9.js","assets/PortalItem-eLNwGntE.js","assets/writeUtils-BArD5fe9.js","assets/CollectionFlattener-DqqIW8Ln.js","assets/persistable-BhM8_Nvw.js","assets/MD5-MtSiOt06.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-o9xhC_1c.js","assets/PolygonCollection-CeRBzyKs.js","assets/mat4f32-Djp3mnm5.js","assets/TablesMixin-YmY2jgQz.js","assets/timeZoneUtils-BSc7-7qA.js","assets/ReactiveMap-B0by2bYu.js","assets/Query-Dal_c4tA.js","assets/Field-Cm_ZejYW.js","assets/fieldType-DVUzXtk_.js","assets/ElevationQuery-DStHBHni.js","assets/TileInfo-Ed-RyvGY.js","assets/Scheduler-CNrsbccs.js","assets/constants-D67WmGms.js","assets/floatRGBA-CCeie_ny.js","assets/labelUtils-BtizwBfq.js","assets/ArcadeExpression-tLhjkIsm.js","assets/TimeOnly-CyjHJh3J.js","assets/enum-BzLwmiID.js","assets/UnknownTimeZone-B697BDFv.js","assets/FieldsIndex-DldSuWRM.js","assets/TileKey-C44YQC4_.js","assets/layerViewUtils-BTa15X3o.js","assets/unitConversionUtils-BhI4jDV1.js","assets/vec2f32-CaVKkSa6.js","assets/dehydratedFeatures-CTv_fIM5.js","assets/quantizationUtils-BHf4RTyd.js","assets/featureConversionUtils-BIy1MIBK.js","assets/OptimizedFeature-CwRGZPwv.js","assets/OptimizedFeatureSet-BR8EEvDc.js","assets/Octree-CCWW6e3I.js","assets/elevationInfoUtils-DW7fNUvj.js","assets/intersectorUtilsConversions-DntjJfod.js","assets/DefaultLoadingContext-CD84Ifzv.js","assets/wosrLoader-BBb8Esv0.js","assets/Version-BtYZEj58.js","assets/axisAngleDegrees-BxP7rfWR.js","assets/edgePreprocessing-KwHJ9wld.js","assets/config-Dg972SSE.js","assets/GeometryUtils-Baowv_lX.js","assets/definitions-Dvg4hMIw.js","assets/WorkerHandle-C7Ujx0oh.js","assets/colorUtils-CQgSrs28.js","assets/vec3-B_phcnZY.js","assets/vec33-CWJeyzxV.js","assets/capabilities-Bi6C4OG6.js","assets/imageUtils-Dd3IjdtB.js","assets/angularMeasurementUtils-DwnUpjOS.js","assets/geometry2dUtils-BvGwGPs_.js","assets/utils-DTE-xBiC.js","assets/geodeticLengthOperator-RdkkEHwB.js","assets/geodeticCurveType-CirnHLSB.js","assets/GridSnappingEngine-C0n_KEKG.js","assets/FeatureSnappingEngine-B232kM_B.js","assets/FeatureFilter-RMRaD2rw.js","assets/floorFilterUtils-DKzVzLpH.js"])))=>i.map(i=>d[i]);
import{_ as ae}from"./index-CAyy5ces.js";import{l as Je,_ as p,m as d,a as Rt,v as Xe,i as Xn,as as Kn,bh as Yn,s as Tt,C as Qn,a1 as ts,a8 as es,d as oe,ad as ns}from"./jsonMap-Bs3hmeCU.js";import{d as ss}from"./asyncUtils-w6KfWU41.js";import{l as me,w as Ke,c as is,U as rs}from"./reactiveUtils-SO2Ko3sy.js";import{h as N,j as as,k as os,W as Oe,N as us}from"./projectionUtils-DIbtnzb-.js";import{E as cs,U as yt,b as Ye,I as ls}from"./elevationInfoUtils-DW7fNUvj.js";import{O as xt,r as Zt,n as y,t as ot,N as hs}from"./collectionUtils-yEu3-UXw.js";import{i as Qe,t as Et,n as ue}from"./projectVectorToVector-P-2wsy-w.js";import{u as Ft}from"./Color-CERqXxxY.js";import{l as ps}from"./lengthUtils-BsZbNiqt.js";import{g as ds}from"./Layer-B6AWeI6O.js";import{v as ve,R as C,P as j,q as L,o as lt,_ as Wt,Z as $e,c as Xt,s as Se,p as Mt,H as S,J as fs,j as gs,A as ys,u as ms,I as vs}from"./vec32-BF0cLBAR.js";import{b as $s}from"./Query-Dal_c4tA.js";import{bh as Ce,a8 as _s,aB as Z}from"./ShadowCastClear.glsl-9G1ObMeX.js";import{r as ws}from"./utils-DTE-xBiC.js";import{m as bs,l as Ss}from"./mathUtils-PIGhLnI9.js";import{P as xs,e as Pt,b as ht,q as Ms,d as It,az as Ts,j as Kt,p as Gt,ak as Ps,F as tn,U as en,aA as He,aj as Rs,Y as Es}from"./Polygon-BUi4eoGW.js";import{n as ft,r as At,l as Ls}from"./vec2f64-rIxtbMRN.js";import{s as zs,j as qs}from"./vec42-Cr02Pi7P.js";import{n as Ns}from"./vec4f64-DPb6J-GU.js";import{af as nn,$ as ks,f as sn,a1 as xe,R as Lt,aD as js,a0 as Ds,az as Os,b9 as Cs,ax as Hs,bs as rn}from"./Point-B6yFWNoR.js";import{y as an}from"./Polyline-CiznIgZG.js";import{a as Yt,j as F,W as _e,c as on,J as un,O as Is,w as As,X as Vs,R as cn,k as ln}from"./plane-B7VfuINA.js";import{X as Zs,q as Fs,T as Ws,c as Gs}from"./sphere-BiyfUvnN.js";import{g as Us}from"./geometry2dUtils-BvGwGPs_.js";import{x as hn,i as Bs,f as Js}from"./screenUtils-BitdhK1O.js";import{m as Xs,l as pn}from"./geodeticLengthOperator-RdkkEHwB.js";import{c as Ks,a as Ys}from"./spatialReferenceEllipsoidUtils-CJDHI1w1.js";let at=class extends Je{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new xt}};p([d({constructOnly:!0})],at.prototype,"layer",void 0),p([d()],at.prototype,"enabled",void 0),p([d()],at.prototype,"updating",void 0),p([d()],at.prototype,"availability",void 0),p([d()],at.prototype,"sublayerSources",void 0),at=p([Rt("esri.views.interactive.snapping.FeatureSnappingLayerSource")],at);let B=class extends Xe{constructor(){super(...arguments),this.enabled=!0}};p([d({type:Boolean})],B.prototype,"enabled",void 0),B=p([Rt("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],B);let w=class extends Xe{constructor(t){super(t),this.lineSnapper=new B,this.parallelLineSnapper=new B,this.rightAngleSnapper=new B,this.rightAngleTriangleSnapper=new B,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ft([255,127,0]),this.orangeTransparent=new Ft([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};p([d({type:B,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"lineSnapper",void 0),p([d({type:B,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"parallelLineSnapper",void 0),p([d({type:B,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"rightAngleSnapper",void 0),p([d({type:B,constructOnly:!0,nonNullable:!0,json:{write:!0}})],w.prototype,"rightAngleTriangleSnapper",void 0),p([d({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],w.prototype,"shortLineThreshold",void 0),p([d({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],w.prototype,"distance",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"pointThreshold",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"intersectionParallelLineThreshold",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"parallelLineThreshold",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"verticalLineThresholdMeters",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"touchSensitivityMultiplier",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],w.prototype,"pointOnLineThreshold",void 0),p([d({type:Ft,nonNullable:!0})],w.prototype,"orange",void 0),p([d({type:Ft,nonNullable:!0})],w.prototype,"orangeTransparent",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"lineHintWidthReference",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"lineHintWidthTarget",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"lineHintFadedExtensions",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],w.prototype,"parallelLineHintWidth",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],w.prototype,"parallelLineHintLength",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],w.prototype,"parallelLineHintOffset",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],w.prototype,"rightAngleHintSize",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],w.prototype,"rightAngleHintOutlineSize",void 0),p([d({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],w.prototype,"satisfiesConstraintScreenThreshold",void 0),w=p([Rt("esri.views.interactive.snapping.Settings.Defaults")],w);const Ut=new w;let R=class extends Je{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new xt,this.distance=Ut.distance,this.touchSensitivityMultiplier=Ut.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const t=this.featureSources;t.some(Ie)&&Xn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const n=t.filter(ti),s=this._get("_effectiveFeatureSources")?.filter(Ie)??new xt;for(const u of n){const c=s.find(l=>l.layer===u.layer.parent);if(c)c.sublayerSources.includes(u)||c.sublayerSources.add(u);else if(u.layer.parent){const l=new at({layer:u.layer.parent});l.sublayerSources.add(u),s.add(l)}}for(const u of s){const c=u.sublayerSources.filter(l=>!n.includes(l));u.sublayerSources.removeMany(c)}s.removeMany(s.filter(u=>u.sublayerSources.length===0));const i=t.filter(Qs),r=this._get("_effectiveFeatureSources")??new xt,{added:a,removed:o}=Kn(r.toArray(),[...i,...s]);return r.removeMany(o),r.addMany(a),r}};function Ie(e){return e.layer.type==="subtype-group"}function Qs(e){return e.layer.type!=="subtype-group"}function ti(e){return e.layer.type==="subtype-sublayer"}p([d()],R.prototype,"enabled",void 0),p([d()],R.prototype,"enabledToggled",void 0),p([d()],R.prototype,"forceDisabled",void 0),p([d()],R.prototype,"selfEnabled",void 0),p([d()],R.prototype,"featureEnabled",void 0),p([d()],R.prototype,"gridEnabled",void 0),p([d()],R.prototype,"attributeRulesEnabled",void 0),p([d({type:xt.ofType(at)})],R.prototype,"featureSources",void 0),p([d()],R.prototype,"distance",void 0),p([d()],R.prototype,"touchSensitivityMultiplier",void 0),p([d({readOnly:!0})],R.prototype,"effectiveEnabled",null),p([d({readOnly:!0})],R.prototype,"effectiveGridEnabled",null),p([d({readOnly:!0})],R.prototype,"effectiveSelfEnabled",null),p([d({readOnly:!0})],R.prototype,"effectiveFeatureEnabled",null),p([d({readOnly:!0})],R.prototype,"_effectiveFeatureSources",null),R=p([Rt("esri.views.interactive.snapping.SnappingOptions")],R);function dn(e,t,n){return H(e,t,n)}function H(e=0,t=0,n=0){return Zt(e,t,n)}function Yr(e){return e}function Qr(e){return e}function pt(e,t,n){return Zt(e,t,n)}function mt(e){const[t,n,s]=e;return e.length>3?[t,n,s,e[3]]:[t,n,s]}function ce(e){return e[3]=1|((e.length>3?e[3]:void 0)??0),e}function ta(e){return!!(1&((e.length>3?e[3]:void 0)??0))}function Ae(e,t,{coordinateHelper:n,elevationInfo:s},i){return e?St(n.vectorToDehydratedPoint(e,ei),t,s,i):null}function St(e,t,n,s=H()){return s[0]=e.x,s[1]=e.y,s[2]=e.z??0,t==null||(t.type==="2d"?s[2]=0:s[2]=cs(t,e,n,yt)??0),s}function ea(e,t,n){return n?(Qe(n,e[0],e[1],e[2],t),n):Et(e[0],e[1],e[2],t)}function Ve(e,t,{z:n,m:s},i,r){const{spatialReference:a,elevationInfo:o}=i;let u;n==null&&s==null?u=void 0:t==null||t.type==="2d"?u=n??void 0:u=Ye(t,e,a,yt,o)??0;const[c,l]=e;return r?Qe(r,c,l,u,a):r=Et(c,l,u,a),s!=null&&(r.m=s,r.hasM=!0),r}function na(e,t,n,s,i=H()){const[r,a]=e;return i[0]=r,i[1]=a,e.length>3&&(i[3]=e[3]??0),n?.type!=="3d"?(i[2]=t.value,i):(i[2]=ls(n,r,a,t.value,s,t.elevationInfo,yt)??0,i)}const ei=Et(0,0,0,null),sa=Symbol("grid-placement-graphic");function fn(e,t){const n=e.x-t.x,s=e.y-t.y;return n*n+s*s}function ia(e,t){return Math.sqrt(fn(e,t))}function ni(e,t){t.sort((n,s)=>ve(n.targetPoint,e)-ve(s.targetPoint,e))}function ra({parameters:{point:e,distance:t,returnEdge:n,vertexMode:s,coordinateHelper:{spatialReference:i},filter:r},mode:a,returnZ:o,filter:u}){const c=u?.clone()??new $s({where:"1=1"});return c.returnZ=o??a==="3d",r&&(c.geometry=r.geometry,c.distance=r.distance,c.spatialRelationship=r.spatialRelationship,c.where=ps(c.where,r.where),c.timeExtent=ds(c.timeExtent,r.timeExtent),c.objectIds=si(c.objectIds,r.objectIds)),{point:Et(e[0],e[1],e[2],i.toJSON()),mode:a,distance:t,returnEdge:n,vertexMode:s,query:c.toJSON()}}function si(e,t){return e||t?t?e?Array.from(Yn(new Set(e),new Set(t))):t:e:null}function aa(e,t,n){return{left:Ae(e.leftVertex.pos,t,n),right:Ae(e.rightVertex.pos,t,n)}}const Ze=Symbol("snapping-toggle");function oa(e,t=()=>{}){const n=me(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:s,snappingOptions:i})=>{if(e.removeHandles(Ze),!s||!i)return;const r=_s.TOOL,a=[s.on("key-down",o=>{o.key!==Ce.toggle||o.repeat||(i.enabledToggled=!0,t())},r),s.on("key-up",o=>{o.key===Ce.toggle&&(i.enabledToggled=!1,t())},r),s.on("pointer-move",o=>{const u=o.native.ctrlKey;i.enabledToggled!==u&&(i.enabledToggled=u,t())},r)];e.addHandles(a,Ze)},Ke);e.addHandles(n)}function ua(e){return ws(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}function ca(e){return e?.type==="line"}function gn(e){if(!e)return null;const t=e.wkid;if(t)return as[t];const n=e.wkt2??e.wkt;return n?ii(n):null}function ii(e){const t=os.exec(e);if(!t||t.length!==2)return null;const n=t[1].split(",");if(!n||n.length<3)return null;const s=parseFloat(n[1]),i=parseFloat(n[2]);return isNaN(s)||isNaN(i)?null:{a:s,f:i===0?0:1/i}}function Qt(e){const t=gn(e);if(ri(t))return t;const n=t.a*(1-t.f);return Object.assign(t,{b:n,eSq:1-(n/t.a)**2,radius:(2*t.a+n)/3,densificationRatio:1e4/((2*t.a+n)/3)})}function ri(e){return e!=null&&"b"in e&&"eSq"in e&&"radius"in e}function kt(e,t,n){const{a:s,eSq:i}=Qt(n),r=Math.sqrt(i),a=Math.sin(t[1]*N),o=s*t[0]*N;let u;return i>0?u=s*((1-i)*(a/(1-i*(a*a))-1/(2*r)*Math.log((1-r*a)/(1+r*a))))*.5:u=s*a,e[0]=o,e[1]=u,e}function vt(e){return ks(e)&&!!gn(e)}function la(e,t="square-meters"){if(e.some(a=>!vt(a.spatialReference)))throw new Tt("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let a=0;a<e.length;a++){const o=e[a],u=o.spatialReference,{radius:c,densificationRatio:l}=Qt(u),h=c*l;n.push(oi(o,h))}const s=[],i=[0,0],r=[0,0];for(let a=0;a<n.length;a++){const{rings:o,spatialReference:u}=n[a];let c=0;for(let l=0;l<o.length;l++){const h=o[l];kt(i,h[0],u),kt(r,h[h.length-1],u);let g=r[0]*i[1]-i[0]*r[1];for(let f=0;f<h.length-1;f++)kt(i,h[f+1],u),kt(r,h[f],u),g+=r[0]*i[1]-i[0]*r[1];c+=g}c=nn(c,"square-meters",t),s.push(c/-2)}return s}function ai(e,t="meters"){if(!e)throw new Tt("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(s=>!vt(s.spatialReference)))throw new Tt("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let s=0;s<e.length;s++){const i=e[s],{spatialReference:r}=i,a=i.type==="polyline"?i.paths:i.rings;let o=0;for(let u=0;u<a.length;u++){const c=a[u];let l=0;for(let h=1;h<c.length;h++){const g=c[h-1][0],f=c[h][0],m=c[h-1][1],v=c[h][1];if(m!==v||g!==f){const $=new zt;qt($,[g,m],[f,v],r),l+=$.distance}}o+=l}o=nn(o,"meters",t),n.push(o)}return n}function oi(e,t){if(e.type!=="polyline"&&e.type!=="polygon")throw new Tt("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:n}=e;if(!vt(n))throw new Tt("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const s=e.type==="polyline"?e.paths:e.rings,i=[],r=[0,0],a=new zt;for(const u of s){const c=[];i.push(c),c.push([u[0][0],u[0][1]]);let l,h,g=u[0][0],f=u[0][1];for(let m=0;m<u.length-1;m++){if(l=u[m+1][0],h=u[m+1][1],g===l&&f===h)continue;const v=[g,f];qt(a,[g,f],[l,h],n);const{azimuth:$,distance:x}=a,P=x/t;if(P>1){for(let z=1;z<=P-1;z++)gt(r,v,$,z*t,n),c.push(r.slice());gt(r,v,$,(x+Math.floor(P-1)*t)/2,n),c.push(r.slice())}gt(r,v,$,x,n),c.push(r.slice()),g=r[0],f=r[1]}}const o=Qn(sn,n);return e.type==="polyline"?new an({paths:i,spatialReference:o}):new xs({rings:i,spatialReference:o})}let zt=class{constructor(t=0,n=void 0,s=void 0){this.distance=t,this.azimuth=n,this.reverseAzimuth=s}};function gt(e,t,n,s,i){const r=t[0],a=t[1],o=r*N,u=a*N,c=(n??0)*N,{a:l,b:h,f:g}=Qt(i),f=Math.sin(c),m=Math.cos(c),v=(1-g)*Math.tan(u),$=1/Math.sqrt(1+v*v),x=v*$,P=Math.atan2(v,m),z=$*f,D=z*z,E=1-D,b=E*(l*l-h*h)/(h*h),O=1+b/16384*(4096+b*(b*(320-175*b)-768)),I=b/1024*(256+b*(b*(74-47*b)-128));let k,G,q,A=s/(h*O),wt=2*Math.PI;for(;Math.abs(A-wt)>1e-12;)q=Math.cos(2*P+A),k=Math.sin(A),G=Math.cos(A),wt=A,A=s/(h*O)+I*k*(q+I/4*(G*(2*q*q-1)-I/6*q*(4*k*k-3)*(4*q*q-3)));const V=x*k-$*G*m,X=Math.atan2(x*G+$*k*m,(1-g)*Math.sqrt(D+V*V)),dt=g/16*E*(4+g*(4-3*E)),re=Math.atan2(k*f,$*G-x*k*m)-(1-dt)*g*z*(A+dt*k*(q+dt*G*(2*q*q-1)));return e[0]=(o+re)/N,e[1]=X/N,e}function qt(e,t,n,s){const i=t[0]*N,r=t[1]*N,a=n[0]*N,o=n[1]*N,{a:u,b:c,f:l,radius:h}=Qt(s),g=a-i,f=Math.atan((1-l)*Math.tan(r)),m=Math.atan((1-l)*Math.tan(o)),v=Math.sin(f),$=Math.cos(f),x=Math.sin(m),P=Math.cos(m);let z,D,E,b,O,I,k,G,q,A,wt=1e3,V=g;do{if(k=Math.sin(V),G=Math.cos(V),E=Math.sqrt(P*k*(P*k)+($*x-v*P*G)*($*x-v*P*G)),E===0)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;O=v*x+$*P*G,I=Math.atan2(E,O),q=$*P*k/E,D=1-q*q,b=O-2*v*x/D,isNaN(b)&&(b=0),A=l/16*D*(4+l*(4-3*D)),z=V,V=g+(1-A)*l*q*(I+A*E*(b+A*O*(2*b*b-1)))}while(Math.abs(V-z)>1e-12&&--wt>0);if(wt===0){const Wn=h,Gn=Math.acos(Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos(a-i))*Wn,De=a-i,Un=Math.sin(De)*Math.cos(o),Bn=Math.cos(r)*Math.sin(o)-Math.sin(r)*Math.cos(o)*Math.cos(De),Jn=Math.atan2(Un,Bn);return e.azimuth=Jn/N,e.distance=Gn,e.reverseAzimuth=void 0,e}const X=D*(u*u-c*c)/(c*c),dt=X/1024*(256+X*(X*(74-47*X)-128)),re=c*(1+X/16384*(4096+X*(X*(320-175*X)-768)))*(I-dt*E*(b+dt/4*(O*(2*b*b-1)-dt/6*b*(4*E*E-3)*(4*b*b-3)))),Zn=Math.atan2(P*Math.sin(V),$*x-v*P*Math.cos(V)),Fn=Math.atan2($*Math.sin(V),$*x*Math.cos(V)-v*P);return e.azimuth=Zn/N,e.distance=re,e.reverseAzimuth=Fn/N,e}function pa(e){return vt(e)?e:xe(e)?sn.WGS84:null}function Me({start:e,end:t,type:n},s,i){const r=[],a=ht(Nt,t,e),o=ht(te,e,s),u=Gt(a),c=2*Kt(a,o),l=c*c-4*u*(Gt(o)-i*i);if(l===0){const h=-c/(2*u);(n===0||h>=0)&&r.push(It(ft(),e,a,h))}else if(l>0){const h=Math.sqrt(l),g=(-c+h)/(2*u);(n===0||g>=0)&&r.push(It(ft(),e,a,g));const f=(-c-h)/(2*u);(n===0||f>=0)&&r.push(It(ft(),e,a,f))}return r}function yn(e,t){const n=e.start,s=e.end,i=ht(Nt,s,n),r=lt(ne,-i[1],i[0],0),a=t.start,o=t.end,u=C(Pe,o,a),c=j(u,r),l=lt(xn,n[0],n[1],0),h=C(Mn,l,a),g=j(h,r),f=Pt();if(Math.abs(c)<f)return[];const m=L(Tn,a,u,g/c);if(t.type===0){const v=C(we,m,a);if(j(v,u)<-f)return[]}if(e.type===1){const v=Ts(te,m,n);if(Kt(v,i)<-f)return[]}return[ot(m)]}function ui(e,t){return li(Bt(Re,t[2],e),t)}function mn(e,t){return bn(Bt(Re,0,e),Bt(fi,0,t)).map(([s,i])=>At(s,i))}function vn(e,t,n){return _n(e,Bt(Re,e[2],t),n)}function $n(e,t,n,s=y()){const i=ht(Nt,e,t),r=Ms(i);return It(s,t,i,r===0?1:n/r),s[2]=e[2],s}function _n(e,{start:t,end:n,type:s},i=y()){const r=C(ee,e,t),a=C(ne,n,t),o=j(r,a)/j(a,a);return L(i,t,a,s===0?Math.max(o,0):o)}const ci=(()=>{const e=y(),t=y(),n=y();return({start:s,end:i},{center:r,radius:a,normal:o,slicePlane:u})=>{const c=Yt(r,o,di);if(_(_e(c,s),0)&&_(_e(c,i),0)){on(o,e,t);const h=(m,v)=>(Xt(n,v,r),tn(m,j(n,e),j(n,t)),m),g=Us({start:h(Nt,s),end:h(te,i)},Ls,a),f=[];for(const[m,v]of g){const $=Se(y(),r);L($,$,e,m),L($,$,t,v),u&&!ct(u,$)||f.push($)}return f}const l=y();return un(c,s,i,l)?!_(Mt(l,r),a)||u&&!ct(u,l)?[]:[l]:[]}})();function wn({start:e,end:t,type:n},s,i){const r=[],a=Xt(ee,t,e),o=ht(te,e,s),u=Gt(a),c=2*Kt(a,o),l=c*c-4*u*(Gt(o)-i*i);if(l===0){const h=-c/(2*u);(n===1||h>=0)&&r.push(L(y(),e,a,h))}else if(l>0){const h=Math.sqrt(l),g=(-c+h)/(2*u);(n===1||g>=0)&&r.push(L(y(),e,a,g));const f=(-c-h)/(2*u);(n===1||f>=0)&&r.push(L(y(),e,a,f))}return r}function bn(e,t){const n=e.start,s=e.end,i=t.start,r=t.end,a=C(ee,s,n),o=C(ne,r,i),u=C(Pe,i,n),c=Wt(xn,a,o);if(!_(j(u,c),0))return[];const l=$e(c);if(_(l,0))return[];const h=Wt(Mn,u,o),g=j(h,c)/l,f=L(Tn,n,a,g);if(e.type===0){const m=C(we,f,n);if(j(a,m)<-Pt())return[]}if(t.type===0){const m=C(we,f,i);if(j(o,m)<-Pt())return[]}return[ot(f)]}function li({start:e,end:t,type:n},s){const i=C(ee,s,e),r=C(ne,t,e),a=Wt(Pe,r,i),o=$e(a)/$e(r),u=Pt();if(o<u)switch(n){case 1:return[ot(s)];case 0:return j(r,i)<-u?[]:[ot(s)]}return[]}function Te(e,t,n,s){const[i,r]=e,[a,o]=n,u=a-i,c=o-r,l=u*u+c*c,h=Math.sqrt(l);if(h>t+s)return[];if(h<Math.abs(t-s))return[];if(_(h,0)&&_(t,s))return[];const g=(t*t-s*s+l)/(2*h),f=Math.sqrt(t*t-g*g),m=f*c/h,v=f*u/h,[$,x]=Ps(Nt,e,n,g/h);return _(m,v)?[At($,x)]:[At($+m,x-v),At($-m,x+v)]}function Bt(e,t,{start:n,end:s,type:i}){return lt(e.start,n[0],n[1],t),lt(e.end,s[0],s[1],t),e.type=pi[i],e}function Sn(e,t){return _(e[2],t[2])}function _(e,t){return bs(Math.abs(e-t),0,Pt())}function hi(e,t){return t.filter(n=>ct(e,n))}function ct(e,t){return Is(e,t)}const pi={0:1,1:0},Nt=ft(),te=ft(),ee=y(),ne=y(),Pe=y(),xn=y(),Mn=y(),Tn=y(),we=y(),di=F(),Re={start:y(),end:y(),type:1},fi={start:y(),end:y(),type:1};class W{intersect(t){return nt(this,t)}closestPoints(t){return[this.closestTo(t)]}}class $t extends W{constructor(t){super(),this.point=t}equals(t){return this===t||U(t)&&S(this.point,t.point)}closestTo(){return mt(this.point)}}class Ee extends W{constructor(t,n,s){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:s}}equals(t){return this===t||K(t)&&this.lineLike.type===t.lineLike.type&&S(this.start,t.start)&&S(this.end,t.end)}closestTo(t){const n=H();return _n(t,this.lineLike,n),n}}class Le extends Ee{constructor(t,n){super(t,n,1)}}class gi extends Ee{constructor(t,n){super(t,n,0)}}class Pn extends W{constructor(t){super(),this.constraints=t}equals(t){return this===t||be(t)&&es(this.constraints,t.constraints,(n,s)=>n.equals(s))}closestTo(t){let n,s=1/0;for(const i of this.constraints){const r=i.closestTo(t),a=ve(t,r);a<s&&(s=a,n=r)}return mt(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class Rn extends W{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||Q(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=H();return $n(t,this.center,this.radius,n),n}}class ze extends W{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||it(t)&&S(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=H();return $n(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new qe(mt(this.center),this.radius,pt(0,0,1))}}class qe extends W{constructor(t,n,s,i=void 0){super(),this.center=t,this.radius=n,this.normal=s,this.slicePlane=i}equals(t){return this===t||ut(t)&&S(this.center,t.center)&&S(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:s}=this;cn(this.getPlane(yi),t,le);const i=C(le,le,n),r=gs(i);if(_(r,0))return mt(t);const a=s/Math.sqrt(r),o=H();L(o,n,i,a);const{slicePlane:u}=this;return u&&!ct(u,o)?ke(u,this)?.closestTo(t)??mt(t):o}getPlane(t=F()){return Yt(this.center,this.normal,t)}}const le=y(),yi=F();class mi extends W{constructor(t){super(),this.z=t}equals(t){return this===t||st(t)&&this.z===t.z}closestTo(t){return pt(t[0],t[1],this.z)}getPlane(t=F()){return lt(Fe,0,0,this.z),Yt(Fe,hs,t)}}const Fe=y();class Ne extends W{constructor(t,n,s){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:s}}equals(t){return this===t||Y(t)&&this.planeLike.type===t.planeLike.type&&S(this.start,t.start)&&S(this.end,t.end)}closestTo(t){const n=H();return vn(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:s}=this.planeLike;return Math.sign(Kt(ht(vi,s,n),ht($i,t,n)))>0?this.end:this.start}getPlane(t=F()){const n=Se(We,this.end);return n[2]+=1,As(this.start,this.end,n,t)}getSlicePlane(t=F()){const{start:n,end:s,type:i}=this.planeLike;if(i===0)return;const r=lt(We,n[0],n[1],0),a=lt(Ge,s[0],s[1],0),o=Xt(Ge,a,r);return Yt(r,o,t),t}}const vi=ft(),$i=ft(),We=y(),Ge=y();class da extends Ne{constructor(t,n){super(t,n,1)}}class En extends Ne{constructor(t,n){super(t,n,0)}}class _i extends W{constructor(t,n){super(),this.sphere=Fs(t,n),this._center=ot(t)}equals(t){return this===t||rt(t)&&Ws(this.sphere,t.sphere)}closestTo(t){const n=H();return Gs(this.sphere,t,n),n}get center(){return this._center}get radius(){return this.sphere[3]}}class Ln extends W{constructor(t,n,s){super(),this.start=t,this.end=n,this.getZ=s,this.planeLike={start:t,end:n,type:0}}equals(t){return this===t||Jt(t)&&S(this.start,t.start)&&S(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Ti(this,t)}addIfOnTheGround(t,n){for(const s of n){const i=this.getZ(s[0],s[1])??0;_(s[2],i)&&(s[2]=i,t.push(s))}}}class wi extends W{constructor(t,n,s){super(),this._x=t,this._y=n,this._z=s}equals(t){return this===t||Vi(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,s]){return dn(this._x??t,this._y??n,this._z??s)}}class bi extends W{constructor(t,n,s,i,r){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=s,this._z=i,this._directionDegrees=r}equals(t){return this===t||Ai(t)&&He(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,s]){return tn(bt,t,n),He(bt,this._origin)||this._applyDirectionAndDistance(bt),dn(bt[0],bt[1],this._z??s)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)gt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)xi(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=qt(Si,this._origin,t,this._spatialReference);gt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const bt=[0,0],Si=new zt;function xi(e,t,n,s,i){let{azimuth:r,distance:a}=qt(Mi,t,s,i);r??=0;let o=a*Math.cos((r-n)*N);o=Math.max(0,o),gt(e,t,n,o,i)}const Mi=new zt;function Ti(e,t){const n=H();return vn(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??qn,n}function nt(e,t){if(be(e)){const n=[];for(const s of e.constraints){const i=s.intersect(t);i&&n.push(i)}return je(n)}if(be(t))return nt(t,e);if(Jt(e))return Ue(e,t);if(Jt(t))return Ue(t,e);if(U(e)){const{point:n}=e;if(U(t))return S(n,t.point)?e:void 0;const s=t.closestTo(n);return fs(s,n)?e:void 0}if(K(e)){if(U(t))return nt(t,e);if(K(t))return J(bn(e.lineLike,t.lineLike));if(st(t))return Pi(e,t);if(Y(t))return J(yn(t.planeLike,e.lineLike));if(Q(t))return J(wn(e.lineLike,t.center,t.radius));if(ut(t))return J(ci(e.lineLike,t));if(it(t))return Ri(e,t);if(rt(t))return Ei(e,t)}else if(st(e)){if(U(t)||K(t))return nt(t,e);if(st(t))return Li(e,t);if(Y(t))return zi(e,t);if(Q(t))return qi(e,t);if(ut(t))return ki(e,t);if(it(t))return Ni(e,t);if(rt(t))return ji(e,t)}else if(Y(e)){if(U(t)||K(t)||st(t))return nt(t,e);if(Y(t))return he(mn(e.planeLike,t.planeLike));if(Q(t))return he(Me(e.planeLike,t.center,t.radius));if(ut(t))return Oi(e,t);if(it(t))return Di(e,t);if(rt(t))return Ci(e,t)}else if(Q(e)){if(U(t)||K(t)||st(t)||Y(t))return nt(t,e);if(Q(t))return he(Te(e.center,e.radius,t.center,t.radius));if(ut(t))return void 0;if(it(t))return Hi(e,t);if(rt(t))return void 0}else if(ut(e)){if(U(t)||K(t)||st(t)||Y(t)||Q(t))return nt(t,e);if(ut(t))return void 0;if(it(t))return t.asCircle(),void 0;if(rt(t))return void 0}else if(it(e)){if(U(t)||K(t)||st(t)||Y(t)||Q(t)||ut(t))return nt(t,e);if(it(t))return Ii(t,e);if(rt(t))return void 0}else if(rt(e)){if(U(t)||K(t)||st(t)||Y(t)||Q(t)||it(t))return nt(t,e);if(rt(t))return void 0}}const Pi=(()=>{const e=F();return(t,n)=>{const{start:s,end:i}=t;if(Sn(s,i)&&_(s[2],n.z))return t;const r=H();return un(n.getPlane(e),s,i,r)?new $t(r):void 0}})();function Ri({lineLike:e},{center:t,radius:n}){const s=t[2];return J(wn(e,t,n).filter(i=>_(i[2],s)))}function Ei({lineLike:e},{sphere:t}){return J(Zs(t,e.start,e.end))}const ke=(()=>{const e=Ns(),t=y(),n=y();return(s,i,r)=>{const{normal:a,center:o,radius:u}=i;on(a,t,n);const c=ln(s),l=u*j(c,t),h=u*j(c,n);zs(e,o[0],o[1],o[2],1);const g=qs(s,e),f=Math.hypot(l,h),m=_(f,0);if(_(_e(s,o),0)){if(m)return i;if(_(u,0))return!r||ct(r,o)?new $t(mt(o)):void 0;Wt(t,c,a),ys(t,t);const b=new Array,O=ot(o);L(O,O,t,u),r&&!ct(r,O)||b.push(O);const I=ot(o);return L(I,I,t,-u),r&&!ct(r,I)||b.push(I),J(b)}if(m)return;const v=-g/f;if(Math.abs(v)>1||_(v,1))return;const $=Math.atan(l/h),x=Ss(v)-$,P=Math.PI-x,z=new Array,D=y();L(D,o,t,u*Math.cos(x)),L(D,D,n,u*Math.sin(x)),z.push(D);const E=y();return L(E,o,t,u*Math.cos(P)),L(E,E,n,u*Math.sin(P)),z.push(E),J(r?hi(r,z):z)}})();function Li(e,t){return _(e.z,t.z)?e:void 0}function zi({z:e},{planeLike:t}){const[n,s]=t.start,[i,r]=t.end,a=pt(n,s,e),o=pt(i,r,e);return t.type===0?new Le(a,o):new gi(a,o)}function qi(e,t){const[n,s]=t.center;return new ze(pt(n,s,e.z),t.radius)}function Ni(e,t){return _(t.center[2],e.z)?t:void 0}const ki=(()=>{const e=F();return(t,n)=>ke(t.getPlane(e),n,n.slicePlane)})();function ji(e,{center:t,radius:n}){const s=Math.abs(t[2]-e.z);if(s>n&&!_(s,n))return;const i=pt(t[0],t[1],e.z),r=Math.sqrt(n**2-s**2);return _(r,0)?void 0:new ze(i,r)}const Di=(()=>{const e=F();return(t,{center:n,radius:s})=>{const i=Me(t.planeLike,n,s),r=n[2];t.getSlicePlane(e);const a=new Array;for(const[o,u]of i){const c=[o,u,r];ct(e,c)&&a.push(c)}return J(a)}})(),Oi=(()=>{const e=F(),t=F();return(n,s)=>ke(n.getPlane(e),s,n.getSlicePlane(t))})(),Ci=(()=>{const e=F();return(t,{center:n,radius:s})=>{const i=t.getPlane(e),r=Vs(i,n),a=Math.abs(r);if(a>s&&!_(a,s))return;const o=Math.sqrt(s**2-r**2);if(_(o,0)){const l=H();return cn(i,n,l),new $t(l)}const u=H(),c=ot(ln(i));return L(u,n,c,r),new qe(u,o,c,t.getSlicePlane())}})();function Hi(e,t){const n=en(e.center,t.center);return _(n,0)&&_(e.radius,t.radius)?t:zn(Te(e.center,e.radius,t.center,t.radius),t.center[2])}function Ii(e,t){if(!Sn(e.center,t.center))return;const n=en(e.center,t.center);return _(n,0)&&_(e.radius,t.radius)?e:zn(Te(e.center,e.radius,t.center,t.radius),e.center[2])}function Ue(e,t){const{planeLike:n,getZ:s}=e,i=new Array;if(U(t))e.addIfOnTheGround(i,ui(n,t.point));else if(K(t))e.addIfOnTheGround(i,yn(n,t.lineLike));else if(Q(t))for(const[r,a]of Me(n,t.center,t.radius)){const o=s(r,a);o!=null&&i.push(Zt(r,a,o))}else if(Y(t)||Jt(t))for(const[r,a]of mn(n,t.planeLike)){const o=s(r,a)??qn;i.push(Zt(r,a,o))}return J(i)}function he(e){return je(e.map(([t,n])=>{const s=pt(t,n,0),i=pt(t,n,1);return new Le(s,i)}))}function J(e){return je(e.map(t=>t?new $t(t):void 0))}function zn(e,t){return J(e.map(([n,s])=>[n,s,t]))}function je(e){if(e.length!==0)return e.length===1?e[0]??void 0:new Pn(e.filter(ts))}function be(e){return e instanceof Pn}function U(e){return e instanceof $t}function K(e){return e instanceof Ee}function st(e){return e instanceof mi}function Y(e){return e instanceof Ne}function Q(e){return e instanceof Rn}function it(e){return e instanceof ze}function ut(e){return e instanceof qe}function rt(e){return e instanceof _i}function Jt(e){return e instanceof Ln}function Ai(e){return e instanceof bi}function Vi(e){return e instanceof wi}const qn=0;let _t=class{constructor(t,n,s,i){this.targetPoint=t,this.constraint=n,this.isDraped=s,this.domain=i}},Nn=class extends _t{constructor({targetPoint:t,objectId:n,constraint:s,isDraped:i}){super(t,s,i,1),this.objectId=n}},se=class{constructor(t,n){this.isDraped=t,this.domain=n}},tt=class kn extends se{constructor(t,n,s,i,r=3,a=!0,o=!0){super(i,r),this.type=t,this.lineStart=n,this.lineEnd=s,this.fadeLeft=a,this.fadeRight=o}equals(t){return t instanceof kn&&this.type===t.type&&S(this.lineStart,t.lineStart)&&S(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return Mt(this.lineStart,this.lineEnd)}};class Zi extends Nn{constructor(t){super({...t,isDraped:!0,constraint:new Ln(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new tt(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}let Fi=class extends Nn{constructor(t){super({...t,constraint:new Le(t.edgeStart,t.edgeEnd)})}get hints(){return[new tt(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Wi=class jn extends se{constructor(t,n,s=3){super(n,s),this.intersectionPoint=t}equals(t){return t instanceof jn&&S(this.intersectionPoint,t.intersectionPoint)}},Vt=class extends _t{constructor(t,n,s,i){super(t,new $t(t),i,3),this.first=n,this.second=s}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Wi(this.targetPoint,this.isDraped,this.domain)]}},Gi=class extends _t{constructor({lineStart:t,lineEnd:n,targetPoint:s,isDraped:i}){super(s,new En(t,n),i,2),this._referenceLineHint=new tt(2,t,n,i,this.domain)}get hints(){return[this._referenceLineHint,new tt(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ui=class Dn extends se{constructor(t,n,s,i=3){super(s,i),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof Dn&&S(this.lineStart,t.lineStart)&&S(this.lineEnd,t.lineEnd)}},Bi=class extends _t{constructor({referenceLine:t,lineStart:n,targetPoint:s,isDraped:i}){const r=ot(n),{left:a,right:o}=t;Xt(r,ms(r,r,o),a),super(s,new En(n,r),i,2),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new tt(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Ui(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new tt(1,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const n={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(s=>{S(t.right,s.edge.left)&&(s.fadeLeft=!1,n.fadeRight=!1),S(t.right,s.edge.right)&&(s.fadeRight=!1,n.fadeRight=!1),S(t.left,s.edge.right)&&(s.fadeRight=!1,n.fadeLeft=!1),S(t.left,s.edge.left)&&(s.fadeLeft=!1,n.fadeLeft=!1)}),this._referenceLines.push(n)}},On=class Cn extends se{constructor(t,n,s,i,r=3){super(i,r),this.previousVertex=t,this.centerVertex=n,this.nextVertex=s}equals(t){return t instanceof Cn&&S(this.previousVertex,t.previousVertex)&&S(this.centerVertex,t.centerVertex)&&S(this.nextVertex,t.nextVertex)}},Ji=class extends _t{constructor({targetPoint:t,constraint:n,previousVertex:s,otherVertex:i,otherVertexType:r,isDraped:a,selfSnappingType:o,objectId:u,domain:c}){super(t,n,a,c??2),this.previousVertex=s,this.otherVertex=i,this.otherVertexType=r,this.selfSnappingType=o??0,this.objectId=u??null}get hints(){const t=this.previousVertex,n=this.otherVertexType===1?this.otherVertex:this.targetPoint,s=this.otherVertexType===1?this.targetPoint:this.otherVertex;return[new tt(0,n,s,this.isDraped,this.domain),new tt(1,t,n,this.isDraped,this.domain),new On(this.previousVertex,n,s,this.isDraped,this.domain)]}},Xi=class extends _t{constructor({targetPoint:t,point1:n,point2:s,isDraped:i}){super(t,new Rn(vs(y(),n,s,.5),.5*Rs(n,s)),i,2),this._p1=n,this._p2=s}get hints(){return[new tt(1,this.targetPoint,this._p1,this.isDraped,this.domain),new tt(1,this.targetPoint,this._p2,this.isDraped,this.domain),new On(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Sa(e,t,n,s){const i=n.projectToRenderScreen(e,Qi),r=n.projectToRenderScreen(t,tr);return i==null||r==null?null:(ht(s,r,i),Es(s,s),s)}function Ki(e,t,n,s,i=y()){const r=Se(Yi,e);return r[2]=Ye(s,r,t,n)||0,s.renderCoordsHelper.toRenderCoords(r,t,i),i}const Yi=y(),Qi=hn(),tr=hn();function er(e,t,n,s){return s.type==="2d"?(jt.x=e[0],jt.y=e[1],jt.spatialReference=t,s.toScreen(jt)):(Ki(e,t,n,s,Be),s.state.camera.projectToScreen(Be,pe),Bs(pe[0],pe[1]))}const jt=Et(0,0,0,null),Be=y(),pe=Js();function xa(e){return vt(e)||xe(e)}function Hn(e,t,n,...s){return vt(e)?t.apply(void 0,s):e.isWebMercator?n.apply(void 0,s):null}const Ma=1e5;function nr(e){const{spatialReference:t}=e;return Hn(t,ur,cr,e)}function sr(e,t){if(!Lt(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return Dt[0]=e.x,Dt[1]=e.y,Dt[2]=e.hasZ?e.z:0,Ot[0]=t.x,Ot[1]=t.y,Ot[2]=t.hasZ?t.z:0,In(Dt,Ot,n)}function In(e,t,n){return Hn(n,ar,or,e,t,n)}const ir={geodesicLength:nr,geodesicDistanceBetweenPoints:sr,geodesicDistance:In};async function rr(){return await Xs(),ir}function ar(e,t,n){return Z(qt(hr,e,t,n).distance,"meters")}function or(e,t,n){return Z(pn(lr(e,t,n),{unit:"meters"}),"meters")}function ur(e){return Z(ai([e],"meters")[0],"meters")}function cr(e){return Z(pn(e,{unit:"meters"}),"meters")}function lr(e,t,n){return new an({spatialReference:n,paths:[[[...e],[...t]]]})}const hr=new zt,Dt=y(),Ot=y();let et=class extends is{constructor(e){super(e),this.options=new R,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([me(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:s,effectiveGridEnabled:i}=this.options;return{selfEnabled:n,featureEnabled:s,gridEnabled:this.view.type==="2d"&&i,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=ss(n=>this._updateEngines(e,t,n))},Ke),me(()=>this.options,e=>{for(const t of this._engines)t.options=e},rs)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const s=this._engineCache,i=await Promise.allSettled([e.featureEnabled&&!s.has("feature")?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!s.has("self")?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!s.has("grid")?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(const r of i)r.status==="fulfilled"&&r.value?.engine.destroy();else{for(const r of i)r.status==="fulfilled"&&r.value&&s.set(r.value.type,r.value.engine);this._engines=Array.from(s.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},n]=await Promise.all([ae(()=>import("./SelfSnappingEngine-BInGx8el.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155])),rr()]);return oe(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:n}=await ae(()=>import("./GridSnappingEngine-C0n_KEKG.js"),__vite__mapDeps([156,1,11,5,6,3,4,15,2,7,8,9,16,17,38,39,49,10,50,51,52,53,87,94,135,127,44,45,47,46,30,68,111,55,112,113,12,13,14,18,19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,37,40,41,42,43,48,54,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,88,89,90,91,92,93,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,114,115,116,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,153,152,154,155]));return oe(e),{type:"grid",engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await ae(()=>import("./FeatureSnappingEngine-B232kM_B.js"),__vite__mapDeps([157,3,4,1,12,13,14,15,2,5,6,7,8,9,16,17,11,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,10,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,158,159,153,152,154,155]));oe(e);const{view:n,options:s}=this,{spatialReference:i}=n;return{type:"feature",engine:new t({view:n,options:s,spatialReference:i})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return fr(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const s=this._currentMainCandidate;if(s==null)return t;const i=this._selectUpdateInput(e);if(i==null)return t;const{spatialReference:r}=n,a=Oe(i,r);if(a==null)return t;const{view:o}=this,{elevationInfo:u,visualizer:c}=n,l=[],h=St(a,o,u),g=s.constraint.closestTo(h);if(!this._arePointsWithinScreenThreshold(h,g,n)||!fe(s,n.drawConstraints))return this._resetSnappingState(),t;s.targetPoint=ce(g),l.push(...s.hints);for(const f of this._currentOtherActiveCandidates)fe(f,n.drawConstraints)&&(f.targetPoint=ce(g),l.push(...f.hints));return c!=null&&this.addHandles(c.draw(l,{spatialReference:r,elevationInfo:gr(n),view:o,selfSnappingZ:n.selfSnappingZ}),de),Ve(g,o,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(de)}async _snapSinglePoint({point:e,context:t,signal:n}){const{view:s}=this,{elevationInfo:i}=t,r=St(e,s,i),a=await this._fetchCandidates(r,3,t,n);return this._createSnapResult(r,0,a,s,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:s}){const{view:i}=this,{coordinateHelper:r,elevationInfo:a,spatialReference:o}=n;await us(t.spatialReference,o);const u=Oe(t,o),c=St(u,i,a),l=await this._fetchCandidates(c,1,n,s);if(l.length>0){const f=await this._fetchCandidates(c,2,n,s);return this._createSnapResult(c,1,[...l,...f],i,u,n,s)}const h=St(e,i,a),g=await this._fetchCandidates(h,2,n,s);return this._createSnapResult(h,0,g,i,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},n,s)}async _fetchCandidates(e,t,n,s){return(await Promise.all(this._engines.map(i=>i.fetchCandidates(e,t,n,s)))).flat()}_createSnapResult(e,t,n,s,i,r,a){return{get valid(){return!ns(a)},apply:()=>{const{spatialReference:o}=r,{snappedPoint:u,hints:c}=this._processCandidates(e,t,n,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(c,{spatialReference:o,elevationInfo:yt,view:s,selfSnappingZ:r.selfSnappingZ}),de),Ve(u,s,i,r)}}}_processCandidates(e,t,n,s){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),ni(e,n);const i=this._currentMainCandidate;if(i!=null){const r=dr(i,n);if(r>=0){if(!(n[r]instanceof Vt))return this._intersectWithOtherCandidates(r,n,e,t,s);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,s))return this._updateSnappingCandidate(i,t,n,s)}}return this._intersectWithOtherCandidates(0,n,e,t,s)}_intersectWithOtherCandidates(e,t,n,s,i){const{coordinateHelper:r}=i,a=t[e],o=[];for(let u=0;u<t.length;++u){if(u===e)continue;const c=t[u],l=a.constraint.intersect(c.constraint);if(l)for(const h of l.closestPoints(a.targetPoint))o.push([new Vt(ce(h),a,c,c.isDraped),this._squaredScreenDistance(n,h,r)])}return o.length>0&&(o.sort((u,c)=>u[1]-c[1]),o[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(o[0][0],s,t,i):fe(a,i.drawConstraints)?this._updateSnappingCandidate(a,s,t,i):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const i=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const a of n){if(e instanceof Vt){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const o=a.constraint.closestTo(i);this._squaredScreenDistance(o,i,s.coordinateHelper)<pr()&&(a.targetPoint=i,this._currentOtherActiveCandidates.push(a),r.push(...a.hints))}return{snappedPoint:i,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return fn(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return er(e,t.spatialReference,yt,this.view)}get test(){}};p([d({constructOnly:!0})],et.prototype,"view",void 0),p([d()],et.prototype,"options",void 0),p([d({readOnly:!0})],et.prototype,"updating",null),p([d()],et.prototype,"_loadTask",void 0),p([d()],et.prototype,"_engines",void 0),p([d()],et.prototype,"_squaredMouseProximityThreshold",null),p([d()],et.prototype,"_squaredTouchProximityThreshold",null),et=p([Rt("esri.views.interactive.snapping.SnappingManager")],et);const de="visualization-handle";function pr(){return Ut.satisfiesConstraintScreenThreshold*Ut.satisfiesConstraintScreenThreshold}function fe(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Zi||e instanceof Fi||e instanceof Gi||e instanceof Bi||e instanceof Xi)&&(!(e instanceof Ji)||t.direction==null&&e.selfSnappingType===1)}function dr(e,t){return e instanceof Vt?ge(t,e.first)>=0&&ge(t,e.second)>=0?0:-1:ge(t,e)}function ge(e,t){let n=-1;for(let s=0;s<e.length;++s)if(t.constraint.equals(e[s].constraint)){n=s;break}return n}function fr(e){return e.scenePoint!=null}function gr({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?yt:t}function An(e){return js(e)?Ds(e)||xe(e)||Os(e)||Cs(e)?Ks:e:Ys(e)}function Ta(e){return yr(e)}function yr(e,t){const{hasZ:n,spatialReference:s}=e,i=An(s);let r=0;const a=rn(i);if(a==null)return null;const o=Vn;for(const u of e.paths){if(u.length<2)continue;const c=u.length-1;for(let l=0;l<c;++l){const h=u[l];M[0]=h[0],M[1]=h[1],M[2]=n?h[2]:0;const g=u[l+1];T[0]=g[0],T[1]=g[1],T[2]=n?g[2]:0;const f=o(M,T,s);if(f==null)return null;r+=f.value}}return Z(r,a)}function Pa(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,vr(M,T,n)):null}function Ra(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,$r(M,T,n)):null}function Ea(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,Vn(M,T,n)):null}function La(e,t){const{spatialReference:n}=e;return Lt(n,t.spatialReference)?(M[0]=e.x,M[1]=e.y,M[2]=e.hasZ?e.z:0,T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,_r(M,T,n)):null}function za(e){return e!=null?mr(e.hasZ?e.z:0,e.spatialReference):null}function mr(e,t){const n=Hs(t);return n!=null?Z(e??0,n):null}function vr(e,t,n){const s=ie(e,t,n);return s!=null?{direct:Z(s.direct,s.unit),horizontal:Z(s.horizontal,s.unit),vertical:Z(s.vertical,s.unit)}:null}function $r(e,t,n){const s=ie(e,t,n,0);return s!=null?Z(s.direct,s.unit):null}function Vn(e,t,n){const s=ie(e,t,n,1);return s!=null?Z(s.horizontal,s.unit):null}function _r(e,t,n){const s=ie(e,t,n,2);return s!=null?Z(s.verticalSigned,s.unit):null}function ie(e,t,n,s){const i=An(n),r=rn(i);if(r==null)return null;const a=t[2]-e[2];if(s===2)return{verticalSigned:a,unit:r};if(!ue(e,n,ye,i)||!ue(t,n,Ct,i))return null;if(s===0)return{direct:Mt(Ct,ye),unit:r};if(lt(Ht,e[0],e[1],t[2]),!ue(Ht,n,Ht,i))return null;const o=Mt(Ht,Ct);return s===1?{horizontal:o,unit:r}:{direct:Mt(Ct,ye),horizontal:o,vertical:Math.abs(a),unit:r}}const M=y(),T=y(),ye=y(),Ct=y(),Ht=y();export{_n as $,On as A,ua as B,Ae as C,Ji as D,da as E,er as F,ia as G,Sa as H,ea as I,na as J,ta as K,Ki as L,vt as M,pa as N,dn as O,sa as P,Gi as Q,ai as R,Vt as S,H as T,Yr as U,za as V,xa as W,fn as X,ca as Y,Vn as Z,aa as _,Ta as a,Bi as a0,Xi as a1,oa as a2,Ra as a3,Ma as a4,$r as a5,St as a6,Ve as a7,wi as a8,Rn as a9,je as aa,mi as ab,bi as ac,mr as ad,U as ae,La as af,_r as ag,Pa as ah,qt as b,zt as c,Qr as d,ce as e,Zi as f,rr as g,Fi as h,at as i,gt as j,pt as k,Nn as l,Ea as m,$t as n,ra as o,Ut as p,et as q,An as r,se as s,Hn as t,R as u,la as v,Wi as w,tt as x,ni as y,Ui as z};
