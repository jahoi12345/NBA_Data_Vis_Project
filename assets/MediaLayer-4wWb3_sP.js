const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mediaLayerUtils-BJCs1hNY.js","assets/utils-DWWBRhj7.js","assets/jsonMap-Bs3hmeCU.js","assets/originUtils-CPX8CCAY.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/collectionUtils-CB98pReO.js","assets/index-CB_zX-aI.js","assets/index-DJhoxO8W.css","assets/Point-62ir3Nzl.js","assets/reader-DcGs6kKN.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-Cs-ESnE1.js","assets/SimpleObservable-CvFyr0NA.js","assets/PortalItem-QIiqvhel.js","assets/jsonContext-BrBLQJHm.js","assets/portalItemUtils-BnUKAdwm.js","assets/projectionUtils-ClsoIho7.js","assets/Polyline-CUSonZ4c.js","assets/Polygon-BbQMC1ht.js","assets/aaBoundingRect-DfeeUq5j.js","assets/mathUtils-PIGhLnI9.js","assets/saveUtils-Ct7z0HfG.js","assets/Layer-BLV7fz0K.js","assets/date-IqUzANpt.js","assets/resourceUtils-CAhseImT.js","assets/uuid-Oe6SV2kF.js","assets/resourceUtils-BkSOHRyw.js"])))=>i.map(i=>d[i]);
import{_ as x}from"./index-CB_zX-aI.js";import{d as S,i as y,_ as o,m as a,a as g,ah as R,s as p,r as b}from"./jsonMap-Bs3hmeCU.js";import{h as I,O as m,c as O}from"./collectionUtils-CB98pReO.js";import{l as E}from"./MultiOriginJSONSupport-Bd1TKmh_.js";import{f as $,R as M,s as L}from"./Point-62ir3Nzl.js";import{o as h}from"./reader-DcGs6kKN.js";import{b as T}from"./Layer-BLV7fz0K.js";import{p as V}from"./BlendLayer-CEHruVkx.js";import{b as A}from"./OperationalLayer-DydUunj4.js";import{j as C}from"./PortalLayer-DipxjGHJ.js";import{t as H}from"./ScaleRangeLayer-DQr2T3Hh.js";import{V as _,E as w,u as N,c as u,T as P,w as z}from"./VideoElement-BUvG876Q.js";import{m as F,c as j,l as B}from"./reactiveUtils-SO2Ko3sy.js";import{z as G,x as W}from"./Extent-Cs-ESnE1.js";import{N as k,W as q}from"./projectionUtils-ClsoIho7.js";import{o as D}from"./aaBoundingRect-DfeeUq5j.js";import{o as J}from"./BoundsStore-DaboXCXV.js";import{i as K}from"./MediaElementView-BAxbf2oG.js";import"./SimpleObservable-CvFyr0NA.js";import"./date-IqUzANpt.js";import"./layerContainerType-CSXZNpHb.js";import"./jsonUtils-Bref6UUL.js";import"./Color-CERqXxxY.js";import"./mathUtils-PIGhLnI9.js";import"./screenUtils-BitdhK1O.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-Bjnccznk.js";import"./Polygon-BbQMC1ht.js";import"./ElevationInfo-DqQyVbKu.js";import"./lengthUtils-Cm-zragw.js";import"./unitConversionUtils-BSQ4LGUO.js";import"./opacityUtils-DuFH0EC9.js";import"./asyncUtils-w6KfWU41.js";import"./layerUtils-4EQ207Ij.js";import"./PortalItem-QIiqvhel.js";import"./portalItemUtils-BnUKAdwm.js";import"./imageUtils-DRSdxeif.js";import"./uuid-Oe6SV2kF.js";import"./resourceExtension-3aprB2zB.js";import"./sanitizerUtils-BT_8V5US.js";import"./vec2f64-rIxtbMRN.js";import"./ControlPoint-2iU9LZAJ.js";import"./videoUtils-Dwx3AEgj.js";import"./Polyline-CUSonZ4c.js";import"./PooledRBush-Dco5QkUp.js";import"./quickselect-QQC62dOK.js";import"./vec32-zHQcyKRA.js";import"./normalizeUtilsSync-OK6qKDm5.js";import"./jsonUtils-alsySR4T.js";import"./normalizeUtilsCommon-BRJdiLvx.js";const Q={key:"type",defaultKeyValue:"image",base:N,typeMap:{image:w,video:_}},f=m.ofType(Q);let l=class extends I(F(j)){constructor(e){super(e),this._index=new J,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=t=>{for(const r of t.removed){const i=this._elementViewsMap.get(r);this._elementViewsMap.delete(r),this._index.delete(i),this.removeHandles(i),i.destroy(),this.notifyChange("fullExtent")}const{spatialReference:s}=this;for(const r of t.added){if(this._elementViewsMap.get(r))continue;const i=new K({spatialReference:s,element:r});this._elementViewsMap.set(r,i);const d=B(()=>i.coords,()=>this._updateIndexForElement(i,!1));this._updateIndexForElement(i,!0),this.addHandles(d,i)}this._elementsIndexes.clear(),this.elements.forEach((r,i)=>this._elementsIndexes.set(r,i)),this.emit("refresh")},this.elements=new f}async load(e){if(S(e),!this.spatialReference){const t=this.elements.find(s=>s.georeference?.coords!=null);this._set("spatialReference",t?t.georeference.coords.spatialReference:$.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",O(e,this._get("elements"),f))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;const e=this._index.fullBounds;return e==null?null:new G({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):y.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,t){await this.load(),await k(e.spatialReference,this.spatialReference,null,t);const s=M(e.spatialReference,this.spatialReference)?e:q(e,this.spatialReference);if(!s)return[];const r=s.normalize(),i=[];for(const d of r)this._index.forEachInBounds(D(d),({normalizedCoords:c,element:v})=>{c!=null&&W(d,c)&&i.push(v)});return i.sort((d,c)=>this._elementsIndexes.get(d)-this._elementsIndexes.get(c)),i}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,t){const s=e.normalizedBounds,r=this._index.has(e),i=s!=null;this._index.delete(e),i&&this._index.set(e,s),this.notifyChange("fullExtent"),t||(r!==i?this.emit("refresh"):this.emit("change",{element:e.element}))}};o([a()],l.prototype,"elements",null),o([a({readOnly:!0})],l.prototype,"fullExtent",null),o([a()],l.prototype,"spatialReference",null),l=o([g("esri.layers.support.LocalMediaElementSource")],l);let n=class extends V(H(A(C(E(T))))){constructor(e){super(e),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=R(async(t,s,r)=>{const{save:i,saveAs:d}=await x(()=>import("./mediaLayerUtils-BJCs1hNY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]));switch(t){case 0:return i(this,s);case 1:return d(this,r,s)}}),this.source=new l}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){await this.loadFromPortal({supportedTypes:["Media Layer"]},e);let t=this.source;if(!t)throw new p("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const s=this._getSourceOverride(t,this.georeference);s&&(this.setAtOrigin("source",s,"web-map"),this.setAtOrigin("source",s,"web-scene"),t=s);const r=u(t)?new l({elements:new m([t])}):t;this._set("effectiveSource",r),this.spatialReference&&(r.spatialReference=this.spatialReference),await r.load(e),this.spatialReference=r.spatialReference}destroy(){this.effectiveSource?.destroy(),this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}get loaded(){return super.loaded}get source(){return this._get("source")}set source(e){this.loadStatus!=="loaded"&&this.loadStatus!=="failed"?this._set("source",e):y.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new l({elements:new m(e)}):e instanceof m?new l({elements:e}):e:null}readSource(e,t,s){if("itemId"in t&&t.itemId)return;const r=this._createSource(t);return r?.read(t,s),r}writeSource(e,t,s,r){if(e&&e instanceof l){const i=e.elements.length;if(i!==1)return void(r?.messages&&r.messages.push(new p("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${i}.`)));e=e.elements.at(0)}u(e)?e.write(t,r):r?.messages&&(e?r.messages.push(new p("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):r.messages.push(new p("media-layer:unsupported-source","the media layer is missing a source")))}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new w;case"video":return new _}return null}_getSourceOverride(e,t){if(u(e)&&this.originIdOf("source")===3&&t&&(this.originIdOf("georeference")===5||this.originIdOf("georeference")===4)){const s=e.toJSON(),r=this._createSource(s);return r.read({...s},{origin:"portal-item"}),r.read({georeference:t},{origin:"web-map"}),r.read({georeference:t},{origin:"web-scene"}),r}return null}};o([a({readOnly:!0})],n.prototype,"effectiveSource",void 0),o([a({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],n.prototype,"georeference",void 0),o([h("web-document","georeference")],n.prototype,"readGeoreference",null),o([a({type:String})],n.prototype,"copyright",void 0),o([a({readOnly:!0})],n.prototype,"fullExtent",null),o([a({type:["MediaLayer"]})],n.prototype,"operationalLayerType",void 0),o([a({type:["show","hide"]})],n.prototype,"listMode",void 0),o([a({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:P}},overridePolicy(e,t,s){return{enabled:!0,allowNull:!1,ignoreOrigin:z(this,s?.origin)&&u(e)&&!!e.georeference&&e.originIdOf("georeference")>3}}}}})],n.prototype,"source",null),o([L("source")],n.prototype,"castSource",null),o([h("source",["url"])],n.prototype,"readSource",null),o([b("source")],n.prototype,"writeSource",null),o([a()],n.prototype,"spatialReference",void 0),o([a({readOnly:!0})],n.prototype,"type",void 0),n=o([g("esri.layers.MediaLayer")],n);const De=n;export{De as default};
