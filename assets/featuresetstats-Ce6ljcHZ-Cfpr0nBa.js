import{r as p}from"./TimeOnly-BERR31kg-CQiLyUZi.js";import{x as A,l as s}from"./arcade-zfxT_nQK-BUKByHhX.js";import{u as d}from"./enum-BzLwmiID-CcyIdWlQ.js";import{K as l,u,w as c,o as w,Q as h,U as m,i as S}from"./Dictionary-B4WY1XGX-DPfLsCo2.js";import{L as y,i as v}from"./WhereClause-BSVqskBz-CT_IXPhv.js";import{Z as f,f as x,W as Z}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./Point-BfTTZoMu-DeJwQYfh.js";import"./index-B0z_nLWi.js";import"./Feature-BVRwBUzm-CdKSTB7Z.js";import"./Polyline-CoiTLswR-DTxpB2Yg.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./aaBoundingBox-Cn49X7ge-BcYPaJ58.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./aiServices-BQaMAyiK-Bd9y7e2i.js";import"./collectionUtils-jDyktm0P-BDP2Oq99.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./unitConversion-C1kMoaUu-BTuDmVw5.js";import"./arcadeEnvironment-DqZGrNFy-B7LAcj80.js";import"./ImmutableArray-BPVd6ESQ-BGk4ZTNG.js";import"./shared-yd-CR64C-BEo7YVMh.js";import"./streamLayerUtils-DFlbJ4P1-DFlbJ4P1.js";import"./jsonUtils-CmpazY1u-6pDLj5sx.js";import"./number-D_FvV3D1-OQFavbmh.js";import"./hash-CcEbRgUF-DpReY683.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./featureConversionUtils-BDA_FXJx-CDxX1Wik.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./FieldsIndex-CimK-TqD--24JoCkp.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./commonProperties-DHiB1uzW-DHiB1uzW.js";import"./utils-CylVuxNi--x86XOjU.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";async function e(r,n,t,a){if(t.length===1){if(f(t[0]))return s(r,t[0],m(t[1],-1));if(c(t[0]))return s(r,t[0].toArray(),m(t[1],-1))}else if(t.length===2){if(f(t[0]))return s(r,t[0],m(t[1],-1));if(c(t[0]))return s(r,t[0].toArray(),m(t[1],-1));if(u(t[0])){const i=await t[0].load(),o=await F(y.create(t[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),a,n);return g(n,await t[0].calculateStatistic(r,o,m(t[2],1e3),n.abortSignal))}}else if(t.length===3&&u(t[0])){const i=await t[0].load(),o=await F(y.create(t[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),a,n);return g(n,await t[0].calculateStatistic(r,o,m(t[2],1e3),n.abortSignal))}return s(r,t,-1)}function g(r,n){return n instanceof v?p.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?p.dateJSAndZoneToArcadeDate(n,S(r)):n}async function F(r,n,t){const a=r.getVariables();if(a.length>0){const i={};for(const o of a)i[o]=n.evaluateIdentifier(t,{name:o});r.parameters=i}return r}function Ft(r){r.mode==="async"&&(r.functions.stdev=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("stdev",n,o,r))},r.functions.variance=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("variance",n,o,r))},r.functions.average=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("mean",n,o,r))},r.functions.mean=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("mean",n,o,r))},r.functions.sum=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("sum",n,o,r))},r.functions.min=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("min",n,o,r))},r.functions.max=function(n,t){return r.standardFunctionAsync(n,t,(a,i,o)=>e("max",n,o,r))},r.functions.count=function(n,t){return r.standardFunctionAsync(n,t,async(a,i,o)=>{if(l(o,1,1,n,t),o[0]==null)return 0;if(u(o[0]))return o[0].count(a.abortSignal);if(f(o[0])||x(o[0]))return o[0].length;if(c(o[0]))return o[0].length();if(w(o[0]))return o[0].entryCount();throw new d(n,"InvalidParameter",t)})},r.functions.isempty=function(n,t){return r.standardFunctionAsync(n,t,async(a,i,o)=>{if(l(o,1,2,a,i),o.length>=2&&!Z(o[1]))throw new d(a,"InvalidParameter",i);return m(o[1],!1)?u(o[0])?await o[0].isEmpty(a.abortSignal):A(o[0]):h(o[0])})})}export{Ft as registerFunctions};
