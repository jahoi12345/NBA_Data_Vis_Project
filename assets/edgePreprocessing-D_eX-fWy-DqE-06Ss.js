import{s as U,A as nt,y as X}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{l as Y,W as et,v as at,L as F,I as H,A as $,$ as O,F as Z,i as st}from"./vec32-CewSdTn3-VRto2OOh.js";import{t as m}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{m as L,bf as ot}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";function rt(t){return t<=ot?new Array(t):new Int16Array(t)}function _(t,o,a,r,s,n=2){const e=1/(Math.abs(a)+Math.abs(r)+Math.abs(s)),l=a*e,h=r*e,g=s<=0?(l>=0?1:-1)*(1-Math.abs(h)):l,c=s<=0?(h>=0?1:-1)*(1-Math.abs(l)):h,f=o*n;t[f]=P(g),t[f+1]=P(c)}function It(t){const o=t.length/3,a=rt(2*o);let r=0;for(let s=0;s<o;++s)_(a,s,t[r++],t[r++],t[r++]);return a}function bt(t,o){const a=t.length/3,r=new Int16Array(2*a);let s=0;const n=m();for(let e=0;e<a;++e)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],et(n,n,o),_(r,e,n[0],n[1],n[2]);return r}function vt(t,o,a,r=2){const s=a*r,n=S(o[s]),e=S(o[s+1]),l=1-Math.abs(n)-Math.abs(e);return t[2]=l,l<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(e)),t[1]=(e>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=e),Y(t,t)}function P(t){return U(Math.round(32767*t),-32767,32767)}function S(t){return U(t/32767,-1,1)}class ct{constructor(){this.position0=m(),this.position1=m(),this.faceNormal0=m(),this.faceNormal1=m(),this.componentIndex=0,this.cosAngle=0}}const N=-1;function xt(t,o,a){const r=t.vertices.position,s=t.vertices.componentIndex,n=u.position0,e=u.position1,l=u.faceNormal0,h=u.faceNormal1,{edges:g,normals:c}=ht(t),f=g.length/4,A=o.allocate(f);let D=0;const J=f,b=a?.allocate(J);let W=0,j=0,k=0;I.length=0;for(let d=0;d<f;++d){const w=4*d;r.getVec(g.data[w],n),r.getVec(g.data[w+1],e);const y=I.pushNew();y.index=4*d,y.length=at(n,e)}I.sort((d,w)=>w.length-d.length);const q=new Array,z=new Array;I.forAll(({length:d,index:w})=>{const y=g.data[w],tt=g.data[w+1],B=g.data[w+2],C=g.data[w+3],E=C===N;if(r.getVec(y,n),r.getVec(tt,e),E){const p=3*B;F(l,c.data[p],c.data[p+1],c.data[p+2]),H(h,l),u.componentIndex=s.get(y),u.cosAngle=$(l,h)}else{let p=3*B;if(F(l,c.data[p],c.data[p+1],c.data[p+2]),p=3*C,F(h,c.data[p],c.data[p+1],c.data[p+2]),u.componentIndex=s.get(y),u.cosAngle=$(l,h),it(u,pt))return;u.cosAngle<-.9999&&H(h,l)}j+=d,k++,E||lt(u,mt)?(o.write(A,D++,u),q.push(d)):ut(u,G)&&(b&&a&&a.write(b,W++,u),z.push(d))});const K=new Float32Array(q.reverse()),Q=new Float32Array(z.reverse()),R=b&&a?{instancesData:b.slice(0,W),lodInfo:{lengths:Q}}:void 0;return{regular:{instancesData:A.slice(0,D),lodInfo:{lengths:K}},silhouette:R,averageEdgeLength:j/k}}function lt(t,o){return t.cosAngle<o}function it(t,o){return t.cosAngle>o}function ut(t,o){const a=nt(t.cosAngle);return st(T,t.position1,t.position0),a*($(Z(ft,t.faceNormal0,t.faceNormal1),T)>0?-1:1)>o}function ht(t){const o=t.faces.length/3,a=t.faces,r=t.neighbors,s=t.vertices.position;i.length=V.length=0;for(let n=0;n<o;n++){const e=3*n,l=r[e],h=r[e+1],g=r[e+2],c=a[e],f=a[e+1],A=a[e+2];s.getVec(c,M),s.getVec(f,v),s.getVec(A,x),O(v,v,M),O(x,x,M),Z(M,v,x),Y(M,M),V.pushArray(M),(l===N||c<f)&&(i.push(c),i.push(f),i.push(n),i.push(l)),(h===N||f<A)&&(i.push(f),i.push(A),i.push(n),i.push(h)),(g===N||A<c)&&(i.push(A),i.push(c),i.push(n),i.push(g))}return{edges:i,normals:V}}class gt{constructor(){this.index=0,this.length=0}}function Nt(){I.prune(),i.prune(),V.prune()}const I=new L({allocator:t=>t||new gt,deallocator:null}),i=new L({deallocator:null}),V=new L({deallocator:null}),u=new ct,ft=m(),T=m(),M=m(),v=m(),x=m(),G=X(4),pt=Math.cos(G),dt=X(35),mt=Math.cos(dt);export{Nt as I,It as N,_ as S,rt as r,xt as v,bt as x,vt as y};
