import{F as k}from"./Color-CERqXxxY-BuYn26eI.js";import{s as U}from"./Graphic-DgGzDmqW-CFzg0c4i.js";import{v as q,U as O}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{V as $}from"./lengthUtils-Dt1_RvOO-bleznLOi.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./getPopupProvider-CmskPttI-C4PqyuPF.js";import"./collectionUtils-jDyktm0P-ArdXNs6F.js";import"./index-CTl7hdrJ.js";import"./Point-BfTTZoMu-BAT2Wq6O.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./Layer-DZvC7bne-m1cEC_yw.js";import"./jsonUtils-CmpazY1u-ateEpj4Q.js";import"./Polyline-CoiTLswR-BLagWJLS.js";import"./Polygon-D6wEPb3W-CpL9Efjx.js";import"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import"./typeUtils-DqrRcjBx-ZWdHcSIJ.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./typeUtils-CXW_VpOn-BoSnXkME.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-Vi0-2Gvc.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./Font-BwmnW7d2-D-oIm_Md.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./PictureMarkerSymbol-CaSh-vZk-BNpExnAb.js";import"./TextSymbol-hRGhyDHs-C0NgASym.js";function I(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function x(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Z(e){return e.valueExpression?"expression":e.field&&typeof e.field=="string"?"field":"unknown"}function Te(e,n){const r=n||Z(e),i=e.valueUnit||"unknown";return r==="unknown"?"constant":e.stops?"stops":e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?"clamped-linear":i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}const E=()=>q.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=e=>E().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),z=()=>E().error("Use of arcade expressions requires an arcade context"),D=new U,g=Math.PI,_=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(e,n,r){const i="visualVariables"in e?e.visualVariables?.find(c=>c.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void y("ColorVariable");const t=typeof n=="number",l=t?null:n,o=l?.attributes;let s=t?n:null;const a=i.field,{ipData:u,hasExpression:m}=i.cache;let p=i.cache.compiledFunc;if(!a&&!m){const c=i.stops;return c&&c[0]&&c[0].color}if(typeof s!="number")if(m){if(r?.arcade==null)return void z();const c={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,h=d.getViewInfo(c),V=d.createExecContext(l,h,r.timeZone);if(!p){const w=d.createSyntaxTree(i.valueExpression);p=d.createFunction(w),i.cache.compiledFunc=p}s=d.executeFunction(p,V)}else o&&(s=o[a]);const f=i.normalizationField,v=o!=null&&f!=null?parseFloat(o[f]):void 0;if(s!=null&&(!f||t||!isNaN(v)&&v!==0)){x(v)&&!t&&(s/=v);const c=F(s,u);if(c){const d=c[0],h=c[1],V=d===h?i.stops[d].color:k.blendColors(i.stops[d].color,i.stops[h].color,c[2],r?.color);return new k(V)}}}function R(e,n,r){const i="visualVariables"in e?e.visualVariables?.find(c=>c.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void y("OpacityVariable");const t=typeof n=="number",l=t?null:n,o=l?.attributes;let s=t?n:null;const a=i.field,{ipData:u,hasExpression:m}=i.cache;let p=i.cache.compiledFunc;if(!a&&!m){const c=i.stops;return c&&c[0]&&c[0].opacity}if(typeof s!="number")if(m){if(r?.arcade==null)return void z();const c={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,h=d.getViewInfo(c),V=d.createExecContext(l,h,r.timeZone);if(!p){const w=d.createSyntaxTree(i.valueExpression);p=d.createFunction(w),i.cache.compiledFunc=p}s=d.executeFunction(p,V)}else o&&(s=o[a]);const f=i.normalizationField,v=o!=null&&f!=null?parseFloat(o[f]):void 0;if(s!=null&&(!f||t||!isNaN(v)&&v!==0)){x(v)&&!t&&(s/=v);const c=F(s,u);if(c){const d=c[0],h=c[1];if(d===h)return i.stops[d].opacity;{const V=i.stops[d].opacity;return V+(i.stops[h].opacity-V)*c[2]}}}}function C(e,n,r){const i="visualVariables"in e?e.visualVariables?.find(v=>v.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void y("RotationVariable");const t=i.axis||"heading",l=t==="heading"&&i.rotationType==="arithmetic"?90:0,o=t==="heading"&&i.rotationType==="arithmetic"?-1:1,s=typeof n=="number"?null:n,a=s?.attributes,u=i.field,{hasExpression:m}=i.cache;let p=i.cache.compiledFunc,f=null;if(!u&&!m)return f;if(m){if(r?.arcade==null)return void z();const v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},c=r.arcade.arcadeUtils,d=c.getViewInfo(v),h=c.createExecContext(s,d,r.timeZone);if(!p){const V=c.createSyntaxTree(i.valueExpression);p=c.createFunction(V),i.cache.compiledFunc=p}f=c.executeFunction(p,h)}else a&&(f=a[u]);return f=typeof f!="number"||isNaN(f)?null:l+o*f,f}function A(e,n,r){const i=typeof n=="number",t=i?null:n,l=t?.attributes;let o=i?n:null;const{isScaleDriven:s}=e.cache;let a=e.cache.compiledFunc;if(s){const m=r?.scale,p=r?.view;o=m==null||p==="3d"?j(e):m}else if(!i)switch(e.inputValueType){case"expression":{if(r?.arcade==null)return void z();const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(m),v=p.createExecContext(t,f,r.timeZone);if(!a){const c=p.createSyntaxTree(e.valueExpression);a=p.createFunction(c),e.cache.compiledFunc=a}o=p.executeFunction(a,v);break}case"field":l&&(o=l[e.field]);break;case"unknown":o=null}if(!x(o))return null;if(i||!e.normalizationField)return o;const u=l?parseFloat(l[e.normalizationField]):null;return x(u)&&u!==0?o/u:null}function j(e){let n=null,r=null;const i=e.stops;return i?(n=i[0].value,r=i[i.length-1].value):(n=e.minDataValue||0,r=e.maxDataValue||0),(n+r)/2}function S(e,n,r){const i="visualVariables"in e?e.visualVariables?.find(l=>l.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void y("SizeVariable");const t=T(A(i,n,r),i,n,r,i.cache.ipData);return t==null||isNaN(t)?void 0:t}function b(e,n,r){return e==null?null:I(e)?S(e,n,r):x(e)?e:null}function N(e,n,r){return x(r)&&e>r?r:x(n)&&e<n?n:e}function P(e,n,r,i){const t=b(n.minSize,r,i)||n.minDataValue;return e==null&&t==null?null:(e??0)+(t??0)}function B(e,n,r){const i=e.stops;let t=i?.length&&i[0].size;return t==null&&(t=e.minSize),b(t,n,r)}function L(e,n,r,i){const t=b(n.minSize,r,i);if(e==null)return t;const{minDataValue:l,maxDataValue:o}=n;if(l==null||o==null)return null;const s=(e-l)/(o-l),a=b(n.maxSize,r,i),u=i?.shape;if(e<=l)return t;if(e>=o)return a;if(t==null||a==null)return null;if(n.scaleBy==="area"&&u){const m=u==="circle",p=m?g*(t/2)**2:t*t,f=p+s*((m?g*(a/2)**2:a*a)-p);return m?2*Math.sqrt(f/g):Math.sqrt(f)}return t+s*(a-t)}function G(e,n,r,i){const t=b(n.minSize,r,i);if(e==null||t==null)return t;const l=i?.shape,{minDataValue:o}=n;if(o==null)return null;const s=e/o,a=b(n.maxSize,r,i);let u=null;return u=l==="circle"?2*Math.sqrt(s*(t/2)**2):l==="square"||l==="diamond"||l==="image"?Math.sqrt(s*t**2):s*t,N(u,t,a)}function H(e,n,r,i,t){if(e==null)return null;const[l,o,s]=F(e,t);if(l===o)return b(n.stops?.[l].size,r,i);{const a=b(n.stops?.[l].size,r,i),u=b(n.stops?.[o].size,r,i);return a==null||u==null?null:a+(u-a)*s}}function J(e,n,r,i){const t=(i?.resolution??1)*$[n.valueUnit],l=b(n.minSize,r,i),o=b(n.maxSize,r,i),{valueRepresentation:s}=n;if(e==null)return l;let a=null;return a=s==="area"?2*Math.sqrt(e/g)/t:s==="radius"||s==="distance"?2*e/t:e/t,N(a,l,o)}function T(e,n,r,i,t){switch(n.transformationType){case"additive":return P(e,n,r,i);case"constant":return B(n,r,i);case"clamped-linear":return L(e,n,r,i);case"proportional":return G(e,n,r,i);case"stops":return H(e,n,r,i,t);case"real-world-size":return J(e,n,r,i);case"identity":return e;case"unknown":return null}}function K(e,n,r){const{isScaleDriven:i}=e.cache;if(!(i&&r==="3d"||n))return null;const t={scale:n,view:r};let l=b(e.minSize,D,t),o=b(e.maxSize,D,t);if(l!=null||o!=null){if(l>o){const s=o;o=l,l=s}return{minSize:l,maxSize:o}}}function Q(e,n,r){if(!e.visualVariables)return;const i=[],t=[],l=[],o=[],s=[];for(const a of e.visualVariables)switch(a.type){case"color":t.push(a);break;case"opacity":l.push(a);break;case"rotation":s.push(a);break;case"size":o.push(a)}return t.forEach(a=>{const u=M(a,n,r);i.push({variable:a,value:u})}),l.forEach(a=>{const u=R(a,n,r);i.push({variable:a,value:u})}),s.forEach(a=>{const u=C(a,n,r);i.push({variable:a,value:u})}),o.forEach(a=>{const u=S(a,n,r);i.push({variable:a,value:u})}),i}function F(e,n){if(!n)return;let r=0,i=n.length-1;return n.some((t,l)=>e<t?(i=l,!0):(r=l,!1)),[r,i,(e-n[r])/(n[i]-n[r])]}function W(e,n,r){const i=["proportional","proportional","proportional"];for(const t of e){const l=t.useSymbolValue?"symbol-value":S(t,n,r)??"proportional";switch(t.axis){case"width":i[0]=l;break;case"depth":i[1]=l;break;case"height":i[2]=l;break;case"width-and-depth":i[0]=l,i[1]=l;break;case"all":case void 0:case null:i[0]=l,i[1]=l,i[2]=l;break;default:O(t.axis)}}return i}const Ue=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:W,getColor:M,getOpacity:R,getRotationAngle:C,getSize:S,getSizeForValue:T,getSizeFromNumberOrVariable:b,getSizeRangeAtScale:K,getVisualVariableValues:Q,viewScaleRE:_},Symbol.toStringTag,{value:"Module"}));export{Q as D,W as U,Ue as a,M as d,Z as i,Te as l,C as m,I as n,_ as p,R as v};
