const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/resourceUtils-DmUA0Cus-CDxuZ74N.js","assets/Point-BfTTZoMu-DeJwQYfh.js","assets/index-B0z_nLWi.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/reader-DcGs6kKN-DHJfK-tm.js"])))=>i.map(i=>d[i]);
import{H as g,_ as v}from"./index-B0z_nLWi.js";import{cj as S,o as y,I as T,bd as U}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{r as b}from"./uuid-Oe6SV2kF-IYX19xBA.js";import{getSiblingOfSameTypeI as x,contentToBlob as m}from"./resourceUtils-DmUA0Cus-CDxuZ74N.js";const w=(t,s=w,o=s.f||(s.f=["assets/resourceUtils-DmUA0Cus.js","assets/Point-BfTTZoMu.js","assets/jsonMap-Bs3hmeCU.js","assets/reader-DcGs6kKN.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css"]))=>t.map(r=>o[r]);async function O(t,s,o){const r=await I(t,s,o);await _(r,s,o)}async function P(t,s,o,r,a){const c=await I(o,r,a);await t.update({data:s}),await _(c,r,a)}async function I(t,s,o){if(!s?.resources)return;const r=s.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=s.portalItem;const a=new Set(s.resources.toKeep.map(e=>e.resource.path)),c=new Set,f=[];a.forEach(e=>{r.delete(e),t.paths.push(e)});const p=[],i=[],u=[];for(const e of s.resources.toUpdate)if(r.delete(e.resource.path),a.has(e.resource.path)||c.has(e.resource.path)){const{resource:n,content:j,finish:d}=e,h=x(n,b());t.paths.push(h.path),p.push({resource:h,content:await m(j),compress:e.compress}),d&&u.push(()=>d(h))}else{t.paths.push(e.resource.path),i.push({resource:e.resource,content:await m(e.content),compress:e.compress});const n=e.finish;n&&u.push(()=>n(e.resource)),c.add(e.resource.path)}for(const e of s.resources.toAdd)if(t.paths.push(e.resource.path),r.has(e.resource.path))r.delete(e.resource.path);else{p.push({resource:e.resource,content:await m(e.content),compress:e.compress});const n=e.finish;n&&u.push(()=>n(e.resource))}if(p.length||i.length){const{addOrUpdateResources:e}=await g(()=>v(()=>import("./resourceUtils-DmUA0Cus-CDxuZ74N.js"),__vite__mapDeps([0,1,2,3,4,5])),w([0,1,2,3,4,5]));await e(s.portalItem,p,"add",o),await e(s.portalItem,i,"update",o)}if(u.forEach(e=>e()),f.length===0)return r;const l=await S(f);if(y(o),l.length>0)throw new T("save:resources","Failed to save one or more resources",{errors:l});return r}async function _(t,s,o){if(!t||!s.portalItem)return;const r=[];for(const a of t){const c=s.portalItem.resourceFromPath(a);r.push(c.portalItem.removeResource(c,o))}await U(r)}export{O as A,P as F};
