import{M as I,m as P,U as $,Q as D,n as E,q as C,r as M,u as V,v as y,w as z,A as L,B as k}from"./arcade-BKDVbdEl.js";import{F as Jt}from"./arcade-BKDVbdEl.js";import{m as l,i as O,r as Z}from"./TimeOnly-CcssPQOY.js";import{r as c}from"./arcadeEnvironment-DqZGrNFy.js";import{V as J,A as _,p as f,t as R,l as G,H as N,B as q,X as U}from"./Dictionary-7tKlwTvz.js";import{D as B,w as j,I as d}from"./Feature-Ch0d2c_a.js";import{n as o}from"./enum-BzLwmiID.js";import{t as b}from"./ImmutableArray-BPVd6ESQ.js";import{e as H,i as Q,y as W}from"./jsonMap-Bs3hmeCU.js";import{n as X}from"./isImageryGraphicOrigin-Ccuhb4eK.js";import{n as K}from"./isImageryTileGraphicOrigin-ZR-gBf9D.js";import{q as v,y as F,u as Y,s as ee,t as te,n as re}from"./lengthUtils-S7Vd15KB.js";import{a as ne}from"./rasterFieldUtils-0bNK-dHZ.js";import{z as ie}from"./Extent-BhRcB6A3.js";import{y as ae,m as se}from"./Polyline-BX3kGhk1.js";import{b as oe}from"./Point-C1MrKtFQ.js";import{P as le}from"./Polygon-Bn-bHOAm.js";import"./index-DJqVgRZI.js";import"./aiServices-sUqO5qoM.js";import"./UnknownTimeZone-B697BDFv.js";import"./date-IqUzANpt.js";import"./reactiveUtils-SO2Ko3sy.js";import"./collectionUtils-0LMOubEE.js";import"./reader-DcGs6kKN.js";import"./SimpleObservable-CvFyr0NA.js";import"./commonProperties-DHiB1uzW.js";import"./utils-B141yH2f.js";import"./shared-CW0TWaw1.js";import"./Field-Cm_ZejYW.js";import"./Color-CERqXxxY.js";import"./mathUtils-PIGhLnI9.js";import"./fieldType-DVUzXtk_.js";import"./WhereClause-BKUytwv8.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./jsonUtils-DCeeRI0j.js";import"./unitConversion-BQvehlAd.js";import"./number-D_FvV3D1.js";import"./hash-CcEbRgUF.js";import"./uuid-Oe6SV2kF.js";import"./featureConversionUtils-D_cSc3SE.js";import"./aaBoundingBox-CB-h8mLX.js";import"./aaBoundingRect-CirBGiM6.js";import"./DoubleArray-DExKNiTh.js";import"./mat4f64-q_b6UJoq.js";import"./OptimizedFeature-CwRGZPwv.js";import"./memoryEstimations-Bd726a_p.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./createFeatureId-CVwTD0fV.js";import"./FieldsIndex-DJnOcUNs.js";import"./timeZoneUtils-BSc7-7qA.js";const ue=()=>Q.getLogger("esri.arcade.Pixel");function x(e){return e.rasterFields.filter(r=>r.name.startsWith(ne))}class T{constructor(r,t,n){this._graphic=t,this._timeZone=n,this.arcadeDeclaredClass="esri.arcade.Pixel",this._values=new Map,this._fields=new Map(r.map(s=>[c(s.name),s]))}static fromImageryGraphic(r,t){if(!X(r.origin)&&!K(r.origin))throw new o(null,"InvalidParameter",null);return new T(x(r.origin.layer),r,t)}static getDeclaredMembers(r){return x(r).map(t=>v(t.name)&&t.type==="string"?{name:t.name,type:"array",elementType:{type:"text"}}:B(t)).filter(t=>t!=null)}keys(){return Array.from(this._fields.values()).map(r=>r.name).sort()}hasField(r){return this._fields.has(c(r))}field(r){const t=this._fields.get(c(r));if(t==null)throw new o(null,"FieldNotFound",null,{key:r});return H(this._values,t.name,()=>{const n=this._graphic.getAttribute(t.name);return n==null?null:v(t.name)&&typeof n=="string"?new b(n.split(/,\s*|\s+/)):F(n)||J(n)?j(n,t.type,this._timeZone??"system"):(ue().warn(`Unsupported type for attribute: ${t.name}. Ignoring value.`),null)})}isEmpty(){return this._fields.size<=0}castToText(r=!1){const t={};for(const n of this._fields.values())t[n.name]=this.field(n.name);return _(t,{useNumbersForDates:r})}}const m="Voxel.Position",u="Voxel.LocalTime";function ce(e){const r=e.getAttribute(m);if(typeof r!="string")throw new o(null,"InvalidParameter",null);const t=JSON.parse(r);if(!Array.isArray(t)||typeof t[0]!="number"||typeof t[1]!="number"||typeof t[2]!="number")throw new o(null,"InvalidParameter",null);return new b(t)}function pe(e,r){const t=e.getAttribute(u);if(t==null)return null;if(!F(t))throw new o(null,"InvalidParameter",null);return l.dateJSAndZoneToArcadeDate(t,r)}class yt{constructor(r,t){this._graphic=r,this._timeZone=t,this.arcadeDeclaredClass="esri.arcade.Voxel",this._layer=r.sourceLayer}static getDeclaredMembers(r){return r.fields.map(t=>{switch(t.name){case m:return{name:t.name,type:"array",elementType:{type:"number"}};case u:return{name:t.name,type:"date"};default:switch(t.type){case"string":return{name:t.name,type:"text"};case"double":return{name:t.name,type:"number"}}return null}}).filter(t=>t!=null)}getPosition(){return this._position!==void 0?this._position:this._position=ce(this._graphic)}getLocalTime(){return this._localTime!==void 0?this._localTime:this._localTime=pe(this._graphic,this._timeZone??"system")}keys(){return this._layer.fields.map(r=>r.name).sort()}hasField(r){return this._layer.fieldsIndex.has(r)}field(r){const t=this._layer.fieldsIndex?.get(r)?.name;if(t==null)throw new o(null,"FieldNotFound",null,{key:r});switch(t){case m:return this.getPosition();case u:return this.getLocalTime()}return this._graphic.attributes[t]??null}isEmpty(){return this._layer.fields.length<=0}castToText(r=!1){const t={...this._graphic.attributes};t[m]=this.getPosition(),u in t&&(t[u]=this.getLocalTime());for(const n of Object.keys(t))this._layer.fieldsIndex?.has(n)||delete t[n];return _(t,{useNumbersForDates:r})}}const me={vars:{$feature:"any",$view:"any"}};function fe(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function ht(e){return e==null?null:Y(e)||R(e)?"array":G(e)?"date":ee(e)?"text":te(e)?"boolean":re(e)?"number":e instanceof f?"dictionary":N(e)?"feature":e instanceof oe?"point":e instanceof le?"polygon":e instanceof ae?"polyline":e instanceof se?"multipoint":e instanceof ie?"extent":e instanceof O?"dateOnly":e instanceof Z?"time":q(e)?"featureSet":U(e)?"featureSetCollection":null}function p(e){if(!e)return null;try{return P(e)}catch{}return null}function gt(e,r){const t=typeof e=="string"?p(e):e;if(!t)return null;try{return r=r||W(me),I(t,r)}catch{}return null}function vt(e,r,t){return{vars:{$feature:e==null?new d:d.createFromGraphic(e,t),$view:r?.view},spatialReference:r?.sr,timeZone:t??null}}function xt(e,r,t){return d.createFromGraphicLikeObject(r,e,t,null)}function wt(e,r){e.vars!=null&&(e.vars.$feature=r)}function $t(e,r){let t;try{t=C(e,r)}catch{t=null}return t}function _t(e,r){let t;try{t=e?e(r):null}catch{t=null}return t}function bt(e,r){try{return e?e(r):Promise.resolve(null)}catch{return Promise.resolve(null)}}const de=["$feature","$aggregatedFeatures","$voxel"].map(e=>c(e));function Ft(e,r){if(!e)return[];const t=typeof e=="string"?p(e):e;if(!t)return[];const n=new Map;if(Array.isArray(r)||r==null)for(const i of de)n.set(i,r);else for(const[i,a]of r)n.set(c(i),a);const s=M(t).flatMap(({varId:i,memberNamePattern:a})=>{if(!n.has(i))return[];if(a.includes("*")){const g=n.get(i);if(g==null)return[];const S=new RegExp(`^${a.split(/\*+/).map(fe).join(".*")}$`,"i");return g.filter(A=>S.test(A))}return a.toLowerCase()});return[...new Set(s.sort())]}function Tt(e){return $(e,"$view")}function St(e,r){return!!e&&$(e,r)}function At(e){if(!e||e.spatialReference==null&&(e.scale==null||e.viewingMode==null))return;let r,t;const{timeProperties:n,timeZone:s}=e;if(n!=null){const{currentStart:i,currentEnd:a}=n;s!=null?(r=i!=null?l.dateJSAndZoneToArcadeDate(i,s):null,t=a!=null?l.dateJSAndZoneToArcadeDate(a,s):null):(r=i!=null?l.dateJSToArcadeDate(i):null,t=a!=null?l.dateJSToArcadeDate(a):null)}return{view:e.viewingMode&&e.scale!=null?new f({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:r!=null||t!=null?new f({__proto__:null,currentStart:r,currentEnd:t,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function It({url:e,spatialReference:r,lrucache:t,interceptor:n}){const s=y();return s?s.createFeatureSetCollectionFromService(e,r,t,n):null}function Pt({layer:e,spatialReference:r,outFields:t,returnGeometry:n,lrucache:s,interceptor:i}){if(e===null)return null;const a=y();return a?a.constructFeatureSet(e,r,t,n??!0,s,i):null}function Dt(e){if(e?.map===null)return null;const r=y();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function Et(e,r){return f.convertJsonToArcade(e,r)}function Ct(e,r,t=[]){return V(e,r,t)}function Mt(){return E()}function Vt(){return D()}function ye(e){return"type"in e&&(e.type==="class-breaks"||e.type==="dictionary"||e.type==="dot-density"||e.type==="pie-chart"||e.type==="simple"||e.type==="unique-value")}function he(e){return e.declaredClass==="esri.layers.support.LabelClass"}function ge(e){return e.declaredClass==="esri.PopupTemplate"}function h(e,r){if(!e)return!1;if(typeof e=="string")return r(e);const t=e;if(ye(t)){if(t.type==="dot-density"){const i=t.attributes?.some(a=>r(a.valueExpression));if(i)return i}const n=t.visualVariables,s=!!n&&n.some(i=>{let a=r(i.valueExpression);return i.type==="size"&&(w(i.minSize)&&(a=a||r(i.minSize.valueExpression)),w(i.maxSize)&&(a=a||r(i.maxSize.valueExpression))),a});return!(!("valueExpression"in t)||!r(t.valueExpression))||s}if(he(t)){const n=t.labelExpressionInfo?.expression;return!(!n||!r(n))||!1}return!!ge(t)&&(!!t.expressionInfos&&t.expressionInfos.some(n=>r(n.expression))||Array.isArray(t.content)&&t.content.some(n=>n.type==="expression"&&r(n.expressionInfo?.expression)))}function ve(e){const r=p(e);return!!r&&L(r)}function zt(e){return h(e,ve)}function xe(e){const r=p(e);return!!r&&k(r)}function Lt(e){return h(e,xe)}function kt(e){return h(e,r=>{const t=p(r);return!!t&&z(t)})}function w(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}export{f as Dictionary,T as Pixel,yt as Voxel,Jt as arcade,d as arcadeFeature,Pt as convertFeatureLayerToFeatureSet,Et as convertJsonToArcade,Dt as convertMapToFeatureSetCollection,It as convertServiceUrlToWorkspace,vt as createExecContext,xt as createFeature,gt as createFunction,p as createSyntaxTree,Tt as dependsOnView,Vt as enableFeatureSetOperations,Mt as enableGeometryOperations,$t as evalSyntaxTree,bt as executeAsyncFunction,_t as executeFunction,Ft as extractFieldNames,ht as getArcadeType,At as getViewInfo,zt as hasGeometryFunctions,Lt as hasGeometryOperations,St as hasVariable,Ct as loadScriptDependencies,kt as requiresTrack,wt as updateExecContext};
