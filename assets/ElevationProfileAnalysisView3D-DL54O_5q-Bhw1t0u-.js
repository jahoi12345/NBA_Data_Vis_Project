const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-qjwwYihz-Cy00HIFY.js","assets/Point-BfTTZoMu-BAT2Wq6O.js","assets/index-CTl7hdrJ.js","assets/index-Cv2ko1Ob.css","assets/jsonMap-Bs3hmeCU-Cusd0Fmz.js","assets/reader-DcGs6kKN-DHJfK-tm.js","assets/Point2D-CMz7woHH-BVbGGL7p.js","assets/Envelope2D-mFnl8dXR-MYac-bfa.js","assets/ProjectionTransformation-PJc9H7Gq-Rbz84pUM.js","assets/Transformation2D-CrydmBdC-D4jE8w-_.js","assets/SimpleGeometryCursor-B92kdZ15-B1Z6elF7.js","assets/OperatorDefinitions-DP7_WWTp-DP7_WWTp.js","assets/Extent-CgDMOSRD-CU1qE5Kr.js","assets/Polyline-CoiTLswR-BLagWJLS.js","assets/Polygon-D6wEPb3W-CpL9Efjx.js","assets/aaBoundingRect-CjwcS2F3-D7aII9DY.js","assets/mathUtils-PIGhLnI9-B1tKUlUb.js","assets/jsonConverter-DmBmaSz7-DAl7KiR-.js","assets/apiConverter-BAgvri9D-CJVft-_U.js"])))=>i.map(i=>d[i]);
import{H as nt,_ as rt}from"./index-CTl7hdrJ.js";import{q as j,c as oe,i as ee,c7 as Te,o as L,J as at,x as lt,E as pt,a as ce,a4 as ut,aX as ct,e as Ge,a8 as ht,I as mt,s as dt,M as yt,$ as Oe,bZ as ft,w as vt,Y as a,H as p,G as R,bH as G,bc as re}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{s as gt}from"./AnalysisView3D-zhHEgrUR-DZ8OICjY.js";import{j as P,l as k,t as _t,i as le}from"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import{Q as N,a5 as wt,F as B,f as Me,a8 as bt,af as pe,b as Pt,bp as St,bq as Et}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{L as Dt,J as Rt}from"./vec32-CewSdTn3-DHOFKD0R.js";import{t as be,R as ze,b as xt}from"./collectionUtils-jDyktm0P-ArdXNs6F.js";import{x as kt,q as Ct}from"./sphere-DLQ6p7mp-DmnRpHXV.js";import{r as Le}from"./ElevationQuery-DzlYa4L4-BxQXlEAE.js";import{f as $e,bf as Vt,bd as It,a8 as Pe,be as Tt,bg as Gt}from"./ShadowCastClear.glsl-CeOT_rAo-iOFMl8eB.js";import{z as Ot}from"./Texture-CFNZjV2R-lGBztxVp.js";import{K as Mt}from"./intersectorUtilsConversions-pLQPEbcN-rV-4Q5_m.js";import{E as zt,R as qe,q as Lt,m as Se,a as $t}from"./elevationInfoUtils-B8MpdRMP-CN_w2fPT.js";import{m as He,d as qt}from"./mathUtils-PIGhLnI9-B1tKUlUb.js";import{n as ye,o as Ht}from"./Polyline-CoiTLswR-BLagWJLS.js";import{ay as At,aj as jt,ak as Ut}from"./Polygon-D6wEPb3W-CpL9Efjx.js";import{N as Ee,W as me,X as Ft}from"./projectionUtils-BGH_5_I3-BySNUA-B.js";import{g as Zt,v as Nt,q as Bt,h as Ae}from"./euclideanLengthMeasurementUtils-CpHh36Dt-B3Q3Npaw.js";import{A as Wt}from"./floatRGBA-D-Q4FzNN-BzjdY1tU.js";import{r as Qt}from"./Scheduler-CNrsbccs-Bcg8fWoS.js";import{i as Xt}from"./settings-CtLiSuVx-Dwe01oqt.js";import{X as je}from"./OutlineVisualElement-D-YFBknk-D6MK02_Z.js";import{F as fe}from"./Color-CERqXxxY-BuYn26eI.js";import{s as Ue}from"./throttle-D_a5zHdu-DIXrv8Hy.js";import{e as Jt,T as Kt}from"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import{q as Yt}from"./createUtils-ScyvvYX6-NA68pXeg.js";import{H as Fe}from"./asyncUtils-w6KfWU41-HenJ0UOu.js";import{M as ei}from"./LRUCache-fy84PBMi-Y56WPIvD.js";import{s as ti}from"./getDefaultUnitForView-BIGim07z-C-_fairS.js";import{s as ve}from"./ElevationInfo-Cw2HaA6E-Br1RWTYu.js";import{o as ii}from"./Map-AEYszeHg-D2YZkc1e.js";import{s as si}from"./Graphic-DgGzDmqW-CFzg0c4i.js";import{r as oi}from"./UpdatingHandles-D2RI_3Hb-dwLPjVun.js";import ni from"./GraphicsLayer-CZ0Xqeb2-BpD6EhPB.js";import{a as ri}from"./typeUtils-CXW_VpOn-BoSnXkME.js";import{m as ai}from"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import{T as li,f as pi}from"./SketchViewModel-DKGDyAz7--IntltwL.js";import"./Extent-CgDMOSRD-CU1qE5Kr.js";import"./mat4-C96X-Nn0-Do6fKsNS.js";import"./vector-B8ZDYGQ6-B1uNywRb.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./quatf64-CCm9z-pX-CQ7_sSji.js";import"./vec2f64-rIxtbMRN-Kai9mK1i.js";import"./typeUtils-DqrRcjBx-ZWdHcSIJ.js";import"./modeUtils-BA-mAwuS-UrytRxLw.js";import"./intl-DRFqUect-ClAS7BRt.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./sanitizerUtils-BT_8V5US-CWQWUwZQ.js";import"./lengthUtils-Dt1_RvOO-bleznLOi.js";import"./workers-BEkgoq8Q-BNWfkyQs.js";import"./PooledRBush-Dco5QkUp-DX3CMhf3.js";import"./GraphicsCollection-Bk6M0b7D-ByzFamPI.js";import"./HeightModelInfo-D5IdRvJ2-BK9di2bT.js";import"./spatialReferenceEllipsoidUtils-D2JabnKt-Cip58jmo.js";import"./RealisticTree.glsl-WN9nrQUl-CRRcYwOn.js";import"./BufferView-Cj2sQaht-DuP-iLZg.js";import"./vec42-B8VM4vXb-BnA9MysM.js";import"./Emissions.glsl-B8XKMjLy-DXfiRNVX.js";import"./InterleavedLayout-B7roQAzV-CC2VYRPC.js";import"./aaBoundingBox-Cn49X7ge-DORLZxoS.js";import"./MeshLocalVertexSpace-BGd1IdEs-DqCdtROz.js";import"./projectVectorToVector-Csv3NYZI-BsIKHfQD.js";import"./vec3f32-WCVSSNPR-9V6Uhrx-.js";import"./Indices-D0_UQPPr-t1Qev6md.js";import"./orientedBoundingBox-BLEx7wLU-CPBtS4XC.js";import"./quat-B7J5v7rV-i-DOMCm_.js";import"./frustum-CMzahy3--CFytpSYl.js";import"./Layer-DZvC7bne-m1cEC_yw.js";import"./TilemapCache-CjhKW_vj-BYOTuKe8.js";import"./CollectionFlattener-D6h2Fkvj-qnUHjb1M.js";import"./Query-BlS0WPDF-BdshFBMz.js";import"./Field-Cm_ZejYW-CwJZmSru.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./normalizeUtils-85zLqeMi-DCF9gKvo.js";import"./normalizeUtilsCommon-CnhQye_A-zWtr51r8.js";import"./TileInfo-Bz7QlefV-tjhen9qQ.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./constants-D67WmGms-H7IOwEdB.js";import"./PolygonSymbol3D-BXRHZiCQ-Vi0-2Gvc.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./Font-BwmnW7d2-D-oIm_Md.js";import"./unitConversionUtils-4vB4Ezlp-B0eWR3Ls.js";import"./vec2f32-CaVKkSa6-BjkBmyoj.js";import"./Octree-DckBBpQ7-BC8mmFdF.js";import"./axisAngleDegrees-CjbXmycq-LMRXo165.js";import"./edgePreprocessing-D_eX-fWy-CRLN12td.js";import"./TileKey-C44YQC4_-BW7BBbYp.js";import"./vec3-B_phcnZY-DHC7I6xa.js";import"./vec33-CWJeyzxV-Me4sF5XB.js";import"./utils-DTE-xBiC-uxMmcNif.js";import"./geodeticLengthOperator-ysQZ6ofQ-CX26XL0i.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./lineStippleUtils-CCavR4OV-DESXkwZW.js";import"./EngineVisualElement-DP9Jiq6V-BhC9DiP0.js";import"./LaserlinePath.glsl-DfE4imRj-B0vl76WV.js";import"./triangulationUtils-D34y65Gu-uORqNaLm.js";import"./earcut-D9gy186--DqxOpTir.js";import"./distanceOperator-DGmm_87g-DnhsW2Ef.js";import"./Point2D-CMz7woHH-BVbGGL7p.js";import"./ProjectionTransformation-PJc9H7Gq-Rbz84pUM.js";import"./Envelope2D-mFnl8dXR-MYac-bfa.js";import"./jsonConverter-DmBmaSz7-DAl7KiR-.js";import"./simplifyOperator-bRe3zzdW-Ci0cJetU.js";import"./mat2d-DlTglBkI--S7WYOjk.js";import"./mat2df64-DFLy2zOC-BU6AmJok.js";import"./Basemap-CL_uaRmk-ChnHJfg0.js";import"./PortalItem-DnxMlRVo-Dhq4alsp.js";import"./writeUtils-DEFpwIW1-D44H3UWs.js";import"./resourceExtension-DOTCeiZj-BXiJr75H.js";import"./PolygonCollection-HNNpnBH7-C5NQ6xHr.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./getPopupProvider-CmskPttI-C4PqyuPF.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./PictureMarkerSymbol-CaSh-vZk-BNpExnAb.js";import"./TextSymbol-hRGhyDHs-C0NgASym.js";import"./SketchOptions-Dguq2sp8-DmrYxGLA.js";import"./reader-DcGs6kKN-DHJfK-tm.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./aaBoundingRect-CjwcS2F3-D7aII9DY.js";import"./TileKey-CXWFOqOI-CcilLir8.js";import"./jsonUtils-CmpazY1u-ateEpj4Q.js";import"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./projectPointToVector-DL7Z4uvb-BbcUuq8O.js";import"./scaleUtils-yfx9kKWT-BPfZ-Fh2.js";import"./layerUtils-DZGhvm-W-DLw3QMll.js";import"./tagSymbols-BPcGfZon-BPcGfZon.js";import"./Queue-CYlrXMwB-CYJTUII-.js";import"./signal-BX9ezF8a-cf1Pn6io.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./ReactiveMap-B0by2bYu-DCsCfMj5.js";import"./TablesMixin-Q80MT3nU-CFBTh0j7.js";import"./plane-BNdSPG2o-Cq7jmU6w.js";import"./enums-B4pqBiXb-BO-3hS_8.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./VertexElementDescriptor-BlxU8vCE-BwuKQkTU.js";import"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import"./computeTranslationToOriginAndRotation-Bjd4esRf-CXUng2L4.js";import"./layerViewUtils-BTa15X3o-BjQlX2q8.js";import"./dehydratedFeatures-Ql-uVzLq-DehgeO5I.js";import"./quantizationUtils-Ceq-Uxsu-CDK8m1qL.js";import"./featureConversionUtils-BDA_FXJx-CUwkrHf5.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./HUDIntersectorResult-1xTExS7z-CU1-YQoW.js";import"./DefaultLoadingContext-DXgBe4GE-Colk9t6X.js";import"./wosrLoader-CIPfz1Cl-qtGxLmBP.js";import"./Version-BtYZEj58-LyRHDnSJ.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./config-Dg972SSE-D9DBKeq5.js";import"./GeometryUtils-C354xUs0-CG8X9WjO.js";import"./definitions-Dvg4hMIw-CdK2DzFN.js";import"./WorkerHandle-B930SiRy-b7IwaSpV.js";import"./colorUtils-CeIi7j7j-nwrKvQYb.js";import"./capabilities-Bi6C4OG6-CpURufko.js";import"./imageUtils-142g71N8-CjUugWaS.js";import"./videoUtils-Dwx3AEgj-CduhpDRk.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./quickselect-QQC62dOK-Br2Ahhru.js";import"./meshVertexSpaceUtils-CtG7DPVT-V_uCtHpB.js";import"./Intersector-DS9YtyQY-CuzM48xl.js";import"./loadAll-BCyxerwc-DK9uHnLK.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./persistable-CdoDQOTR-CH9U-JJT.js";import"./MD5-MtSiOt06-jWr180Yc.js";import"./multiOriginJSONSupportUtils-C0wm8_Yw-DH8sdIsE.js";import"./utils-CylVuxNi-CqOfmBVG.js";import"./utils-Dpg4yj1D-BVnuoMV8.js";import"./types-BKo2foNY-DE0QfIFp.js";import"./labelUtils-BtizwBfq-Zegx4520.js";import"./ArcadeExpression-BlIRq-oN-DGzfhzBj.js";import"./TimeOnly-BERR31kg-PKcKegNB.js";import"./enum-BzLwmiID-CcyIdWlQ.js";import"./FieldsIndex-CimK-TqD-CrSnohIk.js";import"./geometry2dUtils-B4vDf2wH-D5Eyn-ve.js";import"./line-DShd3yGd-Vds7wO8W.js";import"./line-CgFvXjo5-DqgBHZMR.js";import"./BlendLayer-HE_aYHHW-CZa4IAJu.js";import"./layerContainerType-CSXZNpHb-BIF7XAYP.js";import"./jsonUtils-CY6YsQMo-SliJcuqs.js";import"./ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js";import"./automaticAreaMeasurementUtils-L66brXzH-PvNPZ2Ew.js";import"./geodesicAreaMeasurementUtils-DMf2sF8v-BTVCK7aY.js";import"./automaticLengthMeasurementUtils-O6uwtXFm-C_BY4_yv.js";import"./geodeticCurveType-CirnHLSB-CirnHLSB.js";import"./VisualElement-By4iq8p4-ZBataKFH.js";import"./deduplicate-Lzwo1kX7-CSf-1ZcR.js";import"./Distance2DCalculator-CXhBP-8I-BMMI87Nn--mnz8rUK.js";import"./apiConverter-BAgvri9D-CJVft-_U.js";import"./Transformation2D-CrydmBdC-D4jE8w-_.js";import"./SimpleGeometryCursor-B92kdZ15-B1Z6elF7.js";import"./OperatorDefinitions-DP7_WWTp-DP7_WWTp.js";import"./operatorSimplify-5A_MmN4K-aDmNvEee.js";const Ze=(e,t=Ze,i=t.f||(t.f=["assets/lengthOperator-qjwwYihz.js","assets/Point-BfTTZoMu.js","assets/jsonMap-Bs3hmeCU.js","assets/reader-DcGs6kKN.js","assets/index-BzxsWNRw.js","assets/index-Cv2ko1Ob.css","assets/Point2D-CMz7woHH.js","assets/Envelope2D-mFnl8dXR.js","assets/ProjectionTransformation-PJc9H7Gq.js","assets/Transformation2D-CrydmBdC.js","assets/SimpleGeometryCursor-B92kdZ15.js","assets/OperatorDefinitions-DP7_WWTp.js","assets/Extent-CgDMOSRD.js","assets/Polyline-CoiTLswR.js","assets/Polygon-D6wEPb3W.js","assets/aaBoundingRect-CjwcS2F3.js","assets/mathUtils-PIGhLnI9.js","assets/jsonConverter-DmBmaSz7.js","assets/apiConverter-BAgvri9D.js"]))=>e.map(s=>i[s]);function D(e,t){let i,s=!1;function o(...r){const n=e.apply(this,r);return s&&i!==void 0&&t?.(i,n)?i:(s=!0,i=n,n)}return o}function Ne(e){return e?.map?.allLayers?.toArray().filter(t=>(t.type!=="graphics"||!t.internal)&&t.visible).map(t=>t.uid)??[]}let Be={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Be.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:pe(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function A(){return Be}const ui={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};let ie=class extends mt{constructor(e,t,i){super(e,t,i),this.name="unknown",this.name=e}},ae=class extends ie{constructor(){super("too-complex","The input geometry has too many points.")}},We=class extends ie{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class ci extends ie{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let hi=class extends ie{constructor(){super("unknown","Unknown error.")}};async function mi(e,t,i,s,o,r,n){let l,u,c;const h=e.spatialReference,d=h.isGeographic||h.isWebMercator;let m=0;if(!d){const{execute:v}=await nt(()=>rt(()=>import("./lengthOperator-qjwwYihz-Cy00HIFY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(_=>_.l),Ze([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]));L(n),m=v(e,{unit:"meters"}),L(n)}const y=1/B(s);if(d){await Ee([{source:h,dest:s},{source:h,dest:Me.WGS84}],n);const v=xi(e);l=Zt([v],"meters")[0];const _=De(l,o);if(ke(e,l,_)>r)throw new ae;const f=Re(v,t,i);({densifiedPath:u,distances:c}=wi(f,_,y)),u=me(u,s)}else{await Ee([{source:h,dest:s}],n),l=m;const v=De(l,o);if(ke(e,l,v)>r)throw new ae;const _=Re(e,t,i);({densifiedPath:u,distances:c}=_i(_,v,y)),L(n),u=me(u,s)}return{densifiedPath:u,pathLength:l*y,distances:c}}function De(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function Re(e,t,i){if(t==null)return xe(e);const s=e.spatialReference,o=t.mode,r=$t(t,s);let n=null;switch(i.type){case"2d":n=di(e,o,r);break;case"3d":n=yi(e,o,r,i)}return n==null?xe(e):new ye({hasZ:!0,hasM:!1,spatialReference:s,paths:Qe(e.paths,n)})}function di({hasZ:e},t,i){return t==="absolute-height"?e?([s,o,r])=>[s,o,r+i]:([s,o])=>[s,o,i]:null}function yi({spatialReference:e,hasZ:t},i,s,{elevationProvider:o}){const r=(n,l,u,c)=>o?.getElevation(n,l,u,e,c)??0;switch(i){case"on-the-ground":return([n,l])=>[n,l,r(n,l,0,"ground")];case"absolute-height":return t?([n,l,u])=>[n,l,u+s]:([n,l])=>[n,l,s];case"relative-to-ground":return t?([n,l,u])=>[n,l,u+r(n,l,u,"ground")+s]:([n,l])=>[n,l,r(n,l,0,"ground")+s];case"relative-to-scene":return t?([n,l,u])=>[n,l,u+r(n,l,u,"scene")+s]:([n,l])=>[n,l,r(n,l,0,"scene")+s];default:return null}}function xe(e){return e.hasZ?new ye({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:Qe(e.paths,([t,i])=>[t,i])}):e}function Qe(e,t){const i=e.length,s=new Array(i);for(let o=0;o<i;++o){const r=e[o],n=r.length,l=new Array(r.length);s[o]=l;for(let u=0;u<n;++u)l[u]=t(r[u])}return s}function Xe(e){return ge(e)&&e.paths.some(t=>t.length>1)}function fi(e){return vi(e)&&Xe(e.geometry)}function vi(e){return Je(e)&&ge(e?.geometry)}function ge(e){return!Je(e)&&e!=null&&e.type==="polyline"}function Je(e){return e!=null&&"geometry"in e}function gi(e){const t=e?.layer;return t!=null&&t.type==="graphics"&&t.internal}function Ke(e,t,i,s,o){const{spatialReference:r,hasZ:n}=e,l={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:r,metersPerSR:B(r)},u=[],c=[];let h=0;for(let d=0;d<e.paths.length;++d){const m=e.paths[d],y=new Array,v=new Array;let _=0;for(let f=1;f<m.length;++f){const w=m[f-1],E=m[f],C=s(l,w,E);let x;for(x=_;x<C.distance&&!qt(x,C.distance);x+=t)y.push(o(C,x)),v.push((h+x)*i);_=x-C.distance,h+=C.distance,y.push(E),v.push(h*i)}u[d]=y,c[d]=v}return{densifiedPath:new ye({spatialReference:r,hasZ:n,paths:u}),distances:c}}function _i(e,t,i){const{hasZ:s}=e;return Ke(e,t,i,Pi,s?Ri:Di)}function wi(e,t,i){const{hasZ:s}=e;return Ke(e,t,i,bi,s?Ei:Si)}function bi(e,t,i){return e.distance=0,Bt(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function Pi(e,t,i){return e.from=t,e.to=i,e.distance=jt(i,t)*e.metersPerSR,e}function Si({from:e,azimuth:t,spatialReference:i},s){return Ae([0,0],e,t,s,i)}function Ei({from:e,to:t,azimuth:i,distance:s,spatialReference:o},r){const n=r/s,l=[0,0,He(e[2],t[2],n)];return Ae(l,e,i,r,o),l}function Di({from:e,to:t,distance:i},s){return Ut([0,0],e,t,s/i)}function Ri({from:e,to:t,distance:i},s){return Rt([0,0,0],e,t,s/i)}function xi(e){return Nt(e.spatialReference)?e:me(e,Me.WGS84)}function Ye(e){return e.paths.reduce((t,i)=>t+i.length,0)}function ke(e,t,i){return Ye(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce(s=>1+s,0)-1)}function ki(e,t){const i=e.length;if(i===0)return null;const s=e[0],o=s.sampledZ;let r=o,n=o,l=0,u=0,c=null,h=null,d=o??0,m=0,y=0,v=o!=null?1:0,_=0,f=0;const w=B(t),E=N(t),C=A().minSlopeSampleDistance/w,x=2*C,W=new Ce,O=new Ce,ue=()=>{ot(),W.copy(O),O.reset()},we=(V,K)=>{ue(),V>0&&V-W.start<=x&&(V=W.start+C),O.restart(V,K)},ot=()=>{if(W.isHole||O.isHole)return;const V=O.avgElevation-W.avgElevation,K=O.start-W.start,Y=V*E,$=K*w,q=pe(Math.atan2(Y,$),"radians","degrees");q>0?(m+=q,c=H(c,q),_++):q<0&&(y-=q,h=H(h,-q),f++)};s.sampledZ!=null&&we(s.distance,s.sampledZ);for(let V=1;V<i;++V){const K=e[V-1],Y=e[V],$=Y.sampledZ;if($==null){O.isHole||ue();continue}v++,d+=$,r=_e(r,$),n=H(n,$),O.isHole||Y.distance-O.start>=C?we(Y.distance,$):O.insert($);const q=K.sampledZ;if(q!=null){const se=$-q;se>0?l+=se:se<0&&(u-=se)}}return ue(),v===0?null:{maxDistance:e[i-1].distance,minElevation:r,maxElevation:n,avgElevation:v===0?null:d/v,elevationGain:l,elevationLoss:u,maxPositiveSlope:c,maxNegativeSlope:h,avgPositiveSlope:_===0?null:m/_,avgNegativeSlope:f===0?null:y/f}}function Ci(e){const t=e.filter(Ge),i=t.length;if(i===0)return null;const s=t[0];if(i===1)return s;let o=s.maxDistance,r=s.minElevation,n=s.maxElevation,l=s.maxPositiveSlope,u=s.maxNegativeSlope;for(let c=1;c<t.length;++c){const h=t[c];o=H(o,h.maxDistance),r=_e(r,h.minElevation),n=H(n,h.maxElevation),l=H(l,h.maxPositiveSlope),u=H(u,h.maxNegativeSlope)}return{maxDistance:o,minElevation:r,maxElevation:n,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:l,maxNegativeSlope:u,avgPositiveSlope:null,avgNegativeSlope:null}}function Vi(e){let t=null,i=null,s=null;for(const o of e){if(o==null)continue;const{statistics:r,spatialReference:n}=o;if(r==null)continue;const l=B(n);t=H(t,he(r.maxDistance,l));const u=N(n);s=_e(s,he(r.minElevation,u)),i=H(i,he(r.maxElevation,u))}return{minDistance:0,maxDistance:t??0,minElevation:s??0,maxElevation:i??0}}function _e(e,t){return t==null?e:e!=null?Math.min(e,t):t}function H(e,t){return t==null?e:e!=null?Math.max(e,t):t}function he(e,t){return e!=null&&t!=null?e*t:null}let Ce=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,t){this._start=e,this._sampleCount=1,this._totalElevation=t}insert(e){++this._sampleCount,this._totalElevation+=e}};function Ii(e,t,i=[]){if(e>=t||(i.push(e),t-e<2))return i;const s=t-1;i.push(s);const o=de(e+1,s);for(;;){const r=o.next();if(r.done)break;i.push(r.value)}return i}function*de(e,t){if(e>=t)return;const i=e+Math.floor((t-e)/2);yield i;const s=de(e,i),o=de(i+1,t);for(;;){const r=s.next(),n=o.next();if(r.done&&n.done)break;r.done||(yield r.value),n.done||(yield n.value)}}async function*Ti(e,t){const{view:i,geometry:s,elevationInfo:o,providers:r,options:n}=e,l=i.spatialReference;if(!l||s==null||!Xe(s))throw new We;const u=r.length;if(u===0)return null;const c=Math.round(n.maxTotalSamples/u);if(Ye(s)>c)throw new ae;const h=await mi(s,o,i,l,n,c,t);L(t);let d=0;const m=new Array(u),y=new Array(u);for(let f=0;f<u;f++){const w=$i(h);m[f]=w,d+=w.samples.length;const E={...e,provider:r[f],result:w,densificationResult:h};y[f]=Gi(E,t)[Symbol.iterator]()}if(d>n.maxTotalSamples)throw new ae;const v=await Promise.all(y.map(f=>{const w=f.next();return w.done===!0?Promise.resolve(null):w.value}));L(t);for(let f=0;f<u;f++)m[f]=v[f];yield m,await ht(e.delayAfterPreview??A().delayAfterPreviewMillis,null,t.signal),L(t);const _=[];try{let f;do{f=!1;for(let w=0;w<u;w++){const E=y[w].next();E.done===!1&&(_.push({resultPromise:E.value,index:w}),f=!0)}}while(f)}finally{y.forEach(f=>f.return?.())}for(const{resultPromise:f,index:w}of _)m[w]=await f,L(t),yield m;for(const f of m)f!=null&&(f.progress=1);yield m}function*Gi(e,t){const{densificationResult:i}=e,s={...e,abortOptions:t,densificationResult:i},o=Ii(0,s.result.samples.length),r=o.slice(0,s.provider.numSamplesForPreview);yield Ve(s,r,!0);const n=ft(o,s.provider.numSamplesPerChunk);for(const l of n)yield Ve(s,l,!1)}async function Ve({densificationResult:e,result:t,provider:i,queue:s,abortOptions:o,cache:r},n,l){const{densifiedPath:u,pathLength:c}=e,h=t.spatialReference,{samples:d}=t,m=[];for(let y=0;y<n.length;y++){const v=d[n[y]];m[y]=[...v.coordinate]}try{return await s.push({geometry:new Ht({spatialReference:h,points:m,hasZ:u.hasZ}),provider:i,indices:n,preview:l,result:t,parameters:{...A().defaultQueryOptions(),minDemResolution:Math.round(l?c/i.numSamplesForPreview:c/d.length),cache:r}},o),{...t}}catch(y){return vt(y)?null:ui}}function Oi(e){return new Wt({priority:Qt.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{L(t.parameters);try{await Mi(t)}catch(i){ct(i)}}})}async function Mi({geometry:e,provider:t,indices:i,preview:s,result:o,parameters:r}){if(i.length===0)return;const n=(await Ai(t,e,r)).geometry,{hasZ:l,points:u}=n,c=r.noDataValue,{samples:h}=o;for(let d=0;d<i.length;d++){const m=h[i[d]];if(m.isHole)continue;const y=l?u[d][2]:null;y===null||y===c?m.sampledZ=null:(o.hasZ=!0,m.sampledZ=y),m.sampled=!0}zi(h),o.progress=s?0:o.progress+i.length/h.length,o.statistics=ki(o.samples,o.spatialReference)}function zi(e){const t=e.length-1;let i=0;for(let s=1;s<=t;s++)(e[s].sampled||s===t)&&(Li(e,i,s),i=s)}function Li(e,t,i){if(i-t===1)return;const s=e[t],o=s.sampledZ,r=e[i],n=r.sampledZ;if(o==null||n==null){for(let c=t+1;c<i;c++)e[c].sampledZ=null;return}const l=s.distance,u=r.distance-l;for(let c=t+1;c<i;c++){const h=e[c],d=(h.distance-l)/u;h.sampledZ=He(o,n,d)}}function $i({densifiedPath:e,distances:t}){const i=e.spatialReference,s=bt(i),o=e.paths,r=o.length,n=[];let l=null,u=0;for(let c=0;c<r;c++){const h=o[c],d=h.length,m=t[c];for(let y=0;y<d;y++){const v=h[y],_=m[y];s&&(v[0]=At(v[0],s.valid[0],s.valid[1])),l&&y===0&&qi(n,l,v,u,_),n.push(Hi(v,_)),l=v,u=_}}return{progress:0,samples:n,hasZ:!1,statistics:null,spatialReference:i}}function qi(e,t,i,s,o){e.push(Ie(t,s)),e.push(Ie(i,o))}function Hi(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Ie(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Ai(e,t,i){try{return await e.queryElevation(t,i)}catch{throw new ci}}function ji(e,t,i){if(!e||e.length===0)return;const s=e.length-1,o=e[0];if(t<=i(o))return o;const r=e[s];if(t>=i(r))return r;let n=0,l=0,u=s;for(;n<u;){l=n+Math.floor((u-n)/2);const c=e[l],h=i(c);if(h===t)return c;if(t<h){if(l>0){const d=e[l-1],m=i(d);if(t>m)return t-m>=h-t?c:d}u=l}else{if(l<s){const d=e[l+1],m=i(d);if(t<m)return t-h>=m-t?d:c}n=l+1}}return e[l]}function et(e){return e>.999999?1:e}function Ui(e,t){if(e==null||t==null)return null;const{samples:i,spatialReference:s}=e,{distance:o,elevation:r}=t,n=B(s),l=N(s),u=i.length,c=new Array(u);for(let h=0;h<u;++h){const d=i[h],m=d.sampledZ,y=d.coordinate;c[h]={x:y[0],y:y[1],z:m,distance:tt(d.distance,n,o),elevation:Q(m,l,r)}}return c}function Fi(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;const{distance:i,elevation:s}=t,{statistics:o,spatialReference:r}=e,n=B(r),l=N(r);return{maxDistance:tt(o.maxDistance,n,i),minElevation:Q(o.minElevation,l,s),maxElevation:Q(o.maxElevation,l,s),avgElevation:Q(o.avgElevation,l,s),elevationGain:Q(o.elevationGain,l,s),elevationLoss:Q(o.elevationLoss,l,s),maxPositiveSlope:o.maxPositiveSlope,maxNegativeSlope:o.maxNegativeSlope,avgPositiveSlope:o.avgPositiveSlope,avgNegativeSlope:o.avgNegativeSlope}}function tt(e,t,i){return e==null?null:pe(e*t,"meters",i)}function Q(e,t,i){return e==null?null:pe(e*t,"meters",i)}let I=class extends xt{constructor(e){super(e),this._getSamplesMemoized=Se((t,i)=>Ui(t,i)),this._getStatisticsMemoized=Se((t,i)=>Fi(t,i)),this.rawResult=null}get available(){const{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return et(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;const{rawResult:t,samples:i}=this;if(i==null||t==null)return null;const s=i.length;if(s===0)return null;const o=i[s-1].distance,r=ji(i,e*o,c=>c.distance);if(r==null)return null;const{x:n,y:l,z:u}=r;return u==null?null:new Pt({x:n,y:l,z:u,spatialReference:t.spatialReference})}};a([p()],I.prototype,"available",null),a([p({readOnly:!0})],I.prototype,"profile",null),a([p({readOnly:!0})],I.prototype,"progress",null),a([p()],I.prototype,"samples",null),a([p()],I.prototype,"statistics",null),a([p({constructOnly:!0})],I.prototype,"computation",void 0),a([p()],I.prototype,"rawResult",void 0),a([p()],I.prototype,"hoveredPoint",null),I=a([R("esri.views.analysis.ElevationProfile.ElevationProfileResult")],I);let S=class extends j{constructor(e){super(e),this.result=new I({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([P(()=>{const{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),le)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return A().defaultDemResolution}};a([p({constructOnly:!0})],S.prototype,"controller",void 0),a([p({constructOnly:!0})],S.prototype,"profile",void 0),a([p({constructOnly:!0})],S.prototype,"onInvalidate",void 0),a([p()],S.prototype,"result",void 0),a([p({readOnly:!0})],S.prototype,"progress",null),a([p()],S.prototype,"hoveredPoint",null),a([p()],S.prototype,"available",null),a([p()],S.prototype,"numSamplesForPreview",void 0),a([p()],S.prototype,"numSamplesPerChunk",void 0),a([p({readOnly:!0})],S.prototype,"minDemResolution",null),S=a([R("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],S);const Zi=2e5;let M=class extends S{constructor(){super(...arguments),this.type="scene",this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getStableElevationDependencies=D(()=>{const e=this._view;return e?{view:e,stationary:e.stationary,geometry:this.controller?.analysis.geometry,visibleLayerIds:this._getStableLayerIds(),maxIntersectionDistance:this._maxIntersectionDistance,intersectOptions:this._intersectOptions,spatialReference:this._getStableSpatialReference()}:null},G),this._getStableSpatialReference=D(()=>this._view?.spatialReference,re),this._getStableLayerIds=D(()=>Ne(this._view),G),this._getStablePointCloudLayers=D(()=>{const e=this._view;return e?e.allLayerViews.toArray().filter(t=>t.layer?.type==="point-cloud").map(t=>t.layer):[]},G),this._vecA=be(),this._vecB=be(),this._ray=kt()}get minDemResolution(){const e=this._view;if(!e)return null;const t=e.pointsOfInterest?.focus?.worldUnitsPerContentPixel;return t==null?null:t*N(e.spatialReference)}initialize(){const e=()=>this.onInvalidate(this);return this.addHandles([P(()=>this._queryElevationDependencies,e,le),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:i}){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const o=this._intersector;if(o==null)throw new Error(`${this.declaredClass}: no view`);const{intersectOptions:r,view:n,spatialReference:l}=s,u=n.renderCoordsHelper,c=n.sceneIntersectionHelper,h=this._vecA,d=this._vecA,m=this._vecB,y=this._ray;if(!l)return{geometry:e,noDataValue:t};const v=await Le.fromGeometry(e).project(l,i);if(!v)return{geometry:e,noDataValue:t};const _=v.coordinates,f=_.length;for(let w=0;w<f;++w){const E=_[w];Dt(m,E.x,E.y,E.z??0),u.toRenderCoords(m,l,m),u.setAltitude(h,Zi,m);const C=Ct(h,m,y);c.computeIntersection(C,o,!0,r);const x=Ni(s,o.results.all);x?(x.getIntersectionPoint(d),u.fromRenderCoords(d,d,l),E.z=d[2]):E.z=t}return{geometry:v.export(),noDataValue:t}}get _queryElevationDependencies(){return this._getStableElevationDependencies()}get _intersectOptions(){const e=this._view;if(!e||e.destroyed)return{};const{include:t,exclude:i}=this.profile;return It(e,{include:t,exclude:[...this._pointCloudLayers,...pt(i)?i:i?[i]:[]]})}get _pointCloudLayers(){return this._getStablePointCloudLayers()}get _view(){const e=this.controller.view;return e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e?.renderCoordsHelper?wt(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(!e)return null;const t=new Ot(e.state.viewingMode),i=t.options;return i.hud=!1,i.invisibleTerrain=!1,i.backfacesTerrain=!1,i.selectionMode=!1,i.store=2,t}};function Ni({intersectOptions:e,maxIntersectionDistance:t,view:i},s){const o=e.graphics,r=!(!o?.include&&!o?.exclude);for(const n of s)if(n.withinDistance(t)){if(r){const l=Mt(n,i);if(l!=null&&!Tt(o,l))continue}return n}return null}a([p({readOnly:!0})],M.prototype,"minDemResolution",null),a([p()],M.prototype,"_queryElevationDependencies",null),a([p()],M.prototype,"_intersectOptions",null),a([p()],M.prototype,"_pointCloudLayers",null),a([p()],M.prototype,"_view",null),a([p()],M.prototype,"_maxIntersectionDistance",null),a([p()],M.prototype,"_intersector",null),M=a([R("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineSceneComputation")],M);function Bi(e){return Oe([P(()=>{const{analysis:t,sketchGraphic:i,toolState:s,visible:o}=e.analysisViewData,{geometryVisualizationVisible:r}=t.viewOptions;return{geometryVisualizationVisible:r,geometry:t.geometry,sketchGraphic:i,toolState:s,visible:o}},({geometryVisualizationVisible:t,sketchGraphic:i,toolState:s,visible:o})=>{if(e.remove(),o)return t&&i!=null&&s!=="reshaping"&&s!=="sketching"?e.show(i):void 0},k)])}let X=class extends j{constructor(e){super(e),this._visualElementHandle=null}initialize(){this._settings=new Xt({getTheme:()=>this.view.effectiveTheme}),this.addHandles(Bi({analysisViewData:this.analysisViewData,remove:()=>this._remove(),show:e=>this._show(e)}))}destroy(){this._remove()}get updating(){return!1}_remove(){this._visualElementHandle=dt(this._visualElementHandle)}_show(e){this._remove();const{view:t}=this,i=new je({view:t,geometry:this.analysisViewData.analysis.geometry,attached:!1,renderOccluded:8,isDecoration:!0}),s=[P(()=>this.analysisViewData.analysis.elevationInfo,o=>{i.elevationInfo=o,i.isDraped=zt(!0,o)==="on-the-ground"},k),P(()=>this.analysisViewData.analysis.geometry,o=>{i.geometry=o}),t.maskOccludee(e),yt(i)];this._settings.visualElements.lineObjects.outline.apply(i),i.attached=!0,this._visualElementHandle=Oe(s)}};a([p({constructOnly:!0})],X.prototype,"view",void 0),a([p({constructOnly:!0})],X.prototype,"analysisViewData",void 0),a([p()],X.prototype,"updating",null),X=a([R("esri.views.3d.analysis.ElevationProfile.ElevationProfileGeometryVisualization3D")],X);function Wi(e,t){e??=[];const i=e.length-1,s=[];let o=[];for(let r=0;r<=i;r++){const{x:n,y:l,z:u}=e[r];u!=null&&o.push([n,l,u]),r!==i&&u!=null||!o.length||(s.push(o),o=[])}return Yt(s,t,!0)}let z=class extends j{constructor(e){super(e),this._updateGeometryThrottled=Ue(t=>{if(!t)return;const{samples:i,spatialReference:s}=t,o=i!=null&&i.length>0;this._visualElement.geometry=o?Wi(i,s):null},A().profileLinesUpdateThrottleMillis)}initialize(){this._visualElement=new je({view:this.view,elevationInfo:qe,innerWidth:0,innerColor:Jt(0,0,0,0),width:3,falloff:0,renderOccluded:16,isDecoration:!0}),this.addHandles([P(()=>({color:this._result?.computation.profile.color,visible:this._effectiveVisible}),({color:e,visible:t})=>{e&&(this._visualElement.color=Kt(fe.toUnitRGBA(e))),this._visualElement.visible=t},k),P(()=>this.analysisViewData.analysis.geometry,()=>{this._visualElement.geometry=null},k),P(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),k),this._updateGeometryThrottled])}destroy(){this._visualElement.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){const{analysisViewData:e,_result:t}=this;return e.visible&&t!=null&&t.available&&t.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){return this._effectiveVisible&&this.analysisViewData.progress!==1?null:{samples:this._result?.samples,spatialReference:this.view.spatialReference}}};a([p()],z.prototype,"view",void 0),a([p()],z.prototype,"analysisViewData",void 0),a([p()],z.prototype,"getResult",void 0),a([p()],z.prototype,"updating",null),a([p()],z.prototype,"_result",null),a([p()],z.prototype,"_effectiveVisible",null),a([p()],z.prototype,"_geometryUpdateParameters",null),z=a([R("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineVisualization3D")],z);let U=class extends j{constructor(e){super(e),this.position=null,this.color=new fe("#ffffff"),this.element=Qi()}initialize(){this.addHandles([P(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},k),P(()=>this.color.toCss(),e=>{this.element.style.background=e},k)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:e,view:t}=this;t.type==="3d"?(t.commitProperty("size"),t.commitProperty("camera")):t.commitProperty("center");const i=t?.spatialReference,s=i?Ft(e,i).geometry:null;return s&&t?.ready?t.toScreen(s):null}};function Qi(){const e=document.createElement("div"),{size:t,borderStyle:i,borderColor:s,borderWidth:o,boxShadow:r}=A().hoveredPointsStyle,{style:n}=e;return n.display="block",n.position="absolute",n.top="0",n.left="0",n.contain="strict",n.boxSizing="border-box",n.width=`${t}px`,n.height=`${t}px`,n.marginTop=`-${t/2}px`,n.marginLeft=`-${t/2}px`,n.border=`${i} ${o}px ${s}`,n.borderRadius=`${t}px`,n.boxShadow=r,e}a([p()],U.prototype,"position",void 0),a([p({type:fe})],U.prototype,"color",void 0),a([p()],U.prototype,"view",void 0),a([p()],U.prototype,"_screenLocation",null),U=a([R("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],U);let F=class extends j{constructor(e){super(e),this._hoveredPoints=new ze}initialize(){const{analysisViewData:e}=this,{analysis:t}=e;this.addHandles([P(()=>{const{hoveredPoints:i,visible:s,updating:o}=e;return s?o?null:i.map((r,n)=>{const l=t.profiles.at(n);return l?.viewOptions.hoveredPointVisible===!0&&r!=null?{hoveredPoint:r,color:l.color}:null}).filter(r=>!!r):[]},i=>this._update(i),k),P(()=>t.geometry,()=>this._update([]),k)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;const{view:t,_hoveredPoints:i}=this,s=e.length;for(;i.length>s;)i.pop()?.destroy();for(;i.length<s;){const o=new U({view:t});i.push(o)}for(let o=0;o<s;++o){const r=e[o],n=i.at(s-1-o);n.position=r.hoveredPoint,n.color=r.color}}};a([p()],F.prototype,"view",void 0),a([p()],F.prototype,"analysisViewData",void 0),a([p()],F.prototype,"_hoveredPoints",void 0),a([p()],F.prototype,"updating",null),F=a([R("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],F);let J=class extends j{constructor(e){super(e)}initialize(){const{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new F({view:e,analysisViewData:t}),this._geometryVisualization=new X({view:e,analysisViewData:t}),this._lineVisualizations=$e(()=>this.analysisViewData.analysis.profiles,i=>new z({view:e,analysisViewData:t,getResult:()=>t.results.find(s=>s.computation.profile===i)}))}destroy(){this._geometryVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy()}get updating(){return this._geometryVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};a([p()],J.prototype,"view",void 0),a([p()],J.prototype,"analysisViewData",void 0),a([p()],J.prototype,"updating",null),J=a([R("esri.views.3d.analysis.ElevationProfile.ElevationProfileVisualization3D")],J);let g=class extends j{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=D(()=>{const t=Vi(this._activeComputations.map(o=>o.result.rawResult)),i=this.analysis.displayUnits,s=ti(this.view);return{distance:Et(t.maxDistance,"meters",i.distance??s),elevation:St(t.maxElevation,"meters",i.elevation??s)}},G),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=D(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),G),this._getStableGenerationParameters=D(()=>{const{view:t,analysis:i}=this;return t?.ready&&this._queue?{view:t,geometry:i.geometry,geometryIsValid:i.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:t.type==="3d"?t.slice.plane:null}:null},G),this._getStableElevationInfo=D(()=>this.analysis.elevationInfo??Xi,re),this._getStableOptions=D(()=>{const{densificationMaxSamples:t,defaultDemResolution:i,maxTotalSamples:s}=A();let o=this._minDemResolution??i;return o=parseFloat(o.toFixed(2)),{samplingDistance:o,densificationMaxSamples:Math.round(t/this._activeComputations.length),maxTotalSamples:s}},G),this._updateThrottled=Ue(t=>this._update(t),A().updateThrottleMillis)}initialize(){this._computationsCollection=$e(()=>this.analysis.profiles,t=>this.computationFactory.create({controller:this,profile:t,onInvalidate:i=>this._invalidateComputation(i)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),P(()=>this._updateParameters,t=>this._updateThrottled(t),k),this._updateThrottled]);const e=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=Oi(e?.scheduler),e?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=oe(this._queue),this._currentTileCache=oe(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(const i of this._activeComputations)e++,t+=i.progress;return et(e>0?t/e:0)}get updating(){const{progress:e}=this,t=!!this._queue?.updating,i=this._updateThrottled.hasPendingUpdates(),s=this._updateTask!=null&&!this._updateTask.finished;return t||i||s||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return Ci(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){const{view:t}=this;return t?.type==="3d"?_t(()=>t.elevationProvider,"elevation-change",e,{onListenerAdd:e,onListenerRemove:e}):ee()}get _tileCache(){this._currentTileCache=oe(this._currentTileCache);const e=this.view;if(e?.type==="3d"){const t=e.basemapTerrain?.elevationQueryCache;if(t!=null)return t}return this._currentTileCache==null&&(this._currentTileCache=new Vt(new ei(20971520))),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){const e=this._minDemResolutions;return e.length>0?Te(e):null}get _minDemResolutions(){const e=[];for(const{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:i}){this._abortUpdate(),e&&(i!=null?this._updateTask=Fe(async s=>{this.error=null;const o=t.filter(r=>!this._isComputationValid(r,i));try{if(!i.geometryIsValid)throw new We;const r=Ti({...i,providers:o},{signal:s});let n=!1;for await(const l of r){L(s),n||(this._clearInvalidResults(i),n=!0);for(let u=0;u<o.length;u++)o[u].setResult(l[u])}for(const l of o)this._parametersPerComputation.set(l,i)}catch(r){at(r),this._abortUpdate(),this.error=r instanceof ie?r:new hi,o.forEach(n=>{n.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=lt(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(const e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};a([p({constructOnly:!0})],g.prototype,"analysis",void 0),a([p({constructOnly:!0})],g.prototype,"analysisViewData",void 0),a([p({constructOnly:!0})],g.prototype,"computationFactory",void 0),a([p({constructOnly:!0})],g.prototype,"view",void 0),a([p()],g.prototype,"error",void 0),a([p({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),a([p()],g.prototype,"progress",null),a([p()],g.prototype,"updating",null),a([p()],g.prototype,"results",null),a([p()],g.prototype,"statistics",null),a([p()],g.prototype,"hoveredPoints",null),a([p()],g.prototype,"_updateTask",void 0),a([p()],g.prototype,"_queue",void 0),a([p()],g.prototype,"_tileCache",null),a([p()],g.prototype,"_computationsCollection",void 0),a([p()],g.prototype,"_computations",null),a([p()],g.prototype,"_activeComputations",null),a([p({readOnly:!0})],g.prototype,"_minDemResolution",null),a([p()],g.prototype,"_minDemResolutions",null),a([p()],g.prototype,"_updateParameters",null),a([p()],g.prototype,"_generationParameters",null),a([p()],g.prototype,"elevationInfo",null),a([p()],g.prototype,"_options",null),g=a([R("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const Xi=new ve({...qe});function it(e){if(e==null)return null;if(ii(e))return st(e);const t=e.tileInfo;if(t==null)return null;const i=t.lods?.at(-1);return i==null?null:i.resolution*B(t.spatialReference)}function st(e){if(e==null)return null;const t=e.layers.items.map(Ji).filter(Ge);return Te(t)??null}function Ji(e){return e&&"tileInfo"in e?it(e):null}let Z=class extends S{constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=D(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),G),this._getStableGroundLayers=D(()=>this._ground?.layers?.toArray(),G)}get minDemResolution(){return st(this._ground)}get available(){return this._ground?.layers.some(e=>e.visible)===!0}initialize(){this.addHandles([P(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(e,t){const i=this._queryElevationDependencies;if(i==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:s}=i;if(s==null)throw new Error("No ground configured in the view");const o=await s.queryElevation(e,t),r=N(e.spatialReference),n=N(s.layers.at(0).spatialReference);if(r!==n){const l=o.geometry;l.points=l.points.map(([u,c,h])=>[u,c,h===t.noDataValue?h:h*n/r])}return o}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};a([p()],Z.prototype,"minDemResolution",null),a([p()],Z.prototype,"available",null),a([p()],Z.prototype,"_queryElevationDependencies",null),a([p()],Z.prototype,"_ground",null),Z=a([R("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],Z);let ne=class extends S{constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=D(()=>{const{view:e}=this.controller;if(!e)return null;const t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},G),this._getStableElevationInfo=D(()=>this.controller.elevationInfo,re),this._getStableSpatialReference=D(()=>this.controller.view?.spatialReference,re),this._getStableLayerIds=D(()=>{const{view:e}=this.controller;return e.type!=="3d"?[]:Ne(e)},G)}initialize(){const e=()=>this.onInvalidate(this);this.addHandles([P(()=>this._queryElevationDependencies,e,le),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:i}){const s=this._queryElevationDependencies;if(s==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:o,spatialReference:r}=s;if(this._requiresElevationAlignment&&o.type==="3d"&&r){const n=await Le.fromGeometry(e).project(r,i);if(!n)return{geometry:e,noDataValue:t};const l=o.elevationProvider;return n.coordinates.forEach(u=>{u.z=l.getElevation(u.x,u.y,0,r,"ground")??0}),{geometry:n.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};a([p()],ne.prototype,"_queryElevationDependencies",null),ne=a([R("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],ne);let te=class extends S{constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return it(this.profile.source)}get available(){const{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(t=>t.visible))}initialize(){this.addHandles(P(()=>this.profile.source,()=>this.onInvalidate(this),le))}queryElevation(e,t){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(e,t)}};a([p({readOnly:!0})],te.prototype,"minDemResolution",null),a([p()],te.prototype,"available",null),te=a([R("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],te);let T=class extends j{constructor(e){super(e),this._sketchViewModels=new ze,this._updatingHandles=new oi,this._operationManager=new li}initialize(){const{view:e}=this;this._graphicsLayer=new ni({listMode:"hide",internal:!0}),this.addHandles([P(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:t,internalGraphicsLayer:i,state:s,geometryVisualizationVisible:o,visible:r})=>{Yi(t,i);const n=this.sketchGraphic;switch(n&&(n.visible=r),s){case"idle":case"reshaping-disabled":n&&!o&&(n.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":ce(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},k),P(()=>this._analysis.elevationInfo,t=>{this._graphicsLayer.elevationInfo=t},k)])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(t=>oe(t));const e=this._graphicsLayer;this.view.map?.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:e,interactive:t}=this.analysisViewData;if(!e)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?t?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Ki(this.view.type)}place(e){return this._operationManager.start("place",async t=>{const i=this._createSketchViewModel(),s=this._analysis.clone();this._ensureUpdatedSketchGraphic();const o=this.sketchGraphic,r=this._analysis.elevationInfo,n=ee(()=>{this.sketchGraphic===o&&(this._graphicsLayer.elevationInfo=r)}),l=i.on("create",u=>{switch(u.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=u.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case"cancel":t.stop()}});t.handles.push(l,ee(()=>(l.remove(),i.destroy(),this._sketchViewModels.remove(i),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?ut(e)||s.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),n),this._graphicsLayer.elevationInfo=es,await this._updatingHandles.addPromise(ce(i.create("polyline")))},e)}async pickFeature(e){return this._operationManager.start("pick-feature",async t=>{const{view:i}=this;i.closePopup();let s=null;const o=n=>{n.defer(async()=>{s?.abort(),s=Fe(async l=>{const{results:u}=await i.hitTest(n);L(l);let c=null;for(const h of u)if(h.type==="graphic"&&fi(h.graphic)&&!gi(h.graphic)){c=h.graphic;break}c?(n.preventDefault(),n.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=c.geometry,this._analysis.elevationInfo=new ve({...Lt(c)}),t.resolve({feature:c}),t.stop()):t.reject()}),await s.promise})},r=n=>{Gt(n)&&(t.reject(),t.stop())};t.handles.push(i.on("immediate-click",o,Pe.TOOL),i.on("key-down",r,Pe.TOOL),i.acquireCursor("crosshair","high"),ee(()=>{s?.abort(),t.reject()})),i.focus()},e)}_startReshape(){const e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start("reshape",async t=>{const i=()=>{const o=this._ensureUpdatedSketchGraphic();return o?this._updatingHandles.addPromise(e.update(o,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const s=e.on("update",o=>{this._updateAnalysisFromSketchGraphic(),o.state==="complete"&&(this.state==="reshaping"?ce(i()):t.resolve())});t.handles.push(s,ee(()=>{s.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await i()})}_createSketchViewModel(){return new pi({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const t=this.sketchGraphic??=new si({symbol:this._lineSymbol,geometry:e});return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){const{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(i=>i!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let e=this.sketchGraphic?.geometry;ge(e)||(e=null);const t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function Ki(e){if(e==="2d"){const t={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new ri({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...t,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...t,color:[255,255,255,255]}]}}})}return new ai({color:[0,0,0,0]})}function Yi(e,t){t&&(t.removeFromParent(),e?.add(t))}a([p({constructOnly:!0})],T.prototype,"analysisViewData",void 0),a([p({constructOnly:!0})],T.prototype,"view",void 0),a([p()],T.prototype,"sketchGraphic",null),a([p({nonNullable:!0})],T.prototype,"state",null),a([p()],T.prototype,"updating",null),a([p()],T.prototype,"_sketching",null),a([p()],T.prototype,"_analysis",null),a([p()],T.prototype,"_lineSymbol",null),T=a([R("esri.views.analysis.ElevationProfile.ElevationProfileTool")],T);const es=new ve({mode:"on-the-ground",offset:0});let b=class extends gt{constructor(e){super(e),this.type="elevation-profile-view-3d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:e,view:t}=this;this._controller=new g({analysis:e,analysisViewData:this,view:t,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new Z(i);case"input":return new ne(i);case"query":return new te(i);case"scene":return new M(i)}}}}),this._visualization=new J({view:t,analysisViewData:this}),this._sketchTool=new T({view:t,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:"meters",elevation:"meters"}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return this._controller?.updating===!0||this._visualization?.updating===!0||this._sketchTool?.updating===!0}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??"idle"}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};a([p({readOnly:!0})],b.prototype,"type",void 0),a([p({constructOnly:!0,nonNullable:!0})],b.prototype,"analysis",void 0),a([p({readOnly:!0})],b.prototype,"effectiveDisplayUnits",null),a([p({readOnly:!0})],b.prototype,"error",null),a([p()],b.prototype,"hoveredPosition",void 0),a([p()],b.prototype,"hoveredPoints",null),a([p({readOnly:!0})],b.prototype,"progress",null),a([p({readOnly:!0})],b.prototype,"results",null),a([p({readOnly:!0})],b.prototype,"statistics",null),a([p({readOnly:!0})],b.prototype,"updating",null),a([p()],b.prototype,"sketchGraphic",null),a([p()],b.prototype,"toolState",null),a([p()],b.prototype,"_controller",void 0),a([p()],b.prototype,"_visualization",void 0),a([p()],b.prototype,"_sketchTool",void 0),b=a([R("esri.views.3d.analysis.ElevationProfileAnalysisView3D")],b);const Or=b;export{Or as default};
