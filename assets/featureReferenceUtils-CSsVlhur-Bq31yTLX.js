import{h as v,x as $,w as q}from"./vec32-CewSdTn3-VRto2OOh.js";import{t as I}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{q as w,x as h}from"./sphere-DLQ6p7mp-DyEe1Vll.js";import{K as P,Q as T,P as A}from"./intersectorUtilsConversions-pLQPEbcN-Ck-nyNYa.js";function Q(e,r){return f(e)===f(r)}function f(e){if(e==null)return null;const r=e.layer!=null?e.layer.id:"";let t=null;return t=e.objectId!=null?e.objectId:e.layer!=null&&"objectIdField"in e.layer&&e.layer.objectIdField!=null&&e.attributes!=null?e.attributes[e.layer.objectIdField]:e.uid,t==null?null:`o-${r}-${t}`}const z={json:{write:{writer:H,target:{"feature.layerId":{type:[Number,String],isRequired:!0},"feature.objectId":{type:[Number,String],isRequired:!0}}},origins:{"web-scene":{read:M}}},clonable:"reference"};function H(e,r){e?.layer?.objectIdField!=null&&e.attributes!=null&&(r.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function M(e){if(e.layerId!=null&&e.objectId!=null)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}function B(e,r,t,l){const{sceneIntersectionHelper:F}=e,{observer:m,observerFeatureId:c,targetFeatureId:s,target:j}=t;if(c==null&&s==null)return;l||(l=n=>n),v(u,m,j);const o=$(u),a=1;q(u,m,u,a/o);const N=w(u,j,k);r.options.store=2,F.intersectToolIntersectorRay(N,r);let y=null,g=null,d=null,i=null;for(const n of r.results.all){const p=P(n,e);if(p==null||n.distanceInRenderSpace==null)continue;const b=f(p);b!=null&&(c!=null&&b===c&&(y??=l(S(n,e,o)),n.distanceInRenderSpace-a<y&&(d=n)),s!=null&&b===s&&(g??=l(S(n,e,o)),i==null&&n.distanceInRenderSpace-a<o&&o-n.distanceInRenderSpace+a<g&&(i=n)))}const{observerAdjusted:R,targetAdjusted:x}=t;d?.getIntersectionPoint(R)?t.observerSurfaceNormal=d.getTransformedNormal(I()):t.observerSurfaceNormal=null,i?.getIntersectionPoint(x)?t.targetSurfaceNormal=i.getTransformedNormal(I()):t.targetSurfaceNormal=null}function S(e,r,t){if(T(e)){const l=A(e,r);if(l!=null)return Math.min(l*O,t)}return 1e-5*t}const O=.05,k=h(),u=I();export{Q as E,z as G,f as I,B as J};
