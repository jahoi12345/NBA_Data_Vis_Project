import{f as p,g as m,a as S}from"./screenUtils-BitdhK1O.js";import{n as k}from"./vec2f64-rIxtbMRN.js";import{_ as w,c as E,r as y,s as M,P as D,g as h,u as F}from"./vec32-CBRzfVYF.js";import{n as i}from"./collectionUtils-0LMOubEE.js";import{b as $}from"./Point-C1MrKtFQ.js";import{$ as R}from"./projectionUtils-DgeaYumr.js";import{K as b,j as T,k as U,a as A}from"./plane-B9g_Fkw2.js";import{b as K,M as q}from"./sphere-CJMW5PSr.js";import{t as C,e as G}from"./vector-CX91PKdq.js";import{x as _}from"./elevationInfoUtils-M7_FbiD_.js";import{E as g}from"./ShadowCastClear.glsl-L5KbQEJ_.js";import{u as j,w as H}from"./Texture-DX30_NqW.js";import{D as z}from"./InteractiveToolBase-CqHycher.js";function B(e,r){return I(e,()=>r)}function cn(e){return I(e,r=>r.plane)}function I(e,r){const t=i(),l=i();let o=!1;return n=>{const u=r(n);if(n.action==="start"){const c=m(n.screenStart,S(C.get())),a=g(e.state.camera,c,x);a!=null&&(o=b(u,a,t))}if(!o)return null;const s=m(n.screenEnd,S(C.get())),d=g(e.state.camera,s,x);return d==null?null:b(u,d,l)?{...n,renderStart:t,renderEnd:l,plane:u,ray:d}:null}}function J(e,r,t=0,l=null,o=null){let n=null;return u=>{if(u.action==="start"&&(n=e.sceneIntersectionHelper.intersectElevationFromScreen(p(u.screenStart.x,u.screenStart.y),r,t,o),n!=null&&l!=null&&!R(n,n,l))||n==null)return null;const s=e.sceneIntersectionHelper.intersectElevationFromScreen(p(u.screenEnd.x,u.screenEnd.y),r,t,o);return s!=null&&(l==null||R(s,s,l))?{...u,mapStart:n,mapEnd:s}:null}}function O(e,r,t,l=null,o=null){return J(e,t,_(r,e,t),l,o)}function dn(e,r,t,l){const o=t.toMap(e.screenStart);return o!=null?O(r,o,t.elevationInfo,l):null}function L(e,r){const t=P,l=v,o=T();e.renderCoordsHelper.worldUpAtPosition(r,t);const n=w(U(o),t,E(l,r,e.state.camera.eye));return w(n,n,t),A(r,n,o)}function fn(e,r,t){let l=null;const o=new z;return o.next(B(e,L(e,r))).next(N(e,r)).next(Q(e,t)).next(n=>{n.mapEnd.x=n.mapStart.x,n.mapEnd.y=n.mapStart.y,l=n}),n=>(l=null,o.execute(n),l)}function N(e,r){const t=i(),l=y(r);e.renderCoordsHelper.worldUpAtPosition(r,t);const o=i(),n=i(),u=s=>(E(s,s,r),G(t,s,s),e.viewingMode==="global"&&y(s)*Math.sign(D(t,s))<.001-l&&E(s,h(s,t,.001),r),F(s,s,r),s);return s=>(s.renderStart=u(M(o,s.renderStart)),s.renderEnd=u(M(n,s.renderEnd)),s)}function mn(e,r){const t=l=>{const o=m(l,S(V)),n=g(e.state.camera,o,x);return n==null?null:q(r,n,P,v)?.[0]};return l=>{const o=t(l.screenStart);if(o==null)return null;const n=t(l.screenEnd);return n==null?null:{...l,renderStart:o,renderEnd:n}}}function Q(e,r){const t=e.renderCoordsHelper;return l=>{const o=t.fromRenderCoords(l.renderStart,new $({spatialReference:r})),n=t.fromRenderCoords(l.renderEnd,new $({spatialReference:r}));return o!=null&&n!=null?{...l,mapStart:o,mapEnd:n}:null}}function pn(e){let r=null;return t=>{switch(t.action){case"start":r=e.disableDisplay();break;case"end":case"cancel":r!=null&&(r.remove(),r=null)}return t}}function Sn(e,r=null){const t=new j(e.state.viewingMode);t.options.selectionMode=!0,t.options.store=0,t.options.hud=!1;const l=p(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},n=i(),u=r??e.spatialReference,s=c=>{e.map.ground&&e.map.ground.opacity<1?o.exclude.add(H):o.exclude.delete(H),e.sceneIntersectionHelper.intersectIntersectorScreen(m(c,l),t,o);const a=t.results.min;let f;if(a.getIntersectionPoint(n))f=a.intersector===7?0:1;else{if(!t.results.ground.getIntersectionPoint(n))return null;f=0}return{location:e.renderCoordsHelper.fromRenderCoords(n,new $({spatialReference:u})),surfaceType:f}};let d;return c=>{if(c.action==="start"){const f=s(c.screenStart);d=f!=null?f.location:null}if(d==null)return null;const a=s(c.screenEnd);return a?.location!=null?{...c,mapStart:d,mapEnd:a.location,surfaceType:a.surfaceType}:null}}const V=k(),P=i(),v=i(),x=K();export{mn as D,pn as G,O as M,Sn as O,B as P,cn as R,fn as T,dn as k,Q as q};
