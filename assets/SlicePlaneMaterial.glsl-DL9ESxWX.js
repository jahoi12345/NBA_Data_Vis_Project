import{u as O}from"./Color-CERqXxxY.js";import{Q as yt,I as Lt}from"./colorUtils-B2x0XChU.js";import{l as zt,h as Ft}from"./reactiveUtils-SO2Ko3sy.js";import{R as it,f as Rt,c as L,x as Ht,l as St,o as nt,i as at,_ as lt}from"./mat4-BAXvdiEz.js";import{e as Y}from"./mat4f64-q_b6UJoq.js";import{R as ct}from"./quat-DfRdiNBH.js";import{r as C,g as p,o as B,u as f,s as M,c as _,P as T,A as P,_ as v,j as Nt}from"./vec32-3aXs3jbn.js";import{l as qt,t as Et,n as V,r as X}from"./collectionUtils-DoXnmzlX.js";import{c as l,u as Gt,a as F,o as dt}from"./vector-t8v3Ie0E.js";import{j as Bt,g as Vt,u as ut,v as Jt,C as G,e as Qt,i as gt,n as Ut,x as Z,U as Kt,S as pt,l as Yt,a as Xt,c as Zt}from"./sliceToolConfig-BnawSSVt.js";import{v as te,ak as ee,_ as S,m as k,al as ht,a as re,i as ie}from"./jsonMap-Bs3hmeCU.js";import{a as ft}from"./Cyclical-BLSxUpe7.js";import{b as jt,s as mt}from"./Point-vWR8_ZMt.js";import{M as se,s as bt}from"./mathUtils-PIGhLnI9.js";import{p as tt}from"./screenUtils-BitdhK1O.js";import"./Extent-DY3BG_6i.js";import{F as oe}from"./projectionUtils-CxkhtTt4.js";import{d as ne,z as xt,v as Ot,N as et,e as ae,J as le,H as ce,$ as de,M as $t,r as _t,L as ue}from"./RealisticTree.glsl-CgA5d_b1.js";import{I as kt,a as At}from"./plane-ymHyaMHs.js";import{b as ge}from"./sphere-BzYvaOhL.js";import{r as z}from"./vec4f64-DPb6J-GU.js";import{o as pe,p as he,w as fe,r as me,Y as be,t as A}from"./ShadedColorMaterial.glsl-Bu17swPM.js";import{a as wt}from"./vec42-DhV2kIac.js";import{t as vt,f as $e,o as _e}from"./Emissions.glsl-B8XKMjLy.js";import{V as we,W as ve,au as Mt,T as Me,a1 as Ce,a2 as Pe,a3 as ye,a8 as Re,aQ as Se,aR as Ue,aj as je,ai as xe}from"./Texture-CeSIfj9V.js";import{f as Tt}from"./DefaultLayouts-BQ_3lPmZ.js";import{i as Oe}from"./TriangleMaterial-DXTsmCl3.js";import{_ as ke}from"./index-JW0QcsSZ.js";import{bz as Ae,J as Te}from"./ShadowCastClear.glsl-BvoFxLds.js";import{m as q}from"./ColorMaterial.glsl-C-QhMypJ.js";let w=class extends qt(te){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&this.width===t.width&&this.height===t.height&&ee(this.position,t.position)}};S([k({type:["plane"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],w.prototype,"type",void 0),S([k({type:jt,json:{write:{isRequired:!0}}})],w.prototype,"position",void 0),S([k({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),mt(t=>ft.normalize(ht(t),0,!0))],w.prototype,"heading",void 0),S([k({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),mt(t=>ft.normalize(ht(t),0,!0))],w.prototype,"tilt",void 0),S([k({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],w.prototype,"width",void 0),S([k({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],w.prototype,"height",void 0),w=S([re("esri.analysis.SlicePlane")],w);const We=w,Ie=z(0,0,0,.04);function De({accentColor:t}){return yt(t,.5)}function Le({accentColor:t}){return yt(t,.7)}function Wt(t){const e=new we,{vertex:n,fragment:o,attributes:i,varyings:s}=e;return ve(n,t),i.add("position","vec3"),i.add("uv0","vec2"),s.add("vUV","vec2"),n.main.add(vt`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),o.uniforms.add(new Mt("backgroundColor",r=>r.backgroundColor),new Mt("gridColor",r=>r.gridColor),new $e("gridWidth",r=>r.gridWidth)).main.add(vt`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),e}const ze=Object.freeze(Object.defineProperty({__proto__:null,build:Wt},Symbol.toStringTag,{value:"Module"}));class Fe extends Me{constructor(){super(...arguments),this.backgroundColor=z(1,0,0,.5),this.gridColor=z(0,1,0,.5),this.gridWidth=4}}class He extends Ce{constructor(e,n){super(e,n,new Pe(ze,()=>ke(()=>Promise.resolve().then(()=>Ze),void 0)),Tt.locations)}initializePipeline(){return ye({blending:Se,depthTest:{func:513},colorWrite:Re})}}class Ne extends Oe{constructor(e){super(e,Ee),this.produces=new Map([[8,n=>_e(n)]]),this._configuration=new Ue}get visible(){return!0}createGLMaterial(e){return new qe(e)}createBufferWriter(){return new je(Tt)}getConfiguration(){return this._configuration}}class qe extends xe{constructor(e){super(e)}beginSlot(e){return this.getTechnique(He,e)}}class Ee extends Fe{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}class Ge extends pe{constructor(e){super(e),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=z(1,0,0,1),this._backgroundColor=z(1,0,0,1),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){wt(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){wt(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new Ne(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(e){e(this._material)}createGeometries(e){if(this._material!=null){const n=ne(this._material);e.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material?.setParameters(this._materialParameters)}}function xr(t,e,n,o,i,s,r,a){return Be(e,r.worldUpAtPosition(t,l.get()),i,s,a.basis1,a.basis2),p(a.basis1,a.basis1,n),p(a.basis2,a.basis2,o),M(a.origin,t),kt(a.basis2,a.basis1,a.origin,a.plane),a}function Be(t,e,n,o,i,s){const r=T(t,e),a=l.get(),c=l.get();switch(o===0?Math.abs(r)>Qt?1:2:o){case 2:{const u=Math.abs(r)<=gt?t:n.viewUp;v(a,u,e),M(c,e);break}case 1:v(a,n.viewUp,e),v(c,e,a);break;case 3:{const u=Math.abs(r)<=gt?e:n.viewUp;v(a,u,t),v(c,t,a);break}}const d=v(l.get(),a,c);T(d,n.viewForward)>0&&p(c,c,-1),P(i,a),P(s,c)}function Ve(t,e,n){const o=e.worldUpAtPosition(t.origin,l.get()),i=t.basis1,s=ot(t,o),r=Math.round(s/W)*W;return et(t,r-s,i,n)}function Or(t,e,n,o,i,s){const r=M(l.get(),i.origin);f(r,r,p(l.get(),i.basis1,t.direction[0]<0?1:-1)),f(r,r,p(l.get(),i.basis2,t.direction[1]<0?1:-1));const a=C(i.basis1),c=C(i.basis2),d=_(l.get(),n,r),u=_(l.get(),e,r);let g=0,m=0;if(Dt(t)){const Q=rt(i),I=rt(s);g=a-.5*t.direction[0]*T(i.basis1,u)/a,m=c-.5*t.direction[1]*T(i.basis2,u)/c;const H=I/Q;g*=H,m*=H}const h=g+.5*t.direction[0]*T(i.basis1,d)/a,$=m+.5*t.direction[1]*T(i.basis2,d)/c,j=p(l.get(),i.basis1,h/a),y=p(l.get(),i.basis2,$/c);(h<=0||Ct(s.origin,j,o)<=ut)&&M(j,s.basis1),($<=0||Ct(s.origin,y,o)<=ut)&&M(y,s.basis2);const b=M(l.get(),r);return f(b,b,p(l.get(),j,t.direction[0]<0?-1:1)),f(b,b,p(l.get(),y,t.direction[1]<0?-1:1)),ce(b,j,y,s)}function kr(t,e){return Jt*Math.min(e.width,e.height)*e.computeRenderPixelSizeAt(t)}function Ar(t,e,n,o){const i=v(l.get(),e,n);return v(i,i,e),At(t,i,o)}function Tr(t,e){return fe(t.basis1,t.basis2,t.origin,e)}function Wr(t,e,n,o){const i=e.worldUpAtPosition(t.origin,l.get()),s=l.get();switch(n){case 1:M(s,i);break;case 2:M(s,t.basis1)}return At(t.origin,s,o)}function Ir(t,e,n,o){const i=st(n,2),s=F.get();Ht(s,e,i.edge*Math.PI/2);const r=P(l.get(),i.basis);let a=p(l.get(),r,i.direction*o.computeScreenPixelSizeAt(i.position)*G);f(a,a,i.position);const c=o.projectToRenderScreen(a,tt(l.get())),d=Je(o,c);Ae(o,c,E),P(E.direction,E.direction);const u=l.get();!d&&de(n,E,u)&&(a=u),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=Et(a),d?t.state|=J:t.state&=~J}function Je(t,e){if(e==null)return!1;const[n,o,i,s]=t.viewport,r=Math.min(i,s)/16;let a=!0;return e[0]<n+r?(e[0]=n+r,a=!1):e[0]>n+i-r&&(e[0]=n+i-r,a=!1),e[1]<o+r?(e[1]=o+r,a=!1):e[1]>o+s-r&&(e[1]=o+s-r,a=!1),a}function Dr(t,e,n,o){const i=C(o.basis1),s=C(o.basis2),r=It(o),a=rt(o),c=B(l.get(),0,0,0);f(c,p(l.get(),o.basis1,e.direction[0]),p(l.get(),o.basis2,e.direction[1])),f(c,o.origin,c);let d=0,u=1;if(Dt(e))e.direction[0]===1&&e.direction[1]===-1?d=W:e.direction[0]===1&&e.direction[1]===1?d=Math.PI:e.direction[0]===-1&&e.direction[1]===1&&(d=3*Math.PI/2),u=a;else{const m=e.direction[0]!==0?1:2;d=m===1?W:0,u=(m===1?s:i)-r}const g=it(F.get(),d);Rt(g,g,B(l.get(),u,u,u)),L(g,n,g),g[12]=0,g[13]=0,g[14]=0,t.modelTransform=g,t.renderLocation=c}function Lr(t,e,n,o){const i=o.worldUpAtPosition(n.origin,l.get()),s=st(n,0),r=it(F.get(),s.edge*Math.PI/2);St(r,r,-ot(n,i)),L(r,e,r),r[12]=0,r[13]=0,r[14]=0,t.modelTransform=r,t.renderLocation=s.position}function zr(t,e,n){const o=st(n,1),i=it(F.get(),o.edge*Math.PI/2);St(i,i,W),L(i,e,i),i[12]=0,i[13]=0,i[14]=0,t.modelTransform=i,t.renderLocation=o.position}function st(t,e){switch(e){case 0:return{basis:t.basis1,direction:1,position:f(l.get(),t.origin,t.basis1),edge:e};case 1:return{basis:t.basis2,direction:1,position:f(l.get(),t.origin,t.basis2),edge:e};case 2:return{basis:t.basis1,direction:-1,position:_(l.get(),t.origin,t.basis1),edge:e};case 3:return{basis:t.basis2,direction:-1,position:_(l.get(),t.origin,t.basis2),edge:e}}}function Ct(t,e,n){const o=n.projectToRenderScreen(f(l.get(),t,e),tt(l.get())),i=n.projectToRenderScreen(_(l.get(),t,e),tt(l.get()));return o&&i?Nt(_(o,o,i)):0}function It(t){const e=C(t.basis1),n=C(t.basis2);return Vt*Math.min(e,n)}function rt(t){return It(t)}function Dt(t){return t.direction[0]!==0&&t.direction[1]!==0}function Fr(t){const e=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new he({view:t,attached:!1,color:Le(t.effectiveTheme),width:Bt,renderOccluded:4,geometry:[e],isDecoration:!0})}function Hr(t){return new Ge({view:t,attached:!1,backgroundColor:Ie,gridColor:De(t.effectiveTheme),gridWidth:4,renderOccluded:4,isDecoration:!0})}function Nr(t,e,n,o=new We){if(t==null)return null;const{renderCoordsHelper:i}=e,s=i.fromRenderCoords(t.origin,new jt({spatialReference:e.spatialReference}));if(s==null)return null;const r=oe(s,n);if(r==null)return null;o.position=r;const a=2*C(t.basis1),c=2*C(t.basis2),d=Ot.renderUnitScaleFactor(e.spatialReference,n);o.width=a*d,o.height=c*d;const u=i.worldUpAtPosition(t.origin,l.get());return o.tilt=se(ot(t,u)),o.heading=i.headingAtPosition(t.origin,t.basis1)-90,o}function ot(t,e){return Gt(e,t.basis2,t.basis1)+W}function Qe(t,e,n,o,i,s,r=xt()){return s.toRenderCoords(t,r.origin)?(s.worldBasisAtPosition(r.origin,0,r.basis1),s.worldBasisAtPosition(r.origin,1,r.basis2),kt(r.basis2,r.basis1,r.origin,r.plane),et(r,-bt(e),ae(r),r),et(r,bt(n),r.basis1,r),p(r.basis1,r.basis1,o/2),p(r.basis2,r.basis2,i/2),le(r),r):(ie.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${t.spatialReference.wkid} is not supported`),null)}function qr(t,e){if(t?.position==null)return null;const n=me(t.position,e.spatialReference,e.elevationProvider);if(n==null)return null;const o=Ot.renderUnitScaleFactor(t.position.spatialReference,e.spatialReference),i=t.width*o,s=t.height*o;return{position:n,heading:t.heading,tilt:t.tilt,renderWidth:i,renderHeight:s}}function Er(t,e,n,o=xt()){if(t==null)return null;const i=Qe(t.position,t.heading,t.tilt,t.renderWidth,t.renderHeight,e.renderCoordsHelper,o);return n.tiltEnabled||i==null||Ve(i,e.renderCoordsHelper,i),i}const U=16,J=32,E=ge(),W=Math.PI/2,Gr=16,Br=32;function Vr(t){return(t.type==="building-scene-3d"?t:null)!=null}let Jr=class extends be{constructor(e,n){const o=new Te({width:1,renderOccluded:4,isDecoration:!0},e.state.isGlobal),i=new q({cullFace:2,renderOccluded:16,isDecoration:!0}),s=new q({cullFace:2,renderOccluded:16,isDecoration:!0}),r=new q({cullFace:2,renderOccluded:16,isDecoration:!0}),a=new q({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:e,...Ke({offsetMode:n,tubeMaterial:i,tipMaterial:s,capMaterial:r,outlineMaterial:a,calloutMaterial:o})}),this._themeHandle=zt(()=>e.effectiveTheme.accentColor,c=>{const d=Lt(c),u=O.toUnitRGBA(c),g=O.toUnitRGBA(d),m=O.toUnitRGBA(O.blendColors(d,c,.4)),h=O.toUnitRGBA(O.blendColors(d,c,.14));o.setParameters({color:u}),i.setParameters({color:h}),s.setParameters({color:g}),r.setParameters({color:m}),a.setParameters({color:u})},Ft)}destroy(){this._themeHandle.remove(),super.destroy()}};function Ke({offsetMode:t,tubeMaterial:e,tipMaterial:n,capMaterial:o,outlineMaterial:i,calloutMaterial:s}){const r=t===0?G:0,a=[X(r,0,-pt/2),X(r,0,pt/2)],c=Xe(a),d=Pt({vertices:a,padding:0,materials:{tube:e,tip:n,cap:o}}),u=Pt({vertices:a,padding:Kt,materials:{tube:i,tip:i,cap:i}}),g=$t(s,[[r,0,0],[r-G,0,0]]),m=$t(s,[[r,0,0],[r-G,0,0]]);return{renderObjects:[...d.normal.map(h=>new A(h,1|U)),...u.normal.map(h=>new A(h,1|U)),new A(g,1|U|J),...d.focused.map(h=>new A(h,2|U)),...u.focused.map(h=>new A(h,2|U)),new A(m,2|U|J)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[c]},collisionPriority:1,radius:Ut,state:U}}function Pt({vertices:t,padding:e,materials:n}){const o=i=>{const s=t.slice(),r=_(l.get(),s[0],s[1]);P(r,r);const a=_(l.get(),s[s.length-1],s[s.length-2]);if(P(a,a),e>0){const D=p(V(),a,-e);s[s.length-1]=f(D,D,s[s.length-1]);const x=p(V(),r,-e);s[0]=f(x,x,s[0])}const c=i?Zt:1,d=Z*c,u=Ut*c,g=nt(F.get());if(e>0){const D=d/4,x=B(l.get(),0,D,0),N=1+e/D;at(g,g,x),Rt(g,g,B(l.get(),N,N,N)),at(g,g,p(x,x,-1/N))}const m=nt(Y()),h=X(0,1,0),$=lt(Y(),ct(dt.get(),h,a));$[12]=s[s.length-1][0],$[13]=s[s.length-1][1],$[14]=s[s.length-1][2],L($,$,g);const j=n.tube,y=Ye(Yt*(i?Xt:1)+e,s,j);y.transformation=m;const b=[y],Q=n.tip,I=_t(Q,d,u,24,!1,!1,!0);I.transformation=$,b.push(I);const H=n.cap,K=_t(H,d,u,24,!1,!0,!1);K.transformation=$,b.push(K);const R=lt(Y(),ct(dt.get(),h,r));return R[12]=s[0][0],R[13]=s[0][1],R[14]=s[0][2],L(R,R,g),b.push(I.instantiate({transformation:R})),b.push(K.instantiate({transformation:R})),b};return{normal:o(!1),focused:o(!0)}}function Ye(t,e,n){const o=[];for(let s=0;s<12;s++){const r=s/12*2*Math.PI;o.push([Math.cos(r)*t,Math.sin(r)*t])}return ue(n,o,e,[],[],!1)}function Xe(t,e){const n=_(V(),t[t.length-1],t[t.length-2]);P(n,n),p(n,n,Z),f(n,n,t[t.length-1]);{const o=_(V(),t[0],t[1]);return P(o,o),p(o,o,Z),f(o,o,t[0]),[o,...t,n]}}const Ze=Object.freeze(Object.defineProperty({__proto__:null,build:Wt},Symbol.toStringTag,{value:"Module"}));export{Gr as C,Vr as L,Er as R,J as S,qr as U,Jr as _,xr as a,Dt as b,We as c,Ir as d,zr as e,Le as f,Ie as g,Fr as h,De as i,Hr as j,Br as k,Dr as l,rt as m,kr as n,Ar as o,Wr as r,Tr as s,Or as t,Lr as u,Nr as w,U as x};
