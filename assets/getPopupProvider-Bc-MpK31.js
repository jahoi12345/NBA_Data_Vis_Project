import{v as u,_ as i,m as o,a as l,x as Zt,y as _,E as v,l as te,q as Ne,r as B,bz as Se,a7 as Re,i as _e}from"./jsonMap-Bs3hmeCU.js";import{l as I,O as D}from"./collectionUtils-DO-P7c3V.js";import{s as Te}from"./Point-fJINO2ru.js";import{o as qt}from"./reader-DcGs6kKN.js";import{g as Ce,I as Oe,d as Ae,x as Me,w as Be,M as Ee,A as ke,z as Je}from"./lengthUtils-BPaBCXl4.js";import{r as Lt,u as qe}from"./Color-CERqXxxY.js";import{M as Le}from"./date-IqUzANpt.js";import{s as De}from"./Layer-CZbHrbnb.js";let ot=class extends u{constructor(e){super(e),this.type=null}};i([o({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],ot.prototype,"type",void 0),ot=i([l("esri.popup.content.Content")],ot);const b=ot,it=new Zt({asc:"ascending",desc:"descending"});let W=class extends I(u){constructor(e){super(e),this.field=null,this.order="ascending"}};i([o({type:String,json:{write:!0}})],W.prototype,"field",void 0),i([o({type:it.apiValues,json:{type:it.jsonValues,read:it.read,write:it.write}})],W.prototype,"order",void 0),W=i([l("esri.popup.support.AttachmentsOrderByInfo")],W);const We=W;let f=class extends I(b){constructor(e){super(e),this.attachmentKeywords=null,this.attachmentTypes=null,this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};i([o({type:[String],json:{write:!0}})],f.prototype,"attachmentKeywords",void 0),i([o({type:[["application","audio","image","model","text","video"]],json:{write:!0}})],f.prototype,"attachmentTypes",void 0),i([o({type:String,json:{write:!0}})],f.prototype,"description",void 0),i([o({type:["auto","preview","list"],json:{write:!0}})],f.prototype,"displayType",void 0),i([o({type:[We],json:{write:!0}})],f.prototype,"orderByFields",void 0),i([o({type:String,json:{write:!0}})],f.prototype,"title",void 0),i([o({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],f.prototype,"type",void 0),f=i([l("esri.popup.content.AttachmentsContent")],f);const X=f;var wt;let T=wt=class extends b{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new wt({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?_(this.outFields):null})}};i([o()],T.prototype,"creator",void 0),i([o()],T.prototype,"destroyer",void 0),i([o()],T.prototype,"outFields",void 0),i([o({type:["custom"],readOnly:!0})],T.prototype,"type",void 0),T=wt=i([l("esri.popup.content.CustomContent")],T);const Ge=T;var vt;let E=vt=class extends u{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new vt({title:this.title,expression:this.expression})}};i([o({type:String,json:{write:!0}})],E.prototype,"title",void 0),i([o({type:String,json:{write:!0}})],E.prototype,"expression",void 0),i([o({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],E.prototype,"returnType",void 0),E=vt=i([l("esri.popup.ElementExpressionInfo")],E);const Pe=E;var gt;let G=gt=class extends b{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){return new gt({expressionInfo:this.expressionInfo?.clone()})}};i([o({type:Pe,json:{write:!0}})],G.prototype,"expressionInfo",void 0),i([o({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],G.prototype,"type",void 0),G=gt=i([l("esri.popup.content.ExpressionContent")],G);const ct=G;let rt=class extends I(u){constructor(e){super(e),this.type=null}};i([o({type:["date-time","number"],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],rt.prototype,"type",void 0),rt=i([l("esri.layers.support.FieldFormat")],rt);const Dt=rt,ee="auto";let $=class extends Dt{constructor(e){super(e),this.dateStyle=null,this.hour12=ee,this.month=null,this.timeStyle=null,this.type="date-time",this.year=null}};i([o({type:["full","long","medium","short"],json:{write:!0}})],$.prototype,"dateStyle",void 0),i([o({type:["always","auto","never"],nonNullable:!0,json:{default:ee,write:!0}})],$.prototype,"hour12",void 0),i([o({type:["long","short"],json:{write:!0}})],$.prototype,"month",void 0),i([o({type:["full","long","medium","short"],json:{write:!0}})],$.prototype,"timeStyle",void 0),i([o({type:["date-time"]})],$.prototype,"type",void 0),i([o({type:["numeric"],json:{write:!0}})],$.prototype,"year",void 0),$=i([l("esri.layers.support.DateTimeFieldFormat")],$);const M=$,zt={min:0,max:20},ie=2,oe=0,re="decimal",se="auto";let j=class extends Dt{constructor(e){super(e),this.maximumFractionDigits=ie,this.minimumFractionDigits=oe,this.style=re,this.type="number",this.useGrouping=se}};i([o({type:v,nonNullable:!0,range:zt,json:{default:ie,write:!0}})],j.prototype,"maximumFractionDigits",void 0),i([o({type:v,nonNullable:!0,range:zt,json:{default:oe,write:!0}})],j.prototype,"minimumFractionDigits",void 0),i([o({type:["decimal"],nonNullable:!0,json:{default:re,write:!0}})],j.prototype,"style",void 0),i([o({type:["number"]})],j.prototype,"type",void 0),i([o({type:["always","auto","never"],nonNullable:!0,json:{default:se,write:!0}})],j.prototype,"useGrouping",void 0),j=i([l("esri.layers.support.NumberFieldFormat")],j);const dt=j;let k=class extends I(u){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};i([Lt(Le)],k.prototype,"dateFormat",void 0),i([o({type:Boolean,json:{write:!0}})],k.prototype,"digitSeparator",void 0),i([o({type:v,json:{write:!0}})],k.prototype,"places",void 0),k=i([l("esri.popup.support.FieldInfoFormat")],k);const q=k,Ue={base:Dt,key:"type",errorContext:"field-configuration-field-format",typeMap:{"date-time":M,number:dt}};function Ni(t,e){const{format:r}=t;return e&&yt(e)?r?ne(r,e):st(e,{hour12:"always",useGrouping:"always"}):null}function ne(t,e){const{dateFormat:r}=t;if(!e)return r?Kt(t):Vt(t);if(!yt(e))return;const s={hour12:"always"};switch(e.type){case"integer":case"small-integer":case"big-integer":case"long":return le(t);case"single":case"double":return Vt(t);case"date":case"timestamp-offset":return r?Kt(t):st(e,s);case"date-only":return r?ze(t):st(e);case"time-only":return r?Ve(t):st(e,s)}}function yt(t){return Ce(t)||Oe(t)||Ae(t)||Me(t)||Be(t)}function le(t){return new dt({useGrouping:t.digitSeparator?"always":"never"})}function Vt(t){const e=le(t),{places:r}=t;return e.minimumFractionDigits=r??0,e.maximumFractionDigits=r??2,e}function Kt(t){return new M({dateStyle:ae(t),year:ce(t),month:ue(t),timeStyle:de(t),hour12:pe(t)})}function ze(t){return new M({dateStyle:ae(t),year:ce(t),month:ue(t)})}function Ve(t){return new M({timeStyle:de(t),hour12:pe(t)})}function ae(t){const{dateFormat:e}=t;return e?e.startsWith("short-date")?"short":e.startsWith("day-short-month-year")?"medium":e.startsWith("long-month-day-year")?"long":e.startsWith("long-date")?"full":null:null}function pe(t){return t.dateFormat?.endsWith("-24")?"never":"always"}function ue(t){switch(t.dateFormat){case"short-month-year":return"short";case"long-month-year":return"long";default:return null}}function de(t){const{dateFormat:e}=t;return e?e.includes("short-time")?"short":e.includes("long-time")?"medium":null:null}function ce(t){switch(t.dateFormat){case"short-month-year":case"long-month-year":case"year":return"numeric";default:return null}}function Ke(t,e){const r=t.type==="number",s=t.type==="date-time";if(!e)return r?Ht(t):s?Qt(t):null;if(yt(e))switch(e.type){case"integer":case"small-integer":case"big-integer":case"long":return r?ye(t):null;case"single":case"double":return r?Ht(t):null;case"date":case"timestamp-offset":return s?Qt(t):null;case"date-only":return s?He(t):null;case"time-only":return s?Qe(t):null}}function ye(t){return new q({digitSeparator:t.useGrouping!=="never"})}function Ht(t){const e=ye(t);return e.places=t.maximumFractionDigits,e}function Qt(t){let e;const r=he(t),s=me(t),n=t.hour12==="never"?"24":null,a=t.year==="numeric"?"year":null,c=fe(t);return r&&s&&n?e=`${r}-${s}-${n}`:r&&s?e=`${r}-${s}`:r?e=r:a&&c?e=`${c}-${a}`:a&&(e=a),e?new q({dateFormat:e}):null}function He(t){let e;const r=he(t),s=t.year==="numeric"?"year":null,n=fe(t);return r?e=r:s&&n?e=`${n}-${s}`:s&&(e=s),e?new q({dateFormat:e}):null}function Qe(t){let e;const r=me(t),s=t.hour12==="never"?"24":null;return r&&s?e=`short-date-${r}-${s}`:r&&(e=`short-date-${r}`),e?new q({dateFormat:e}):null}function he(t){switch(t.dateStyle){case"short":return"short-date";case"medium":return"day-short-month-year";case"long":return"long-month-day-year";case"full":return"long-date";default:return}}function me(t){return t.timeStyle&&(t.timeStyle==="short"?"short-time":"long-time")}function fe(t){switch(t.month){case"short":return"short-month";case"long":return"long-month";default:return}}function st(t,e){if(!yt(t))return;const r=e?.useGrouping??"auto",s=e?.hour12??"auto";switch(t.type){case"integer":case"small-integer":case"big-integer":case"long":return new dt({minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:r});case"single":case"double":return new dt({minimumFractionDigits:0,maximumFractionDigits:2,useGrouping:r});case"date":case"timestamp-offset":return new M({dateStyle:"short",timeStyle:"short",hour12:s});case"date-only":return new M({dateStyle:"short"});case"time-only":return new M({timeStyle:"short",hour12:s})}}let d=class extends I(u){constructor(e){super(e),this.fieldName=null,this.isEditable=!0,this.label=null,this.statisticType=null,this.stringFieldOption="text-box",this.tooltip=null,this.visible=!0}set fieldFormat(e){this._set("fieldFormat",e),this._set("format",e?Ke(e):null)}set format(e){this._set("format",e),this._set("fieldFormat",e?ne(e):null)}readFormat(e,r){if(!r.fieldFormat)return e?q.fromJSON(e):null}clone(){const e=super.clone();return e._set("format",this.format?.clone()),e._set("fieldFormat",this.fieldFormat?.clone()),e}};i([o({value:null,clonable:!1,types:Ue,json:{write:{overridePolicy(t,e,r){const{fieldName:s}=this;return{enabled:!!s&&!s.startsWith("expression/")&&!s.startsWith("relationships/")&&!!r?.writeFieldFormat}}}}})],d.prototype,"fieldFormat",null),i([o({type:String,json:{write:!0}})],d.prototype,"fieldName",void 0),i([o({value:null,clonable:!1,type:q,json:{write:!0}})],d.prototype,"format",null),i([qt("format")],d.prototype,"readFormat",null),i([o({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],d.prototype,"isEditable",void 0),i([o({type:String,json:{write:!0}})],d.prototype,"label",void 0),i([o({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],d.prototype,"statisticType",void 0),i([Lt(new Zt({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],d.prototype,"stringFieldOption",void 0),i([o({type:String,json:{write:!0}})],d.prototype,"tooltip",void 0),i([o({type:Boolean,json:{write:!0}})],d.prototype,"visible",void 0),d=i([l("esri.popup.FieldInfo")],d);const we=d;var xt;let N=xt=class extends b{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}clone(){return new xt(_({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};i([o({type:Object,json:{write:!0}})],N.prototype,"attributes",void 0),i([o({type:String,json:{write:!0}})],N.prototype,"description",void 0),i([o({type:[we],json:{write:!0}})],N.prototype,"fieldInfos",void 0),i([o({type:String,json:{write:!0}})],N.prototype,"title",void 0),i([o({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],N.prototype,"type",void 0),N=xt=i([l("esri.popup.content.FieldsContent")],N);const Y=N;let C=class extends u{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};i([o({type:String,json:{write:!0}})],C.prototype,"altText",void 0),i([o({type:String,json:{write:!0}})],C.prototype,"caption",void 0),i([o({type:String,json:{write:!0}})],C.prototype,"title",void 0),i([o({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],C.prototype,"type",void 0),C=i([l("esri.popup.content.mixins.MediaInfo")],C);const Wt=C;var $t;let O=$t=class extends te{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new $t({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};i([o()],O.prototype,"color",void 0),i([o()],O.prototype,"fieldName",void 0),i([o()],O.prototype,"tooltip",void 0),i([o()],O.prototype,"value",void 0),O=$t=i([l("esri.popup.content.support.ChartMediaInfoValueSeries")],O);const Xe=O;var Ft;let S=Ft=class extends u{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Ft({colors:_(this.colors),fields:_(this.fields),normalizeField:this.normalizeField,series:_(this.series),tooltipField:this.tooltipField})}};i([o({type:[qe],json:{type:[[v]],write:!0}})],S.prototype,"colors",void 0),i([o({type:[String],json:{write:{isRequired:!0}}})],S.prototype,"fields",void 0),i([o({type:String,json:{write:!0}})],S.prototype,"normalizeField",void 0),i([o({type:[Xe],json:{read:!1}})],S.prototype,"series",void 0),i([o({type:String,json:{write:!0}})],S.prototype,"tooltipField",void 0),S=Ft=i([l("esri.popup.content.support.ChartMediaInfoValue")],S);const Ye=S;let P=class extends Wt{constructor(e){super(e),this.type=null,this.value=void 0}};i([o({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],P.prototype,"type",void 0),i([o({type:Ye,json:{write:{isRequired:!0}}})],P.prototype,"value",void 0),P=i([l("esri.popup.content.mixins.ChartMediaInfo")],P);const ht=P,mt=Ne()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var It;let nt=It=class extends ht{constructor(t){super(t),this.type="bar-chart"}clone(){return new It({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};i([o({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:mt.write,isRequired:!0}}})],nt.prototype,"type",void 0),nt=It=i([l("esri.popup.content.BarChartMediaInfo")],nt);const ve=nt;var bt;let lt=bt=class extends ht{constructor(t){super(t),this.type="column-chart"}clone(){return new bt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};i([o({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:mt.write,isRequired:!0}}})],lt.prototype,"type",void 0),lt=bt=i([l("esri.popup.content.ColumnChartMediaInfo")],lt);const ge=lt;var jt;let U=jt=class extends u{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new jt({linkURL:this.linkURL,sourceURL:this.sourceURL})}};i([o({type:String,json:{write:!0}})],U.prototype,"linkURL",void 0),i([o({type:String,json:{write:{isRequired:!0}}})],U.prototype,"sourceURL",void 0),U=jt=i([l("esri.popup.content.support.ImageMediaInfoValue")],U);const Ze=U;var Nt;let J=Nt=class extends Wt{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new Nt({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};i([o({type:Number,json:{write:!0}})],J.prototype,"refreshInterval",void 0),i([o({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],J.prototype,"type",void 0),i([o({type:Ze,json:{write:{isRequired:!0}}})],J.prototype,"value",void 0),J=Nt=i([l("esri.popup.content.ImageMediaInfo")],J);const xe=J;var St;let at=St=class extends ht{constructor(t){super(t),this.type="line-chart"}clone(){return new St({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};i([o({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:mt.write,isRequired:!0}}})],at.prototype,"type",void 0),at=St=i([l("esri.popup.content.LineChartMediaInfo")],at);const $e=at;var Rt;let pt=Rt=class extends ht{constructor(t){super(t),this.type="pie-chart"}clone(){return new Rt({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};i([o({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:mt.write,isRequired:!0}}})],pt.prototype,"type",void 0),pt=Rt=i([l("esri.popup.content.PieChartMediaInfo")],pt);const Fe=pt,_t={base:Wt,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":ve,"column-chart":ge,"line-chart":$e,"pie-chart":Fe,image:xe}};var Tt;let h=Tt=class extends b{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?xe.fromJSON(e):e.type==="barchart"?ve.fromJSON(e):e.type==="columnchart"?ge.fromJSON(e):e.type==="linechart"?$e.fromJSON(e):e.type==="piechart"?Fe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new Tt(_({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};i([o()],h.prototype,"activeMediaInfoIndex",void 0),i([o({type:Object,json:{write:!0}})],h.prototype,"attributes",void 0),i([o({type:String,json:{write:!0}})],h.prototype,"description",void 0),i([o({types:[_t]})],h.prototype,"mediaInfos",void 0),i([qt("mediaInfos")],h.prototype,"readMediaInfos",null),i([B("mediaInfos")],h.prototype,"writeMediaInfos",null),i([o({type:String,json:{write:!0}})],h.prototype,"title",void 0),i([o({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],h.prototype,"type",void 0),h=Tt=i([l("esri.popup.content.MediaContent")],h);const Z=h;var Ct;let z=Ct=class extends u{constructor(t){super(t),this.field=null,this.order=null}clone(){return new Ct({field:this.field,order:this.order})}};i([o({type:String,json:{write:!0}})],z.prototype,"field",void 0),i([o({type:["asc","desc"],json:{write:!0}})],z.prototype,"order",void 0),z=Ct=i([l("esri.popup.support.RelatedRecordsInfoFieldOrder")],z);const Ie=z;let w=class extends I(b){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};i([o({type:String,json:{write:!0}})],w.prototype,"description",void 0),i([o({type:Number,json:{type:v,write:!0}})],w.prototype,"displayCount",void 0),i([o({type:["list"],json:{write:{isRequired:!0}}})],w.prototype,"displayType",void 0),i([o({type:[Ie],json:{write:!0}})],w.prototype,"orderByFields",void 0),i([o({type:Number,json:{type:v,write:{isRequired:!0}}})],w.prototype,"relationshipId",void 0),i([o({type:String,json:{write:!0}})],w.prototype,"title",void 0),i([o({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],w.prototype,"type",void 0),w=i([l("esri.popup.content.RelationshipContent")],w);const tt=w;var Ot;let V=Ot=class extends b{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new Ot({text:this.text})}};i([o({type:String,json:{write:!0}})],V.prototype,"text",void 0),i([o({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],V.prototype,"type",void 0),V=Ot=i([l("esri.popup.content.TextContent")],V);const et=V;let F=class extends I(u){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};i([o({type:String,json:{write:!0}})],F.prototype,"title",void 0),i([o({type:String,json:{write:!0}})],F.prototype,"description",void 0),i([o({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],F.prototype,"type",void 0),i([o({type:Number,json:{type:v,write:!0}})],F.prototype,"associatedNetworkSourceId",void 0),i([o({type:Number,json:{type:v,write:!0}})],F.prototype,"associatedAssetGroup",void 0),i([o({type:Number,json:{type:v,write:!0}})],F.prototype,"associatedAssetType",void 0),F=i([l("esri.popup.support.UtilityNetworkAssociationType")],F);const ti=F;let R=class extends I(b){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};i([o({type:String,json:{write:!0}})],R.prototype,"description",void 0),i([o({type:Number,json:{type:v,write:!0}})],R.prototype,"displayCount",void 0),i([o({type:String,json:{write:!0}})],R.prototype,"title",void 0),i([o({type:[ti],json:{write:!0}})],R.prototype,"associationTypes",void 0),i([Lt({utilityNetworkAssociations:"utility-network-associations"})],R.prototype,"type",void 0),R=i([l("esri.popup.content.UtilityNetworkAssociationsContent")],R);const Gt=R,ei={base:null,key:"type",typeMap:{attachment:X,media:Z,text:et,expression:ct,field:Y,relationship:tt,utilityNetworkAssociations:Gt}},ii={base:null,key:"type",typeMap:{attachment:X,media:Z,text:et,expression:ct,field:Y,relationship:tt}};var At;let A=At=class extends u{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new At({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};i([o({type:String,json:{write:!0}})],A.prototype,"name",void 0),i([o({type:String,json:{write:!0}})],A.prototype,"title",void 0),i([o({type:String,json:{write:!0}})],A.prototype,"expression",void 0),i([o({type:["string","number"],json:{write:!0}})],A.prototype,"returnType",void 0),A=At=i([l("esri.popup.ExpressionInfo")],A);const oi=A;var Mt;let K=Mt=class extends u{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Mt({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};i([o({type:Boolean,json:{write:!0}})],K.prototype,"returnTopmostRaster",void 0),i([o({type:Boolean,json:{write:!0}})],K.prototype,"showNoDataRecords",void 0),K=Mt=i([l("esri.popup.LayerOptions")],K);const ri=K;var Bt;let H=Bt=class extends u{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Bt({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?_(this.orderByFields):null})}};i([o({type:Boolean,json:{write:!0}})],H.prototype,"showRelatedRecords",void 0),i([o({type:[Ie],json:{write:!0}})],H.prototype,"orderByFields",void 0),H=Bt=i([l("esri.popup.RelatedRecordsInfo")],H);const Xt=H;var Et;let y=Et=class extends De(te){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Et({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};i([o()],y.prototype,"active",void 0),i([o()],y.prototype,"className",void 0),i([o()],y.prototype,"disabled",void 0),i([o()],y.prototype,"icon",void 0),i([o()],y.prototype,"id",void 0),i([o()],y.prototype,"indicator",void 0),i([o()],y.prototype,"title",void 0),i([o()],y.prototype,"type",void 0),i([o()],y.prototype,"visible",void 0),y=Et=i([l("esri.support.actions.ActionBase")],y);const Pt=y;var kt;let ut=kt=class extends Pt{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new kt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};i([o()],ut.prototype,"image",void 0),ut=kt=i([l("esri.support.actions.ActionButton")],ut);const si=ut;var Jt;let Q=Jt=class extends Pt{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Jt({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};i([o()],Q.prototype,"image",void 0),i([o()],Q.prototype,"value",void 0),Q=Jt=i([l("esri.support.actions.ActionToggle")],Q);const ni=Q,L="relationships/",Yt="expression/",li=D.ofType({key:"type",defaultKeyValue:"button",base:Pt,typeMap:{button:si,toggle:ni}}),ai={base:b,key:"type",typeMap:{media:Z,custom:Ge,text:et,attachments:X,fields:Y,expression:ct,relationship:tt,utilityNetworkAssociations:Gt}},be=new Set(["attachments","fields","media","text","expression","relationship"]),pi=new Set([...be,"utility-network-associations"]);let p=class extends I(u){constructor(t){super(t),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(t){return Array.isArray(t)?t.map(e=>Se(ai,e)):typeof t=="string"||typeof t=="function"||t instanceof HTMLElement||Re(t)?t:(_e.getLogger(this).error("content error","unsupported content value",{value:t}),null)}readContent(t,e){const{popupElements:r}=e;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(e.description,e.mediaInfos,r):this._readPopupInfo(e)}writeWebSceneContent(t,e,r,s){this._writePopupTemplateContent(t,e,s)}writeWebMapContent(t,e,r,s){this._writePopupTemplateContent(t,e,s)}writeFieldInfos(t,e,r,s){const{content:n}=this,a=Array.isArray(n)?n:null,{writeFieldFormat:c,...g}=s||{};if(t){const m=a?a.filter(x=>x.type==="fields"):[],ft=m.length&&m.every(x=>x.fieldInfos?.length);e.fieldInfos=t.filter(Boolean).map(x=>{const Ut=x.toJSON(g);return ft&&(Ut.visible=!1),Ut})}if(a)for(const m of a)m.type==="fields"&&this._writeFieldsContent(m,e,g)}writeLayerOptions(t,e,r,s){e[r]=!t||t.showNoDataRecords===null&&t.returnTopmostRaster===null?null:t.toJSON(s)}writeTitle(t,e){e.title=t||""}async collectRequiredFields(t,e,r){const s=this.expressionInfos||[];await this._collectExpressionInfoFields(t,e,r,[...s,...this._getContentExpressionInfos(this.content,s)]),Ee(t,e,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t,e){const r=new Set;return await this.collectRequiredFields(r,t,e),[...r].sort()}_writePopupTemplateContent(t,e,r){typeof t!="string"?Array.isArray(t)&&(e.popupElements=t.filter(s=>r?.origin==="web-scene"?be.has(s.type):pi.has(s.type)).map(s=>s?.toJSON(r)),e.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(e):s.type==="media"?this._writeMediaContent(s,e):s.type==="text"?this._writeTextContent(s,e):s.type==="relationship"&&this._writeRelationshipContent(s,e)})):e.description=t}_writeFieldsContent(t,e,r){const s=t.fieldInfos;if(!Array.isArray(s)||!s.length)return;const n=e.fieldInfos;if(Array.isArray(n))for(const a of s){const c=n.find(g=>g.fieldName?.toLowerCase()===a.fieldName?.toLowerCase());c?c.visible=!0:n.push(a.toJSON(r))}else e.fieldInfos=s.map(a=>a.toJSON(r))}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeRelationshipContent(t,e){const r=t.orderByFields?.map(n=>this._toFieldOrderJSON(n,t.relationshipId))||[],s=[...e.relatedRecordsInfo?.orderByFields||[],...r];e.relatedRecordsInfo={showRelatedRecords:!0,...s?.length&&{orderByFields:s}}}_writeTextContent(t,e){!e.description&&t.text&&(e.description=t.text)}_writeMediaContent(t,e){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const r=_(t.mediaInfos);Array.isArray(e.mediaInfos)?e.mediaInfos=[...e.mediaInfos,...r]:e.mediaInfos=r}_readPopupInfoElements(t,e,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!e||s.mediaInfos||(n.mediaInfos=e,s.mediaInfos=!0),Z.fromJSON(n)):n.type==="text"?(n.text||!t||s.description||(n.text=t,s.description=!0),et.fromJSON(n)):n.type==="attachments"?X.fromJSON(n):n.type==="fields"?Y.fromJSON(n):n.type==="expression"?ct.fromJSON(n):n.type==="relationship"?tt.fromJSON(n):n.type==="utilityNetworkAssociations"?Gt.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(t){const{field:e,order:r}=t;if(!e?.startsWith(L))return null;const s=e.replace(L,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),a=s[1];return!Number.isNaN(n)&&a?tt.fromJSON({relationshipId:n,orderByFields:[{field:a,order:r}]}):null}_toFieldOrderJSON(t,e){const{order:r,field:s}=t;return{field:`${L}${e}/${s}`,order:r}}_readPopupInfo({description:t,mediaInfos:e,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];t?n.push(new et({text:t})):n.push(new Y),Array.isArray(e)&&e.length&&n.push(Z.fromJSON({mediaInfos:e})),r&&n.push(X.fromJSON({displayType:"auto"}));const{showRelatedRecords:a,orderByFields:c}=s;return a&&c?.length&&c.forEach(g=>{const m=this._toRelationshipContent(g);m&&n.push(m)}),n.length?n:t}_getContentElementFields(t){const e=t?.type;if(e==="attachments")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(e==="custom")return t.outFields||[];if(e==="fields")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos??this.fieldInfos)];if(e==="media"){const r=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return e==="text"?this._extractFieldNames(t.text):e==="relationship"||e==="utility-network-associations"?[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)]:[]}_getMediaInfoFields(t){const{caption:e,title:r,value:s}=t,n=s||{},{fields:a,normalizeField:c,tooltipField:g,sourceURL:m,linkURL:ft}=n,x=[...this._extractFieldNames(r),...this._extractFieldNames(e),...this._extractFieldNames(m),...this._extractFieldNames(ft),...a??[]];return c&&x.push(c),g&&x.push(g),x}_getContentExpressionInfos(t,e){return Array.isArray(t)?t.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],e):[]}_getContentFields(t){return typeof t=="string"?this._extractFieldNames(t):Array.isArray(t)?t.reduce((e,r)=>[...e,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(t,e,r,s){s&&await Promise.all(s.map(n=>ke(t,e,r,n.expression)))}_getFieldInfoFields(t){return t?t.filter(({fieldName:e,visible:r})=>!(r!==void 0&&!r||!e||e.startsWith(L)||e.startsWith(Yt))).map(e=>e.fieldName):[]}_getActionsFields(t){return t?t.toArray().reduce((e,r)=>[...e,...this._getActionFields(r)],[]):[]}_getActionFields(t){const{className:e,title:r,type:s}=t,n=s==="button"||s==="toggle"?t.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(e),...this._extractFieldNames(n)]}_getTitleFields(t){return typeof t=="string"?this._extractFieldNames(t):[]}_extractFieldNames(t){return Je(t).filter(e=>!(e.startsWith(L)||e.startsWith(Yt)))}};i([o({type:li})],p.prototype,"actions",void 0),i([o()],p.prototype,"content",void 0),i([Te("content")],p.prototype,"castContent",null),i([qt("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],p.prototype,"readContent",null),i([B("web-scene","content",{popupElements:{type:D.ofType(ii)},showAttachments:{type:Boolean},mediaInfos:{type:D.ofType(_t)},description:{type:String},relatedRecordsInfo:{type:Xt}})],p.prototype,"writeWebSceneContent",null),i([B("content",{popupElements:{type:D.ofType(ei)},showAttachments:{type:Boolean},mediaInfos:{type:D.ofType(_t)},description:{type:String},relatedRecordsInfo:{type:Xt}})],p.prototype,"writeWebMapContent",null),i([o({type:[oi],json:{write:!0}})],p.prototype,"expressionInfos",void 0),i([o({type:[we]})],p.prototype,"fieldInfos",void 0),i([B("fieldInfos")],p.prototype,"writeFieldInfos",null),i([o({type:ri})],p.prototype,"layerOptions",void 0),i([B("layerOptions")],p.prototype,"writeLayerOptions",null),i([o({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],p.prototype,"lastEditInfoEnabled",void 0),i([o()],p.prototype,"outFields",void 0),i([o()],p.prototype,"overwriteActions",void 0),i([o()],p.prototype,"returnGeometry",void 0),i([o({json:{type:String}})],p.prototype,"title",void 0),i([B("title")],p.prototype,"writeTitle",null),p=i([l("esri.PopupTemplate")],p);const Ai=p,je=Symbol("popupProvider");function Mi(t){return typeof t=="object"&&t!==null&&"popupEnabled"in t&&"popupTemplate"in t}function ui(t){return!!t&&je in t}function Bi(t){return ui(t)?t[je]:null}export{Ke as D,Z as I,st as M,je as a,Ue as b,Ni as c,Ie as d,ti as e,we as f,We as g,yt as h,oi as i,et as j,Pe as k,Y as l,q as m,X as n,Mi as o,Xe as p,Ai as q,si as r,ni as s,Bi as t,Pt as u};
