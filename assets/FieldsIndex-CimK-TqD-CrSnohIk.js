import{v as N,I as S,y as I}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{t as O}from"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import{e as B}from"./Point-BfTTZoMu-BAT2Wq6O.js";import{x as $,A as b,v as y,E as _,I as q,_ as v,t as z}from"./lengthUtils-Dt1_RvOO-bleznLOi.js";import{f as F,g as u,N as D,U as L}from"./date-IqUzANpt-bLKO9IDT.js";import{E as h}from"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";function R(n){return"timeZone"in n}function x(n){return"timeZone"in n}function J(n){return"dateFieldsTimeZone"in n}const A=new Map;class m{static fromJSON(e){return new m(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new m(e.fields??[],T(e))}static fromLayerJSON(e){return new m(e.fields??[],T(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const s=[];for(const t of this.fields){const r=t?.name,o=g(r);if(r&&o){const l=d(r);this._fieldsMap.set(r,t),this._fieldsMap.set(l,t),this._normalizedFieldsMap.set(o,t),s.push(`${l}:${t.type}:${this._timeZoneByFieldName?.get(r)}`),$(t)?(this.dateFields.push(t),this._dateFieldsSet.add(t)):b(t)&&(this._numericFieldsSet.add(t),this.numericFields.push(t)),y(t)||_(t)||(t.editable=t.editable==null||!!t.editable,t.nullable=t.nullable==null||!!t.nullable)}}s.sort(),this.uid=s.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)y(e)||_(e)||e.nullable||q(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(d(e))??this._normalizedFieldsMap.get(g(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(N.getLogger("esri.layers.support.FieldsIndex").errorOnce(new S("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),F):Z.has(i.type)?u:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===u?O.instance:i===F?D.utcInstance:I(A,i,()=>L.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return v(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>B(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function d(n){return n.trim().toLowerCase()}function g(n){return z(n)?.toLowerCase()??""}const Z=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function T(n){const e=new Map;if(!n.fields)return e;const i=n.datesInUnknownTimezone===!0,{timeInfo:s,editFieldsInfo:t}=n,r=(s?"startField"in s?s.startField:s.startTimeField:"")??"",o=(s?"endField"in s?s.endField:s.endTimeField:"")??"",l=J(n)?n.dateFieldsTimeZone??null:n.dateFieldsTimeReference?h(n.dateFieldsTimeReference):null,c=t?R(t)?t.timeZone??l:t.dateFieldsTimeReference?h(t.dateFieldsTimeReference):l??F:null,p=s?x(s)?s.timeZone??l:s.timeReference?h(s.timeReference):l:null,w=new Map([[d(t?.creationDateField??""),c],[d(t?.editDateField??""),c],[d(r),p],[d(o),p]]);for(const{name:a,type:f}of n.fields)if(Z.has(f))e.set(a,u);else if(f!=="date"&&f!=="esriFieldTypeDate")e.set(a,null);else if(i)e.set(a,u);else{const M=w.get(d(a??""))??l;e.set(a,M)}return e}export{m};
