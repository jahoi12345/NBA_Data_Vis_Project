import"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{a as w,p as C,u as A}from"./PointCloudUniqueValueRenderer-7tgHeRs5-HegVVIn7.js";import{s as F,c as R,F as x,u as I}from"./I3SBinaryReader-ZmgM2p_h-BnxBvCpV.js";function V(a,r,u,s){const{rendererJSON:d,isRGBRenderer:p}=a;let t=null,n=null;if(r&&p)t=r;else if(r&&d?.type==="pointCloudUniqueValueRenderer"){n=w.fromJSON(d);const e=n.colorUniqueValueInfos;t=new Uint8Array(3*s);const i=m(n.fieldTransformType);for(let l=0;l<s;l++){const c=(i?i(r[l]):r[l])+"";for(let o=0;o<e.length;o++)if(e[o].values.includes(c)){t[3*l]=e[o].color.r,t[3*l+1]=e[o].color.g,t[3*l+2]=e[o].color.b;break}}}else if(r&&d?.type==="pointCloudStretchRenderer"){n=C.fromJSON(d);const e=n.stops;t=new Uint8Array(3*s);const i=m(n.fieldTransformType);for(let l=0;l<s;l++){const c=i?i(r[l]):r[l],o=e.length-1;if(c<e[0].value)t[3*l]=e[0].color.r,t[3*l+1]=e[0].color.g,t[3*l+2]=e[0].color.b;else if(c>=e[o].value)t[3*l]=e[o].color.r,t[3*l+1]=e[o].color.g,t[3*l+2]=e[o].color.b;else for(let f=1;f<e.length;f++)if(c<e[f].value){const b=(c-e[f-1].value)/(e[f].value-e[f-1].value);t[3*l]=e[f].color.r*b+e[f-1].color.r*(1-b),t[3*l+1]=e[f].color.g*b+e[f-1].color.g*(1-b),t[3*l+2]=e[f].color.b*b+e[f-1].color.b*(1-b);break}}}else if(r&&d?.type==="pointCloudClassBreaksRenderer"){n=A.fromJSON(d);const e=n.colorClassBreakInfos;t=new Uint8Array(3*s);const i=m(n.fieldTransformType);for(let l=0;l<s;l++){const c=i?i(r[l]):r[l];for(let o=0;o<e.length;o++)if(c>=e[o].minValue&&c<=e[o].maxValue){t[3*l]=e[o].color.r,t[3*l+1]=e[o].color.g,t[3*l+2]=e[o].color.b;break}}}else t=new Uint8Array(3*s).fill(255);if(u&&n?.colorModulation){const e=n.colorModulation.minValue,i=n.colorModulation.maxValue,l=.3;for(let c=0;c<s;c++){const o=u[c],f=o>=i?1:o<=e?l:l+(1-l)*(o-e)/(i-e);t[3*c]=f*t[3*c],t[3*c+1]=f*t[3*c+1],t[3*c+2]=f*t[3*c+2]}}return t}function B(a,r){if(a.encoding==null||a.encoding===""){const u=R(r,a);if(u.vertexAttributes.position==null)return;const s=x(r,u.vertexAttributes.position),d=u.header.fields,p=[d.offsetX,d.offsetY,d.offsetZ],t=[d.scaleX,d.scaleY,d.scaleZ],n=s.length/3,e=new Float64Array(3*n);for(let i=0;i<n;i++)e[3*i]=s[3*i]*t[0]+p[0],e[3*i+1]=s[3*i+1]*t[1]+p[1],e[3*i+2]=s[3*i+2]*t[2]+p[2];return e}if(a.encoding==="lepcc-xyz")return I(r).result}function J(a,r,u){return a?.attributeInfo.useElevation?r?M(r,u):null:a?.attributeInfo.storageInfo?F(a.attributeInfo.storageInfo,a.buffer,u,!0):null}function M(a,r){const u=new Float64Array(r);for(let s=0;s<r;s++)u[s]=a[3*s+2];return u}function U(a,r,u,s,d){const p=a.length/3;let t=0;for(let n=0;n<p;n++){let e=!0;for(let i=0;i<s.length&&e;i++){const{filterJSON:l}=s[i],c=d[i].values[n];switch(l.type){case"pointCloudValueFilter":{const o=l.mode==="exclude";l.values.includes(c)===o&&(e=!1);break}case"pointCloudBitfieldFilter":{const o=v(l.requiredSetBits),f=v(l.requiredClearBits);(c&o)===o&&(c&f)===0||(e=!1);break}case"pointCloudReturnFilter":{const o=15&c,f=c>>>4&15,b=f>1,k=o===1,y=o===f;let h=!1;for(const g of l.includedReturns)if(g==="last"&&y||g==="firstOfMany"&&k&&b||g==="lastOfMany"&&y&&b||g==="single"&&!b){h=!0;break}h||(e=!1);break}}}e&&(u[t]=n,a[3*t]=a[3*n],a[3*t+1]=a[3*n+1],a[3*t+2]=a[3*n+2],r[3*t]=r[3*n],r[3*t+1]=r[3*n+1],r[3*t+2]=r[3*n+2],t++)}return t}function m(a){switch(a){default:case null:case"none":return r=>r;case"low-four-bit":return r=>15&r;case"high-four-bit":return r=>(240&r)>>4;case"absolute-value":return r=>Math.abs(r);case"modulo-ten":return r=>r%10}}function v(a){let r=0;for(const u of a||[])r|=1<<u;return r}export{J as F,U as J,V as M,M as R,B as T};
