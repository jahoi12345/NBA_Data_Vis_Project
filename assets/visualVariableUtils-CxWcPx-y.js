import{u as E}from"./Color-CERqXxxY.js";import{_ as U}from"./Graphic-B5lJuCvi.js";import{aA as q,i as O}from"./jsonMap-Bs3hmeCU.js";import{m as I}from"./lengthUtils-BsZbNiqt.js";function _(a){return a&&a.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function x(a){return a!=null&&!isNaN(a)&&isFinite(a)}function A(a){return a.valueExpression?"expression":a.field&&typeof a.field=="string"?"field":"unknown"}function ne(a,t){const n=t||A(a),e=a.valueUnit||"unknown";return n==="unknown"?"constant":a.stops?"stops":a.minSize!=null&&a.maxSize!=null&&a.minDataValue!=null&&a.maxDataValue!=null?"clamped-linear":e==="unknown"?a.minSize!=null&&a.minDataValue!=null?a.minSize&&a.minDataValue?"proportional":"additive":"identity":"real-world-size"}const D=()=>O.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=a=>D().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${a}`),z=()=>D().error("Use of arcade expressions requires an arcade context"),k=new U,g=Math.PI,Z=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function M(a,t,n){const e="visualVariables"in a?a.visualVariables?.find(u=>u.type==="color"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void y("ColorVariable");const r=typeof t=="number",l=r?null:t,s=l?.attributes;let o=r?t:null;const i=e.field,{ipData:c,hasExpression:v}=e.cache;let f=e.cache.compiledFunc;if(!i&&!v){const u=e.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(v){if(n?.arcade==null)return void z();const u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(u),V=d.createExecContext(l,h,n.timeZone);if(!f){const w=d.createSyntaxTree(e.valueExpression);f=d.createFunction(w),e.cache.compiledFunc=f}o=d.executeFunction(f,V)}else s&&(o=s[i]);const p=e.normalizationField,m=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||r||!isNaN(m)&&m!==0)){x(m)&&!r&&(o/=m);const u=F(o,c);if(u){const d=u[0],h=u[1],V=d===h?e.stops[d].color:E.blendColors(e.stops[d].color,e.stops[h].color,u[2],n?.color);return new E(V)}}}function R(a,t,n){const e="visualVariables"in a?a.visualVariables?.find(u=>u.type==="opacity"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void y("OpacityVariable");const r=typeof t=="number",l=r?null:t,s=l?.attributes;let o=r?t:null;const i=e.field,{ipData:c,hasExpression:v}=e.cache;let f=e.cache.compiledFunc;if(!i&&!v){const u=e.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(v){if(n?.arcade==null)return void z();const u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},d=n.arcade.arcadeUtils,h=d.getViewInfo(u),V=d.createExecContext(l,h,n.timeZone);if(!f){const w=d.createSyntaxTree(e.valueExpression);f=d.createFunction(w),e.cache.compiledFunc=f}o=d.executeFunction(f,V)}else s&&(o=s[i]);const p=e.normalizationField,m=s!=null&&p!=null?parseFloat(s[p]):void 0;if(o!=null&&(!p||r||!isNaN(m)&&m!==0)){x(m)&&!r&&(o/=m);const u=F(o,c);if(u){const d=u[0],h=u[1];if(d===h)return e.stops[d].opacity;{const V=e.stops[d].opacity;return V+(e.stops[h].opacity-V)*u[2]}}}}function C(a,t,n){const e="visualVariables"in a?a.visualVariables?.find(m=>m.type==="rotation"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void y("RotationVariable");const r=e.axis||"heading",l=r==="heading"&&e.rotationType==="arithmetic"?90:0,s=r==="heading"&&e.rotationType==="arithmetic"?-1:1,o=typeof t=="number"?null:t,i=o?.attributes,c=e.field,{hasExpression:v}=e.cache;let f=e.cache.compiledFunc,p=null;if(!c&&!v)return p;if(v){if(n?.arcade==null)return void z();const m={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},u=n.arcade.arcadeUtils,d=u.getViewInfo(m),h=u.createExecContext(o,d,n.timeZone);if(!f){const V=u.createSyntaxTree(e.valueExpression);f=u.createFunction(V),e.cache.compiledFunc=f}p=u.executeFunction(f,h)}else i&&(p=i[c]);return p=typeof p!="number"||isNaN(p)?null:l+s*p,p}function j(a,t,n){const e=typeof t=="number",r=e?null:t,l=r?.attributes;let s=e?t:null;const{isScaleDriven:o}=a.cache;let i=a.cache.compiledFunc;if(o){const v=n?.scale,f=n?.view;s=v==null||f==="3d"?P(a):v}else if(!e)switch(a.inputValueType){case"expression":{if(n?.arcade==null)return void z();const v={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},f=n.arcade.arcadeUtils,p=f.getViewInfo(v),m=f.createExecContext(r,p,n.timeZone);if(!i){const u=f.createSyntaxTree(a.valueExpression);i=f.createFunction(u),a.cache.compiledFunc=i}s=f.executeFunction(i,m);break}case"field":l&&(s=l[a.field]);break;case"unknown":s=null}if(!x(s))return null;if(e||!a.normalizationField)return s;const c=l?parseFloat(l[a.normalizationField]):null;return x(c)&&c!==0?s/c:null}function P(a){let t=null,n=null;const e=a.stops;return e?(t=e[0].value,n=e[e.length-1].value):(t=a.minDataValue||0,n=a.maxDataValue||0),(t+n)/2}function S(a,t,n){const e="visualVariables"in a?a.visualVariables?.find(l=>l.type==="size"):a;if(!e)return;if(e.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void y("SizeVariable");const r=T(j(e,t,n),e,t,n,e.cache.ipData);return r==null||isNaN(r)?void 0:r}function b(a,t,n){return a==null?null:_(a)?S(a,t,n):x(a)?a:null}function N(a,t,n){return x(n)&&a>n?n:x(t)&&a<t?t:a}function B(a,t,n,e){const r=b(t.minSize,n,e)||t.minDataValue;return a==null&&r==null?null:(a??0)+(r??0)}function L(a,t,n){const e=a.stops;let r=e?.length&&e[0].size;return r==null&&(r=a.minSize),b(r,t,n)}function G(a,t,n,e){const r=b(t.minSize,n,e);if(a==null)return r;const{minDataValue:l,maxDataValue:s}=t;if(l==null||s==null)return null;const o=(a-l)/(s-l),i=b(t.maxSize,n,e),c=e?.shape;if(a<=l)return r;if(a>=s)return i;if(r==null||i==null)return null;if(t.scaleBy==="area"&&c){const v=c==="circle",f=v?g*(r/2)**2:r*r,p=f+o*((v?g*(i/2)**2:i*i)-f);return v?2*Math.sqrt(p/g):Math.sqrt(p)}return r+o*(i-r)}function H(a,t,n,e){const r=b(t.minSize,n,e);if(a==null||r==null)return r;const l=e?.shape,{minDataValue:s}=t;if(s==null)return null;const o=a/s,i=b(t.maxSize,n,e);let c=null;return c=l==="circle"?2*Math.sqrt(o*(r/2)**2):l==="square"||l==="diamond"||l==="image"?Math.sqrt(o*r**2):o*r,N(c,r,i)}function J(a,t,n,e,r){if(a==null)return null;const[l,s,o]=F(a,r);if(l===s)return b(t.stops?.[l].size,n,e);{const i=b(t.stops?.[l].size,n,e),c=b(t.stops?.[s].size,n,e);return i==null||c==null?null:i+(c-i)*o}}function K(a,t,n,e){const r=(e?.resolution??1)*I[t.valueUnit],l=b(t.minSize,n,e),s=b(t.maxSize,n,e),{valueRepresentation:o}=t;if(a==null)return l;let i=null;return i=o==="area"?2*Math.sqrt(a/g)/r:o==="radius"||o==="distance"?2*a/r:a/r,N(i,l,s)}function T(a,t,n,e,r){switch(t.transformationType){case"additive":return B(a,t,n,e);case"constant":return L(t,n,e);case"clamped-linear":return G(a,t,n,e);case"proportional":return H(a,t,n,e);case"stops":return J(a,t,n,e,r);case"real-world-size":return K(a,t,n,e);case"identity":return a;case"unknown":return null}}function Q(a,t,n){const{isScaleDriven:e}=a.cache;if(!(e&&n==="3d"||t))return null;const r={scale:t,view:n};let l=b(a.minSize,k,r),s=b(a.maxSize,k,r);if(l!=null||s!=null){if(l>s){const o=s;s=l,l=o}return{minSize:l,maxSize:s}}}function W(a,t,n){if(!a.visualVariables)return;const e=[],r=[],l=[],s=[],o=[];for(const i of a.visualVariables)switch(i.type){case"color":r.push(i);break;case"opacity":l.push(i);break;case"rotation":o.push(i);break;case"size":s.push(i)}return r.forEach(i=>{const c=M(i,t,n);e.push({variable:i,value:c})}),l.forEach(i=>{const c=R(i,t,n);e.push({variable:i,value:c})}),o.forEach(i=>{const c=C(i,t,n);e.push({variable:i,value:c})}),s.forEach(i=>{const c=S(i,t,n);e.push({variable:i,value:c})}),e}function F(a,t){if(!t)return;let n=0,e=t.length-1;return t.some((r,l)=>a<r?(e=l,!0):(n=l,!1)),[n,e,(a-t[n])/(t[e]-t[n])]}function X(a,t,n){const e=["proportional","proportional","proportional"];for(const r of a){const l=r.useSymbolValue?"symbol-value":S(r,t,n)??"proportional";switch(r.axis){case"width":e[0]=l;break;case"depth":e[1]=l;break;case"height":e[2]=l;break;case"width-and-depth":e[0]=l,e[1]=l;break;case"all":case void 0:case null:e[0]=l,e[1]=l,e[2]=l;break;default:q(r.axis)}}return e}const te=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:X,getColor:M,getOpacity:R,getRotationAngle:C,getSize:S,getSizeForValue:T,getSizeFromNumberOrVariable:b,getSizeRangeAtScale:Q,getVisualVariableValues:W,viewScaleRE:Z},Symbol.toStringTag,{value:"Module"}));export{W as D,X as U,te as a,M as d,A as i,ne as l,C as m,_ as n,Z as p,R as v};
