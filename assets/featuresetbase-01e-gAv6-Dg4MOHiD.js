import{s as Me}from"./Graphic-DgGzDmqW-d1CNicxz.js";import{r as Re}from"./TimeOnly-BERR31kg-CQiLyUZi.js";import{t as Oe,l as le}from"./arcade-zfxT_nQK-BUKByHhX.js";import{K as v,m as Ge,k as me,u as U,A as R,a as k,p as Ve,i as Ne,c as Te,l as Ee,U as j,s as J,L as te,w as W,M as ze,b as Q,a8 as He,I as ne}from"./Dictionary-B4WY1XGX-DPfLsCo2.js";import{u as p,T as $e,c as We}from"./enum-BzLwmiID-CcyIdWlQ.js";import{I as _e}from"./Feature-BVRwBUzm-CdKSTB7Z.js";import{v as Ke,R as De,y as qe,h as ue,e as Je,i as Qe,s as Be,F as oe,E as Ye,k as Xe,O as et,a as $,I as tt,D as ie,b as L,x as de}from"./featureSetUtils-ChgF7kv_-DzFrfZ8q.js";import{h as nt}from"./ImmutableArray-BPVd6ESQ-BGk4ZTNG.js";import{l as it}from"./portalUtils-CnpwenOG-DKdnPlyB.js";import{I as ot,o as ve}from"./SpatialFilter-BsNcxI05-43y_KqcT.js";import{_ as ke,D as ce}from"./shared-yd-CR64C-BEo7YVMh.js";import{N as rt,ai as at,v as st,a7 as we,aD as lt,aK as q,Y as b,H as D,G as ae,K as Se}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{L as E}from"./WhereClause-BSVqskBz-CT_IXPhv.js";import Le from"./FeatureLayer-BRWpcy_W-D7AhvLUt.js";import{o as P}from"./Field-Cm_ZejYW-CwJZmSru.js";import{l as xe}from"./collectionUtils-jDyktm0P-BDP2Oq99.js";import{H as mt}from"./Point-BfTTZoMu-DeJwQYfh.js";import{J as ut,d as dt,q as ct}from"./utils-CylVuxNi--x86XOjU.js";import{u as Ae}from"./reader-DcGs6kKN-DHJfK-tm.js";import{n as ft}from"./Polyline-CoiTLswR-DTxpB2Yg.js";import{t as K}from"./NetworkElement-BXc67_5E-DNTBtQTx.js";import{f as Z,Z as A,j as pt}from"./lengthUtils-Dt1_RvOO-j3MEdmHu.js";import"./getPopupProvider-CmskPttI-CzUWpGwk.js";import"./Color-CERqXxxY-BuYn26eI.js";import"./mathUtils-PIGhLnI9-B1tKUlUb.js";import"./date-IqUzANpt-bLKO9IDT.js";import"./reactiveUtils-SO2Ko3sy-BCLX8Jdy.js";import"./Layer-DZvC7bne-D3VLDrab.js";import"./index-B0z_nLWi.js";import"./Extent-CgDMOSRD-Bod5LY6s.js";import"./Polygon-D6wEPb3W-D2MPjRU4.js";import"./typeUtils-DqrRcjBx-DZ6_Gsbu.js";import"./typeUtils-CXW_VpOn-BGgLp_TK.js";import"./lineMarkers-CDwLe3J6-CNUjJvs3.js";import"./PolygonSymbol3D-BXRHZiCQ-BjPAY2LA.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x-CsVYZCeG.js";import"./aaBoundingBox-Cn49X7ge-BcYPaJ58.js";import"./mat4f64-q_b6UJoq-Dh6sWB_w.js";import"./Font-BwmnW7d2-Dwh3xjKw.js";import"./SimpleFillSymbol-CDawtd9z-CWD2KI2D.js";import"./SimpleMarkerSymbol-BGAFRS9_-CVQ5NLIA.js";import"./PictureMarkerSymbol-CaSh-vZk-xhjZ61bb.js";import"./TextSymbol-hRGhyDHs-CoS7dSjf.js";import"./UnknownTimeZone-B697BDFv-CBbtul7O.js";import"./aiServices-BQaMAyiK-Bd9y7e2i.js";import"./unitConversion-C1kMoaUu-BTuDmVw5.js";import"./featureLayerUtils-FKjLNPl_-Cv8vWd4i.js";import"./asyncUtils-w6KfWU41-HenJ0UOu.js";import"./Query-BlS0WPDF-jdXS_Qhy.js";import"./SimpleRenderer-CEmCWePp-BJ25mYcH.js";import"./commonProperties-DbO613LF-CHjBvYhj.js";import"./colorRamps-DswZzxkO-BqSFavfl.js";import"./ColorStop-De5gQTjr-C1lw16u9.js";import"./visualVariableUtils-ma4r7Z2K-Df6C3Hkh.js";import"./defaults3D-C2hXSee1-CTj29-Ly.js";import"./defaults-BDN9qxeN-C-EfxQM4.js";import"./UniqueValueRenderer-JPjz9Qvs-Duu1CubQ.js";import"./RendererLegendOptions-ByGHYLtx-Bwoo6l33.js";import"./NormalizationBinParametersMixin-BK9wNkI3-BKYeOhDN.js";import"./FeatureType-CFJlAOcG-DepIzvPz.js";import"./FeatureTemplate-Bur8tORn-C24tlGMe.js";import"./PortalItem-DnxMlRVo-CI4Ns2_M.js";import"./workers-BEkgoq8Q-BM_Hz460.js";import"./intl-DRFqUect-DPhFaHB2.js";import"./MultiOriginJSONSupport-Bd1TKmh_-BHNF5tHX.js";import"./FormTemplate-DuPZvaVv-DtJsNdqp.js";import"./GraphicOrigin-uE6TDXc9-DqbdmNAV.js";import"./projectionUtils-BGH_5_I3-DGwchVO8.js";import"./FeatureSet-BF7daP96-B_JvMbY7.js";import"./mat4f32-Djp3mnm5-DzYG3LYB.js";import"./mat4-C96X-Nn0-BrMLOLCb.js";import"./DisplayFilteredLayer-DyjtPayS-DLMYIA49.js";import"./EditBusLayer-rxUbWTiY-BxA39RQ7.js";import"./FeatureEffect-mVCOF1v6--fvFHZv2.js";import"./FeatureFilter-G4_pWMVe-D0hu4KAy.js";import"./FeatureLayerBase-BUeDgO3U-q6RnYMdc.js";import"./HeightModelInfo-D5IdRvJ2-23y6MRiu.js";import"./OperationalLayer-B6zbJ5nR-DyK_ztCk.js";import"./ElevationInfo-Cw2HaA6E-CuK5hJ96.js";import"./unitConversionUtils-4vB4Ezlp-DnY5MDxd.js";import"./LayerFloorInfo-CTubHTci-DciGdwJt.js";import"./Relationship-CrANqG2c-DiHDOAEy.js";import"./FeatureReductionLayer-Bhh5MvS_-6_Dufsno.js";import"./FeatureReductionSelection-Du7o8OIG-DmruV-ou.js";import"./labelingInfo-BYG2hiVF-B7-dv03v.js";import"./jsonUtils-BCGKNxno-DZ1Xr_O8.js";import"./typeUtils-DDFS4uuz-B7KgP61w.js";import"./ClassBreaksRenderer-BvgdqtTq-D2fU8Sng.js";import"./LRUCache-fy84PBMi-Y56WPIvD.js";import"./vec42-B8VM4vXb-B6OGOEI9.js";import"./vec4f64-DPb6J-GU-C7c2DqbZ.js";import"./OrderedLayer-DQAUgUTV-CpnQmtbN.js";import"./RefreshableLayer-CBbEkZf--DylHaNOC.js";import"./TimeInfo-D7ssmbZO-Burc-nDV.js";import"./TrackableLayer-B-086Hm8-C0H4r_hG.js";import"./TitleCreator-BosRD8XX-Cm4g2hqp.js";import"./sanitizerUtils-BT_8V5US-CWQWUwZQ.js";import"./versionUtils-BfuZvWmP-RYMRQmOM.js";import"./fieldType-DVUzXtk_-tUuvnZJM.js";import"./jsonUtils-CmpazY1u-6pDLj5sx.js";import"./createFeatureId-CVwTD0fV-3fKpJDrk.js";import"./arcadeEnvironment-DqZGrNFy-B7LAcj80.js";import"./streamLayerUtils-DFlbJ4P1-DFlbJ4P1.js";import"./number-D_FvV3D1-OQFavbmh.js";import"./hash-CcEbRgUF-DpReY683.js";import"./uuid-Oe6SV2kF-IYX19xBA.js";import"./featureConversionUtils-BDA_FXJx-CDxX1Wik.js";import"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import"./OptimizedFeature-CwRGZPwv-Ddclhn0A.js";import"./memoryEstimations-Bd726a_p-0cVCY2Jz.js";import"./OptimizedFeatureSet-BR8EEvDc-CgsRgxJh.js";import"./DoubleArray-DExKNiTh-CvVpHySW.js";import"./FieldsIndex-CimK-TqD--24JoCkp.js";import"./timeZoneUtils-BSc7-7qA-BAv3h8mh.js";import"./commonProperties-DHiB1uzW-DHiB1uzW.js";import"./SimpleObservable-CvFyr0NA-DXpoMYph.js";import"./MD5-MtSiOt06-jWr180Yc.js";import"./operatorsWorkerConnection-DB7Gw949-xZQu01kQ.js";import"./Queue-CYlrXMwB-CYJTUII-.js";import"./screenUtils-BitdhK1O-L0FLPAMi.js";import"./opacityUtils-DuFH0EC9-DWspTgn2.js";import"./layerContainerType-CSXZNpHb-BIF7XAYP.js";import"./isFeatureGraphicOrigin-YA2hudPe-Bk2FjH_E.js";import"./editsZScale-D3N5iH_c-CCATcpvE.js";import"./queryZScale-CRP3Sh_E-F3y679Wx.js";import"./APIKeyMixin--YGbad8e-DJ-JJTX5.js";import"./ArcGISService-SIwch9bz-DEFXc423.js";import"./BlendLayer-HE_aYHHW-D0es7Iiq.js";import"./jsonUtils-CY6YsQMo-LM0PY-PG.js";import"./CustomParametersMixin-Dshqz1Zp-BFC165kX.js";import"./scaleUtils-yfx9kKWT-D9SVsyM-.js";import"./displayFilterUtils-CIXGrQzt-XEoxkZ3i.js";import"./FeatureEffectLayer-BG_KTtPw-C05GQDNc.js";import"./layerUtils-DZGhvm-W-CfyHx1TZ.js";import"./multiLayerServiceUtils-CpHWiXA7-HO_F3Kjq.js";import"./serviceCapabilitiesUtils-BV_pcUiO-Dw-u7_oZ.js";import"./infoFor3D-DhzudQro-CCYgWfsv.js";import"./portalItemUtils-CaPNUJg6-CXDHI5LA.js";import"./labelUtils-BtizwBfq-Zegx4520.js";import"./defaultsJSON-GKolV7NZ-GKolV7NZ.js";import"./jsonUtils-C9q_FK4K-GRCbm_Pe.js";import"./DictionaryScriptEvaluator-G73uSGpN-ErvAW-Hm.js";import"./Version-BtYZEj58-LyRHDnSJ.js";import"./ArcadeExpression-BlIRq-oN-VZkrwLVE.js";import"./utils-DX2muIr3-DiPfFKSl.js";import"./heatmapUtils-B-AXnq0l-BF3Q_jd2.js";import"./diffUtils-wTC1YzlE-DCTUTUs8.js";import"./styleUtils-DWvicjTN-DL6_BIk4.js";import"./PortalLayer-CbFNhtZ4-Doeialq-.js";import"./ScaleRangeLayer-DQr2T3Hh-Dh1UYk4i.js";import"./TemporalLayer-D4R0YvXo-PSBzKw25.js";import"./fieldProperties-BoJj55FN-DI1Lssr9.js";import"./styleUtils-CZJC3pZm-BNE6B1Si.js";import"./popupUtils-D4UavgYz-DI7Mb3me.js";import"./featureQueryAll-BfDWA5Wx-BKksFkIA.js";new q({Clean:"clean",Dirty:"dirty"});new q({Physical:"physical",Virtual:"virtual"});new q({"Start and end":"start-and-end",Start:"start",Midspan:"midspan",End:"end"});new q({startingPoint:"starting-point",barrier:"barrier",stoppingPoint:"stopping-point"});new q({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation",path:"path",circuit:"circuit"});const Ue="{00000000-0000-0000-0000-000000000000}",O=new q({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"});new q({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let _=class extends K{constructor(n){super(n),this.type="telecomNetworkElement",this.firstUnit=null,this.numUnits=null}};b([D({json:{write:!1}})],_.prototype,"type",void 0),b([D({json:{write:!0}})],_.prototype,"firstUnit",void 0),b([D({json:{write:!0}})],_.prototype,"numUnits",void 0),_=b([ae("esri.rest.networks.support.TelecomNetworkElement")],_);let x=class extends we{constructor(n){super(n),this.globalId=null,this.associationType=null,this.fromNetworkElement=null,this.toNetworkElement=null,this.geometry=null,this.errorMessage=null,this.percentAlong=null,this.errorCode=null,this.isContentVisible=null,this.status=null}readFromNetworkElement(n,l){return l.fromFirstUnit||l.fromNumUnits?new _({globalId:l.fromGlobalId,networkSourceId:l.fromNetworkSourceId,terminalId:l.fromTerminalId,firstUnit:l.fromFirstUnit,numUnits:l.fromNumUnits}):new K({globalId:l.fromGlobalId,networkSourceId:l.fromNetworkSourceId,terminalId:l.fromTerminalId})}writeFromNetworkElement(n,l){if(n&&(l.fromGlobalId=n.globalId,l.fromNetworkSourceId=n.networkSourceId,l.fromTerminalId=n.terminalId,n.type==="telecomNetworkElement")){const t=n;l.fromFirstUnit=t.firstUnit,l.fromNumUnits=t.numUnits}}readToNetworkElement(n,l){return l.toFirstUnit||l.toNumUnits?new _({globalId:l.toGlobalId,networkSourceId:l.toNetworkSourceId,terminalId:l.toTerminalId,firstUnit:l.toFirstUnit,numUnits:l.toNumUnits}):new K({globalId:l.toGlobalId,networkSourceId:l.toNetworkSourceId,terminalId:l.toTerminalId})}writeToNetworkElement(n,l){if(n&&(l.toGlobalId=n.globalId,l.toNetworkSourceId=n.networkSourceId,l.toTerminalId=n.terminalId,n.type==="telecomNetworkElement")){const t=n;l.toFirstUnit=t.firstUnit,l.toNumUnits=t.numUnits}}equals(n){if(this.globalId===Ue&&n.globalId===Ue){let l=function(a,s){return a.networkSourceId===s.networkSourceId&&a.globalId===s.globalId&&a.terminalId===s.terminalId&&a.firstUnit===s.firstUnit&&a.numUnits===s.numUnits};const t=this.fromNetworkElement,o=this.toNetworkElement,w=n.fromNetworkElement,I=n.toNetworkElement,e=l(t,w),i=l(o,I);return e&&i&&this.associationType===n.associationType}return this.globalId!=null&&n.globalId!=null&&this.globalId===n.globalId}};b([D({type:String,json:{write:!0}})],x.prototype,"globalId",void 0),b([D({type:O.apiValues,json:{type:O.jsonValues,read:O.read,write:O.write}})],x.prototype,"associationType",void 0),b([D({type:K,json:{write:{target:{fromGlobalId:{type:String},fromNetworkSourceId:{type:Number},fromTerminalId:{type:Number},fromFirstUnit:{type:Number},fromNumUnits:{type:Number}}},read:{source:["fromGlobalId","fromNetworkSourceId","fromTerminalId","fromFirstUnit","fromNumUnits"]}}})],x.prototype,"fromNetworkElement",void 0),b([Ae("fromNetworkElement")],x.prototype,"readFromNetworkElement",null),b([Se("fromNetworkElement")],x.prototype,"writeFromNetworkElement",null),b([D({type:K,json:{write:{target:{toGlobalId:{type:String},toNetworkSourceId:{type:Number},toTerminalId:{type:Number},toFirstUnit:{type:Number},toNumUnits:{type:Number}}},read:{source:["toGlobalId","toNetworkSourceId","toTerminalId","toFirstUnit","toNumUnits"]}}})],x.prototype,"toNetworkElement",void 0),b([Ae("toNetworkElement")],x.prototype,"readToNetworkElement",null),b([Se("toNetworkElement")],x.prototype,"writeToNetworkElement",null),b([D({type:ft,json:{write:!0}})],x.prototype,"geometry",void 0),b([D({type:String,json:{write:!0}})],x.prototype,"errorMessage",void 0),b([D({type:Number,json:{write:!0}})],x.prototype,"percentAlong",void 0),b([D({type:Number,json:{write:!0}})],x.prototype,"errorCode",void 0),b([D({type:Boolean,json:{write:!0}})],x.prototype,"isContentVisible",void 0),b([D({type:Number,json:{write:!0}})],x.prototype,"status",void 0),x=b([ae("esri.rest.networks.support.Association")],x);let re=class extends we{constructor(n){super(n),this.associations=[]}};b([D({type:[x],json:{write:!0}})],re.prototype,"associations",void 0),re=b([ae("esri.rest.networks.support.QueryAssociationsResult")],re);function yt(n){const{returnDeletes:l,elements:t,gdbVersion:o,moment:w}=n.toJSON();return{returnDeletes:l,elements:JSON.stringify(t.map(I=>({globalId:I.globalId,networkSourceId:I.networkSourceId,terminalId:I.terminalId}))),types:JSON.stringify(n.types.map(I=>O.toJSON(I))).replaceAll('"connectivity"','"junctionJunctionConnectivity"'),gdbVersion:o,moment:w??Date.now()}}async function wt(n,l,t){const o=ut(n),w={...yt(l),f:"json"},I=dt({...o.query,...w}),e=ct(I,{...t,method:"post"}),i=`${o.path}/associations/query`,{data:a}=await mt(i,e),s=re.fromJSON(a);return l.types.includes("connectivity")&&at(st.getLogger("esri/rest/networks/support/QueryAssociationsParameters"),"types",{replacement:"Please use 'junction-junction-connectivity' instead of 'connectivity'.",see:"https://arcg.is/11Tr8a#types",version:"4.29",warnOnce:!0}),s}var pe;let z=pe=class extends we{static from(n){return lt(pe,n)}constructor(n){super(n),this.returnDeletes=!1,this.elements=[],this.types=[],this.gdbVersion=null,this.moment=null}};b([D({type:Boolean,json:{write:!0}})],z.prototype,"returnDeletes",void 0),b([D({type:[K],json:{write:!0}})],z.prototype,"elements",void 0),b([D({type:[O.apiValues],json:{type:O.jsonValues,read:O.read,write:O.write}})],z.prototype,"types",void 0),b([D({type:String,json:{write:!0}})],z.prototype,"gdbVersion",void 0),b([D({type:Date,json:{type:Number,write:{writer:(n,l)=>{l.moment=n?.getTime()}}}})],z.prototype,"moment",void 0),z=pe=b([ae("esri.rest.networks.support.QueryAssociationsParameters")],z);function It(n){if(n.length===1){if(A(n[0]))return le("distinct",n[0],-1);if(W(n[0]))return le("distinct",n[0].toArray(),-1)}return le("distinct",n,-1)}function fe(n,l,t){const o=n.getVariables();if(o.length>0){const w={};for(const I of o)w[I]=l.evaluateIdentifier(t,{name:I});n.parameters=w}return n}function d(n,l,t=null){for(const o in n)if(o.toLowerCase()===l.toLowerCase())return n[o];return t}function Ce(n){if(n===null)return null;const l={type:d(n,"type",""),name:d(n,"name","")};if(l.type==="range")l.range=d(n,"range",[]);else{l.codedValues=[];for(const t of d(n,"codedValues",[]))l.codedValues.push({name:d(t,"name",""),code:d(t,"code",null)})}return l}function ye(n){if(n===null)return null;const l={},t=d(n,"wkt");t!==null&&(l.wkt=t);const o=d(n,"wkid");return o!==null&&(l.wkid=o),l}function je(n){if(n===null)return null;const l={hasZ:d(n,"hasz",!1),hasM:d(n,"hasm",!1)},t=d(n,"spatialreference");t!=null&&(l.spatialReference=ye(t));const o=d(n,"x",null);if(o!==null)return l.x=o,l.y=d(n,"y",null),l.hasZ&&(l.z=d(n,"z",null)),l.hasM&&(l.m=d(n,"m",null)),l;const w=d(n,"rings",null);if(w!==null)return l.rings=w,l;const I=d(n,"paths",null);if(I!==null)return l.paths=I,l;const e=d(n,"points",null);if(e!==null)return l.points=e,l;for(const i of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const a=d(n,i,null);a!==null&&(l[i]=a)}return l}function gt(n,l){for(const t of l)if(t===n)return!0;return!1}function ht(n){return!!n.layerDefinition&&!!n.featureSet&&gt(n.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&A(n.layerDefinition.fields)!==!1&&A(n.featureSet.features)!==!1}function B(n){return n?.toLowerCase()==="utc"?"UTC":n?.toLowerCase()==="unknown"?"Unknown":n}async function bt(n,l,t,o,w,I,e){const i=await n.getFeatureSetInfo();if((i?.layerId??null)===null||!w.layerIdLookup.get(i.layerId))return null;const a=n.serviceUrl().replace(/\/FeatureServer/i,"/UtilityNetworkServer"),s=[];switch(t){case"connected":s.push("connectivity"),s.push("junction-edge-from-connectivity"),s.push("junction-edge-to-connectivity"),s.push("junction-edge-midspan-connectivity"),s.push("junction-junction-connectivity");break;case"container":case"content":s.push("containment");break;case"structure":case"attached":s.push("attachment");break;case"junctionedge":s.push("junction-edge-from-connectivity"),s.push("junction-edge-to-connectivity");break;case"midspan":s.push("junction-edge-midspan-connectivity");break;default:throw new p(I,"InvalidParameter",e)}let y=null,c=!1;if(o!==null&&o!==""&&o!==void 0){for(const u of w.terminals)u.terminalName===o&&(y=u.terminalId);y===null&&(c=!0)}const m=[];if(!c){const u=new K({globalId:l.field(n.globalIdField),networkSourceId:w.layerIdLookup.get(i.layerId).sourceId,...y?{terminalId:y}:""}),f=await wt(a,new z({types:s,elements:[u]}));let S=0;for(const g of f.associations){let h=null,T="",M="";if(g.fromNetworkElement?.globalId===u.globalId?(h=g.toNetworkElement,M="to"):g.toNetworkElement?.globalId===u.globalId&&(h=g.fromNetworkElement,M="from"),!h)continue;switch(t){case"attached":if(g.associationType!=="attachment"||M!=="to")continue;break;case"structure":if(g.associationType!=="attachment"||M!=="from")continue;break;case"container":if(g.associationType!=="containment"||M!=="from")continue;break;case"content":if(g.associationType!=="containment"||M!=="to")continue;break;case"connected":break;case"junctionedge":g.associationType==="junction-edge-to-connectivity"?T="to":g.associationType==="junction-edge-from-connectivity"&&(T="from");break;case"midspan":if(g.associationType!=="junction-edge-midspan-connectivity")continue}const Y=w.sourceIdLookup.get(h.networkSourceId)?.className??"";m.push(new Me({geometry:null,attributes:{objectId:S++,globalId:h.globalId,percentAlong:g.percentAlong??0,isContentVisible:g.isContentVisible?0:1,className:Y,side:T}}))}}const r=new Le({source:m,geometryType:null,objectIdField:"objectId",globalIdField:"globalId",fields:[new P({name:"objectId",alias:"objectId",type:"oid"}),new P({name:"globalId",alias:"globalId",type:"global-id"}),new P({name:"percentAlong",alias:"percentAlong",type:"double"}),new P({name:"side",alias:"side",type:"string"}),new P({name:"isContentVisible",alias:"isContentVisible",type:"integer"}),new P({name:"className",alias:"className",type:"string"})]});return oe(r)}function wo(n){if(n.mode==="async"){n.functions.timezone=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,1,2,t,o),Ge(e[0])||me(e[0]))return"Unknown";if(U(e[0])){if(await e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?B("unknown"):B(e[0].dateFieldsTimeZone);if(!(e[1]instanceof R)||e[1].hasField("type")===!1)throw new p(t,"InvalidParameter",o);const s=e[1].field("type");if(Z(s)===!1)throw new p(t,"InvalidParameter",o);switch(k(s).toLowerCase()){case"preferredtimezone":return B(e[0].preferredTimeZone);case"editfieldsinfo":return B(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return B(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&Z(e[1].field("fieldname")))return B(e[0].fieldTimeZone(k(e[1].field("fieldname"))))}throw new p(t,"InvalidParameter",o)}const i=Ve(e[0],Ne(t));if(i===null)return null;const a=i.timeZone;return a==="system"?Re.systemTimeZoneCanonicalName:a.toLowerCase()==="utc"?"UTC":a.toLowerCase()==="unknown"?"Unknown":a})},n.functions.sqltimestamp=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{v(e,1,3,t,o);const i=e[0];if(Te(i)){if(e.length===1)return i.toSQLWithKeyword();if(e.length===2)return i.changeTimeZone(k(e[1])).toSQLWithKeyword();throw new p(t,"InvalidParameter",o)}if(me(i))return i.toSQLWithKeyword();if(U(i)){if(e.length!==3)throw new p(t,"InvalidParameter",o);await i.load();const a=k(e[1]);if(me(e[2]))return e[2].toSQLWithKeyword();if(Te(e[2])===!1)throw new p(t,"InvalidParameter",o);const s=i.fieldTimeZone(a);return s==null?e[2].toSQLWithKeyword():e[2].changeTimeZone(s).toSQLWithKeyword()}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"sqltimestamp",min:2,max:4}),n.functions.featuresetbyid=function(t,o){return n.standardFunctionAsync(t,o,(w,I,e)=>{if(v(e,2,4,t,o),Ee(e[0])){const i=k(e[1]);let a=j(e[2],null);const s=J(j(e[3],!0));if(a===null&&(a=["*"]),A(a)===!1)throw new p(t,"InvalidParameter",o);return e[0].featureSetById(i,s,a)}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"featuresetbyid",min:2,max:4});const l=new $e(["datasource","parent","root"]);n.functions.getfeatureset=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,1,2,t,o),te(e[0])){const i=e[1]==null?"datasource":l.lookup(k(e[1]));return Ke(e[0].fullSchema(),i,t.lrucache,t.interceptor,t.spatialReference)}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"getfeatureset",min:1,max:2}),n.functions.featuresetbyportalitem=function(t,o){return n.standardFunctionAsync(t,o,(w,I,e)=>{if(v(e,2,5,t,o),e[0]===null)throw new p(t,"PortalRequired",o);if(e[0]instanceof Oe){const c=k(e[1]),m=k(e[2]);let r=j(e[3],null);const u=J(j(e[4],!0));if(r===null&&(r=["*"]),A(r)===!1)throw new p(t,"InvalidParameter",o);let f;return f=t.services?.portal?t.services.portal:xe.getDefault(),f=it(e[0],f),De(c,m,t.spatialReference,r,u,f,t.lrucache,t.interceptor)}if(Z(e[0])===!1)throw new p(t,"PortalRequired",o);const i=k(e[0]),a=k(e[1]);let s=j(e[2],null);const y=J(j(e[3],!0));if(s===null&&(s=["*"]),A(s)===!1)throw new p(t,"InvalidParameter",o);return De(i,a,t.spatialReference,s,y,t.services?.portal??xe.getDefault(),t.lrucache,t.interceptor)})},n.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),n.functions.featuresetbyname=function(t,o){return n.standardFunctionAsync(t,o,(w,I,e)=>{if(v(e,2,4,t,o),Ee(e[0])){const i=k(e[1]);let a=j(e[2],null);const s=J(j(e[3],!0));if(a===null&&(a=["*"]),A(a)===!1)throw new p(t,"InvalidParameter",o);return e[0].featureSetByName(i,s,a)}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"featuresetbyname",min:2,max:4}),n.functions.featureset=function(t,o){return n.standardFunction(t,o,(w,I,e)=>{v(e,1,1,t,o);const i={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(Z(e[0])){const a=JSON.parse(e[0]);a.layerDefinition!==void 0?(i.layerDefinition=a.layerDefinition,i.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(i.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(i.featureSet.features=a.features,i.featureSet.geometryType=a.geometryType,i.layerDefinition.geometryType=i.featureSet.geometryType,i.layerDefinition.objectIdField=a.objectIdFieldName??"",i.layerDefinition.typeIdField=a.typeIdFieldName,i.layerDefinition.globalIdField=a.globalIdFieldName,i.layerDefinition.fields=a.fields,a.spatialReference&&(i.layerDefinition.spatialReference=a.spatialReference))}else{if(!(e[0]instanceof R))throw new p(t,"InvalidParameter",o);{const a=JSON.parse(e[0].castToText(!0)),s=d(a,"layerdefinition");if(s!==null){i.layerDefinition.geometryType=d(s,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.globalIdField=d(s,"globalidfield",""),i.layerDefinition.objectIdField=d(s,"objectidfield",""),i.layerDefinition.typeIdField=d(s,"typeidfield",""),i.layerDefinition.hasZ=d(s,"hasz",!1)===!0,i.layerDefinition.hasM=d(s,"hasm",!1)===!0;const y=d(s,"spatialreference");y&&(i.layerDefinition.spatialReference=ye(y));const c=[];for(const r of d(s,"fields",[])){const u={name:d(r,"name",""),alias:d(r,"alias",""),type:d(r,"type",""),nullable:d(r,"nullable",!0),editable:d(r,"editable",!0),length:d(r,"length",null),domain:Ce(d(r,"domain"))};c.push(u)}i.layerDefinition.fields=c;const m=d(a,"featureset");if(m){const r={};for(const u of c)r[u.name.toLowerCase()]=u.name;for(const u of d(m,"features",[])){const f={},S=d(u,"attributes",{});for(const g in S)f[r[g.toLowerCase()]]=S[g];i.featureSet.features.push({attributes:f,geometry:je(d(u,"geometry"))})}}}else{i.layerDefinition.hasZ=d(a,"hasz",!1)===!0,i.layerDefinition.hasM=d(a,"hasm",!1)===!0,i.layerDefinition.geometryType=d(a,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.objectIdField=d(a,"objectidfieldname",""),i.layerDefinition.typeIdField=d(a,"typeidfieldname","");const y=d(a,"spatialreference");y&&(i.layerDefinition.spatialReference=ye(y));const c=[],m=d(a,"fields",null);if(!A(m))throw new p(t,"InvalidParameter",o);for(const f of m){const S={name:d(f,"name",""),alias:d(f,"alias",""),type:d(f,"type",""),nullable:d(f,"nullable",!0),editable:d(f,"editable",!0),length:d(f,"length",null),domain:Ce(d(f,"domain"))};c.push(S)}i.layerDefinition.fields=c;const r={};for(const f of c)r[f.name.toLowerCase()]=f.name;let u=d(a,"features",null);if(A(u))for(const f of u){const S={},g=d(f,"attributes",{});for(const h in g)S[r[h.toLowerCase()]]=g[h];i.featureSet.features.push({attributes:S,geometry:je(d(f,"geometry",null))})}else u=null,i.featureSet.features=u}}}if(ht(i)===!1)throw new p(t,"InvalidParameter",o);return i.layerDefinition.geometryType||(i.layerDefinition.geometryType="esriGeometryNull"),qe.create(i,t.spatialReference)})},n.signatures.push({name:"featureset",min:1,max:1}),n.functions.filter=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,2,2,t,o),A(e[0])||W(e[0])){const i=[];let a,s=e[0];if(s instanceof nt&&(s=s.toArray()),!ze(e[1]))throw new p(t,"InvalidParameter",o);a=e[1].createFunction(t);for(const y of s){const c=a(y);rt(c)?await c===!0&&i.push(y):c===!0&&i.push(y)}return i}if(U(e[0])){const i=await e[0].load(),a=E.create(e[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),s=a.getVariables();if(s.length>0){const y={};for(const c of s)y[c]=n.evaluateIdentifier(t,{name:c});a.parameters=y}return new ue({parentfeatureset:e[0],whereclause:a})}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"filter",min:2,max:2}),n.functions.orderby=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,2,2,t,o),U(e[0])){const i=new Je(e[1]);return new Qe({parentfeatureset:e[0],orderbyclause:i})}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"orderby",min:2,max:2}),n.functions.top=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,2,2,t,o),U(e[0]))return new Be({parentfeatureset:e[0],topnum:e[1]});if(A(e[0]))return Q(e[1])>=e[0].length?e[0].slice():e[0].slice(0,Q(e[1]));if(W(e[0]))return Q(e[1])>=e[0].length()?e[0].slice():e[0].slice(0,Q(e[1]));throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"top",min:2,max:2}),n.functions.first=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,1,1,t,o),U(e[0])){const i=await e[0].first(w.abortSignal);if(i!==null){const a=_e.createFromGraphicLikeObject(i.geometry,i.attributes,e[0],t.timeZone);return a._underlyingGraphic=i,a}return i}return A(e[0])?e[0].length===0?null:e[0][0]:W(e[0])?e[0].length()===0?null:e[0].get(0):null})},n.signatures.push({name:"first",min:1,max:1}),n.functions.attachments=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{v(e,1,2,t,o);const i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof R){if(e[1].hasField("minsize")&&(i.minsize=Q(e[1].field("minsize"))),e[1].hasField("metadata")&&(i.returnMetadata=J(e[1].field("metadata"))),e[1].hasField("maxsize")&&(i.maxsize=Q(e[1].field("maxsize"))),e[1].hasField("types")){const a=He(e[1].field("types"),!1);a.length>0&&(i.types=a)}}else if(e[1]!==null)throw new p(t,"InvalidParameter",o)}if(te(e[0])){const a=e[0]._layer;let s;if(U(a))s=a;else{if(a==null||!ke(a))return[];s=oe(a,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)}return await s.load(),s.queryAttachments(e[0].field(s.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata)}if(e[0]===null)return[];throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"attachments",min:1,max:2}),n.functions.featuresetbyrelationshipname=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{v(e,2,4,t,o);const i=e[0],a=k(e[1]);let s=j(e[2],null);const y=J(j(e[3],!0));if(s===null&&(s=["*"]),A(s)===!1)throw new p(t,"InvalidParameter",o);if(e[0]===null)return null;if(!te(e[0]))throw new p(t,"InvalidParameter",o);const c=i._layer;let m;if(U(c))m=c;else{if(c==null||!ke(c))return null;m=oe(c,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)}m=await m.load();const r=m.relationshipMetaData().filter(h=>h.name===a);if(r.length===0)return null;if(r[0].relationshipTableId!==void 0&&r[0].relationshipTableId!==null&&r[0].relationshipTableId>-1)return Ye(m,r[0],i.field(m.objectIdField),m.spatialReference,s,y,t.lrucache,t.interceptor);let u=m.serviceUrl();if(!u)return null;u=u.endsWith("/")?u+r[0].relatedTableId.toString():u+"/"+r[0].relatedTableId.toString();const f=await Xe(u,m.spatialReference,s,y,t.lrucache,t.interceptor);await f.load();let S=f.relationshipMetaData();if(S=S.filter(h=>h.id===r[0].id),i.hasField(r[0].keyField)===!1||i.field(r[0].keyField)===null){const h=await m.getFeatureByObjectId(i.field(m.objectIdField),[r[0].keyField]);if(h){const T=E.create(S[0].keyField+"= @id",{fieldsIndex:f.getFieldsIndex(),timeZone:f.dateFieldsTimeZoneDefaultUTC});return T.parameters={id:h.attributes[r[0].keyField]},f.filter(T)}return new ot({parentfeatureset:f})}const g=E.create(S[0].keyField+"= @id",{fieldsIndex:f.getFieldsIndex(),timeZone:f.dateFieldsTimeZoneDefaultUTC});return g.parameters={id:i.field(r[0].keyField)},f.filter(g)})},n.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),n.functions.featuresetbyassociation=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{v(e,2,3,t,o);const i=e[0],a=We(k(j(e[1],""))),s=Z(e[2])?k(e[2]):null;if(e[0]===null)return null;if(!te(e[0]))throw new p(t,"InvalidParameter",o);let y=i._layer;if(y instanceof Le&&(y=oe(y,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),y===null||U(y)===!1)return null;await y.load();const c=y.serviceUrl(),m=await et(c,t.spatialReference,!0);if(m.unVersion>=8)return await bt(y,i,a,s,m,t,o);const r=m.associations;let u=null,f=null,S=!1;if(s!==null&&s!==""&&s!==void 0){for(const N of m.terminals)N.terminalName===s&&(f=N.terminalId);f===null&&(S=!0)}const g=r.getFieldsIndex(),h=g.get("TOGLOBALID").name,T=g.get("FROMGLOBALID").name,M=g.get("TOTERMINALID").name,Y=g.get("FROMTERMINALID").name,X=g.get("FROMNETWORKSOURCEID").name,ee=g.get("TONETWORKSOURCEID").name,H=g.get("ASSOCIATIONTYPE").name,Ze=g.get("ISCONTENTVISIBLE").name,Pe=g.get("OBJECTID").name;for(const N of y.fields)if(N.type==="global-id"){u=i.field(N.name);break}let G=null,Ie=new $(new P({name:"percentalong",alias:"percentalong",type:"double"}),E.create("0",{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),ge=new $(new P({name:"side",alias:"side",type:"string"}),E.create("''",{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));const C="globalid",he="globalId",be={};for(const N in m.lkp)be[N]=m.lkp[N].sourceId;const V=new tt(new P({name:"classname",alias:"classname",type:"string"}),null,be);let F="";switch(a){case"midspan":{F=`((${h}='${u}') OR ( ${T}='${u}')) AND (${H} IN (5))`,V.codefield=E.create(`CASE WHEN (${h}='${u}') THEN ${X} ELSE ${ee} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC});const N=ce(L.findField(r.fields,T));N.name=C,N.alias=C,G=new $(N,E.create(`CASE WHEN (${T}='${u}') THEN ${h} ELSE ${T} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),Ie=m.unVersion>=4?new de(L.findField(r.fields,g.get("PERCENTALONG").name)):new $(new P({name:"percentalong",alias:"percentalong",type:"double"}),E.create("0",{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));break}case"junctionedge":{F=`((${h}='${u}') OR ( ${T}='${u}')) AND (${H} IN (4,6))`,V.codefield=E.create(`CASE WHEN (${h}='${u}') THEN ${X} ELSE ${ee} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC});const N=ce(L.findField(r.fields,T));N.name=C,N.alias=C,G=new $(N,E.create(`CASE WHEN (${T}='${u}') THEN ${h} ELSE ${T} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC})),ge=new $(new P({name:"side",alias:"side",type:"string"}),E.create(`CASE WHEN (${H}=4) THEN 'from' ELSE 'to' END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));break}case"connected":{let N=`${h}='@T'`,Fe=`${T}='@T'`;f!==null&&(N+=` AND ${M}=@A`,Fe+=` AND ${Y}=@A`),F="(("+N+") OR ("+Fe+"))",F=ne(F,"@T",u??""),N=ne(N,"@T",u??""),f!==null&&(N=ne(N,"@A",f.toString()),F=ne(F,"@A",f.toString())),V.codefield=E.create("CASE WHEN "+N+` THEN ${X} ELSE ${ee} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC});const se=ce(L.findField(r.fields,T));se.name=C,se.alias=C,G=new $(se,E.create("CASE WHEN "+N+` THEN ${T} ELSE ${h} END`,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}));break}case"container":F=`${h}='${u}' AND ${H} = 2`,f!==null&&(F+=` AND ${M} = `+f.toString()),V.codefield=X,F="( "+F+" )",G=new ie(L.findField(r.fields,T),C,C);break;case"content":F=`(${T}='${u}' AND ${H} = 2)`,f!==null&&(F+=` AND ${Y} = `+f.toString()),V.codefield=ee,F="( "+F+" )",G=new ie(L.findField(r.fields,h),C,C);break;case"structure":F=`(${h}='${u}' AND ${H} = 3)`,f!==null&&(F+=` AND ${M} = `+f.toString()),V.codefield=X,F="( "+F+" )",G=new ie(L.findField(r.fields,T),C,he);break;case"attached":F=`(${T}='${u}' AND ${H} = 3)`,f!==null&&(F+=` AND ${Y} = `+f.toString()),V.codefield=ee,F="( "+F+" )",G=new ie(L.findField(r.fields,h),C,he);break;default:throw new p(t,"InvalidParameter",o)}return S&&(F="1 <> 1"),new L({parentfeatureset:r,adaptedFields:[new de(L.findField(r.fields,Pe)),new de(L.findField(r.fields,Ze)),G,ge,V,Ie],extraFilter:F?E.create(F,{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}):null})})},n.signatures.push({name:"featuresetbyassociation",min:2,max:6}),n.functions.groupby=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,3,3,t,o),!U(e[0]))throw new p(t,"InvalidParameter",o);const i=await e[0].load(),a=[],s=[];let y=!1,c=[];if(Z(e[1]))c.push(e[1]);else if(e[1]instanceof R)c.push(e[1]);else if(A(e[1]))c=e[1];else{if(!W(e[1]))throw new p(t,"InvalidParameter",o);c=e[1].toArray()}for(const m of c)if(Z(m)){const r=E.create(k(m),{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),u=ve(r)===!0?k(m):"%%%%FIELDNAME";a.push({name:u,expression:r}),u==="%%%%FIELDNAME"&&(y=!0)}else{if(!(m instanceof R))throw new p(t,"InvalidParameter",o);{const r=m.hasField("name")?m.field("name"):"%%%%FIELDNAME",u=m.hasField("expression")?m.field("expression"):"";if(r==="%%%%FIELDNAME"&&(y=!0),!r)throw new p(t,"InvalidParameter",o);a.push({name:r,expression:E.create(u||r,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(c=[],Z(e[2]))c.push(e[2]);else if(A(e[2]))c=e[2];else if(W(e[2]))c=e[2].toArray();else{if(!(e[2]instanceof R))throw new p(t,"InvalidParameter",o);c.push(e[2])}for(const m of c){if(!(m instanceof R))throw new p(t,"InvalidParameter",o);{const r=m.hasField("name")?m.field("name"):"",u=m.hasField("statistic")?m.field("statistic"):"",f=m.hasField("expression")?m.field("expression"):"";if(!(r&&u&&Z(u)&&f))throw new p(t,"InvalidParameter",o);s.push({name:r,statistic:u,expression:E.create(f,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(y){const m={};for(const u of i.fields)m[u.name.toLowerCase()]=1;for(const u of a)u.name!=="%%%%FIELDNAME"&&(m[u.name.toLowerCase()]=1);for(const u of s)u.name!=="%%%%FIELDNAME"&&(m[u.name.toLowerCase()]=1);let r=0;for(const u of a)if(u.name==="%%%%FIELDNAME"){for(;m["field_"+r.toString()]===1;)r++;m["field_"+r.toString()]=1,u.name="FIELD_"+r.toString()}}for(const m of a)fe(m.expression,n,t);for(const m of s)fe(m.expression,n,t);return e[0].groupby(a,s)})},n.signatures.push({name:"groupby",min:3,max:3}),n.functions.distinct=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(U(e[0])){v(e,2,2,t,o);const i=await e[0].load(),a=[];let s=[];if(Z(e[1]))s.push(e[1]);else if(e[1]instanceof R)s.push(e[1]);else if(A(e[1]))s=e[1];else{if(!W(e[1]))throw new p(t,"InvalidParameter",o);s=e[1].toArray()}let y=!1;for(const c of s)if(Z(c)){const m=E.create(k(c),{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),r=ve(m)===!0?k(c):"%%%%FIELDNAME";a.push({name:r,expression:m}),r==="%%%%FIELDNAME"&&(y=!0)}else{if(!(c instanceof R))throw new p(t,"InvalidParameter",o);{const m=c.hasField("name")?c.field("name"):"%%%%FIELDNAME",r=c.hasField("expression")?c.field("expression"):"";if(m==="%%%%FIELDNAME"&&(y=!0),!m)throw new p(t,"InvalidParameter",o);a.push({name:m,expression:E.create(r||m,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC})})}}if(y){const c={};for(const r of i.fields)c[r.name.toLowerCase()]=1;for(const r of a)r.name!=="%%%%FIELDNAME"&&(c[r.name.toLowerCase()]=1);let m=0;for(const r of a)if(r.name==="%%%%FIELDNAME"){for(;c["field_"+m.toString()]===1;)m++;c["field_"+m.toString()]=1,r.name="FIELD_"+m.toString()}}for(const c of a)fe(c.expression,n,t);return e[0].groupby(a,[])}return It(e)})},n.functions.getfeaturesetinfo=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,1,1,t,o),!U(e[0]))return null;const i=await e[0].getFeatureSetInfo();return i?R.convertObjectToArcadeDictionary({layerId:i.layerId,layerName:i.layerName,itemId:i.itemId,serviceLayerUrl:i.serviceLayerUrl,webMapLayerId:i.webMapLayerId??null,webMapLayerTitle:i.webMapLayerTitle??null,className:null,objectClassId:null},Ne(t),!1,!1):null})},n.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),n.functions.filterbysubtypecode=function(t,o){return n.standardFunctionAsync(t,o,async(w,I,e)=>{if(v(e,2,2,t,o),U(e[0])){const i=await e[0].load(),a=e[1];if(!pt(a))throw new p(t,"InvalidParameter",o);if(i.subtypeField){const y=E.create(`${i.subtypeField}= ${e[1]}`,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC});return new ue({parentfeatureset:e[0],whereclause:y})}if(i.typeIdField===null||i.typeIdField==="")throw new p(t,"FeatureSetDoesNotHaveSubtypes",o);const s=E.create(`${i.typeIdField}= ${e[1]}`,{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC});return new ue({parentfeatureset:e[0],whereclause:s})}throw new p(t,"InvalidParameter",o)})},n.signatures.push({name:"filterbysubtypecode",min:2,max:2})}}export{wo as registerFunctions};
