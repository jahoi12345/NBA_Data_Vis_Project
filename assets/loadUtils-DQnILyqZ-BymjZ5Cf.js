import{w as S,h as b,s as v,y as $,N as k}from"./aaBoundingRect-CjwcS2F3-ri8bmh30.js";import{a as y}from"./dataUtils-1NJ_tbX7-BVfW_Ul3.js";import{u as I}from"./FeatureTileDescriptor-n_NQwd9p-DjCngMQK.js";import{r as N}from"./Cyclical-BLSxUpe7-Bj8R2Yk-.js";import{a8 as A}from"./Point-BfTTZoMu-DeJwQYfh.js";class P{constructor(e,t,o,i,r){this.extent=e,this.timeExtent=t,this.size=o,this.pixelRatio=i,this.time=r}get flowExtentInfo(){return{modelSize:this.size,valid:A(this.extent.spatialReference)?.valid,extent:k(this.extent)}}insideMapExtent(e,t){return z(this.flowExtentInfo,e,t)}modelToMapSpace(e,t,o){return E(this.flowExtentInfo,e,t,o)}}function z(n,e,t){const{extent:o,valid:i}=n,[r,u,l,s]=o;return!(t<u||t>s)&&(i!=null&&r>l?e>=l||e<=r:e>=r&&e<=l)}function E(n,e,t,o){const{extent:i,modelSize:r,valid:u}=n,[l,s,c]=i,f=R(l,c,u);let a=e/r[0]*f+l;return u!=null&&o&&(a=new N(u[0],u[1]).normalize(a)),[a,(r[1]-t)/r[1]*v(i)+s]}function F(n,e,t){return t!=null&&Math.abs(n-t.valid[0])<t.dx&&Math.abs(e-t.valid[1])<t.dx}function R(n,e,t){if(t!=null&&n>e){const[o,i]=t;return i-n+(e-o)}return e-n}function Q(n){return n?4:3}function q(n){return n[0].vertices instanceof Float32Array}class B{constructor(e,t,o,i,r,u){this.data=e,this.mask=t,this.width=o,this.height=i,this.lij=r,this.extent=u}}function C(n){return I(n.lij[0],n.lij[1],n.lij[2])}function D(n,e){let[t,o,i,r]=[null,null,null,null];for(const u of n){const l=u.extent;t=j(l[0],t),o=j(l[1],o),i=M(l[2],i),r=M(l[3],r)}if(t==null||o==null||i==null||r==null)return null;if(F(t,i,e)){const u=[...n].toSorted((a,h)=>a.extent[0]-h.extent[0]);let l=u[0].extent[2],s=0,c=0,f=0;for(let a=1;a<u.length;a++){const[h,x,m]=u[a].extent;if(l<h&&(f++,s=l,c=h,f>1))break;l=Math.max(l,m)}f===1&&(t=c,i=s)}return $([t,o,i,r])}function M(n,e){return e==null?n:Math.max(n,e)}function j(n,e){return e==null?n:Math.min(n,e)}function H(n,e,t){const[o,i]=t.modelSize;let r=null;const u=new Map;e.forEach(s=>{u.set(s.lij,y(n,s))});const l=(s,c,f)=>S(s.extent,c,f);return(s,c)=>{const f=Math.round(s),a=Math.round(c);if(!n.wrapAround&&(f<0||f>=o||a<0||a>=i))return[0,0];const[h,x]=E(t,s,c,!0);if(!z(t,h,x))return[0,0];if(r==null||!l(r,h,x)){r=null;for(const[T,w]of e)if(l(w,h,x)){r=w;break}}if(r?.data==null)return[0,0];const m=u.get(r.lij);if(m==null)return[0,0];const{width:g,height:p,extent:d}=r;return m((h-d[0])/b(d)*g,p-(x-d[1])/v(d)*p)}}export{F,R as G,P as J,Q as K,q as L,B as N,C as O,D as P,H as Q};
