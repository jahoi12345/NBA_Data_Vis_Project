import{o as N}from"./floatRGBA-CCeie_ny.js";import{i as b}from"./jsonMap-Bs3hmeCU.js";import"./mathUtils-PIGhLnI9.js";const k={CIMVectorMarker:{size:10},CIMPictureMarker:{size:10},CIMTextSymbol:{height:10},CIMSolidStroke:{width:4},CIMGradientStroke:{gradientSize:75,gradientType:"Discrete"},CIMHatchFill:{separation:4},CIMGradientFill:{gradientSize:75,gradientType:"Discrete",interval:5},CIMGeometricEffectRadial:{angle:0,length:5}},F=15.5,P=1024,I=()=>b.getLogger("esri.symbols.cim.rasterizingUtils");function $(e,a){e==null&&(e=[]);const t=a==="Butt",r=a==="Square",n=!t&&!r;e.length%2==1&&(e=[...e,...e]);const o=F,s=2*o;let l=0;for(const m of e)l+=m;const i=Math.round(l*o),c=new Float32Array(i*s),h=.5*o;let f=0,C=0,u=.5,d=!0;for(const m of e){for(f=C,C+=m*o;u<=C;){let M=.5;for(;M<s;){const S=(M-.5)*i+u-.5,p=n?(M-o)*(M-o):Math.abs(M-o);c[S]=d?t?Math.max(Math.max(f+h-u,p),Math.max(u-C+h,p)):p:n?Math.min((u-f)*(u-f)+p,(u-C)*(u-C)+p):r?Math.min(Math.max(u-f,p),Math.max(C-u,p)):Math.min(Math.max(u-f+h,p),Math.max(C+h-u,p)),M++}u++}d=!d}const y=c.length,w=new Uint8Array(4*y);for(let m=0;m<y;++m){const M=(n?Math.sqrt(c[m]):c[m])/o;N(M,w,4*m)}return[w,i,s]}let x;function q(e,a){const{colorRamp:t,gradientType:r}=a,n=R(t),o=t.type==="CIMFixedColorRamp";if(r==="Continuous"&&!o)return g(e,n);const s=a.interval??k.CIMGradientFill.interval;if(o)return g(e,v(n,s));const l=[];x??=document.createElement("canvas"),z(x,n,s,1,0);const i=x.getContext("2d").getImageData(0,0,s,1).data;for(let c=0,h=0;c<s;c++,h=4*c){const f=[i[h+0],i[h+1],i[h+2],i[h+3]];l.push({offset:c/s,color:f}),l.push({offset:(c+1)/s,color:f})}return g(e,l)}function R(e){const a=[];switch(e.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{e.type==="CIMPolarContinuousColorRamp"&&I().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const t=e;a.push({offset:0,color:[t.fromColor[0],t.fromColor[1],t.fromColor[2],t.fromColor[3]/255]}),a.push({offset:1,color:[t.toColor[0],t.toColor[1],t.toColor[2],t.toColor[3]/255]});break}case"CIMFixedColorRamp":{const t=e,r=1/(t.colors.length-1);let n=0;for(const o of t.colors)a.push({offset:n,color:[o[0],o[1],o[2],o[3]/255]}),n+=r;break}case"CIMMultipartColorRamp":{const t=e,r=t.weights.reduce((o,s)=>o+s,0);let n=0;for(let o=0;o<t.colorRamps.length;o++){const s=t.colorRamps[o],l=t.weights[o],i=R(s);for(const c of i)a.push({offset:(n+c.offset*l)/r,color:c.color});n+=l}break}default:I().error(`Color ramp "${e.type}" currently unsupported.`)}return a}function v(e,a){const t=[],r=(e.length-1)/(a-1);for(let n=0;n<a;n++){const o=e[Math.round(n*r)].color;t.push({offset:n/a,color:o}),t.push({offset:(n+1)/a,color:o})}return t}function g(e,a,t=0){for(const{offset:r,color:n}of a)e.addColorStop(Math.min(Math.max(r,t),1-t),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`)}function z(e,a,t,r,n){const o=t+2*n;e.width=o,e.height=r;const s=(n+1)/o,l=e.getContext("2d",{willReadFrequently:!0});if(a.length>0){const i=l.createLinearGradient(0,0,o,r);g(i,a,s),l.fillStyle=i}else l.fillStyle="rgba(128, 128, 128, 1)";l.fillRect(0,0,o,r)}function G(e){const a=e[0]?.[0]?.[0]??0,t=e[0]?.[0]?.[1]??0,r={ymin:t,xmin:a,ymax:t,xmax:a,width:0,height:0};for(let n=0;n<e.length;n++){const o=e[n];for(let s=0;s<o.length;s++){const l=o[s][0],i=o[s][1];l<r.xmin&&(r.xmin=l),l>r.xmax&&(r.xmax=l),i<r.ymin&&(r.ymin=i),i>r.ymax&&(r.ymax=i)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}function D(e,a){const t=G(e),r=t.width===0?1:t.width,n=t.height===0?1:t.height,o=[];for(let s=0;s<e.length;s++){const l=e[s],i=[];for(let c=0;c<l.length;c++){let h=Math.round(l[c][0]-t.xmin),f=Math.round(l[c][1]-t.ymin);if(h=a.xmin+h*a.width/r,f=a.ymin+f*a.height/n,isNaN(h)||isNaN(f))throw new Error("Scaled shape has NaN values");i.push([h,f])}o.push(i)}return o}function A(e,a,t){const r=[];for(let n=0;n<e.length;n++){const o=e[n],s=[];for(let l=0;l<o.length;l++){const i=o[l][0]+a,c=o[l][1]+t;if(isNaN(i)||isNaN(c))throw new Error("Scaled shape has NaN values");s.push([i,c])}r.push(s)}return r}export{A as R,D as T,k as o,q as p,P as r,$ as u};
