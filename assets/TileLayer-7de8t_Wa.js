import{f as _,s as u,_ as o,m as a,r as S,a as T}from"./jsonMap-Bs3hmeCU.js";import{f as v,I as b,H as c,A as w,p as O,g as $,d as R,_ as W,s as A}from"./Point-vWR8_ZMt.js";import{l as U}from"./loadAll-BgJqNT2C.js";import{l as P}from"./MultiOriginJSONSupport-Bd1TKmh_.js";import{o as j}from"./reader-DcGs6kKN.js";import{b as D}from"./Layer-BMwTffmV.js";import{o as I}from"./APIKeyMixin--YGbad8e.js";import{p as L}from"./ArcGISCachedService-XgSR7JFf.js";import{m as B,h as M,l as N}from"./SublayersOwner-BcgLcbBw.js";import{l as C}from"./ArcGISService-LAhkiI9y.js";import{p as k}from"./BlendLayer-DtgFiHAc.js";import{s as J}from"./CustomParametersMixin-Dshqz1Zp.js";import{b as q,y as G}from"./OperationalLayer-FCdqv79e.js";import{j as V}from"./PortalLayer-_7TK261k.js";import{f as E}from"./RefreshableLayer-C3RGGUu5.js";import{t as H}from"./ScaleRangeLayer-DQr2T3Hh.js";import{o as f}from"./imageBitmapUtils-BP4sA6iR.js";import{c as x}from"./ElevationInfo-DtRUQF80.js";import"./index-JW0QcsSZ.js";import"./asyncUtils-w6KfWU41.js";import"./collectionUtils-DoXnmzlX.js";import"./reactiveUtils-SO2Ko3sy.js";import"./Extent-DY3BG_6i.js";import"./SimpleObservable-CvFyr0NA.js";import"./date-IqUzANpt.js";import"./TileInfo-DtnBGL2x.js";import"./TileKey-9RS49Vc4.js";import"./aaBoundingRect-aK0fPvVw.js";import"./mathUtils-PIGhLnI9.js";import"./TileInfoTilemapCache-B40skWYU.js";import"./TilemapCache-Cghqht_G.js";import"./LRUCache-fy84PBMi.js";import"./memoryEstimations-Bd726a_p.js";import"./Version-BtYZEj58.js";import"./portalItemUtils-DRve4gDd.js";import"./projectionUtils-CxkhtTt4.js";import"./Polyline-CTW9EJXE.js";import"./Polygon-CHS6Qlya.js";import"./CollectionFlattener-8zklJZX3.js";import"./getPopupProvider-BgJaQ8z_.js";import"./lengthUtils-CUXP1wE0.js";import"./Color-CERqXxxY.js";import"./typeUtils-AKv8bXvZ.js";import"./GraphicOrigin-uE6TDXc9.js";import"./QueryTask-5mJP6VaD.js";import"./infoFor3D-DhzudQro.js";import"./Query-DajRZUMA.js";import"./jsonUtils-qNXxymg9.js";import"./Field-Cm_ZejYW.js";import"./fieldType-DVUzXtk_.js";import"./utils-DdVX7VVR.js";import"./executeForIds-Dl0K5Iin.js";import"./query-BeA-WfHO.js";import"./normalizeUtils-4Z-dvpLB.js";import"./Cyclical-BLSxUpe7.js";import"./normalizeUtilsCommon-3XVOFLrM.js";import"./utils-CNv0zujq.js";import"./pbfQueryUtils-CaaPNUGo.js";import"./pbf-2SIhMekG.js";import"./OptimizedFeature-CwRGZPwv.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./queryZScale-CVasVhPu.js";import"./executeQueryJSON-CjLVsMN9.js";import"./FeatureSet-8KdZphAG.js";import"./Graphic-DycsWsyx.js";import"./createFeatureId-CVwTD0fV.js";import"./typeUtils-T13jKwzH.js";import"./lineMarkers-CDwLe3J6.js";import"./PolygonSymbol3D-BAgGb9Gm.js";import"./ExtrudeSymbol3DLayer-DSc1ou2x.js";import"./screenUtils-BitdhK1O.js";import"./opacityUtils-DuFH0EC9.js";import"./aaBoundingBox-CrbHdtRB.js";import"./DoubleArray-DExKNiTh.js";import"./mat4f64-q_b6UJoq.js";import"./Font-C_NUqpB1.js";import"./SimpleFillSymbol-CDawtd9z.js";import"./SimpleMarkerSymbol-BGAFRS9_.js";import"./PictureMarkerSymbol-yvaMzXB0.js";import"./TextSymbol-BNX3_RE6.js";import"./featureConversionUtils-C_5of_Fv.js";import"./OrderedLayer-DQAUgUTV.js";import"./featureLayerUtils-BsfBwNA3.js";import"./uuid-Oe6SV2kF.js";import"./featureQueryAll-Bj9p9Q4m.js";import"./layerUtils-Dp0n27PK.js";import"./SimpleRenderer-BHti7D4O.js";import"./commonProperties-mpuWp0x_.js";import"./colorRamps-DswZzxkO.js";import"./ColorStop-De5gQTjr.js";import"./visualVariableUtils-Be4v1Fd0.js";import"./jsonUtils-BNYTV2Q9.js";import"./defaults3D-DMh44TVU.js";import"./defaults-CokPcT0y.js";import"./defaultsJSON-GKolV7NZ.js";import"./UniqueValueRenderer-DGzclb80.js";import"./diffUtils-DfuxKjJP.js";import"./RendererLegendOptions-DdwljMUZ.js";import"./styleUtils-CKEh3Wrs.js";import"./NormalizationBinParametersMixin-BK9wNkI3.js";import"./FeatureType-DCza4QhC.js";import"./FeatureTemplate-pGMuRPgR.js";import"./FieldsIndex-DEM_SMps.js";import"./UnknownTimeZone-B697BDFv.js";import"./timeZoneUtils-BSc7-7qA.js";import"./labelingInfo-Cp9DNxY2.js";import"./labelUtils-BtizwBfq.js";import"./LayerFloorInfo-Dac7Ym6h.js";import"./Relationship-WiP2c2-q.js";import"./serviceCapabilitiesUtils-BbHNuakj.js";import"./typeUtils-C1OKy2-h.js";import"./ClassBreaksRenderer-M7M-VRvA.js";import"./DictionaryScriptEvaluator-CEGngw_z.js";import"./ArcadeExpression-DtsRQsdf.js";import"./TimeOnly-B3shQgpN.js";import"./enum-BzLwmiID.js";import"./utils-DX2muIr3.js";import"./heatmapUtils-1a29HAAp.js";import"./vec42-DhV2kIac.js";import"./vec4f64-DPb6J-GU.js";import"./popupUtils-66mWTUEG.js";import"./sublayerUtils-BEQnBRaB.js";import"./layerContainerType-CSXZNpHb.js";import"./jsonUtils-DfP5oXgp.js";import"./mat4f32-Djp3mnm5.js";import"./mat4-BAXvdiEz.js";import"./PortalItem-5Ub3M2il.js";import"./unitConversionUtils-DLqXrs5X.js";var d;const y=["Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Elevation/World_Hillshade","Elevation/World_Hillshade_Dark","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Ocean_Basemap","Reference/World_Boundaries_and_Places","Reference/World_Boundaries_and_Places_Alternate","Reference/World_Transportation","World_Imagery","World_Street_Map","World_Topo_Map"];let i=d=class extends k(H(B(L(M(q(V(C(P(E(I(J(D)))))))))))){constructor(...r){super(...r),this.listMode="show",this.elevationInfo=new x({mode:"on-the-ground"}),this.isReference=null,this.operationalLayerType="ArcGISTiledMapServiceLayer",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type="tile",this.url=null}normalizeCtorArgs(r,e){return typeof r=="string"?{url:r,...e}:r}load(r){const e=r!=null?r.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},r).catch(_).then(()=>this._fetchService(e))),Promise.resolve(this)}get attributionDataUrl(){const r=this.parsedUrl?.path.toLowerCase();return r?this._getDefaultAttribution(this._getMapName(r)):null}get hasAttributionData(){return super.hasAttributionData}readSpatialReference(r,e){return(r=r||e.tileInfo?.spatialReference)&&v.fromJSON(r)}writeSublayers(r,e,t,s){if(!this.loaded||!r)return;const l=r.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).toArray(),p=[],m={writeSublayerStructure:!1,...s};l.forEach(n=>{const h=n.write({},m);p.push(h)}),p.some(n=>Object.keys(n).length>1)&&(e.layers=p)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl?.path)}castTileServers(r){return Array.isArray(r)?r.map(e=>b(e).path):null}fetchTile(r,e,t,s={}){const{signal:l}=s,p=this.getTileUrl(r,e,t),m={responseType:"image",signal:l,query:{...this.refreshParameters}};return c(p,m).then(n=>n.data)}async fetchImageBitmapTile(r,e,t,s={}){const{signal:l}=s;if(this.fetchTile!==d.prototype.fetchTile){const h=await this.fetchTile(r,e,t,s);return f(h,r,e,t,l)}const p=this.getTileUrl(r,e,t),m={responseType:"blob",signal:l,query:{...this.refreshParameters}},{data:n}=await c(p,m);return f(n,r,e,t,l)}getTileUrl(r,e,t){const s=!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile,l=w({...this.parsedUrl?.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),p=this.tileServers;return`${p&&p.length?p[e%p.length]:this.parsedUrl?.path}/tile/${r}/${e}/${t}${l?"?"+l:""}`}loadAll(){return U(this,r=>{r(this.allSublayers)})}_fetchService(r){return new Promise((e,t)=>{if(this.sourceJSON){if(this.sourceJSON.bandCount!=null&&this.sourceJSON.pixelSizeX!=null)throw new u("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");return void e({data:this.sourceJSON})}if(!this.parsedUrl)throw new u("tile-layer:undefined-url","layer's url is not defined");const s=O(this.parsedUrl.path);if(s!=null&&s.serverType==="ImageServer")throw new u("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:r}).then(e,t)}).then(e=>{let t=this.url;if(e.ssl&&(t=this.url=t.replace(/^http:/i,"https:")),this.sourceJSON=e.data,this.read(e.data,{origin:"service",url:this.parsedUrl}),this.version===10.1&&!$(t))return this._fetchServerVersion(t,r).then(s=>{this.read({currentVersion:s})}).catch(()=>{})})}_fetchServerVersion(r,e){if(!R(r))return Promise.reject();const t=r.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return c(t,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(s=>{if(s.data?.currentVersion)return s.data.currentVersion;throw new u("tile-layer:version-not-available","Server did not provide a version")})}_getMapName(r){const e=r.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/mapserver/i);return e?e[2]:void 0}_getDefaultAttribution(r){if(r==null)return null;let e;r=r.toLowerCase();for(let t=0,s=y.length;t<s;t++)if(e=y[t],e.toLowerCase().includes(r))return W("//static.arcgis.com/attribution/"+e);return null}_getDefaultTileServers(r){if(r==null)return[];const e=r.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i)!==-1,t=r.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i)!==-1;return e||t?[r,r.replace(e?/server\.arcgisonline/i:/services\.arcgisonline/i,e?"services.arcgisonline":"server.arcgisonline")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile[g]}};o([a({readOnly:!0})],i.prototype,"attributionDataUrl",null),o([a({type:["show","hide","hide-children"]})],i.prototype,"listMode",void 0),o([a({json:{read:!0,write:!0}})],i.prototype,"blendMode",void 0),o([a()],i.prototype,"elevationInfo",void 0),o([a({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],i.prototype,"isReference",void 0),o([a({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],i.prototype,"operationalLayerType",void 0),o([a({type:Boolean})],i.prototype,"resampling",void 0),o([a()],i.prototype,"sourceJSON",void 0),o([a({type:v})],i.prototype,"spatialReference",void 0),o([j("spatialReference",["spatialReference","tileInfo"])],i.prototype,"readSpatialReference",null),o([a({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],i.prototype,"path",void 0),o([a({readOnly:!0})],i.prototype,"sublayers",void 0),o([S("sublayers",{layers:{type:[N]}})],i.prototype,"writeSublayers",null),o([a({json:{read:!1,write:!1}})],i.prototype,"popupEnabled",void 0),o([a()],i.prototype,"tileServers",null),o([A("tileServers")],i.prototype,"castTileServers",null),o([a({readOnly:!0,json:{read:!1}})],i.prototype,"type",void 0),o([a(G)],i.prototype,"url",void 0),i=d=o([T("esri.layers.TileLayer")],i);const g=Symbol("default-fetch-tile");i.prototype.fetchTile[g]=!0;const ht=i;export{ht as default};
