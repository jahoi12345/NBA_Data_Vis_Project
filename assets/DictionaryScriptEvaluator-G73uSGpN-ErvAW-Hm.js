import{v as l,I as m}from"./jsonMap-Bs3hmeCU-Cusd0Fmz.js";import{c as g}from"./Version-BtYZEj58-LyRHDnSJ.js";import{m as d}from"./FieldsIndex-CimK-TqD--24JoCkp.js";import{J as h,v as y}from"./ArcadeExpression-BlIRq-oN-VZkrwLVE.js";class p{static async from(e,r,t){const n=e.dictionary_version?g.parse(e.dictionary_version):null,s=new Set(e.itemsNames),o={};if(r)for(const i in r)o[i]=r[i];if(e.authoringInfo.configuration)for(const i of e.authoringInfo.configuration)o.hasOwnProperty(i.name)||(o[i.name]=i.value);const a=new Set(e.authoringInfo.symbol);for(const i of Object.keys(t))a.delete(i);a.size&&l.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("missing-fields: fieldMap entries for the following symbol fields are missing",{symbolFields:a});const u=await h(e.expression,null,o);if(!u)throw new m("dictionary-renderer:expression-error","Unable to create dictionary renderer expression");const c=!n||!n.greaterEqual(4,0);c&&l.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("Dictionary script does not support native field types. Applying fallback",{version:n});const f=new _(t,c);return new p(c,s,u,f)}constructor(e,r,t,n){this._requiresFieldCoercionToString=e,this._itemNames=r,this._compiled=t,this._reader=n}get itemNames(){return this._itemNames}evaluate(e,r,t,n){try{return this._reader.bind(e,t,n),this._compiled.evaluate(this._reader,{$view:{scale:r}})}catch(s){l.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("arcade: dictionary script evaluation failed",{error:s})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new d(e);const r=e.map(t=>({...t,type:"esriFieldTypeString"}));return new d(r)}}class _ extends y{constructor(e,r){super(),this._fieldMap=e,this._requiresFieldCoercionToString=r}_getField(e){const r=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(r)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const r=this._getField(e);return r==null||this._boundTarget.attributes[r.name]==null?"":""+this._boundTarget.attributes[r.name]}}export{p as f};
