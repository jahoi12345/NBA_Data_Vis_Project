const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/loader-BzItu4hr.js","assets/jsonMap-Bs3hmeCU.js","assets/mat4f64-q_b6UJoq.js","assets/Point-C1MrKtFQ.js","assets/reader-DcGs6kKN.js","assets/index-DJqVgRZI.js","assets/Version-BtYZEj58.js","assets/mat4-1jyq5T0I.js","assets/collectionUtils-0LMOubEE.js","assets/reactiveUtils-SO2Ko3sy.js","assets/Extent-BhRcB6A3.js","assets/SimpleObservable-CvFyr0NA.js","assets/Polygon-Bn-bHOAm.js","assets/aaBoundingRect-CirBGiM6.js","assets/mathUtils-PIGhLnI9.js","assets/quat-CdWL-X--.js","assets/quatf64-CCm9z-pX.js","assets/vec32-CBRzfVYF.js","assets/vec42-DwKDwCwf.js","assets/BufferView-C2yXdP6t.js","assets/vec2f64-rIxtbMRN.js","assets/vec4f64-DPb6J-GU.js","assets/resourceUtils-DWVfTVer.js","assets/enums-B4pqBiXb.js"])))=>i.map(i=>d[i]);
import{_ as ee}from"./index-DJqVgRZI.js";import{p as te,y as F}from"./Color-CERqXxxY.js";import{a as re}from"./devEnvironmentUtils-8WtPGj6h.js";import{T as j}from"./mathUtils-PIGhLnI9.js";import{n as I,a as G,H as D,D as oe,E as se}from"./Polygon-Bn-bHOAm.js";import{h as ne}from"./mat4-1jyq5T0I.js";import{e as ie}from"./mat4f64-q_b6UJoq.js";import{a as ae}from"./vec2f64-rIxtbMRN.js";import{E as U,c as le,i as k,r as ue,A as ce,I as me}from"./vec32-CBRzfVYF.js";import{n as O}from"./collectionUtils-0LMOubEE.js";import{q as fe,l as z}from"./aaBoundingBox-CB-h8mLX.js";import{P,b as de,o as pe,n as A,m as he,M as xe,e as Te,f as ge}from"./Texture-DX30_NqW.js";import{o as K,T as N,g as be,M as ye,O as we,V as Re}from"./BufferView-C2yXdP6t.js";import{r as $e,n as Me,d as H,l as W}from"./vec3-B_phcnZY.js";import{o as ve,d as q}from"./vec4-B7mYuNMQ.js";import{o as Be,n as Se}from"./indexUtils-DpmEYOW0.js";import{l as Ae}from"./DefaultLoadingContext-D-Jyeob4.js";import{t as E}from"./resourceUtils-DWVfTVer.js";import{a as Ee,i as _e}from"./vec2f32-CaVKkSa6.js";import{h as Fe,M as Ie}from"./wosrLoader-rLve3gJ1.js";import{t as M}from"./orientedBoundingBox-B0LWY6lE.js";function v(t){if(t==null)return null;const r=t.offset!=null?t.offset:Ee,s=t.rotation!=null?t.rotation:0,o=t.scale!=null?t.scale:_e,c=I(1,0,0,0,1,0,r[0],r[1],1),f=I(Math.cos(s),-Math.sin(s),0,Math.sin(s),Math.cos(s),0,0,0,1),i=I(o[0],0,0,0,o[1],0,0,0,1),a=G();return D(a,f,i),D(a,c,a),a}class Oe{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Pe{constructor(r,s,o){this.name=r,this.lodThreshold=s,this.pivotOffset=o,this.stageResources=new Oe,this.numberOfVertices=0}}async function Ce(t,r){const s=Q(re(t));if(s.fileType==="wosr"){const l=await(r.cache?r.cache.loadWOSR(s.url,r):Fe(s.url,r)),{engineResources:p,referenceBoundingBox:h}=Ie(l,r);return{lods:p,referenceBoundingBox:h,isEsriSymbolResource:!1,isWosr:!0}}let o;if(r.cache)o=await r.cache.loadGLTF(s.url,r,!!r.usePBR);else{const{loadGLTF:l}=await ee(()=>import("./loader-BzItu4hr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]));o=await l(new Ae(r.streamDataRequester),s.url,r,r.usePBR)}const c=o.model.meta?.ESRI_proxyEllipsoid,f=o.meta.isEsriSymbolResource&&c!=null&&o.meta.ESRI_webstyle==="EsriRealisticTreesStyle";f&&!o.customMeta.esriTreeRendering&&(o.customMeta.esriTreeRendering=!0,Ue(o,c));const i=!!r.usePBR,a=o.meta.isEsriSymbolResource?{usePBR:i,isSchematic:!1,treeRendering:f,mrrFactors:Te}:{usePBR:i,isSchematic:!1,treeRendering:!1,mrrFactors:ge},u={...r.materialParameters,treeRendering:f},{engineResources:e,referenceBoundingBox:n}=Le(o,a,u,r,s.specifiedLodIndex,f);return{lods:e,referenceBoundingBox:n,isEsriSymbolResource:o.meta.isEsriSymbolResource,isWosr:!1}}function Q(t){const r=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return r?{fileType:"gltf",url:r[1],specifiedLodIndex:r[4]!=null?Number(r[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function Le(t,r,s,o,c,f){const i=t.model,a=new Array,u=new Map,e=new Map,n=i.lods.length,l=fe();return i.lods.forEach((p,h)=>{const x=o.skipHighLods===!0&&(n>1&&h===0||n>3&&h===1)||o.skipHighLods===!1&&c!=null&&h!==c;if(x&&h!==0)return;const m=new Pe(p.name,p.lodThreshold,[0,0,0]);p.parts.forEach(T=>{const g=x?new P({},o):Ve(i,T,m,r,s,u,e,o,f),{geometry:y,vertexCount:d}=je(T,g??new P({},o)),b=y.boundingInfo;b!=null&&h===0&&(z(l,b.bbMin),z(l,b.bbMax)),g!=null&&(m.stageResources.geometries.push(y),m.numberOfVertices+=d)}),x||a.push(m)}),{engineResources:a,referenceBoundingBox:l}}function Ve(t,r,s,o,c,f,i,a,u){const e=t.materials.get(r.material);if(e==null)return null;const{normal:n,color:l,texCoord0:p,tangent:h}=r.attributes,x=r.material+(n?"_normal":"")+(l?"_color":"")+(p?"_texCoord0":"")+(h?"_tangent":""),m=r.attributes.texCoord0!=null,T=r.attributes.normal!=null,g=De(e.alphaMode);if(!f.has(x)){if(m){const $=(S,X=!1,Y=!1)=>{if(S!=null&&!i.has(S)){const _=t.textures.get(S);if(_){const w=_.data,Z=X&&!E(w)?a.compressionOptions:void 0;i.set(S,new xe(E(w)?w.data:w,{..._.parameters,preMultiplyAlpha:!E(w)&&Y,encoding:E(w)?w.encoding:void 0,compressionOptions:Z}))}}},J=g!==1&&!u;$(e.colorTexture,J,g!==1),$(e.normalTexture),$(e.occlusionTexture,!0),$(e.emissiveTexture),$(e.metallicRoughnessTexture,!0)}const d=F(e.color[0]),b=F(e.color[1]),C=F(e.color[2]),B=e.colorTexture!=null&&m?i.get(e.colorTexture):null,L=de(e),V=e.normalTextureTransform?.scale!=null?e.normalTextureTransform?.scale:ae;f.set(x,new P({...o,customDepthTest:1,textureAlphaMode:g,textureAlphaCutoff:e.alphaCutoff,diffuse:[d,b,C],ambient:[d,b,C],opacity:e.alphaMode==="OPAQUE"?1:e.opacity,doubleSided:e.doubleSided,doubleSidedType:"winding-order",cullFace:e.doubleSided?0:2,hasVertexColors:!!r.attributes.color,hasVertexTangents:!!r.attributes.tangent,normalType:T?0:2,castShadows:!0,receiveShadows:e.receiveShadows,receiveAmbientOcclusion:e.receiveAmbientOcclusion,textureId:B?.id,colorMixMode:e.colorMixMode,normalTextureId:e.normalTexture!=null&&m?i.get(e.normalTexture).id:void 0,textureAlphaPremultiplied:B!=null&&!!B.parameters.preMultiplyAlpha,occlusionTextureId:e.occlusionTexture!=null&&m?i.get(e.occlusionTexture).id:void 0,emissiveTextureId:e.emissiveTexture!=null&&m?i.get(e.emissiveTexture).id:void 0,metallicRoughnessTextureId:e.metallicRoughnessTexture!=null&&m?i.get(e.metallicRoughnessTexture).id:void 0,emissiveBaseColor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],mrrFactors:L?pe:[e.metallicFactor,e.roughnessFactor,o.mrrFactors[2]],isSchematic:L,colorTextureTransformMatrix:v(e.colorTextureTransform),normalTextureTransformMatrix:v(e.normalTextureTransform),scale:[V[0],V[1]],occlusionTextureTransformMatrix:v(e.occlusionTextureTransform),emissiveTextureTransformMatrix:v(e.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:v(e.metallicRoughnessTextureTransform),...c},a))}const y=f.get(x);if(s.stageResources.materials.push(y),m){const d=b=>{b!=null&&s.stageResources.textures.push(i.get(b))};d(e.colorTexture),d(e.normalTexture),d(e.occlusionTexture),d(e.emissiveTexture),d(e.metallicRoughnessTexture)}return y}function je(t,r){const s=t.attributes.position.count,o=Be(t.indices||s,t.primitiveType),c=A(3*s),{typedBuffer:f,typedBufferStride:i}=t.attributes.position;$e(c,f,t.transform,3,i);const a=[["position",new M(c,o,3,!0)]];if(t.attributes.normal!=null){const e=A(3*s),{typedBuffer:n,typedBufferStride:l}=t.attributes.normal;oe(R,t.transform),Me(e,n,R,3,l),j(R)&&H(e,e),a.push(["normal",new M(e,o,3,!0)])}if(t.attributes.tangent!=null){const e=A(4*s),{typedBuffer:n,typedBufferStride:l}=t.attributes.tangent;se(R,t.transform),ve(e,n,R,4,l),j(R)&&H(e,e,4),a.push(["tangent",new M(e,o,4,!0)])}if(t.attributes.texCoord0!=null){const e=A(2*s),{typedBuffer:n,typedBufferStride:l}=t.attributes.texCoord0;Se(e,n,2,l),a.push(["uv0",new M(e,o,2,!0)])}const u=t.attributes.color;if(u!=null){const e=new Uint8Array(4*s);u.elementCount===4?u instanceof N?q(e,u,1,255):(u instanceof be||u instanceof ye)&&q(e,u,1/255,255):(e.fill(255),u instanceof K?W(e,u.typedBuffer,1,255,4,u.typedBufferStride):(t.attributes.color instanceof we||t.attributes.color instanceof Re)&&W(e,u.typedBuffer,1/255,255,4,t.attributes.color.typedBufferStride)),a.push(["color",new M(e,o,4,!0)])}return{geometry:new he(r,a),vertexCount:s}}const R=G();function De(t){switch(t){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}function Ue(t,r){for(let s=0;s<t.model.lods.length;++s){const o=t.model.lods[s];for(const c of o.parts){const f=c.attributes.normal;if(f==null)return;const i=c.attributes.position,a=i.count,u=O(),e=O(),n=O(),l=new Float32Array(4*a),p=new Float32Array(3*a),h=ne(ie(),c.transform);let x=0,m=0;for(let T=0;T<a;T++){i.getVec(T,e),f.getVec(T,u),U(e,e,c.transform),le(n,e,r.center),k(n,n,r.radius);const g=n[2],y=ue(n),d=Math.min(.45+.55*y*y,1)**te;k(n,n,r.radius),h!==null&&U(n,n,h),ce(n,n),s+1!==t.model.lods.length&&t.model.lods.length>1&&me(n,n,u,g>-1?.2:Math.min(-4*g-3.8,1)),p[x]=n[0],p[x+1]=n[1],p[x+2]=n[2],x+=3,l[m]=d,l[m+1]=d,l[m+2]=d,l[m+3]=1,m+=4}c.attributes.normal=new K(p.buffer),c.attributes.color=new N(l.buffer)}}}const lt=Object.freeze(Object.defineProperty({__proto__:null,fetch:Ce,parseUrl:Q},Symbol.toStringTag,{value:"Module"}));export{lt as o,v as s,Ce as z};
